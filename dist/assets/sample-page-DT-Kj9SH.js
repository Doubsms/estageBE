import{n as H,aD as V,aE as Y,t as G,r as u,Z as se,j as r,B as k,s as y,w as le,T as x,D as ie,I as ce,L as ue,G as C,H as de,Y as a,C as pe}from"./index-zHPv1lze.js";import{D as F}from"./Delete-CAb5w4Qm.js";import{a as d}from"./index-C3O71W1x.js";import{F as T,S as L}from"./Select-DCG_CkE0.js";import{I as z}from"./OutlinedInput-C5vYvqQm.js";import{M}from"./MenuItem-D-1uk7AZ.js";import{A as O}from"./Alert-D6te_eKs.js";import{A as he}from"./Archive-D2QOqqZQ.js";import{B as ge}from"./Button-0T1tR8_c.js";import"./useFormControl-BwsGWz84.js";import"./Close-DS868zx3.js";import"./ButtonGroupButtonContext-BYVHV5Ft.js";var I={},U;function xe(){if(U)return I;U=1;var i=H();Object.defineProperty(I,"__esModule",{value:!0}),I.default=void 0;var f=i(V()),t=Y();return I.default=(0,f.default)((0,t.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload"),I}var me=xe();const _=G(me);var j={},W;function fe(){if(W)return j;W=1;var i=H();Object.defineProperty(j,"__esModule",{value:!0}),j.default=void 0;var f=i(V()),t=Y();return j.default=(0,f.default)((0,t.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),j}var be=fe();const q=G(be),ve=y(pe)(({theme:i})=>({maxWidth:500,margin:"20px auto",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",borderRadius:"16px",boxShadow:"0 10px 30px rgba(0,0,0,0.2)",position:"relative",overflow:"visible"})),w=y(ge)(({theme:i})=>({background:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:"25px",padding:"10px 20px",margin:"8px",fontWeight:"bold",textTransform:"none","&:hover":{background:"rgba(255,255,255,0.3)",transform:"scale(1.05)"},transition:"all 0.3s ease"})),Ie=y(k)(({theme:i})=>({border:"2px dashed rgba(255,255,255,0.3)",borderRadius:"12px",padding:"20px",textAlign:"center",cursor:"pointer",transition:"all 0.3s ease",backgroundColor:"rgba(255,255,255,0.05)",marginBottom:"16px","&:hover":{backgroundColor:"rgba(255,255,255,0.1)",borderColor:"rgba(255,255,255,0.5)"}})),Se=()=>{const[i,f]=u.useState([]),[t,Z]=u.useState(""),[s,R]=u.useState(""),[b,P]=u.useState(null),[D,E]=u.useState(0),[$,S]=u.useState(!1),[J,N]=u.useState([]),B=se.useRef(null),c="";u.useEffect(()=>{(async()=>{const n=localStorage.getItem("token");try{const o=await d.get(`${c}/listeplantrienal`,{headers:{Authorization:`Bearer ${n}`}});f(o.data)}catch(o){console.error("Erreur lors de la r√©cup√©ration des triennaux:",o),a.error("Erreur lors de la r√©cup√©ration des triennaux.")}})()},[]),u.useEffect(()=>{(async()=>{const n=localStorage.getItem("token");try{const o=await d.get(`${c}/getplanannuel`,{headers:{Authorization:`Bearer ${n}`}});N(o.data)}catch(o){console.error("Erreur lors de la r√©cup√©ration des plans annuels:",o)}})()},[]);const Q=()=>{if(!t)return[];const e=i.find(n=>n.IDPLAN===parseInt(t));return e?[e.ANNEE1,e.ANNEE2,e.ANNEE3].filter(n=>n!==0):[]},A=()=>!t||!s?null:J.find(e=>e.IDTRIENNAT===parseInt(t)&&e.ANNEE===parseInt(s)),K=e=>{if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/pdf"].includes(e.type)){a.error("Veuillez s√©lectionner un fichier Excel (.xlsx) ou PDF");return}if(e.size>10*1024*1024){a.error("Le fichier est trop volumineux (max 10MB)");return}P(e),a.info(`Fichier s√©lectionn√©: ${e.name}`)},X=async()=>{if(!t){a.error("Veuillez s√©lectionner un plan triennal");return}try{const e=localStorage.getItem("token"),n=await d.get(`${c}/telecharger-plantriennal`,{params:{triennal:t},headers:{Authorization:`Bearer ${e}`},responseType:"blob"}),o=i.find(h=>h.IDPLAN===parseInt(t)),g=`plan_triennal_${o.ANNEE1}-${o.ANNEE3}.xlsx`,m=window.URL.createObjectURL(new Blob([n.data])),l=document.createElement("a");l.href=m,l.setAttribute("download",g),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(m),a.success("Plan triennal t√©l√©charg√© avec succ√®s!")}catch(e){console.error("Erreur lors du t√©l√©chargement:",e),a.error("Cette fonctionnalit√© n'est pas encore impl√©ment√©e")}},ee=async()=>{if(!t||!s||!b){a.error("Veuillez s√©lectionner un plan triennal, une ann√©e et un fichier");return}S(!0),E(0);const e=new FormData;e.append("IDTRIENNAT",t),e.append("ANNEE",s),e.append("FICHIER",b);try{const n=localStorage.getItem("token"),o=A();let g;o?(g=await d.patch(`${c}/patchplanannuel/${o.IDPLANANNUEL}`,e,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"},onUploadProgress:l=>{const h=Math.round(l.loaded*100/l.total);E(h)}}),a.success("Plan annuel mis √† jour avec succ√®s!")):(g=await d.post(`${c}/uplaodplanannuel`,e,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"},onUploadProgress:l=>{const h=Math.round(l.loaded*100/l.total);E(h)}}),a.success("Plan annuel archiv√© avec succ√®s!"));const m=await d.get(`${c}/getplanannuel`,{headers:{Authorization:`Bearer ${n}`}});N(m.data),P(null),E(0)}catch(n){console.error("Erreur lors de l'archivage:",n),n.response&&n.response.data&&n.response.data.error?a.error(`Erreur: ${n.response.data.error}`):a.error("Erreur lors de l'archivage du plan annuel")}finally{S(!1)}},re=async()=>{if(!t||!s){a.error("Veuillez s√©lectionner un plan triennal et une ann√©e");return}const e=A();if(!e){a.error("Aucun plan annuel trouv√© pour cette ann√©e");return}try{const n=localStorage.getItem("token"),o=await d.get(`${c}/uploads/${e.FICHIER}`,{headers:{Authorization:`Bearer ${n}`},responseType:"blob"}),g=i.find(oe=>oe.IDPLAN===parseInt(t)),m=e.FICHIER.split(".").pop(),l=`plan_annuel_${s}_${g.ANNEE1}-${g.ANNEE3}.${m}`,h=window.URL.createObjectURL(new Blob([o.data])),v=document.createElement("a");v.href=h,v.setAttribute("download",l),document.body.appendChild(v),v.click(),v.remove(),window.URL.revokeObjectURL(h),a.success("Plan annuel t√©l√©charg√© avec succ√®s!")}catch(n){console.error("Erreur lors du t√©l√©chargement:",n),a.error("Erreur lors du t√©l√©chargement du plan annuel")}},ne=async()=>{if(!t||!s){a.error("Veuillez s√©lectionner un plan triennal et une ann√©e");return}const e=A();if(!e){a.error("Aucun plan annuel trouv√© pour cette ann√©e");return}try{const n=localStorage.getItem("token");await d.delete(`${c}/deleteplanannuel/${e.IDPLANANNUEL}`,{headers:{Authorization:`Bearer ${n}`}});const o=await d.get(`${c}/getplanannuel`,{headers:{Authorization:`Bearer ${n}`}});N(o.data),a.success("Plan annuel supprim√© avec succ√®s!")}catch(n){console.error("Erreur lors de la suppression:",n),a.error("Erreur lors de la suppression du plan annuel")}},te=()=>{B.current?.click()},ae=()=>{P(null)},p=A();return r.jsxs(k,{sx:{padding:2},children:[r.jsx(ve,{children:r.jsxs(le,{sx:{textAlign:"center",padding:3},children:[r.jsx(x,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold",marginBottom:3},children:"üìã Gestion des Plans"}),r.jsxs(T,{fullWidth:!0,sx:{mb:2,backgroundColor:"rgba(255,255,255,0.1)",borderRadius:1},children:[r.jsx(z,{sx:{color:"white"},children:"Plan Triennal"}),r.jsx(L,{value:t,onChange:e=>{Z(e.target.value),R("")},label:"Plan Triennal",sx:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.3)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.5)"},"& .MuiSvgIcon-root":{color:"white"}},children:i.map(e=>r.jsx(M,{value:e.IDPLAN,children:`${e.ANNEE1} - ${e.ANNEE2} - ${e.ANNEE3}`},e.IDPLAN))})]}),r.jsx(w,{startIcon:r.jsx(_,{}),onClick:X,disabled:!t,fullWidth:!0,children:"T√©l√©charger Plan Triennal"}),r.jsx(ie,{sx:{my:2,backgroundColor:"rgba(255,255,255,0.3)"}}),r.jsx(x,{variant:"subtitle1",sx:{mb:2,fontWeight:"bold"},children:"Plan Annuel"}),r.jsxs(T,{fullWidth:!0,sx:{mb:2,backgroundColor:"rgba(255,255,255,0.1)",borderRadius:1},children:[r.jsx(z,{sx:{color:"white"},children:"Ann√©e"}),r.jsx(L,{value:s,onChange:e=>R(e.target.value),label:"Ann√©e",disabled:!t,sx:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.3)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.5)"},"& .MuiSvgIcon-root":{color:"white"}},children:Q().map(e=>r.jsx(M,{value:e,children:e},e))})]}),s&&p&&r.jsxs(O,{severity:"success",sx:{marginBottom:2,backgroundColor:"rgba(76,175,80,0.2)",color:"white","& .MuiAlert-icon":{color:"white"}},children:["Plan annuel disponible pour ",s]}),r.jsxs(Ie,{onClick:te,children:[r.jsx(q,{sx:{fontSize:32,marginBottom:1,opacity:.8}}),r.jsx(x,{variant:"body2",sx:{marginBottom:1},children:p?"Remplacer le fichier":"S√©lectionner un fichier"}),r.jsx(x,{variant:"caption",sx:{opacity:.7},children:"Formats: .xlsx, .pdf (max 10MB)"})]}),r.jsx("input",{type:"file",ref:B,style:{display:"none"},accept:".xlsx,.xls,.pdf",onChange:e=>{e.target.files.length>0&&K(e.target.files[0])}}),b&&r.jsx(O,{severity:"info",sx:{marginBottom:2,backgroundColor:"rgba(255,255,255,0.1)",color:"white","& .MuiAlert-icon":{color:"white"}},action:r.jsx(ce,{size:"small",onClick:ae,children:r.jsx(F,{sx:{color:"white"}})}),children:r.jsxs(k,{sx:{display:"flex",alignItems:"center"},children:[r.jsx(q,{sx:{marginRight:1}}),r.jsx(x,{variant:"body2",noWrap:!0,children:b.name})]})}),$&&r.jsxs(k,{sx:{width:"100%",marginBottom:2},children:[r.jsx(ue,{variant:"determinate",value:D,sx:{height:8,borderRadius:4,backgroundColor:"rgba(255,255,255,0.2)","& .MuiLinearProgress-bar":{backgroundColor:"#4CAF50"}}}),r.jsxs(x,{variant:"caption",sx:{opacity:.8},children:[D,"% ",p?"mis √† jour":"archiv√©"]})]}),r.jsxs(C,{container:!0,spacing:1,sx:{mt:1},children:[r.jsx(C,{item:!0,xs:4,children:r.jsx(w,{startIcon:r.jsx(he,{}),onClick:ee,disabled:!t||!s||!b||$,fullWidth:!0,size:"small",children:p?"Mettre √† jour":"Archiver"})}),r.jsx(C,{item:!0,xs:4,children:r.jsx(w,{startIcon:r.jsx(_,{}),onClick:re,disabled:!t||!s||!p,fullWidth:!0,size:"small",children:"T√©l√©charger"})}),r.jsx(C,{item:!0,xs:4,children:r.jsx(w,{startIcon:r.jsx(F,{}),onClick:ne,disabled:!t||!s||!p,fullWidth:!0,size:"small",sx:{background:"rgba(244,67,54,0.2)","&:hover":{background:"rgba(244,67,54,0.3)"}},children:"Supprimer"})})]}),r.jsx(x,{variant:"caption",sx:{display:"block",marginTop:2,opacity:.7,lineHeight:1.4},children:p?`Plan disponible pour ${s} - Fichier: ${p.FICHIER}`:"S√©lectionnez un plan triennal et une ann√©e pour g√©rer les plans annuels"})]})}),r.jsx(de,{position:"bottom-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})};export{Se as default};
