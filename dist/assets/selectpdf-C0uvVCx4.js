import{l as g,j as e,r as c,B as a,C as ie,T as i,v as L,w as ae,N as ce,x as F,U as le,aX as de,I as k,L as fe,Z as pe}from"./index-zHPv1lze.js";import{C as me}from"./CircularProgress-BHFhENdB.js";import{U as he}from"./Upload-C6xz4iyc.js";import{D as V}from"./Description-Dd72SfDg.js";import{A as q}from"./Alert-D6te_eKs.js";import{B as P}from"./Button-0T1tR8_c.js";import{C as ue}from"./Close-B5GqWx1j.js";import{L as xe}from"./ListItem-CSuwil7H.js";import{D as ge}from"./Delete-DRqEtRSt.js";import{D as ve}from"./Download-CCo6S7zV.js";import{a as je,D as be}from"./DialogContent-COvIddmc.js";import{D as ye}from"./DialogTitle-CCgKuUmv.js";import{D as we}from"./DialogActions-CZ9LuKoL.js";import{S as De}from"./Snackbar-XurLPfxZ.js";import"./Close-DS868zx3.js";import"./ButtonGroupButtonContext-BYVHV5Ft.js";const Ce=g(e.jsx("path",{d:"m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"}),"ArrowDownward"),Fe=g(e.jsx("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"}),"ArrowUpward"),Pe=g(e.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"ErrorOutline"),U=g(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),ze=g(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link"),A=g(e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5zm4-3H19v1h1.5V11H19v2h-1.5V7h3zM9 9.5h1v-1H9zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm10 5.5h1v-3h-1z"}),"PictureAsPdf"),Ie=pe.forwardRef(function(f,p){return e.jsx(q,{elevation:6,ref:p,variant:"filled",...f})}),$e=()=>{const[t,f]=c.useState([]),[p,j]=c.useState(!1),[b,H]=c.useState(!1),[R,l]=c.useState(""),[z,I]=c.useState(!1),[G,y]=c.useState(!1),[N,W]=c.useState(!1),[$,X]=c.useState(""),w=c.useRef(null);c.useEffect(()=>{const o=document.createElement("script");return o.src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js",o.onload=()=>console.log("PDFLib.js chargé"),document.head.appendChild(o),()=>{document.head.removeChild(o)}},[]);const M=async o=>{const s=Array.from(o).filter(n=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/gif","image/bmp","image/webp"].includes(n.type));if(s.length===0){l("Veuillez sélectionner des fichiers PDF, Word ou images valides.");return}H(!0),l("");try{const n=await Promise.all(s.map(async r=>{if(r.type==="application/pdf")return{file:r,name:r.name,type:"pdf",id:Date.now()+Math.random()};if(r.type.startsWith("image")){const v=await _(r);return{file:new File([v],`${r.name.split(".")[0]}.pdf`,{type:"application/pdf"}),name:`${r.name.split(".")[0]}.pdf`,originalName:r.name,type:"image",id:Date.now()+Math.random()}}else return{file:r,name:r.name,type:"document",id:Date.now()+Math.random(),requiresConversion:!0}}));f(r=>[...r,...n]),s.some(r=>r.type.includes("word"))&&(X("Les documents Word nécessitent une conversion manuelle en PDF"),W(!0))}catch(n){console.error("Erreur de conversion:",n),l("Échec de la conversion des fichiers en PDF")}finally{H(!1)}},_=async o=>new Promise((s,n)=>{const r=new FileReader;r.onload=async v=>{try{const{PDFDocument:u}=window.PDFLib,d=await u.create(),x=d.addPage(),m=new Image;m.src=v.target.result,await new Promise(te=>{m.onload=te});const h=document.createElement("canvas"),D=h.getContext("2d");h.width=m.width,h.height=m.height,D.drawImage(m,0,0);const S=await d.embedPng(h.toDataURL("image/png")),{width:C,height:T}=S.scale(1);x.setSize(C,T),x.drawImage(S,{x:0,y:0,width:C,height:T});const ne=await d.save();s(new Blob([ne],{type:"application/pdf"}))}catch(u){n(u)}},r.readAsDataURL(o)}),J=o=>{M(o.target.files),w.current&&(w.current.value="")},Z=o=>{o.preventDefault(),I(!1),M(o.dataTransfer.files)},K=o=>{o.preventDefault(),I(!0)},O=()=>{I(!1)},Q=o=>{f(t.filter(s=>s.id!==o))},B=(o,s)=>{const n=t.findIndex(r=>r.id===o);if(s==="up"&&n>0){const r=[...t];[r[n],r[n-1]]=[r[n-1],r[n]],f(r)}if(s==="down"&&n<t.length-1){const r=[...t];[r[n],r[n+1]]=[r[n+1],r[n]],f(r)}},Y=async(o,s)=>{try{const{PDFDocument:n}=window.PDFLib,r=await n.load(o);return{numPages:r.getPageCount(),pdfDoc:r}}catch(n){return console.error(`Erreur lors de la lecture du PDF: ${s}`,n),null}},ee=async()=>{if(t.length===0){l("Aucun fichier à fusionner.");return}if(t.filter(s=>s.requiresConversion).length>0){y(!0);return}j(!0),l("");try{const{PDFDocument:s}=window.PDFLib,n=await s.create();for(const x of t){const m=await x.file.arrayBuffer(),h=await Y(m,x.name);if(!h){l(`Échec de la lecture du fichier : ${x.name}`),j(!1);return}const{pdfDoc:D}=h;(await n.copyPages(D,D.getPageIndices())).forEach(C=>n.addPage(C))}const r=await n.save(),v=new Blob([r],{type:"application/pdf"}),u=URL.createObjectURL(v),d=document.createElement("a");d.href=u,d.download=`fusion_${new Date().toLocaleDateString("fr-FR").replace(/\//g,"-")}.pdf`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(u),j(!1)}catch(s){console.error("Erreur lors de la fusion:",s),l(`Échec de la fusion des PDF : ${s.message}`),j(!1)}},oe=()=>{f([]),l("")},re=o=>o==="pdf"?e.jsx(A,{}):o==="image"?e.jsx(U,{}):e.jsx(V,{}),E=(o,s)=>{s!=="clickaway"&&W(!1)},se=()=>{f(t.filter(o=>!o.requiresConversion)),y(!1)};return e.jsxs(a,{sx:{maxWidth:"md",mx:"auto",p:3,bgcolor:"#fafafa",minHeight:"100vh",fontFamily:"Roboto, sans-serif"},children:[e.jsxs(ie,{sx:{borderRadius:3,overflow:"hidden",boxShadow:"0 8px 24px rgba(0,0,0,0.05)",bgcolor:"white"},children:[e.jsxs(a,{sx:{bgcolor:"#e3f2fd",color:"#1976d2",p:3,textAlign:"center",borderBottom:"1px solid #e0e0e0"},children:[e.jsx(A,{sx:{fontSize:48,mb:1,color:"#42a5f5"}}),e.jsx(i,{variant:"h5",fontWeight:"500",children:"Fusionneur de fichiers"}),e.jsx(i,{variant:"body2",sx:{mt:1,color:"#616161"},children:"Glissez-déposez ou sélectionnez des PDF, Word ou images"})]}),e.jsxs(a,{onDrop:Z,onDragOver:K,onDragLeave:O,sx:{p:5,textAlign:"center",border:2,borderColor:z?"#42a5f5":"#e0e0e0",borderStyle:"dashed",borderRadius:2,cursor:"pointer",transition:"all 0.2s ease",bgcolor:z?"#f5fbff":"#fafafa",m:3,"&:hover":{borderColor:"#90caf9",bgcolor:"#f5fbff"},position:"relative"},onClick:()=>w.current?.click(),children:[b&&e.jsx(a,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(255,255,255,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10},children:e.jsx(me,{size:60})}),e.jsx(he,{sx:{fontSize:48,color:"#90caf9",mb:2}}),e.jsx(i,{variant:"h6",color:"#42a5f5",gutterBottom:!0,children:z?"Déposez les fichiers ici":"Glissez-déposez vos fichiers ici"}),e.jsx(i,{color:"#757575",sx:{mb:2},children:"Formats supportés: PDF, DOC, DOCX, JPG, PNG, GIF"}),e.jsxs(a,{sx:{display:"flex",justifyContent:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(L,{label:"PDF",icon:e.jsx(A,{}),variant:"outlined",size:"small"}),e.jsx(L,{label:"Word",icon:e.jsx(V,{}),variant:"outlined",size:"small"}),e.jsx(L,{label:"Images",icon:e.jsx(U,{}),variant:"outlined",size:"small"})]}),e.jsx("input",{ref:w,type:"file",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif",multiple:!0,onChange:J,style:{display:"none"}})]}),R&&e.jsx(q,{severity:"error",sx:{m:3,bgcolor:"#ffebee"},onClose:()=>l(""),children:R}),t.length>0&&e.jsxs(ae,{sx:{pt:0},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,px:2},children:[e.jsxs(i,{variant:"subtitle1",color:"#424242",fontWeight:"500",children:["Fichiers à fusionner (",t.length,")"]}),e.jsx(P,{onClick:oe,size:"small",color:"inherit",variant:"outlined",startIcon:e.jsx(ue,{}),sx:{color:"#757575",borderColor:"#e0e0e0"},children:"Tout effacer"})]}),e.jsx(ce,{sx:{maxHeight:300,overflow:"auto"},children:t.map((o,s)=>e.jsx(xe,{sx:{border:"1px solid #f5f5f5",borderRadius:2,mb:1,bgcolor:"#fafafa",transition:"all 0.2s","&:hover":{bgcolor:"#f5f5f5"},px:2,py:1},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(a,{sx:{color:o.requiresConversion?"#f57c00":"#90caf9",mr:2},children:[re(o.type),o.requiresConversion&&e.jsx(F,{title:"Nécessite conversion en PDF",children:e.jsx(Pe,{sx:{color:"#f57c00",fontSize:16,position:"absolute",ml:-1,mt:-1}})})]}),e.jsx(le,{primary:e.jsxs(a,{children:[e.jsx(i,{variant:"body1",color:"#424242",sx:{fontWeight:500},children:o.name}),o.originalName&&e.jsxs(i,{variant:"caption",color:"#9e9e9e",children:["Original: ",o.originalName]})]}),secondary:e.jsx(i,{variant:"body2",color:o.requiresConversion?"#f57c00":"#9e9e9e",children:o.requiresConversion?"Conversion en PDF requise":o.type==="pdf"?"PDF prêt":"Converti en PDF"}),sx:{flexGrow:1}}),e.jsxs(de,{sx:{right:8},children:[e.jsx(F,{title:"Monter",children:e.jsx(k,{size:"small",onClick:()=>B(o.id,"up"),disabled:s===0,sx:{color:s===0?"#e0e0e0":"#757575",mr:1,"&:hover":{bgcolor:"#e3f2fd"}},children:e.jsx(Fe,{fontSize:"small"})})}),e.jsx(F,{title:"Descendre",children:e.jsx(k,{size:"small",onClick:()=>B(o.id,"down"),disabled:s===t.length-1,sx:{color:s===t.length-1?"#e0e0e0":"#757575",mr:1,"&:hover":{bgcolor:"#e3f2fd"}},children:e.jsx(Ce,{fontSize:"small"})})}),e.jsx(F,{title:"Supprimer",children:e.jsx(k,{edge:"end",onClick:()=>Q(o.id),sx:{color:"#757575","&:hover":{color:"#f44336",bgcolor:"#ffebee"}},children:e.jsx(ge,{fontSize:"small"})})})]})]})},o.id))})]}),t.length>0&&e.jsx(a,{sx:{p:3,textAlign:"center",bgcolor:"#fafafa",borderTop:"1px solid #f5f5f5"},children:e.jsx(P,{variant:"contained",color:"primary",startIcon:!p&&e.jsx(ve,{}),onClick:ee,disabled:p||b,sx:{px:4,py:1.5,fontWeight:"500",fontSize:"1rem",borderRadius:2,bgcolor:"#42a5f5",boxShadow:"none","&:hover":{bgcolor:"#1976d2",boxShadow:"0 2px 8px rgba(25, 118, 210, 0.3)"},minWidth:250},children:p?"Fusion en cours...":"Fusionner et Télécharger"})}),(p||b)&&e.jsxs(a,{sx:{p:2,bgcolor:"#fafafa"},children:[e.jsx(fe,{color:"primary"}),e.jsx(i,{variant:"body2",color:"#757575",textAlign:"center",sx:{mt:1},children:b?"Conversion des fichiers...":"Fusion des fichiers en cours..."})]})]}),!p&&t.length===0&&e.jsx(i,{variant:"body1",color:"#9e9e9e",textAlign:"center",sx:{mt:3,fontStyle:"italic"},children:"Aucun fichier sélectionné"}),e.jsxs(je,{open:G,onClose:()=>y(!1),children:[e.jsx(ye,{children:"Conversion requise pour les documents Word"}),e.jsxs(be,{children:[e.jsx(i,{variant:"body1",gutterBottom:!0,children:"Les documents Word doivent être convertis en PDF avant la fusion."}),e.jsx(i,{variant:"body1",gutterBottom:!0,children:"Pour convertir vos documents Word :"}),e.jsxs(a,{component:"ul",sx:{pl:3,mb:2},children:[e.jsx("li",{children:"Ouvrez votre document dans Microsoft Word"}),e.jsx("li",{children:'Cliquez sur "Fichier" → "Exporter" → "Créer un document PDF/XPS"'}),e.jsx("li",{children:"Enregistrez le fichier PDF"}),e.jsx("li",{children:"Ajoutez le fichier PDF converti à cette application"})]}),e.jsxs(i,{variant:"body1",color:"primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ze,{sx:{mr:1}}),e.jsx("a",{href:"https://support.microsoft.com/fr-fr/office/enregistrer-ou-convertir-en-pdf-ou-xps-dans-project-desktop-0e604630-6f1d-4e6e-963e-f88b28b4bee0",target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2"},children:"Guide complet de conversion"})]})]}),e.jsxs(we,{children:[e.jsx(P,{onClick:()=>y(!1),color:"primary",children:"Compris"}),e.jsx(P,{onClick:se,color:"primary",variant:"contained",children:"Supprimer les fichiers Word"})]})]}),e.jsx(De,{open:N,autoHideDuration:6e3,onClose:E,children:e.jsx(Ie,{onClose:E,severity:"info",sx:{width:"100%"},children:$})})]})};export{$e as default};
