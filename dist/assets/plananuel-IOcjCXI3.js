import{l as D,j as e,r as i,u as ce,E as de,B as u,H as ue,J as v,z as I,A as N,T as p,D as pe,G as j,y as o,v as he,V as W,I as xe,L as fe,Y as t,C as ge}from"./index-zHPv1lze.js";import{a as f}from"./index-C3O71W1x.js";import{C as me}from"./Container-iQUVt9w4.js";import{H as be}from"./History-CpgLUztO.js";import{C as je}from"./CalendarToday-BYxDq_1X.js";import{F as H,S as V}from"./Select-DCG_CkE0.js";import{I as _}from"./OutlinedInput-C5vYvqQm.js";import{M as O}from"./MenuItem-D-1uk7AZ.js";import{B as P}from"./Button-0T1tR8_c.js";import{D as ve}from"./Description-Dd72SfDg.js";import{C as G}from"./CheckCircle-BB09QyVE.js";import{A as ye}from"./Alert-D6te_eKs.js";import{U as Ie}from"./Upload-C6xz4iyc.js";import{A as Ae}from"./index-voob9auG.js";import{A as Ee}from"./Archive-D2QOqqZQ.js";import{D as Ce}from"./Delete-DRqEtRSt.js";import{I as we}from"./Info-BG_pDBBb.js";const Ne=D(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),Y=D(e.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload"),Pe=D(e.jsx("path",{d:"M15 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V7zM6 20V4h8v4h4v12zm10-10v5c0 2.21-1.79 4-4 4s-4-1.79-4-4V8.5c0-1.47 1.26-2.64 2.76-2.49 1.3.13 2.24 1.32 2.24 2.63V15h-2V8.5c0-.28-.22-.5-.5-.5s-.5.22-.5.5V15c0 1.1.9 2 2 2s2-.9 2-2v-5z"}),"FilePresent");v(ge);v(I);const ke=()=>{const[A,Q]=i.useState([]),[s,q]=i.useState(""),[c,$]=i.useState(""),[d,k]=i.useState(null),[T,E]=i.useState(0),[L,F]=i.useState(!1),[J,z]=i.useState([]),[R,S]=i.useState(!1),B=i.useRef(null),h="",K=ce();de(K.breakpoints.down("sm")),i.useEffect(()=>{(async()=>{const n=localStorage.getItem("token");try{const a=await f.get(`${h}/listeplantrienal`,{headers:{Authorization:`Bearer ${n}`}});Q(a.data)}catch(a){console.error("Erreur lors de la r√©cup√©ration des triennaux:",a),t.error("Erreur lors de la r√©cup√©ration des triennaux.")}})()},[]),i.useEffect(()=>{(async()=>{const n=localStorage.getItem("token");try{const a=await f.get(`${h}/getplanannuel`,{headers:{Authorization:`Bearer ${n}`}});z(a.data)}catch(a){console.error("Erreur lors de la r√©cup√©ration des plans annuels:",a)}})()},[]);const X=()=>{if(!s)return[];const r=A.find(n=>n.IDPLAN===parseInt(s));return r?[r.ANNEE1,r.ANNEE2,r.ANNEE3].filter(Boolean):[]},C=()=>!s||!c?null:J.find(r=>r.IDTRIENNAT===parseInt(s)&&r.ANNEE===parseInt(c)),U=r=>{if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/pdf"].includes(r.type)){t.error("Veuillez s√©lectionner un fichier Excel (.xlsx) ou PDF");return}if(r.size>10*1024*1024){t.error("Le fichier est trop volumineux (max 10MB)");return}k(r),t.success(`Fichier s√©lectionn√© : ${r.name}`)},Z=r=>{r.preventDefault(),S(!0)},ee=()=>{S(!1)},re=r=>{r.preventDefault(),S(!1);const n=r.dataTransfer.files[0];n&&U(n)},ne=async()=>{if(!s){t.error("Veuillez s√©lectionner un plan triennal");return}const r=A.find(n=>n.IDPLAN===parseInt(s));if(!r||!r.FICHIERPLAN){t.error("Aucun fichier associ√© √† ce plan triennal");return}try{const n=localStorage.getItem("token"),a=await f.get(`${h}/uploads/${r.FICHIERPLAN}`,{headers:{Authorization:`Bearer ${n}`},responseType:"blob"}),b=r.FICHIERPLAN.split(".").pop()||"xlsx",x=`plan_triennal_${r.ANNEE1}-${r.ANNEE3}.${b}`,g=window.URL.createObjectURL(new Blob([a.data])),m=document.createElement("a");m.href=g,m.setAttribute("download",x),document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(g),t.success("Plan triennal t√©l√©charg√© avec succ√®s !")}catch(n){console.error("Erreur lors du t√©l√©chargement:",n),t.error("Erreur lors du t√©l√©chargement du plan triennal")}},oe=async()=>{if(!s||!c||!d){t.error("Veuillez s√©lectionner un plan triennal, une ann√©e et un fichier");return}F(!0),E(0);const r=new FormData;r.append("IDTRIENNAT",s),r.append("ANNEE",c),r.append("FICHIER",d);try{const n=localStorage.getItem("token"),a=C();a?(await f.patch(`${h}/patchplanannuel/${a.IDPLANANNUEL}`,r,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"},onUploadProgress:x=>{const g=Math.round(x.loaded*100/x.total);E(g)}}),t.success("Plan annuel mis √† jour avec succ√®s !")):(await f.post(`${h}/uplaodplanannuel`,r,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"},onUploadProgress:x=>{const g=Math.round(x.loaded*100/x.total);E(g)}}),t.success("Plan annuel archiv√© avec succ√®s !"));const b=await f.get(`${h}/getplanannuel`,{headers:{Authorization:`Bearer ${n}`}});z(b.data),k(null),E(0)}catch(n){console.error("Erreur lors de l'archivage:",n),t.error("Erreur lors de l'archivage du plan annuel")}finally{F(!1)}},te=async()=>{const r=C();if(!r){t.error("Aucun plan annuel trouv√© pour cette ann√©e");return}try{const n=localStorage.getItem("token"),a=await f.get(`${h}/uploads/${r.FICHIER}`,{headers:{Authorization:`Bearer ${n}`},responseType:"blob"}),b=A.find(ie=>ie.IDPLAN===parseInt(s)),x=r.FICHIER.split(".").pop()||"pdf",g=`plan_annuel_${c}_${b.ANNEE1}-${b.ANNEE3}.${x}`,m=window.URL.createObjectURL(new Blob([a.data])),y=document.createElement("a");y.href=m,y.setAttribute("download",g),document.body.appendChild(y),y.click(),y.remove(),window.URL.revokeObjectURL(m),t.success("Plan annuel t√©l√©charg√© avec succ√®s !")}catch(n){console.error("Erreur lors du t√©l√©chargement:",n),t.error("Erreur lors du t√©l√©chargement du plan annuel")}},ae=async()=>{const r=C();if(!r){t.error("Aucun plan annuel trouv√© pour cette ann√©e");return}if(window.confirm("√ätes-vous s√ªr de vouloir supprimer ce plan annuel ?"))try{const n=localStorage.getItem("token");await f.delete(`${h}/deleteplanannuel/${r.IDPLANANNUEL}`,{headers:{Authorization:`Bearer ${n}`}});const a=await f.get(`${h}/getplanannuel`,{headers:{Authorization:`Bearer ${n}`}});z(a.data),t.success("Plan annuel supprim√© avec succ√®s !")}catch(n){console.error("Erreur lors de la suppression:",n),t.error("Erreur lors de la suppression du plan annuel")}},se=()=>B.current?.click(),le=()=>k(null),l=C(),M=X(),w=r=>{switch(r?.split(".").pop()?.toLowerCase()){case"pdf":return"#f44336";case"xls":case"xlsx":return"#4caf50";default:return"#1976d2"}};return e.jsxs(u,{sx:{width:"100%",minHeight:"100vh",bgcolor:"#f8faff",py:4},children:[e.jsx(ue,{position:"top-right",autoClose:3e3}),e.jsx(me,{maxWidth:"lg",children:e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(I,{elevation:0,sx:{p:{xs:3,md:5},borderRadius:4,background:"linear-gradient(145deg, #ffffff 0%, #f8faff 100%)",boxShadow:"0 10px 40px rgba(0,0,0,0.03)",border:"1px solid",borderColor:"rgba(25, 118, 210, 0.1)",position:"relative",overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"4px",background:"linear-gradient(90deg, #1976d2, #64b5f6, #1976d2)"}},children:[e.jsxs(u,{display:"flex",alignItems:"center",mb:4,children:[e.jsx(N,{sx:{width:70,height:70,background:"linear-gradient(135deg, #1976d2 0%, #64b5f6 100%)",boxShadow:"0 10px 20px rgba(25, 118, 210, 0.2)",mr:3},children:e.jsx(be,{sx:{fontSize:32,color:"white"}})}),e.jsxs(u,{children:[e.jsx(p,{variant:"h4",fontWeight:"700",color:"#1a237e",gutterBottom:!0,children:"Gestion des Plans"}),e.jsx(p,{variant:"body1",color:"text.secondary",sx:{maxWidth:600},children:"Archivez, mettez √† jour et g√©rez vos plans triennaux et annuels"})]})]}),e.jsx(pe,{sx:{mb:4,borderColor:"rgba(25, 118, 210, 0.1)"}}),e.jsxs(j,{container:!0,spacing:4,children:[e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(v.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.2},children:e.jsxs(I,{elevation:0,sx:{p:3,borderRadius:3,border:"1px solid",borderColor:"rgba(25, 118, 210, 0.1)",bgcolor:o("#1976d2",.02),height:"100%"},children:[e.jsxs(u,{display:"flex",alignItems:"center",mb:3,children:[e.jsx(N,{sx:{width:40,height:40,bgcolor:o("#1976d2",.1),color:"#1976d2",mr:2},children:e.jsx(je,{sx:{fontSize:20}})}),e.jsx(p,{variant:"h6",fontWeight:"600",color:"#1a237e",children:"Plan Triennal"})]}),e.jsxs(H,{fullWidth:!0,size:"small",sx:{mb:2},children:[e.jsx(_,{sx:{color:"#666"},children:"S√©lectionner un plan triennal"}),e.jsx(V,{value:s,onChange:r=>{q(r.target.value),$("")},label:"S√©lectionner un plan triennal",sx:{borderRadius:2},children:A.map(r=>e.jsx(O,{value:r.IDPLAN,children:`${r.ANNEE1} ‚Äì ${r.ANNEE2} ‚Äì ${r.ANNEE3}`},r.IDPLAN))})]}),e.jsx(P,{variant:"contained",startIcon:e.jsx(Y,{}),onClick:ne,disabled:!s,fullWidth:!0,sx:{py:1.5,background:"linear-gradient(45deg, #1976d2 30%, #64b5f6 90%)",boxShadow:"0 3px 10px rgba(25, 118, 210, 0.2)",borderRadius:2,textTransform:"none","&:hover":{background:"linear-gradient(45deg, #1565c0 30%, #42a5f5 90%)"}},children:"T√©l√©charger le plan triennal"})]})})}),e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(v.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.3},children:e.jsxs(I,{elevation:0,sx:{p:3,borderRadius:3,border:"1px solid",borderColor:l?"rgba(76, 175, 80, 0.2)":"rgba(25, 118, 210, 0.1)",bgcolor:l?o("#4caf50",.02):o("#1976d2",.02),height:"100%"},children:[e.jsxs(u,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(N,{sx:{width:40,height:40,bgcolor:l?o("#4caf50",.1):o("#1976d2",.1),color:l?"#4caf50":"#1976d2",mr:2},children:e.jsx(ve,{sx:{fontSize:20}})}),e.jsx(p,{variant:"h6",fontWeight:"600",color:"#1a237e",children:"Plan Annuel"})]}),l&&e.jsx(he,{icon:e.jsx(G,{}),label:"Archiv√©",size:"small",sx:{bgcolor:o("#4caf50",.1),color:"#4caf50",fontWeight:500}})]}),e.jsxs(H,{fullWidth:!0,size:"small",sx:{mb:2},children:[e.jsx(_,{children:"Ann√©e"}),e.jsx(V,{value:c,onChange:r=>$(r.target.value),label:"Ann√©e",disabled:!s||M.length===0,sx:{borderRadius:2},children:M.map(r=>e.jsx(O,{value:r,children:r},r))})]}),c&&l&&e.jsx(W,{in:!0,children:e.jsxs(ye,{icon:e.jsx(G,{}),severity:"success",sx:{mb:2,borderRadius:2,bgcolor:o("#4caf50",.1),color:"#2e7d32"},children:["Plan annuel disponible pour ",c]})}),e.jsxs(I,{elevation:0,onDragOver:Z,onDragLeave:ee,onDrop:re,onClick:se,sx:{p:2,border:"2px dashed",borderColor:R?"#1976d2":o("#1976d2",.2),borderRadius:2,bgcolor:R?o("#1976d2",.02):"transparent",transition:"all 0.3s ease",cursor:"pointer",textAlign:"center",mb:2,"&:hover":{borderColor:"#1976d2",bgcolor:o("#1976d2",.02)}},children:[e.jsx("input",{type:"file",ref:B,hidden:!0,accept:".xlsx,.xls,.pdf",onChange:r=>r.target.files[0]&&U(r.target.files[0])}),e.jsx(Ie,{sx:{fontSize:32,color:o("#1976d2",.5),mb:1}}),e.jsx(p,{variant:"body2",color:"text.primary",children:R?"D√©posez le fichier ici":"Glissez-d√©posez ou cliquez pour s√©lectionner"}),e.jsx(p,{variant:"caption",color:"text.secondary",children:"Formats : .xlsx, .pdf (max 10 Mo)"})]}),e.jsx(Ae,{children:d&&e.jsx(v.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2,p:1.5,bgcolor:o(w(d.name),.05),borderRadius:2,border:"1px solid",borderColor:o(w(d.name),.2)},children:[e.jsx(N,{sx:{width:40,height:40,bgcolor:o(w(d.name),.1),color:w(d.name),mr:1.5},children:e.jsx(Pe,{})}),e.jsxs(u,{sx:{flexGrow:1,minWidth:0},children:[e.jsx(p,{variant:"body2",fontWeight:"500",noWrap:!0,children:d.name}),e.jsxs(p,{variant:"caption",color:"text.secondary",children:[(d.size/1024).toFixed(2)," KB"]})]}),e.jsx(xe,{size:"small",onClick:le,children:e.jsx(Ne,{fontSize:"small"})})]})})}),L&&e.jsxs(u,{sx:{mb:2},children:[e.jsx(fe,{variant:"determinate",value:T,sx:{height:6,borderRadius:3,bgcolor:o("#1976d2",.1),"& .MuiLinearProgress-bar":{background:"linear-gradient(90deg, #1976d2, #64b5f6)",borderRadius:3}}}),e.jsxs(p,{variant:"caption",color:"text.secondary",sx:{textAlign:"center",mt:.5,display:"block"},children:[T,"% ",l?"mis √† jour":"archiv√©"]})]}),e.jsx(P,{variant:"contained",startIcon:e.jsx(Ee,{}),onClick:oe,disabled:!s||!c||!d||L,fullWidth:!0,sx:{py:1.5,mb:2,background:l?"linear-gradient(45deg, #ed6c02 30%, #ff9800 90%)":"linear-gradient(45deg, #1976d2 30%, #64b5f6 90%)",boxShadow:"0 3px 10px rgba(0,0,0,0.1)",borderRadius:2,textTransform:"none","&:hover":{background:l?"linear-gradient(45deg, #e65100 30%, #fb8c00 90%)":"linear-gradient(45deg, #1565c0 30%, #42a5f5 90%)"}},children:l?"Mettre √† jour le plan":"Archiver le plan"}),l&&e.jsxs(j,{container:!0,spacing:1,children:[e.jsx(j,{item:!0,xs:6,children:e.jsx(P,{variant:"outlined",startIcon:e.jsx(Y,{}),onClick:te,fullWidth:!0,sx:{py:1,borderColor:"#1976d2",color:"#1976d2",borderRadius:2,textTransform:"none","&:hover":{borderColor:"#1565c0",bgcolor:o("#1976d2",.02)}},children:"T√©l√©charger"})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(P,{variant:"outlined",color:"error",startIcon:e.jsx(Ce,{}),onClick:ae,fullWidth:!0,sx:{py:1,borderColor:"#d32f2f",color:"#d32f2f",borderRadius:2,textTransform:"none","&:hover":{borderColor:"#b71c1c",bgcolor:o("#d32f2f",.02)}},children:"Supprimer"})})]})]})})})]}),s&&c&&e.jsx(W,{in:!0,children:e.jsxs(u,{sx:{mt:3,p:2,bgcolor:o("#1976d2",.02),borderRadius:2,border:"1px solid",borderColor:o("#1976d2",.1),display:"flex",alignItems:"center"},children:[e.jsx(we,{sx:{color:o("#1976d2",.5),mr:1.5,fontSize:20}}),e.jsx(p,{variant:"body2",color:"text.secondary",children:l?`üìÑ Plan annuel archiv√© : ${l.FICHIER}`:"üì≠ Aucun plan annuel archiv√© pour cette ann√©e"})]})})]})})})]})},Ye=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"}));export{Ne as C,ke as G,Ye as p};
