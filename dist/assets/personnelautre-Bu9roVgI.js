import{r as l,j as e,G as b,B as s,s as y,w as z,T as t,C as S,v as U,R as oe,F as ne,x as ae,aB as ie,I as le,V as ce,Z as de}from"./index-zHPv1lze.js";import{a as M}from"./index-C3O71W1x.js";import{D as $,B as xe,S as ue,C as fe,E as he}from"./Store-C2vOdZMk.js";import{C as R}from"./CircularProgress-BHFhENdB.js";import{R as me}from"./Refresh-HvTEdGt2.js";import{A as be}from"./Assignment-jETtBEfQ.js";import{T as ge,a as pe,b as je,c as v,d as a,e as Se}from"./TableRow-70JfVjDg.js";import{B as ye}from"./Badge-Q2tdgUxH.js";import{W as H,P as ve,A as Ce,a as Ae}from"./Work-BOwzzg0q.js";import{L as Ie}from"./LocationOn-We7TmFLi.js";import{P as V}from"./People-RwhYgLWm.js";import{D as we}from"./DialogTitle-CCgKuUmv.js";import{S as Re}from"./Settings-B2J8IDH3.js";import{C as ke}from"./Close-B5GqWx1j.js";import{D as Te,a as ze}from"./DialogContent-COvIddmc.js";import{T as Ee}from"./TextField-DNVhVnCv.js";import{I as We}from"./InputAdornment-BgDE6Kz5.js";import{B as Be}from"./Business-DP4Oq-gt.js";import{D as Pe}from"./DialogActions-CZ9LuKoL.js";import{C as De}from"./Cancel-ogBAkz-m.js";import{S as Ne}from"./Save-ByVVUHNY.js";import{S as Fe}from"./Snackbar-XurLPfxZ.js";import{G as Oe}from"./Group-CKNX0Zix.js";import{B as E}from"./Button-0T1tR8_c.js";import{A as Ue}from"./Alert-D6te_eKs.js";import"./OutlinedInput-C5vYvqQm.js";import"./useFormControl-BwsGWz84.js";import"./Select-DCG_CkE0.js";import"./FormHelperText-BXMwkblB.js";import"./ButtonGroupButtonContext-BYVHV5Ft.js";import"./Close-DS868zx3.js";const Me=de.forwardRef(function(i,f){return e.jsx(Ue,{elevation:6,ref:f,variant:"filled",...i})}),Ge=y(S)(({theme:o})=>({background:"linear-gradient(135deg, #eaedf1ff 0%, #c6daedff 100%)",color:"#024091ff",borderRadius:20,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-5px)",boxShadow:"0 12px 40px rgba(0, 0, 0, 0.2)"}})),k=y(E)(({theme:o})=>({borderRadius:25,textTransform:"none",fontWeight:600,padding:o.spacing(1.5,3),boxShadow:"0 4px 15px rgba(0, 0, 0, 0.1)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(0, 0, 0, 0.15)"}})),Le=y(E)(({theme:o})=>({background:"linear-gradient(45deg, #2196F3 30%, #21CBF3 90%)",color:"white",borderRadius:20,padding:o.spacing(1.5,3),boxShadow:"0 4px 15px rgba(33, 150, 243, 0.3)",fontWeight:600,textTransform:"none",transition:"all 0.3s ease","&:hover":{background:"linear-gradient(45deg, #1976D2 30%, #1CB5E0 90%)",transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(33, 150, 243, 0.4)"}})),$e=y(ze)(({theme:o})=>({"& .MuiDialog-paper":{borderRadius:20,boxShadow:"0 10px 40px rgba(0, 0, 0, 0.1)"}})),T=y(E)(({theme:o,active:i})=>({borderRadius:50,textTransform:"none",fontWeight:i?700:500,fontSize:"0.95rem",color:i?"#fff":"#555",backgroundColor:i?"#667eea":"#fff",border:i?"none":"1px solid #e0e0e0",padding:o.spacing(1,2.5),margin:o.spacing(.5),transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:i?"0 4px 12px rgba(102, 126, 234, 0.3)":"0 1px 4px rgba(0, 0, 0, 0.05)","&:hover":{backgroundColor:i?"#5a6fd8":"#f5f7fb",borderColor:"#ccc",transform:"translateY(-1px)",boxShadow:i?"0 6px 16px rgba(102, 126, 234, 0.35)":"0 3px 8px rgba(0, 0, 0, 0.08)"}})),He=({title:o,value:i,icon:f,borderColor:d,textColor:h})=>e.jsx(S,{sx:{borderRadius:3,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.05)",border:`1px solid ${d}`,transition:"all 0.3s ease","&:hover":{transform:"translateY(-3px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.1)"}},children:e.jsxs(z,{sx:{textAlign:"center",py:3},children:[e.jsx(s,{sx:{bgcolor:d.replace("0.1","0.1"),borderRadius:2,p:2,mb:2,display:"inline-block"},children:f}),e.jsx(t,{variant:"h4",fontWeight:"bold",color:h,children:i}),e.jsx(t,{variant:"body2",color:"text.secondary",children:o})]})}),G=[e.jsx($,{sx:{fontSize:30,color:"primary.main"}}),e.jsx(Oe,{sx:{fontSize:30,color:"primary.main"}}),e.jsx(Ce,{sx:{fontSize:30,color:"primary.main"}}),e.jsx(xe,{sx:{fontSize:30,color:"primary.main"}}),e.jsx(ue,{sx:{fontSize:30,color:"primary.main"}}),e.jsx(fe,{sx:{fontSize:30,color:"primary.main"}}),e.jsx(he,{sx:{fontSize:30,color:"primary.main"}}),e.jsx(Ae,{sx:{fontSize:30,color:"primary.main"}}),e.jsx(V,{sx:{fontSize:30,color:"primary.main"}}),e.jsx(H,{sx:{fontSize:30,color:"primary.main"}})],Ve={primary:{border:"rgba(33, 150, 243, 0.1)",text:"primary.main"},success:{border:"rgba(76, 175, 80, 0.1)",text:"success.main"},warning:{border:"rgba(255, 152, 0, 0.1)",text:"warning.main"},secondary:{border:"rgba(156, 39, 176, 0.1)",text:"secondary.main"},info:{border:"rgba(3, 169, 244, 0.1)",text:"info.main"},error:{border:"rgba(244, 67, 54, 0.1)",text:"error.main"}},L=Object.values(Ve),Ar=()=>{const[o,i]=l.useState([]),[f,d]=l.useState([]),[h,W]=l.useState({}),[C,B]=l.useState(!1),[Y,g]=l.useState(!1),[x,Z]=l.useState(null),[p,P]=l.useState(""),[q,D]=l.useState(!1),[J,K]=l.useState(""),[Q,X]=l.useState("success"),[A,N]=l.useState(!1),[c,I]=l.useState(""),F="";l.useEffect(()=>{w()},[]);const w=async()=>{B(!0);const r=localStorage.getItem("token");try{const n=await M.get(`${F}/personnelautredgb`,{headers:{Authorization:`Bearer ${r}`}}),{personnel:m=[],structureStats:u={}}=n.data||{};i(m),d(m),W(u),j(`${m.length} personnel(s) trouvé(s)`,"success")}catch(n){j("Erreur lors du chargement du personnel","error"),console.error("Erreur:",n),i([]),d([]),W({})}finally{B(!1)}},_=[...new Set(o.map(n=>n.structureAutre).filter(n=>n&&n.trim()!==""))].sort(),ee=r=>{Z(r),P(""),g(!0)},re=async()=>{if(!p.trim()){j("Veuillez saisir une structure","warning");return}N(!0);const r=localStorage.getItem("token");try{(await M.patch(`${F}/ajouterstructureautre`,{IDPERSONNEL:x.id,STRUCTUREAUTRE:p.trim()},{headers:{Authorization:`Bearer ${r}`}})).data.success&&(j("Structure mise à jour avec succès","success"),g(!1),i(m=>m.map(u=>u.id===x.id?{...u,structureAutre:p.trim()}:u)),w())}catch(n){j(n.response?.data?.error||"Erreur lors de la mise à jour","error")}finally{N(!1)}},j=(r,n)=>{K(r),X(n),D(!0)},O=()=>{D(!1)};l.useEffect(()=>{d(c?c==="undefined"?o.filter(r=>!r.structureAutre||r.structureAutre.trim()===""):o.filter(r=>r.structureAutre===c):o)},[c,o]);const te=Object.keys(h).filter(r=>r!=="Non définie").slice(0,4).map((r,n)=>{const m=G[n%G.length],u=L[n%L.length];return e.jsx(b,{item:!0,xs:12,sm:6,md:3,children:e.jsx(He,{title:r,value:h[r],icon:m,borderColor:u.border,textColor:u.text})},r)}),se=Object.keys(h).filter(r=>r!=="Non définie").length===0;return e.jsxs(s,{sx:{p:3,minHeight:"100vh",bgcolor:"#f8fafc"},children:[e.jsx(Ge,{sx:{mb:4},children:e.jsx(z,{sx:{py:3},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(s,{sx:{bgcolor:"rgba(255, 255, 255, 0.2)",borderRadius:3,p:1.5,mr:3},children:e.jsx($,{sx:{fontSize:40}})}),e.jsxs(s,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",sx:{mb:1},children:"Personnels Autre à la DGB"}),e.jsx(t,{variant:"body1",sx:{opacity:.9},children:"Gestion des personnels formés externes à la DGB"})]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Le,{startIcon:C?e.jsx(R,{size:20,color:"inherit"}):e.jsx(me,{}),onClick:w,disabled:C,sx:{mb:1},children:"Actualiser"}),e.jsx(t,{variant:"body2",sx:{opacity:.8},children:new Date().toLocaleTimeString("fr-FR")})]})]})})}),e.jsx(b,{container:!0,spacing:3,sx:{mb:4},children:se?e.jsx(b,{item:!0,xs:12,children:e.jsx(S,{sx:{textAlign:"center",py:4,border:"1px dashed #ccc"},children:e.jsxs(t,{variant:"body1",color:"text.secondary",children:["Aucune structure définie dans ",e.jsx("code",{children:"STRUCTUREAUTRE"})]})})}):te}),e.jsxs(S,{sx:{borderRadius:3,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.05)",overflow:"hidden"},children:[e.jsxs(s,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(be,{sx:{mr:2,fontSize:28}}),e.jsxs(t,{variant:"h6",fontWeight:"bold",children:["Liste du Personnel (",f.length,")"]})]}),e.jsx(U,{label:"Personnel Formé",sx:{bgcolor:"rgba(255, 255, 255, 0.2)",color:"white",fontWeight:"bold"}})]}),e.jsxs(ge,{sx:{maxHeight:600},children:[e.jsxs(s,{sx:{bgcolor:"#f8fafc",p:3,borderBottom:"1px solid #e0e4e7"},children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Filtrer par structure :"}),e.jsxs(s,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start"},children:[e.jsxs(T,{active:!c,onClick:()=>I(""),children:["Tous (",o.length,")"]}),_.map(r=>e.jsxs(T,{active:c===r,onClick:()=>I(r),children:[r," (",h[r],")"]},r)),e.jsxs(T,{active:c==="undefined",onClick:()=>I("undefined"),children:["Non définie (",h["Non définie"]||0,")"]})]})]}),e.jsxs(pe,{stickyHeader:!0,children:[e.jsx(je,{children:e.jsxs(v,{children:[e.jsx(a,{sx:{fontWeight:"bold",bgcolor:"#f8fafc"},children:"N°"}),e.jsx(a,{sx:{fontWeight:"bold",bgcolor:"#f8fafc"},children:"Personnel"}),e.jsx(a,{sx:{fontWeight:"bold",bgcolor:"#f8fafc"},children:"Fonction"}),e.jsx(a,{sx:{fontWeight:"bold",bgcolor:"#f8fafc"},children:"Structure Actuelle"}),e.jsx(a,{sx:{fontWeight:"bold",bgcolor:"#f8fafc",textAlign:"center"},children:"Formations"}),e.jsx(a,{sx:{fontWeight:"bold",bgcolor:"#f8fafc"},children:"Contact"}),e.jsx(a,{sx:{fontWeight:"bold",bgcolor:"#f8fafc",textAlign:"center"},children:"Actions"})]})}),e.jsx(Se,{children:C?e.jsx(v,{children:e.jsxs(a,{colSpan:7,align:"center",sx:{py:8},children:[e.jsx(R,{size:40}),e.jsx(t,{variant:"body1",sx:{mt:2},children:"Chargement du personnel..."})]})}):f.length>0?f.map((r,n)=>e.jsxs(v,{hover:!0,sx:{"&:hover":{bgcolor:"rgba(103, 126, 234, 0.04)"},transition:"all 0.2s ease"},children:[e.jsx(a,{children:e.jsx(t,{variant:"body2",fontWeight:"bold",color:"primary.main",children:n+1})}),e.jsx(a,{children:e.jsxs(s,{children:[e.jsxs(t,{variant:"body1",fontWeight:"bold",children:[r.nom," ",r.prenom]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(ye,{sx:{mr:.5,fontSize:14,color:"text.secondary"}}),e.jsx(t,{variant:"body2",color:"text.secondary",children:r.matricule}),r.sexe&&e.jsx(U,{label:r.sexe,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(a,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(H,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(t,{variant:"body2",fontWeight:"500",children:r.fonction||"Non définie"}),r.grade&&e.jsxs(t,{variant:"caption",color:"text.secondary",children:["Grade: ",r.grade]})]})]})}),e.jsx(a,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ie,{sx:{mr:1,fontSize:16,color:"warning.main"}}),e.jsxs(s,{children:[e.jsx(t,{variant:"body2",fontWeight:"500",color:"warning.main",children:r.structureAbbreviation||r.structure}),e.jsx(t,{variant:"caption",color:"text.secondary",children:r.structureAutre||"Non définie"})]})]})}),e.jsx(a,{sx:{textAlign:"center"},children:e.jsx(oe,{badgeContent:r.nombreFormations,color:"success",children:e.jsx(ne,{color:"success"})})}),e.jsx(a,{children:r.telephone?e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(t,{variant:"body2",children:r.telephone})]}):e.jsx(t,{variant:"body2",color:"text.secondary",children:"Non renseigné"})}),e.jsx(a,{sx:{textAlign:"center"},children:e.jsx(ae,{title:"Modifier la structure",children:e.jsx(k,{size:"small",variant:"contained",color:"primary",startIcon:e.jsx(ie,{}),onClick:()=>ee(r),sx:{borderRadius:2},children:"Modifier"})})})]},r.id)):e.jsx(v,{children:e.jsxs(a,{colSpan:7,align:"center",sx:{py:8},children:[e.jsx(V,{sx:{fontSize:60,color:"text.secondary",mb:2}}),e.jsx(t,{variant:"h6",color:"text.secondary",children:"Aucun personnel trouvé"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:c?`Aucun enregistrement pour "${c==="undefined"?"Non définie":c}"`:"Aucun personnel avec formations"})]})})})]})]})]}),e.jsxs($e,{open:Y,onClose:()=>g(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(we,{sx:{bgcolor:"#e6ecf1ff",color:"#076fc4ff",display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Re,{sx:{mr:2}}),e.jsx(t,{variant:"h6",fontWeight:"bold",children:"Modifier la Structure"})]}),e.jsx(le,{onClick:()=>g(!1),sx:{color:"#076fc4ff"},children:e.jsx(ke,{})})]}),e.jsx(Te,{sx:{p:4},children:x&&e.jsxs(s,{children:[e.jsx(S,{sx:{bgcolor:"rgba(103, 126, 234, 0.05)",border:"1px solid rgba(103, 126, 234, 0.2)",borderRadius:2,mb:3},children:e.jsxs(z,{children:[e.jsxs(t,{variant:"h6",fontWeight:"bold",sx:{mb:2},children:[x.NOM," ",x.PRENOM]}),e.jsxs(b,{container:!0,spacing:2,children:[e.jsx(b,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Matricule:"})," ",x.MATRICULE]})}),e.jsx(b,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Fonction:"})," ",x.FONCTION||"Non définie"]})}),e.jsx(b,{item:!0,xs:12,children:e.jsxs(t,{variant:"body2",color:"warning.main",children:[e.jsx("strong",{children:"STRUCTUREAUTRE actuelle:"})," ",x.STRUCTUREAUTRE||"Non définie"]})})]})]})}),e.jsx(Ee,{fullWidth:!0,label:"Nouvelle Structure",value:p,onChange:r=>P(r.target.value),placeholder:"Saisir la nouvelle structure...",variant:"outlined",multiline:!0,rows:2,InputProps:{startAdornment:e.jsx(We,{position:"start",children:e.jsx(Be,{color:"action"})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,"&:hover fieldset":{borderColor:"primary.main"}}}})]})}),e.jsxs(Pe,{sx:{p:3,bgcolor:"#f8fafc"},children:[e.jsx(k,{onClick:()=>g(!1),startIcon:e.jsx(De,{}),variant:"outlined",color:"error",children:"Annuler"}),e.jsx(k,{onClick:re,startIcon:A?e.jsx(R,{size:20}):e.jsx(Ne,{}),variant:"contained",color:"success",disabled:A||!p.trim(),children:A?"Enregistrement...":"Enregistrer"})]})]}),e.jsx(Fe,{open:q,autoHideDuration:6e3,onClose:O,anchorOrigin:{vertical:"top",horizontal:"right"},TransitionComponent:ce,children:e.jsx(Me,{onClose:O,severity:Q,sx:{borderRadius:2,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",minWidth:350},children:J})})]})};export{Ar as default};
