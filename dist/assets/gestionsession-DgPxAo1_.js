import{u as cr,r as a,j as e,B as i,y as l,H as dr,s as L,T as n,v as h,aI as se,aJ as Pe,L as oe,N as Te,Z as pr,U as ne,aK as De,aL as ve,D as ur,I as w,ak as ae,G as Me,w as mr,aM as B,aC as xr,aN as hr,x as Ae,aO as gr,aP as H,aQ as fr,aR as we,Y as u,z as $e,C as Sr}from"./index-zHPv1lze.js";import{a as y}from"./index-C3O71W1x.js";import{T as ie}from"./TextField-DNVhVnCv.js";import{I as le}from"./InputAdornment-BgDE6Kz5.js";import{P as br}from"./Pagination-BeHNtj-4.js";import{a as Y,D as q}from"./DialogContent-COvIddmc.js";import{D as N}from"./DialogActions-CZ9LuKoL.js";import{B as f}from"./Button-0T1tR8_c.js";import{D as jr}from"./DialogTitle-CCgKuUmv.js";import{C as ce}from"./CircularProgress-BHFhENdB.js";import{C as Le}from"./Checkbox-BNRiEFgI.js";import{L as ke}from"./ListItem-CSuwil7H.js";import"./OutlinedInput-C5vYvqQm.js";import"./useFormControl-BwsGWz84.js";import"./Select-DCG_CkE0.js";import"./FormHelperText-BXMwkblB.js";import"./LastPage-aHJdqG80.js";import"./ButtonGroupButtonContext-BYVHV5Ft.js";import"./SwitchBase-CEgujy3G.js";const yr=L($e)(({theme:t})=>({padding:24,borderRadius:16,backgroundColor:t.palette.background.paper,boxShadow:t.shadows[4],border:`1px solid ${l(t.palette.primary.main,.2)}`,transition:"all 0.3s ease","&:hover":{boxShadow:t.shadows[8],borderColor:l(t.palette.primary.main,.4)}})),Ir=L(ke)(({theme:t})=>({backgroundColor:t.palette.grey[50],borderRadius:12,marginBottom:12,padding:"16px 20px",transition:"all 0.3s ease",borderLeft:`4px solid ${t.palette.primary.main}`,"&:hover":{backgroundColor:l(t.palette.primary.light,.1),transform:"translateY(-2px)",boxShadow:t.shadows[2],borderLeftWidth:6}})),Fe=L(ke)(({theme:t})=>({backgroundColor:t.palette.grey[50],borderRadius:8,marginBottom:8,padding:"12px 16px",transition:"all 0.2s ease","&:hover":{backgroundColor:l(t.palette.primary.light,.05),boxShadow:t.shadows[1]}})),Cr=L(Sr)(({theme:t,selected:T,confirmed:D})=>({border:T?`2px solid ${t.palette.primary.main}`:"1px solid #e0e0e0",borderRadius:"12px",cursor:"pointer",transition:"all 0.3s ease",background:D?`linear-gradient(135deg, ${l(t.palette.success.light,.15)} 0%, ${l(t.palette.success.light,.05)} 100%)`:T?`linear-gradient(135deg, ${l(t.palette.primary.light,.15)} 0%, ${l(t.palette.primary.light,.05)} 100%)`:"white",borderColor:D?t.palette.success.main:T?t.palette.primary.main:"#e0e0e0","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(0, 0, 0, 0.1)"}}));L($e)(({theme:t})=>({padding:16,marginBottom:24,backgroundColor:l(t.palette.primary.main,.03),borderRadius:12,border:`1px solid ${l(t.palette.primary.main,.2)}`}));const Yr=()=>{const t=cr(),[T,D]=a.useState(!1),[ze,de]=a.useState(!1),[We,F]=a.useState(!1),[Ue,J]=a.useState(!1),[O,pe]=a.useState(null),[S,ue]=a.useState(null),[g,me]=a.useState(null),[Er,Be]=a.useState([]),[He,xe]=a.useState([]),[G,v]=a.useState([]),[x,M]=a.useState([]),[V,I]=a.useState([]),[Ye,qe]=a.useState([]),[m,C]=a.useState([]),[_,he]=a.useState(""),[Q,Je]=a.useState(""),[A,ge]=a.useState(""),[Ge,fe]=a.useState(!1),[K,Se]=a.useState(!1),[$,be]=a.useState(!1),[Ve,je]=a.useState(!1),[X,ye]=a.useState(!1),[R,Ie]=a.useState(!1),[Z,k]=a.useState(!1),[ee,_e]=a.useState(1),re=5,b="",j=localStorage.getItem("token"),Qe=async()=>{fe(!0);try{const s=(await y.get(`${b}/listeformationeffectuees`,{headers:{Authorization:`Bearer ${j}`}})).data;Be(s);const o=`
        SELECT 
          f.IDFORMATIONM,
          COUNT(DISTINCT s.IDSESSION) as NombreSessions,
          SUM(CASE WHEN ps.IDPERSONNEL IS NOT NULL THEN 1 ELSE 0 END) as TotalParticipants
        FROM formationmodifiable f
        LEFT JOIN sessionformation s ON f.IDFORMATIONM = s.IDFORMATION
        LEFT JOIN participer_session ps ON s.IDSESSION = ps.IDSESSION
        WHERE f.IDFORMATIONM IN (${s.map(p=>p.IDFORMATIONM).join(",")})
        GROUP BY f.IDFORMATIONM;
      `;if(s.length>0){const p=await y.post(`${b}/personnaliserrequette`,{query:o},{headers:{Authorization:`Bearer ${j}`}}),c=s.map(d=>{const E=p.data.find(lr=>lr.IDFORMATIONM===d.IDFORMATIONM);return{...d,NombreSessions:E?.NombreSessions||0,TotalParticipants:E?.TotalParticipants||0}});xe(c)}else xe([])}catch(r){console.error("Erreur lors du chargement des formations :",r),u.error("Erreur lors du chargement des formations.")}finally{fe(!1)}},Ce=async r=>{if(r){Se(!0);try{const s=`
        SELECT 
          s.IDSESSION,
          s.DATE,
          s.CONFIRME,
          f.INTITULE as FormationIntitule,
          COUNT(DISTINCT ps.IDPERSONNEL) as NombreParticipants
        FROM sessionformation s
        LEFT JOIN formationmodifiable f ON s.IDFORMATION = f.IDFORMATIONM
        LEFT JOIN participer_session ps ON s.IDSESSION = ps.IDSESSION
        WHERE s.IDFORMATION = ${r}
        GROUP BY s.IDSESSION, s.DATE, s.CONFIRME, f.INTITULE
        ORDER BY s.DATE DESC;
      `,o=await y.post(`${b}/personnaliserrequette`,{query:s},{headers:{Authorization:`Bearer ${j}`}});v(o.data||[])}catch(s){console.error("Erreur lors du chargement des sessions :",s),u.error("Erreur lors du chargement des sessions.")}finally{Se(!1)}}},Ke=(r,s)=>{if(s.stopPropagation(),r.CONFIRME===1){u.info("Cette session est déjà confirmée.");return}pe(r),F(!0)},Xe=async()=>{if(O){Ie(!0);try{await y.patch(`${b}/confirmer-session/${O.IDSESSION}`,{},{headers:{Authorization:`Bearer ${j}`}}),v(r=>r.map(s=>s.IDSESSION===O.IDSESSION?{...s,CONFIRME:1}:s)),u.success("Session confirmée avec succès !"),F(!1),pe(null)}catch(r){console.error("Erreur lors de la confirmation de la session :",r),r.response?.status===404?u.error("Session non trouvée ou déjà confirmée."):u.error("Erreur lors de la confirmation de la session.")}finally{Ie(!1)}}},Ze=async r=>{if(r){be(!0);try{const s=`
        SELECT 
          p.IDPERSONNEL,
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.NOMMARI,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          COALESCE(s.NOMSTRUCTURE, 'Non spécifié') as Structure,
          COALESCE(s.ABBREVIATION, 'N/A') as StructureAbbreviation
        FROM personel p
        LEFT JOIN structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
        JOIN participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
        WHERE ps.IDSESSION = ${r}
        ORDER BY s.NOMSTRUCTURE, p.NOM, p.PRENOM;
      `,p=((await y.post(`${b}/personnaliserrequette`,{query:s},{headers:{Authorization:`Bearer ${j}`}})).data||[]).map(c=>({idPersonnel:c.IDPERSONNEL,idSession:r,nomComplet:`${c.NOM||""} ${c.PRENOM||""}${c.NOMMARI?" Épse. "+c.NOMMARI:""}`.trim()||"Nom inconnu",structure:c.ABBREVIATION||c.NOMSTRUCTURE||"Structure non définie",matricule:c.MATRICULE,fonction:c.FONCTION}));M(p),I(p)}catch(s){console.error("Erreur lors de la récupération des participants :",s),u.error("Erreur lors de la récupération des participants."),M([]),I([])}finally{be(!1)}}},er=async()=>{je(!0);try{const s=((await y.get(`${b}/listepersonels`,{headers:{Authorization:`Bearer ${j}`}})).data||[]).map(o=>({idPersonnel:o.IDPERSONNEL,matricule:o.MATRICULE,nom:o.NOM,prenom:o.PRENOM,nomMari:o.NOMMARI,fonction:o.FONCTION,structure:o.STRUCTURE_HIERARCHY||o.NOMSTRUCTURE||o.ABBREVIATION||"Structure non définie",nomComplet:`${o.NOM||""} ${o.PRENOM||""}${o.NOMMARI?" Épse. "+o.NOMMARI:""}`.trim()||"Nom inconnu"}));qe(s)}catch(r){console.error("Erreur lors de la récupération des personnels :",r),u.error("Erreur lors du chargement des personnels.")}finally{je(!1)}},rr=async()=>{if(m.length===0){u.error("Veuillez sélectionner au moins un personnel.");return}const r=new Set(x.map(o=>o.idPersonnel)),s=m.filter(o=>!r.has(o.idPersonnel));if(s.length===0){u.error("Tous les personnels sélectionnés sont déjà participants.");return}ye(!0);try{const o=s.map(d=>d.idPersonnel);await y.post(`${b}/participer-session`,{IDPERSONNEL:o,IDSESSION:g?.IDSESSION},{headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"}});const p=s.map(d=>({idPersonnel:d.idPersonnel,idSession:g?.IDSESSION,nomComplet:d.nomComplet,structure:d.structure,matricule:d.matricule,fonction:d.fonction})),c=[...x,...p];M(c),I(c),v(d=>d.map(E=>E.IDSESSION===g?.IDSESSION?{...E,NombreParticipants:(E.NombreParticipants||0)+p.length}:E)),C([]),k(!1),u.success(`${p.length} participant(s) ajouté(s) avec succès !`),J(!1)}catch(o){console.error("Erreur lors de l'ajout des participants :",o),u.error("Erreur lors de l'ajout des participants.")}finally{ye(!1)}},tr=()=>{C(Z?[]:Ee),k(!Z)},sr=async r=>{const{idPersonnel:s,idSession:o}=r;try{await y.post(`${b}/supprimerparticipation`,{IDPERSONNEL:s,IDSESSION:o},{headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"}}),u.success("Participant supprimé avec succès.");const p=x.filter(c=>c.idPersonnel!==s);M(p),I(p),v(c=>c.map(d=>d.IDSESSION===o?{...d,NombreParticipants:(d.NombreParticipants||0)-1}:d)),S&&Ce(S.IDFORMATIONM)}catch(p){console.error("Erreur lors de la suppression :",p),u.error("Erreur lors de la suppression du participant.")}};a.useEffect(()=>{Qe()},[]),a.useEffect(()=>{if(A){const r=A.toLowerCase(),s=x.filter(o=>o.nomComplet.toLowerCase().includes(r)||o.structure.toLowerCase().includes(r)||o.matricule&&o.matricule.toLowerCase().includes(r)||o.fonction&&o.fonction.toLowerCase().includes(r));I(s)}else I(x)},[A,x]);const or=new Set(x.map(r=>r.idPersonnel)),Ee=Ye.filter(r=>!or.has(r.idPersonnel)),z=Ee.filter(r=>{const s=_.toLowerCase();return r.nomComplet.toLowerCase().includes(s)||r.matricule&&r.matricule.toLowerCase().includes(s)||r.fonction&&r.fonction.toLowerCase().includes(s)}),nr=r=>{ue(r),Ce(r.IDFORMATIONM),D(!0)},ar=r=>{me(r),Ze(r.IDSESSION),de(!0)},W=()=>{D(!1),ue(null),v([])},U=()=>{de(!1),me(null),M([]),I([]),ge("")},ir=()=>{er(),C([]),k(!1),J(!0)},te=()=>{J(!1),C([]),he(""),k(!1)},Ne=He.filter(r=>r.INTITULE?.toLowerCase().includes(Q.toLowerCase())||r.DATE&&new Date(r.DATE).toLocaleDateString("fr-FR").includes(Q)),Oe=Math.ceil(Ne.length/re),Re=Ne.slice((ee-1)*re,ee*re),P=r=>r?new Date(r).toLocaleDateString("fr-FR"):"-";return e.jsxs(i,{sx:{padding:3,backgroundColor:t.palette.grey[100],minHeight:"100vh",backgroundImage:`linear-gradient(135deg, ${l(t.palette.primary.light,.05)} 0%, ${t.palette.background.default} 100%)`},children:[e.jsx(dr,{position:"top-right",autoClose:3e3}),e.jsxs(yr,{sx:{width:"100%",height:"85vh",p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,gap:2},children:[e.jsxs(i,{children:[e.jsx(n,{variant:"h4",fontWeight:"bold",color:"primary.main",children:"Formations Réalisées"}),e.jsx(h,{label:"Sélectionnez une formation pour voir les participants",color:"info",size:"small",icon:e.jsx(se,{}),sx:{mt:1,fontWeight:500}})]}),e.jsx(ie,{variant:"outlined",placeholder:"Rechercher une formation...",value:Q,onChange:r=>Je(r.target.value),InputProps:{startAdornment:e.jsx(le,{position:"start",children:e.jsx(Pe,{color:t.palette.primary.main})}),sx:{borderRadius:50,backgroundColor:t.palette.background.paper,boxShadow:t.shadows[1],"&:hover":{boxShadow:t.shadows[2]}}},sx:{width:"35%","& .MuiOutlinedInput-root":{borderRadius:50}}})]}),Ge&&e.jsx(oe,{sx:{mb:2,height:6,borderRadius:3,backgroundColor:l(t.palette.primary.main,.1),"& .MuiLinearProgress-bar":{borderRadius:3,backgroundColor:t.palette.primary.main}}}),e.jsx(Te,{sx:{overflowY:"auto",maxHeight:"calc(80vh - 130px)",pr:1},children:Re.length>0?Re.map(r=>e.jsxs(pr.Fragment,{children:[e.jsx(Ir,{button:!0,onClick:()=>nr(r),children:e.jsx(ne,{primary:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(n,{variant:"subtitle1",fontWeight:"medium",children:r.INTITULE||"Intitulé inconnu"}),e.jsxs(i,{sx:{display:"flex",gap:1,ml:"auto"},children:[e.jsx(h,{icon:e.jsx(De,{}),label:`${r.NombreSessions||0} session${r.NombreSessions>1?"s":""}`,size:"small",color:"primary",variant:"outlined",sx:{fontWeight:600,borderWidth:2,"& .MuiChip-icon":{fontSize:16}}}),r.TotalParticipants>0&&e.jsx(h,{icon:e.jsx(ve,{}),label:`${r.TotalParticipants} participant${r.TotalParticipants>1?"s":""}`,size:"small",color:"success",variant:"outlined",sx:{fontWeight:600,borderWidth:2,"& .MuiChip-icon":{fontSize:16}}})]})]}),secondary:e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[e.jsx("strong",{children:"Date:"})," ",r.DATE?new Date(r.DATE).toLocaleDateString("fr-FR",{weekday:"short",year:"numeric",month:"long",day:"numeric"}):"Non définie"]}),r.LIEU&&e.jsxs(n,{variant:"body2",color:"text.secondary",mt:.5,children:[e.jsx("strong",{children:"Lieu:"})," ",r.LIEU]})]})})}),e.jsx(ur,{sx:{my:1}})]},r.IDFORMATIONM)):e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"50vh",textAlign:"center",p:3},children:[e.jsx(Pe,{size:48,color:t.palette.grey[400],style:{marginBottom:16}}),e.jsx(n,{variant:"h6",color:"textSecondary",children:"Aucune formation trouvée"}),e.jsx(n,{variant:"body2",color:"textSecondary",mt:1,children:"Essayez d'ajuster vos termes de recherche ou consultez d'autres périodes"})]})}),Oe>1&&e.jsx(br,{count:Oe,page:ee,onChange:(r,s)=>_e(s),sx:{display:"flex",justifyContent:"center",mt:3,"& .MuiPaginationItem-root":{borderRadius:8,fontWeight:500},"& .Mui-selected":{boxShadow:t.shadows[1]}},color:"primary",shape:"rounded"})]}),e.jsxs(Y,{open:T,onClose:W,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:8,boxShadow:t.shadows[10],maxHeight:"90vh"}},children:[e.jsxs(N,{sx:{justifyContent:"space-between",p:2,bgcolor:l(t.palette.primary.main,.05)},children:[e.jsxs(i,{children:[e.jsx(n,{variant:"h6",fontWeight:"bold",color:"primary",children:"Sessions de la formation"}),e.jsx(n,{variant:"body2",color:"text.secondary",mt:.5,children:S?.INTITULE})]}),e.jsx(w,{onClick:W,sx:{color:t.palette.grey[600]},children:e.jsx(ae,{size:24})})]}),e.jsxs(q,{sx:{p:3},children:[e.jsxs(i,{sx:{mb:3},children:[e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(h,{label:`Date formation: ${S?.DATE?P(S.DATE):"Non définie"}`,size:"small",color:"info",variant:"outlined"}),S?.LIEU&&e.jsx(h,{label:`Lieu: ${S.LIEU}`,size:"small",color:"info"})]}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{}),G.length," session(s) disponible(s)"]})]}),K&&e.jsx(oe,{sx:{mb:2,height:6,borderRadius:3,backgroundColor:l(t.palette.primary.main,.1),"& .MuiLinearProgress-bar":{borderRadius:3,backgroundColor:t.palette.primary.main}}}),!K&&G.length>0?e.jsx(Me,{container:!0,spacing:2,children:G.map(r=>e.jsx(Me,{item:!0,xs:12,sm:6,children:e.jsx(Cr,{selected:g?.IDSESSION===r.IDSESSION,confirmed:r.CONFIRME===1,onClick:()=>ar(r),children:e.jsxs(mr,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsxs(n,{variant:"h6",sx:{fontSize:"1rem",fontWeight:"bold"},children:["Session #",r.IDSESSION]}),e.jsxs(i,{display:"flex",gap:1,children:[e.jsx(h,{label:`${r.NombreParticipants||0} participants`,size:"small",color:"primary",variant:"outlined"}),r.CONFIRME===1?e.jsx(h,{icon:e.jsx(B,{}),label:"Confirmée",size:"small",color:"success",sx:{fontWeight:600}}):e.jsx(h,{icon:e.jsx(xr,{}),label:"Non confirmée",size:"small",color:"error",variant:"outlined",sx:{fontWeight:600}})]})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(hr,{style:{marginRight:8,fontSize:16,color:t.palette.text.secondary}}),e.jsx(n,{variant:"body2",children:P(r.DATE)})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2},children:[e.jsx(f,{variant:"contained",size:"small",startIcon:e.jsx(ve,{}),disabled:r.NombreParticipants===0,sx:{textTransform:"none",bgcolor:"#e5f0fb",color:"#1754fc","&:hover":{bgcolor:"#1754fc",color:"#ffff"},"&:disabled":{opacity:.5}},children:"Voir les participants"}),r.CONFIRME!==1&&e.jsx(f,{variant:"contained",color:"success",size:"small",onClick:s=>Ke(r,s),disabled:R,startIcon:e.jsx(B,{}),sx:{textTransform:"none",fontWeight:500,ml:1},children:"Confirmer Session"})]})]})})},r.IDSESSION))}):!K&&e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:4,textAlign:"center",bgcolor:t.palette.grey[50],borderRadius:12,border:`1px dashed ${t.palette.grey[300]}`},children:[e.jsx(se,{size:40,color:t.palette.grey[400],style:{marginBottom:16}}),e.jsx(n,{variant:"subtitle1",color:"textSecondary",children:"Aucune session trouvée pour cette formation"})]})]}),e.jsx(N,{sx:{p:2,justifyContent:"flex-end",borderTop:`1px solid ${t.palette.divider}`},children:e.jsx(f,{onClick:W,variant:"outlined",sx:{borderRadius:50,textTransform:"none",fontWeight:500,px:3},children:"Fermer"})})]}),e.jsxs(Y,{open:We,onClose:()=>!R&&F(!1),PaperProps:{sx:{borderRadius:3,p:1,maxWidth:400}},children:[e.jsx(jr,{sx:{pb:1},children:e.jsx(n,{variant:"h6",fontWeight:"600",color:"#2c3e50",children:"Confirmer la session"})}),e.jsxs(q,{children:[e.jsxs(n,{variant:"body1",color:"text.secondary",children:["Êtes-vous sûr de vouloir confirmer la session #",O?.IDSESSION," du ",O?.DATE?P(O.DATE):""," ?"]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Cette action marquera la session comme confirmée."})]}),e.jsxs(N,{sx:{p:2,pt:0},children:[e.jsx(f,{onClick:()=>F(!1),variant:"outlined",disabled:R,sx:{borderRadius:2},children:"Annuler"}),e.jsx(f,{onClick:Xe,variant:"contained",color:"success",disabled:R,startIcon:R?e.jsx(ce,{size:20,color:"inherit"}):e.jsx(B,{}),sx:{borderRadius:2},children:R?"Confirmation...":"Confirmer"})]})]}),e.jsxs(Y,{open:ze,onClose:U,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:8,boxShadow:t.shadows[10],maxHeight:"90vh"}},children:[e.jsxs(N,{sx:{justifyContent:"space-between",p:2,bgcolor:l(t.palette.primary.main,.05)},children:[e.jsxs(i,{children:[e.jsx(n,{variant:"h6",fontWeight:"bold",color:"primary",children:"Participants de la session"}),e.jsxs(n,{variant:"body2",color:"text.secondary",mt:.5,children:["Session #",g?.IDSESSION," - ",P(g?.DATE)]}),g?.CONFIRME===1&&e.jsx(h,{icon:e.jsx(B,{}),label:"Session confirmée",size:"small",color:"success",sx:{mt:1}})]}),e.jsxs(i,{children:[e.jsx(Ae,{title:"Ajouter des participants",arrow:!0,children:e.jsx(w,{onClick:ir,sx:{color:t.palette.primary.main,mr:1,"&:hover":{backgroundColor:l(t.palette.primary.main,.1)}},children:e.jsx(gr,{size:20})})}),e.jsx(w,{onClick:U,sx:{color:t.palette.grey[600]},children:e.jsx(ae,{size:24})})]})]}),e.jsxs(q,{sx:{p:3},children:[e.jsxs(i,{sx:{mb:3},children:[e.jsx(n,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:S?.INTITULE}),e.jsxs(i,{sx:{display:"flex",gap:2,mt:1},children:[e.jsx(h,{label:`Session: ${P(g?.DATE)}`,size:"small",color:"info",variant:"outlined"}),e.jsx(h,{label:`${x.length} participant(s)`,size:"small",color:"primary"})]})]}),e.jsx(ie,{fullWidth:!0,variant:"outlined",placeholder:"Rechercher un participant...",value:A,onChange:r=>ge(r.target.value),InputProps:{startAdornment:e.jsx(le,{position:"start",children:e.jsx(H,{color:t.palette.primary.main})}),sx:{borderRadius:50,backgroundColor:t.palette.background.paper,boxShadow:t.shadows[1],"&:hover":{boxShadow:t.shadows[2]}}},sx:{mb:3,"& .MuiOutlinedInput-root":{borderRadius:50}}}),e.jsx(i,{sx:{display:"flex",alignItems:"center",mb:2,p:1.5,bgcolor:l(t.palette.primary.main,.03),borderRadius:12,border:`1px solid ${l(t.palette.primary.main,.1)}`},children:e.jsxs(n,{variant:"subtitle2",color:"primary",fontWeight:"medium",children:["Participants trouvés: ",e.jsx("span",{style:{fontWeight:"bold"},children:V.length}),A&&x.length>0&&e.jsxs("span",{style:{marginLeft:8,color:t.palette.text.secondary},children:["(sur ",x.length," au total)"]})]})}),$&&e.jsx(oe,{sx:{mb:2,height:6,borderRadius:3,backgroundColor:l(t.palette.primary.main,.1),"& .MuiLinearProgress-bar":{borderRadius:3,backgroundColor:t.palette.primary.main}}}),!$&&V.length>0?e.jsx(Te,{sx:{maxHeight:"40vh",overflowY:"auto",pr:1},children:V.map((r,s)=>e.jsxs(Fe,{children:[e.jsx(ne,{primary:e.jsx(n,{variant:"subtitle2",fontWeight:"medium",children:r.nomComplet}),secondary:e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"body2",color:"textSecondary",children:["Structure: ",r.structure]}),r.matricule&&e.jsxs(n,{variant:"body2",color:"textSecondary",children:["Matricule: ",r.matricule]})]})}),e.jsx(Ae,{title:"Supprimer le participant",arrow:!0,children:e.jsx(w,{edge:"end",onClick:()=>sr(r),sx:{color:t.palette.grey[600],"&:hover":{color:t.palette.error.main,backgroundColor:l(t.palette.error.light,.1)}},children:e.jsx(fr,{})})})]},s))}):!$&&x.length>0?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:4,textAlign:"center",bgcolor:t.palette.grey[50],borderRadius:12,border:`1px dashed ${t.palette.grey[300]}`},children:[e.jsx(H,{size:40,color:t.palette.grey[400],style:{marginBottom:16}}),e.jsx(n,{variant:"subtitle1",color:"textSecondary",children:"Aucun participant ne correspond à votre recherche"}),e.jsx(n,{variant:"body2",color:"textSecondary",mt:1,children:"Essayez d'ajuster vos termes de recherche"})]}):!$&&x.length===0?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:4,textAlign:"center",bgcolor:t.palette.grey[50],borderRadius:12,border:`1px dashed ${t.palette.grey[300]}`},children:[e.jsx(se,{size:40,color:t.palette.grey[400],style:{marginBottom:16}}),e.jsx(n,{variant:"subtitle1",color:"textSecondary",children:"Aucun participant enregistré pour cette session"}),e.jsxs(n,{variant:"body2",color:"textSecondary",mt:1,children:["Utilisez le bouton ",e.jsx("strong",{children:e.jsx(we,{})})," pour ajouter des participants"]})]}):null]}),e.jsxs(N,{sx:{p:2,justifyContent:"space-between",borderTop:`1px solid ${t.palette.divider}`},children:[e.jsx(f,{onClick:()=>{U()},variant:"outlined",sx:{borderRadius:50,textTransform:"none",fontWeight:500,px:3},children:"Retour aux sessions"}),e.jsx(f,{onClick:()=>{U(),W()},variant:"contained",sx:{borderRadius:50,textTransform:"none",fontWeight:500,px:3},children:"Fermer tout"})]})]}),e.jsxs(Y,{open:Ue,onClose:te,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:8,boxShadow:t.shadows[10],maxHeight:"90vh"}},children:[e.jsxs(N,{sx:{justifyContent:"space-between",p:2,bgcolor:l(t.palette.primary.main,.05)},children:[e.jsxs(i,{children:[e.jsx(n,{variant:"h6",fontWeight:"bold",color:"primary",children:"Ajouter des participants"}),e.jsxs(n,{variant:"body2",color:"text.secondary",mt:.5,children:["Session #",g?.IDSESSION," - ",P(g?.DATE)]})]}),e.jsx(w,{onClick:te,sx:{color:t.palette.grey[600]},children:e.jsx(ae,{size:24})})]}),e.jsx(q,{sx:{p:3},children:Ve?e.jsx(i,{display:"flex",justifyContent:"center",py:4,children:e.jsx(ce,{})}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{fullWidth:!0,variant:"outlined",placeholder:"Rechercher un personnel...",value:_,onChange:r=>he(r.target.value),InputProps:{startAdornment:e.jsx(le,{position:"start",children:e.jsx(H,{color:t.palette.primary.main})}),sx:{borderRadius:50,backgroundColor:t.palette.background.paper,boxShadow:t.shadows[1],mb:3,"&:hover":{boxShadow:t.shadows[2]}}},sx:{"& .MuiOutlinedInput-root":{borderRadius:50}}}),z.length>0&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:2,p:1.5,bgcolor:l(t.palette.primary.main,.03),borderRadius:12,border:`1px solid ${l(t.palette.primary.main,.1)}`},children:[e.jsx(Le,{checked:Z,onChange:tr,indeterminate:m.length>0&&m.length<z.length}),e.jsx(n,{variant:"subtitle2",color:"primary",fontWeight:"medium",sx:{ml:1},children:m.length>0?`${m.length} personnel(s) sélectionné(s)`:"Tout sélectionner"})]}),e.jsx(i,{sx:{maxHeight:"40vh",overflowY:"auto",pr:1},children:z.length>0?z.map(r=>e.jsxs(Fe,{button:!0,onClick:()=>{const s=m.some(o=>o.idPersonnel===r.idPersonnel);C(s?m.filter(o=>o.idPersonnel!==r.idPersonnel):[...m,r])},children:[e.jsx(Le,{checked:m.some(s=>s.idPersonnel===r.idPersonnel),onChange:()=>{},onClick:s=>s.stopPropagation()}),e.jsx(ne,{primary:e.jsx(n,{variant:"subtitle2",fontWeight:"medium",children:r.nomComplet}),secondary:e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"body2",color:"textSecondary",children:["Structure: ",r.structure]}),r.matricule&&e.jsxs(n,{variant:"body2",color:"textSecondary",children:["Matricule: ",r.matricule]})]})})]},r.idPersonnel)):e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:4,textAlign:"center",bgcolor:t.palette.grey[50],borderRadius:12,border:`1px dashed ${t.palette.grey[300]}`},children:[e.jsx(H,{size:40,color:t.palette.grey[400],style:{marginBottom:16}}),e.jsx(n,{variant:"subtitle1",color:"textSecondary",children:"Aucun personnel disponible"}),e.jsx(n,{variant:"body2",color:"textSecondary",mt:1,children:_?"Aucun résultat pour votre recherche":"Tous les personnels sont déjà participants"})]})})]})}),e.jsxs(N,{sx:{p:3,justifyContent:"space-between"},children:[e.jsx(f,{onClick:te,variant:"outlined",sx:{borderRadius:2},children:"Annuler"}),e.jsx(f,{onClick:rr,variant:"contained",color:"primary",disabled:m.length===0||X,startIcon:X?e.jsx(ce,{size:20,color:"inherit"}):e.jsx(we,{}),sx:{borderRadius:2},children:X?"Ajout en cours...":`Ajouter ${m.length>0?`(${m.length})`:""}`})]})]})]})};export{Yr as default};
