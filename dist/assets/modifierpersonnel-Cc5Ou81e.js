import{n as D,aD as U,aE as M,t as L,r as R,j as t,B,T as Z,z as ee,I as m,H as re,Y as p}from"./index-zHPv1lze.js";import{a as S}from"./index-C3O71W1x.js";import{D as te}from"./Delete-CAb5w4Qm.js";import{T as A}from"./TextField-DNVhVnCv.js";import{T as ne,a as se,b as oe,c as _,d as I,e as ae}from"./TableRow-70JfVjDg.js";import{T as ce}from"./TablePagination-Dk7TG7ya.js";import{A as le}from"./Autocomplete-DkJdCr17.js";import"./OutlinedInput-C5vYvqQm.js";import"./useFormControl-BwsGWz84.js";import"./Select-DCG_CkE0.js";import"./FormHelperText-BXMwkblB.js";import"./LastPage-aHJdqG80.js";import"./MenuItem-D-1uk7AZ.js";import"./Close-DS868zx3.js";var x={},q;function ie(){if(q)return x;q=1;var l=D();Object.defineProperty(x,"__esModule",{value:!0}),x.default=void 0;var i=l(U()),u=M();return x.default=(0,i.default)((0,u.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),x}var ue=ie();const Ee=L(ue);var N={},V;function de(){if(V)return N;V=1;var l=D();Object.defineProperty(N,"__esModule",{value:!0}),N.default=void 0;var i=l(U()),u=M();return N.default=(0,i.default)((0,u.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),N}var Re=de();const he=L(Re);var f={},$;function Ie(){if($)return f;$=1;var l=D();Object.defineProperty(f,"__esModule",{value:!0}),f.default=void 0;var i=l(U()),u=M();return f.default=(0,i.default)((0,u.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),f}var Te=Ie();const pe=L(Te),Me=()=>{const[l,i]=R.useState([]),[u,z]=R.useState([]),[O,v]=R.useState(null),[P,j]=R.useState({}),[h,b]=R.useState(0),[E,F]=R.useState(5),[w,H]=R.useState(""),T="";R.useEffect(()=>{(async()=>{const e=localStorage.getItem("token");try{const n=await S.get(`${T}/listepersonels`,{headers:{Authorization:`Bearer ${e}`}});i(n.data)}catch(n){console.error("Erreur lors de la récupération du personnel:",n),p.error("Erreur lors de la récupération du personnel.")}})()},[T]),R.useEffect(()=>{(async()=>{const e=localStorage.getItem("token");try{const n=await S.get(`${T}/listestructures`,{headers:{Authorization:`Bearer ${e}`}});z(n.data)}catch(n){console.error("Erreur lors de la récupération des structures:",n),p.error("Erreur lors de la récupération des structures.")}})()},[T]);const C=l.filter(r=>`${r.NOM||""} ${r.PRENOM||""} ${r.NOMMARI||""}`.toLowerCase().includes(w.toLowerCase())),y=r=>{const e=h*E+r,n=C[e];j({...n}),v(e)},G=async r=>{const e=localStorage.getItem("token"),n=h*E+r,o={...C[n]},d={IDPERSONNEL:o.IDPERSONNEL,IDSTRUCTURE:o.IDSTRUCTURE,MATRICULE:o.MATRICULE,NOM:o.NOM,PRENOM:o.PRENOM,SEXE:o.SEXE,NOMMARI:o.NOMMARI,CATEGORIE:o.CATEGORIE,FONCTION:o.FONCTION,TELEPHONE:o.TELEPHONE,NIVEAUETUDE:o.NIVEAUETUDE,GRADE:o.GRADE,SERVICECENTRAL:o.SERVICECENTRAL};console.log("Données envoyées au backend:",d);try{await S.patch(`${T}/updatepersonnel`,d,{headers:{Authorization:`Bearer ${e}`}});const s=[...l],a=s.findIndex(g=>g.IDPERSONNEL===o.IDPERSONNEL);a!==-1&&(s[a]=o,i(s)),v(null),j({}),p.success("Modification enregistrée avec succès.")}catch(s){console.error("Erreur lors de la mise à jour du personnel:",s),p.error("Erreur lors de l'enregistrement des modifications.")}},W=()=>{if(O!==null&&P){const r=[...l],e=r.findIndex(n=>n.IDPERSONNEL===P.IDPERSONNEL);e!==-1&&(r[e]=P,i(r))}v(null),j({})},k=(r,e,n)=>{const o=h*E+r,d=[...l],s=d.findIndex(a=>a.IDPERSONNEL===C[o].IDPERSONNEL);s!==-1&&(d[s][e]=n,i(d))},X=async r=>{if(!window.confirm("Êtes-vous sûr de vouloir supprimer ce personnel ?"))return;const e=localStorage.getItem("token");try{await S.delete(`${T}/deletepersonnel`,{headers:{Authorization:`Bearer ${e}`},data:{IDPERSONNEL:r}}),i(l.filter(n=>n.IDPERSONNEL!==r)),p.success("Personnel supprimé avec succès.")}catch(n){console.error("Erreur lors de la suppression du personnel:",n),p.error("Erreur lors de la suppression du personnel.")}},J=(r,e)=>{b(e)},Q=r=>{F(parseInt(r.target.value,10)),b(0)},Y=r=>{const e=u.find(n=>n.IDSTRUCTURE===r);return e?e.ABBREVIATION:r||"/"},K=r=>u.find(e=>e.IDSTRUCTURE===r)||null,c=(r,e,n)=>{const o=h*E+n,d=O===o;return e==="IDSTRUCTURE"?d?t.jsx(I,{sx:{padding:1},children:t.jsx(le,{options:u,getOptionLabel:s=>`${s.ABBREVIATION} - ${s.NOMSTRUCTURE}`,value:K(r[e]),onChange:(s,a)=>{k(n,e,a?a.IDSTRUCTURE:"")},filterOptions:(s,{inputValue:a})=>s.filter(g=>g.NOMSTRUCTURE.toLowerCase().includes(a.toLowerCase())||g.ABBREVIATION.toLowerCase().includes(a.toLowerCase())),renderInput:s=>t.jsx(A,{...s,placeholder:"Rechercher par nom ou abréviation",variant:"outlined",size:"small",fullWidth:!0}),renderOption:(s,a)=>t.jsxs("li",{...s,children:[t.jsx("strong",{children:a.ABBREVIATION})," - ",a.NOMSTRUCTURE]}),noOptionsText:"Aucune structure trouvée",isOptionEqualToValue:(s,a)=>s.IDSTRUCTURE===a?.IDSTRUCTURE,sx:{minWidth:200}})},e):t.jsx(I,{children:Y(r[e])},e):d?t.jsx(I,{sx:{padding:0},children:t.jsx(A,{value:r[e]||"",onChange:s=>k(n,e,s.target.value),fullWidth:!0,variant:"outlined",size:"small",multiline:!0,minRows:1,maxRows:4,sx:{width:"90%"}})},e):t.jsx(I,{children:r[e]||"/"},e)};return t.jsxs(B,{sx:{padding:2},children:[t.jsxs(B,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(Z,{variant:"h5",color:"black",children:"Liste du Personnel"}),t.jsx(A,{variant:"outlined",placeholder:"Rechercher par nom, prénom ou nom du mari",value:w,onChange:r=>H(r.target.value),sx:{width:"300px"}})]}),t.jsx(ne,{style:{height:"75vh"},component:ee,children:t.jsxs(se,{stickyHeader:!0,children:[t.jsx(oe,{sx:{backgroundColor:"#e3f2fd"},children:t.jsxs(_,{children:[["MATRICULE","NOM","PRENOM","NOMMARI","SEXE","CATEGORIE","FONCTION","TELEPHONE","NIVEAUETUDE","GRADE","STRUCTURE","SERVICE"].map(r=>t.jsx(I,{sx:{fontWeight:"bold",textAlign:"center"},children:r},r)),t.jsx(I,{sx:{textAlign:"center"},children:"Actions"})]})}),t.jsx(ae,{children:C.slice(h*E,h*E+E).map((r,e)=>{const n=h*E+e,o=O===n;return t.jsxs(_,{sx:{backgroundColor:e%2===0?"#f9f9f9":"#ffffff","&:hover":{backgroundColor:"rgba(106, 39, 200, 0.1)"}},onDoubleClick:()=>y(e),children:[c(r,"MATRICULE",e),c(r,"NOM",e),c(r,"PRENOM",e),c(r,"NOMMARI",e),c(r,"SEXE",e),c(r,"CATEGORIE",e),c(r,"FONCTION",e),c(r,"TELEPHONE",e),c(r,"NIVEAUETUDE",e),c(r,"GRADE",e),c(r,"IDSTRUCTURE",e),c(r,"SERVICECENTRAL",e),t.jsx(I,{sx:{textAlign:"center"},children:o?t.jsxs(t.Fragment,{children:[t.jsx(m,{onClick:()=>G(e),color:"primary",children:t.jsx(he,{})}),t.jsx(m,{onClick:W,sx:{color:"red"},children:t.jsx(pe,{})})]}):t.jsxs(t.Fragment,{children:[t.jsx(m,{onClick:()=>y(e),color:"primary",children:t.jsx(Ee,{})}),t.jsx(m,{onClick:()=>X(r.IDPERSONNEL),sx:{color:"red"},children:t.jsx(te,{})})]})})]},r.IDPERSONNEL)})})]})}),t.jsx(ce,{rowsPerPageOptions:[3,10,25],component:"div",count:C.length,rowsPerPage:E,page:h,onPageChange:J,onRowsPerPageChange:Q}),t.jsx(re,{})]})};export{Me as default};
