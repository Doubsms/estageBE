import{r as s,j as e,B as u,T as o,C as $,w as le,G as D,v as G,D as de,z as Pe,N as Te,U as Me,x as be,I as ye,aB as $e,F as Re,Z as Ie,L as Fe}from"./index-zHPv1lze.js";import{l as Le}from"./index-BJqg444i.js";import{L as Ce}from"./LocalizationProvider-DMHyi95E.js";import{f as ve,A as Ee}from"./fr-BqwbHVGE.js";import{a as Be,D as Ne}from"./DialogContent-COvIddmc.js";import{D as We}from"./DialogTitle-CCgKuUmv.js";import{E as ue}from"./Event-DCg_30F7.js";import{A as xe}from"./Alert-D6te_eKs.js";import{D as he}from"./DatePicker-_VewKJ-w.js";import{B as O}from"./Button-0T1tR8_c.js";import{F as De}from"./FormControlLabel-D_GYa5-T.js";import{C as Se}from"./Checkbox-BNRiEFgI.js";import{C as Oe}from"./CheckCircle-BB09QyVE.js";import{C as Ge}from"./Cancel-ogBAkz-m.js";import{A as Ye}from"./Add-gZbuNXg0.js";import{S as Ae}from"./Schedule-WrpPNihg.js";import{C as ze}from"./CircularProgress-BHFhENdB.js";import{L as Je}from"./ListItem-CSuwil7H.js";import{D as Ue}from"./Delete-DRqEtRSt.js";import{D as He}from"./DialogActions-CZ9LuKoL.js";import{P as _e}from"./Print-BhcHkGDV.js";import{P as Ve}from"./Person-CVTBdQV4.js";import{E as qe,a as Xe}from"./EventBusy-Bj-M0_Ng.js";import{T as Ze,a as Ke,b as Qe,c as fe,d as p,e as et}from"./TableRow-70JfVjDg.js";import"./Close-DS868zx3.js";import"./TextField-DNVhVnCv.js";import"./OutlinedInput-C5vYvqQm.js";import"./useFormControl-BwsGWz84.js";import"./Select-DCG_CkE0.js";import"./FormHelperText-BXMwkblB.js";import"./InputAdornment-BgDE6Kz5.js";import"./ButtonGroupButtonContext-BYVHV5Ft.js";import"./SwitchBase-CEgujy3G.js";const tt=({open:d,onClose:Y,dateDebut:U,dateFin:ie})=>{const[E,H]=s.useState([]),[g,A]=s.useState(!1),[y,S]=s.useState(""),[R,T]=s.useState(""),[b,I]=s.useState({date:"",excludeMorning:!1,excludeAfternoon:!1}),[F,_]=s.useState(null),[C,w]=s.useState([]),[Q,V]=s.useState(null),J="",h={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}},L=r=>{if(!r)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(r))return r;const a=new Date(r),P=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),n=String(a.getDate()).padStart(2,"0");return`${P}-${t}-${n}`},ce=r=>{if(!r)return"";const a=r.getFullYear(),P=String(r.getMonth()+1).padStart(2,"0"),t=String(r.getDate()).padStart(2,"0");return`${a}-${P}-${t}`},B=async()=>{try{A(!0);const r=await fetch(`${J}/getexcludeddays`,{method:"GET",headers:h.headers});if(r.ok){const a=await r.json();H(a.data||[]),S("")}else throw new Error("Erreur lors du chargement des jours exclus")}catch(r){console.error("Erreur:",r),S("Impossible de charger les jours exclus")}finally{A(!1)}},q=async()=>{if(C.length===0){S("Veuillez sélectionner au moins une date");return}if(!b.excludeMorning&&!b.excludeAfternoon){S("Veuillez sélectionner au moins une période à exclure");return}try{A(!0);let r=0,a=0;for(const P of C)try{const t={date:P,excludeMorning:b.excludeMorning,excludeAfternoon:b.excludeAfternoon};(await fetch(`${J}/addexcludedday`,{method:"POST",headers:h.headers,body:JSON.stringify(t)})).ok?r++:a++}catch(t){a++,console.error("Erreur pour la date",P,t)}await B(),w([]),T(a===0?`${r} jour(s) exclu(s) ajouté(s) avec succès`:`${r} jour(s) ajouté(s), ${a} erreur(s)`),S(""),setTimeout(()=>T(""),5e3)}catch(r){console.error("Erreur:",r),S("Erreur lors de l'ajout des jours exclus")}finally{A(!1)}},ee=async()=>{if(!b.date){S("La date est obligatoire");return}if(!b.excludeMorning&&!b.excludeAfternoon){S("Veuillez sélectionner au moins une période à exclure");return}const r=L(b.date);try{A(!0);const a={date:r,excludeMorning:b.excludeMorning,excludeAfternoon:b.excludeAfternoon};console.log("Données envoyées pour modification:",a);const P=await fetch(`${J}/updateexcludedday`,{method:"PATCH",headers:h.headers,body:JSON.stringify(a)});if(P.ok)await B(),I({date:"",excludeMorning:!1,excludeAfternoon:!1}),_(null),T("Jour exclu modifié avec succès"),S(""),setTimeout(()=>T(""),3e3);else{const t=await P.json();throw new Error(t.error||"Erreur lors de la modification du jour exclu")}}catch(a){console.error("Erreur:",a),S(a.message)}finally{A(!1)}},te=async r=>{try{A(!0);const P={date:L(r)};console.log("Données envoyées pour suppression:",P);const t=await fetch(`${J}/deleteexcludedday`,{method:"DELETE",headers:h.headers,body:JSON.stringify(P)});if(t.ok)await B(),T("Jour exclu supprimé avec succès"),S(""),setTimeout(()=>T(""),3e3);else{const n=await t.json();throw new Error(n.error||"Erreur lors de la suppression du jour exclu")}}catch(a){console.error("Erreur:",a),S(a.message)}finally{A(!1)}},re=r=>{if(r){const a=ce(r);C.includes(a)||w([...C,a]),V(null)}},ne=r=>{w(C.filter(a=>a!==r))},se=()=>{w([])},oe=r=>{I({date:r.date,excludeMorning:r.excludeMorning,excludeAfternoon:r.excludeAfternoon}),_(r),w([])},v=()=>{I({date:"",excludeMorning:!1,excludeAfternoon:!1}),_(null)},j=r=>new Date(r).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),ae=r=>new Date(r).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"numeric"}),z=r=>{const a=[];return r.excludeMorning&&a.push("14h-16h"),r.excludeAfternoon&&a.push("16h-18h"),a.length===0?"Aucune période":a.length===2?"Toute la journée":a.join(", ")},X=r=>r.excludeMorning&&r.excludeAfternoon?"error":r.excludeMorning||r.excludeAfternoon?"warning":"default",M=r=>F&&F.date===r;return s.useEffect(()=>{d&&B()},[d]),e.jsx(Ce,{dateAdapter:Ee,adapterLocale:ve,children:e.jsxs(Be,{open:d,onClose:Y,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2,minHeight:"600px"}},children:[e.jsxs(We,{children:[e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(ue,{sx:{mr:1,color:"primary.main"}}),e.jsx(o,{variant:"h6",component:"span",children:"Gestion des Jours Exclus"})]}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Les jours exclus ne sont PAS comptabilisés dans le calcul des présences et absences"})]}),e.jsxs(Ne,{children:[y&&e.jsx(xe,{severity:"error",sx:{mb:2},children:y}),R&&e.jsx(xe,{severity:"success",sx:{mb:2},children:R}),e.jsx($,{variant:"outlined",sx:{mb:3},children:e.jsxs(le,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,color:"primary",children:F?"Modifier le jour exclu":"Ajouter des jours exclus"}),e.jsxs(D,{container:!0,spacing:2,alignItems:"flex-start",children:[e.jsx(D,{item:!0,xs:12,md:6,children:F?e.jsxs(u,{children:[e.jsx(o,{variant:"body1",fontWeight:"medium",gutterBottom:!0,children:"Date en cours de modification :"}),e.jsx(G,{label:j(b.date),color:"primary",variant:"filled",sx:{fontSize:"1rem",py:2}})]}):e.jsxs(u,{children:[e.jsx(o,{variant:"body2",gutterBottom:!0,children:"Sélectionnez les dates à exclure :"}),e.jsx(he,{value:Q,onChange:re,slotProps:{textField:{fullWidth:!0,size:"small",placeholder:"Cliquez pour sélectionner une date"}}}),C.length>0&&e.jsxs(u,{sx:{mt:2},children:[e.jsxs(o,{variant:"body2",gutterBottom:!0,children:["Dates sélectionnées (",C.length,") :"]}),e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:1,maxHeight:120,overflow:"auto",p:1,border:"1px solid",borderColor:"divider",borderRadius:1},children:C.map(r=>e.jsx(G,{label:ae(r),onDelete:()=>ne(r),size:"small",color:"primary",variant:"outlined"},r))}),e.jsx(O,{size:"small",onClick:se,sx:{mt:1},children:"Tout effacer"})]})]})}),e.jsxs(D,{item:!0,xs:12,md:6,children:[e.jsx(o,{variant:"body2",gutterBottom:!0,children:"Périodes à exclure :"}),e.jsxs(u,{display:"flex",gap:2,flexDirection:"column",children:[e.jsx(De,{control:e.jsx(Se,{checked:b.excludeMorning,onChange:r=>I({...b,excludeMorning:r.target.checked}),color:"primary"}),label:"14h-16h"}),e.jsx(De,{control:e.jsx(Se,{checked:b.excludeAfternoon,onChange:r=>I({...b,excludeAfternoon:r.target.checked}),color:"primary"}),label:"16h-18h"})]})]}),e.jsx(D,{item:!0,xs:12,children:e.jsx(u,{display:"flex",gap:1,justifyContent:"flex-end",children:F?e.jsxs(e.Fragment,{children:[e.jsx(O,{variant:"contained",onClick:ee,disabled:g,startIcon:e.jsx(Oe,{}),size:"medium",children:"Modifier"}),e.jsx(O,{variant:"outlined",onClick:v,disabled:g,startIcon:e.jsx(Ge,{}),size:"medium",children:"Annuler"})]}):e.jsxs(O,{variant:"contained",onClick:q,disabled:g||C.length===0,startIcon:e.jsx(Ye,{}),size:"medium",children:["Ajouter ",C.length," date(s)"]})})})]})]})}),e.jsx(de,{sx:{mb:2}}),e.jsxs(u,{children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(o,{variant:"h6",children:["Jours actuellement exclus (",E.length,")"]}),E.length>0&&e.jsxs(o,{variant:"body2",color:"text.secondary",children:[e.jsx(Ae,{sx:{fontSize:16,mr:.5,verticalAlign:"text-bottom"}}),E.length," jour(s) configuré(s)"]})]}),g?e.jsx(u,{display:"flex",justifyContent:"center",alignItems:"center",sx:{py:4},children:e.jsx(ze,{size:40})}):E.length===0?e.jsx($,{variant:"outlined",children:e.jsxs(le,{sx:{textAlign:"center",py:4},children:[e.jsx(ue,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(o,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"Aucun jour exclu pour le moment"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Utilisez le formulaire ci-dessus pour ajouter des jours exclus"})]})}):e.jsx(Pe,{variant:"outlined",children:e.jsx(Te,{sx:{maxHeight:400,overflow:"auto"},children:E.map((r,a)=>e.jsx(Je,{divider:a<E.length-1,sx:{backgroundColor:M(r.date)?"action.selected":"transparent",borderLeft:M(r.date)?4:0,borderColor:M(r.date)?"primary.main":"transparent",transition:"all 0.2s ease"},secondaryAction:e.jsxs(u,{display:"flex",gap:1,children:[e.jsx(be,{title:"Modifier",children:e.jsx(ye,{onClick:()=>oe(r),size:"small",color:"primary",children:e.jsx($e,{})})}),e.jsx(be,{title:"Supprimer",children:e.jsx(ye,{onClick:()=>te(r.date),size:"small",color:"error",children:e.jsx(Ue,{})})})]}),children:e.jsx(Me,{primary:e.jsxs(u,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(o,{variant:"body1",fontWeight:M(r.date)?"bold":"medium",color:M(r.date)?"primary.main":"text.primary",children:j(r.date)}),e.jsx(G,{label:z(r),color:X(r),size:"small",variant:"outlined"}),M(r.date)&&e.jsx(G,{label:"En cours de modification",color:"primary",size:"small",variant:"filled"})]}),secondary:e.jsx(o,{variant:"body2",color:"text.secondary",children:"Exclu du calcul des présences"})})},r.date))})})]})]}),e.jsxs(He,{sx:{p:3,pt:2},children:[e.jsx(O,{onClick:Y,variant:"outlined",children:"Fermer"}),E.length>0&&e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{flexGrow:1},children:[E.length," jour(s) exclu(s) configuré(s)"]})]})]})})},rt=Ie.memo(({item:d,index:Y,formatDate:U})=>e.jsxs(fe,{hover:!0,children:[e.jsx(p,{sx:{fontSize:"9px",p:.5},children:Y+1}),e.jsx(p,{sx:{fontSize:"9px",p:.5},children:e.jsxs(u,{children:[e.jsxs(o,{variant:"body2",fontWeight:"medium",sx:{fontSize:"9px"},children:[d.NOM," ",d.PRENOM]}),d.NOMMARI&&e.jsxs(o,{variant:"caption",color:"textSecondary",sx:{fontSize:"8px"},children:["(",d.NOMMARI,")"]})]})}),e.jsx(p,{sx:{p:.5},children:e.jsx(G,{label:d.STRUCTUREAUTRE||d.STRUCTURE_PARENT_ABBREVIATION,size:"small",variant:"outlined",sx:{fontSize:"8px",height:"20px"}})}),e.jsx(p,{align:"center",sx:{fontSize:"9px",p:.5},children:e.jsx(o,{variant:"body2",fontWeight:"medium",children:d.totalCours})}),e.jsx(p,{align:"center",sx:{p:.5},children:e.jsx(G,{label:d.coursPresents,color:"success",size:"small",sx:{fontSize:"8px",height:"20px"}})}),e.jsx(p,{align:"center",sx:{p:.5},children:e.jsx(G,{label:d.coursAbsents,color:d.coursAbsents>0?"error":"default",size:"small",sx:{fontSize:"8px",height:"20px"}})}),e.jsx(p,{align:"center",sx:{p:.5},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(u,{sx:{width:50,mr:.5},children:e.jsx(Fe,{variant:"determinate",value:d.tauxPresence,color:d.tauxPresence>=75?"success":d.tauxPresence>=50?"warning":"error",sx:{height:"6px"}})}),e.jsxs(o,{variant:"body2",fontWeight:"medium",sx:{fontSize:"9px"},children:[d.tauxPresence,"%"]})]})}),e.jsx(p,{sx:{fontSize:"9px",p:.5},children:e.jsx(o,{variant:"body2",children:U(d.premierePresencePeriode)})}),e.jsx(p,{sx:{fontSize:"9px",p:.5},children:e.jsx(o,{variant:"body2",children:U(d.dernierePresencePeriode)})})]})),Ft=()=>{const[d,Y]=s.useState([]),[U,ie]=s.useState(!0),[E,H]=s.useState(""),[g,A]=s.useState(null),[y,S]=s.useState(null),[R,T]=s.useState([]),[b,I]=s.useState(!1),[F,_]=s.useState(!1),C=s.useRef(),w="",Q=localStorage.getItem("token"),V=s.useMemo(()=>({headers:{Authorization:`Bearer ${Q}`,"Content-Type":"application/json"}}),[Q]),J=s.useCallback(t=>{if(!t)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;const n=new Date(t),i=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),x=String(n.getDate()).padStart(2,"0");return`${i}-${l}-${x}`},[]),Z=s.useCallback(t=>{if(!t)return"";const n=new Date(t),i=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),x=String(n.getDate()).padStart(2,"0");return`${i}-${l}-${x}`},[]),h=s.useCallback(t=>t?Z(t):"",[Z]),L=s.useCallback(t=>t?new Date(t).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"--",[]),ce=s.useCallback(t=>t?new Date(t).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",[]),B=s.useMemo(()=>{const t=new Map;return R.forEach(n=>{t.set(n.date,{excludeMorning:n.excludeMorning,excludeAfternoon:n.excludeAfternoon})}),t},[R]),q=s.useCallback(t=>{const n=Z(t);return B.get(n)||{excludeMorning:!1,excludeAfternoon:!1}},[B,Z]),ee=s.useCallback((t,n)=>{if(!t||!n)return 0;const i=new Date(t),l=new Date(n);let x=0;for(let c=new Date(i);c<=l;c.setDate(c.getDate()+1)){const f=c.getDay();if(f>=1&&f<=5){const m=q(c);m.excludeMorning||(x+=1),m.excludeAfternoon||(x+=1)}}return x},[q]),te=s.useCallback((t,n)=>{const i=q(n);if(i.excludeMorning&&i.excludeAfternoon)return 0;const l=new Date(n);l.setHours(12,0,0,0);const x=new Date(n);x.setHours(16,0,0,0);const c=new Date(n);c.setHours(16,0,0,0);const f=new Date(n);f.setHours(20,0,0,0);let m=0;return i.excludeMorning||t.filter(N=>{const W=N.authDateTime;return W>=l&&W<=x}).length>0&&(m+=1),i.excludeAfternoon||t.filter(N=>{const W=N.authDateTime;return W>=c&&W<=f}).length>0&&(m+=1),m},[q]),re=s.useCallback(t=>t?t.split(" | ").reduce((n,i)=>{const l=i.split(" ");return l.length>=2&&n.push({authDateTime:new Date(`${l[0]} ${l[1]}`),direction:l[3],device:l[4]}),n},[]):[],[]),ne=s.useCallback((t,n,i)=>{if(!t.length||!n||!i)return{premierePresence:null,dernierePresence:null};const l=new Date(n),x=new Date(i);x.setHours(23,59,59,999);const c=t.filter(f=>{const m=f.authDateTime;return m>=l&&m<=x});return c.length===0?{premierePresence:null,dernierePresence:null}:(c.sort((f,m)=>f.authDateTime-m.authDateTime),{premierePresence:c[0].authDateTime,dernierePresence:c[c.length-1].authDateTime})},[]),se=s.useCallback((t,n,i)=>{const l=n?h(n):"",x=i?h(i):"";if(!l||!x)return t.map(k=>({...k,coursPresents:0,coursAbsents:0,totalCours:0,tauxPresence:0,premierePresencePeriode:null,dernierePresencePeriode:null}));const c=ee(l,x),f=new Date(l),m=new Date(x);return t.map(k=>{let N=0,W=null,me=null;if(k.DETAILS_PRESENCES){const pe=re(k.DETAILS_PRESENCES),ge=ne(pe,f,m);W=ge.premierePresence,me=ge.dernierePresence;for(let K=new Date(f);K<=m;K.setDate(K.getDate()+1)){const je=K.getDay();je>=1&&je<=5&&(N+=te(pe,K))}}const we=c-N,ke=c>0?(N/c*100).toFixed(1):0;return{...k,coursPresents:N,coursAbsents:Math.max(0,we),totalCours:c,tauxPresence:parseFloat(ke),premierePresencePeriode:W,dernierePresencePeriode:me}})},[h,ee,re,te,ne]),oe=s.useCallback(t=>[...t].sort((n,i)=>{if(i.coursPresents!==n.coursPresents)return i.coursPresents-n.coursPresents;const l=`${n.NOM||""} ${n.PRENOM||""}`.toUpperCase(),x=`${i.NOM||""} ${i.PRENOM||""}`.toUpperCase();return l.localeCompare(x)}),[]),v=s.useMemo(()=>{if(d.length===0)return[];const t=se(d,g,y);return oe(t)},[d,g,y,se,oe,B]),j=s.useMemo(()=>{let t=0,n=0,i=0;return R.forEach(l=>{l.excludeMorning&&l.excludeAfternoon?i++:(l.excludeMorning&&t++,l.excludeAfternoon&&n++)}),{excludedMorningCount:t,excludedAfternoonCount:n,excludedFullDayCount:i,totalExcludedPeriods:t+n+i*2}},[R]),ae=s.useCallback((t,n)=>{const i=t?h(t):"",l=n?h(n):"";if(!i||!l)return 0;const x=new Date(i),c=new Date(l);let f=0;for(let m=new Date(x);m<=c;m.setDate(m.getDate()+1)){const k=m.getDay();k>=1&&k<=5&&f++}return f},[h]),z=s.useMemo(()=>{const t=v.length>0?v[0].totalCours:0,n=v.reduce((c,f)=>c+f.coursPresents,0),i=v.reduce((c,f)=>c+f.coursAbsents,0),l=t>0?(n/(v.length*t)*100).toFixed(1):0,x=ae(g,y);return{totalCoursGlobal:t,totalPresences:n,totalAbsences:i,tauxPresenceGlobal:l,totalJoursOuvres:x}},[v,ae,g,y]),X=s.useCallback(async()=>{try{_(!0);const t=await fetch(`${w}/getexcludeddays`,{method:"GET",headers:V.headers});if(t.ok){const i=((await t.json()).data||[]).map(l=>({...l,date:J(l.date),excludeMorning:!!l.excludeMorning,excludeAfternoon:!!l.excludeAfternoon}));T(i)}else console.error("Erreur lors du chargement des jours exclus"),H("Impossible de charger les jours exclus")}catch(t){console.error("Erreur:",t),H("Erreur lors du chargement des jours exclus")}finally{_(!1)}},[w,V.headers,J]),M=s.useCallback(async()=>{try{ie(!0);const t=await fetch(`${w}/presencescentreexcellence`,{method:"GET",headers:V.headers});if(t.ok){const i=(await t.json()).data||[];Y(i),H("")}else throw new Error("Erreur lors du chargement des données")}catch(t){console.error("Erreur:",t),H("Impossible de charger les données de présence"),Y([])}finally{ie(!1)}},[w,V.headers]),r=s.useCallback(()=>{A(null),S(null)},[]);s.useEffect(()=>{(async()=>{await X(),await M()})()},[X,M]);const a=s.useCallback(()=>{I(!1),X()},[X]),P=Le.useReactToPrint({content:()=>C.current,documentTitle:`Rapport_Presences_${g?h(g):"all"}_${y?h(y):"all"}`,pageStyle:`
      @page {
        size: A4 landscape;
        margin: 5mm;
        @bottom-center {
          content: "Généré par DGB-Formation - ${new Date().toLocaleDateString("fr-FR")} à ${new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}";
          font-size: 8px;
          color: #666;
          font-family: Arial, sans-serif;
        }
      }
      @media print {
        body { -webkit-print-color-adjust: exact; }
        .no-print { display: none !important; }
        .MuiTableContainer-root { box-shadow: none !important; }
        table { width: 100% !important; }
        .page-footer {
          display: none !important;
        }
      }
    `});return U?e.jsx(u,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(ze,{size:50})}):e.jsx(Ce,{dateAdapter:Ee,adapterLocale:ve,children:e.jsxs(u,{children:[e.jsx($,{elevation:3,className:"no-print",children:e.jsxs(le,{children:[e.jsxs(o,{variant:"h5",gutterBottom:!0,color:"primary",sx:{mb:3},children:[e.jsx(Re,{sx:{mr:1,verticalAlign:"middle"}}),"Récapitulatif des Présences - Centre d'Excellence"]}),E&&e.jsx(xe,{severity:"error",sx:{mb:3},children:E}),e.jsxs($,{variant:"outlined",sx:{mb:3,p:2},children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Filtres par période"}),e.jsxs(D,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(D,{item:!0,xs:12,sm:3,children:e.jsx(he,{label:"Date de début",value:g,onChange:A,slotProps:{textField:{fullWidth:!0,size:"small",placeholder:"Sélectionnez une date"}}})}),e.jsx(D,{item:!0,xs:12,sm:3,children:e.jsx(he,{label:"Date de fin",value:y,onChange:S,slotProps:{textField:{fullWidth:!0,size:"small",placeholder:"Sélectionnez une date"}}})}),e.jsx(D,{item:!0,xs:12,sm:6,children:e.jsxs(u,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(O,{variant:"outlined",onClick:r,size:"small",children:"Réinitialiser"}),e.jsx(O,{variant:"outlined",startIcon:e.jsx(ue,{}),onClick:()=>I(!0),size:"small",color:"warning",disabled:F,children:F?"Chargement...":`Périodes exclues (${j.totalExcludedPeriods})`}),e.jsx(O,{variant:"contained",startIcon:e.jsx(_e,{}),onClick:P,size:"small",color:"primary",disabled:U,children:"Imprimer PDF"})]})})]}),j.totalExcludedPeriods>0&&e.jsxs(u,{sx:{mt:2,p:1,backgroundColor:"#ffebee",borderRadius:1},children:[e.jsxs(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Périodes exclues du calcul :"})," ",j.totalExcludedPeriods," période(s) sur ",z.totalJoursOuvres*2," périodes totales"]}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Détail :"})," ",j.excludedFullDayCount," journée(s) complète(s), ",j.excludedMorningCount," période(s) 14h-16h, ",j.excludedAfternoonCount," période(s) 16h-18h"]}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[e.jsx("strong",{children:"Calcul :"})," ",z.totalJoursOuvres," jours ouvrés × 2 cours/jour = ",z.totalJoursOuvres*2," cours - ",j.totalExcludedPeriods," périodes exclues = ",z.totalCoursGlobal," cours comptabilisés"]}),e.jsx(u,{sx:{mt:1,maxHeight:100,overflow:"auto"},children:R.map((t,n)=>e.jsx(G,{label:`${ce(t.date)}: ${t.excludeMorning&&t.excludeAfternoon?"Toute la journée":t.excludeMorning?"14h-16h":"16h-18h"}`,size:"small",color:"warning",variant:"outlined",sx:{m:.5,fontSize:"0.7rem"}},n))})]})]}),e.jsxs(D,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(D,{item:!0,xs:12,sm:3,children:e.jsxs($,{variant:"outlined",sx:{textAlign:"center",p:2},children:[e.jsx(Ve,{color:"primary",sx:{fontSize:40,mb:1}}),e.jsx(o,{variant:"h4",color:"primary",children:v.length}),e.jsx(o,{variant:"body2",color:"textSecondary",children:"Apprenants formés"})]})}),e.jsx(D,{item:!0,xs:12,sm:3,children:e.jsxs($,{variant:"outlined",sx:{textAlign:"center",p:2},children:[e.jsx(qe,{color:"success",sx:{fontSize:40,mb:1}}),e.jsx(o,{variant:"h4",color:"success",children:z.totalPresences}),e.jsx(o,{variant:"body2",color:"textSecondary",children:"Présences"})]})}),e.jsx(D,{item:!0,xs:12,sm:3,children:e.jsxs($,{variant:"outlined",sx:{textAlign:"center",p:2},children:[e.jsx(Xe,{color:"error",sx:{fontSize:40,mb:1}}),e.jsx(o,{variant:"h4",color:"error",children:z.totalAbsences}),e.jsx(o,{variant:"body2",color:"textSecondary",children:"Absences"})]})}),e.jsx(D,{item:!0,xs:12,sm:3,children:e.jsxs($,{variant:"outlined",sx:{textAlign:"center",p:2},children:[e.jsx(Ae,{color:"info",sx:{fontSize:40,mb:1}}),e.jsxs(o,{variant:"h4",color:"info",children:[z.tauxPresenceGlobal,"%"]}),e.jsx(o,{variant:"body2",color:"textSecondary",children:"Taux présence global"})]})})]})]})}),e.jsx(tt,{open:b,onClose:a,dateDebut:g?h(g):"",dateFin:y?h(y):""}),e.jsx("div",{ref:C,children:e.jsx($,{elevation:1,sx:{mt:2},children:e.jsxs(le,{children:[e.jsxs(u,{sx:{mb:2,textAlign:"center"},children:[e.jsx(o,{variant:"h4",gutterBottom:!0,sx:{fontSize:"18px",fontWeight:"bold"},children:"RAPPORT DE PRÉSENCES - CENTRE D'EXCELLENCE"}),g&&y&&e.jsxs(u,{children:[e.jsxs(o,{variant:"h6",color:"textSecondary",sx:{fontSize:"14px"},children:["Période: ",L(h(g))," - ",L(h(y))]}),j.totalExcludedPeriods>0&&e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mt:1,fontStyle:"italic",fontSize:"10px"},children:["Périodes exclues: ",j.totalExcludedPeriods," période(s) sur ",z.totalJoursOuvres*2,"(",j.excludedFullDayCount," jour(s) complet(s), ",j.excludedMorningCount," matin(s), ",j.excludedAfternoonCount," après-midi(s))"]})]}),e.jsxs(o,{variant:"body1",sx:{mt:1,fontSize:"11px"},children:["Généré le: ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR")]})]}),e.jsx(de,{sx:{mb:2}}),e.jsx(Ze,{component:Pe,elevation:0,children:e.jsxs(Ke,{size:"small",sx:{minWidth:650},children:[e.jsx(Qe,{children:e.jsxs(fe,{children:[e.jsx(p,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5",fontSize:"10px",p:1},children:"N°"}),e.jsx(p,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5",fontSize:"10px",p:1},children:"Nom & Prénom"}),e.jsx(p,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5",fontSize:"10px",p:1},children:"Structure"}),e.jsx(p,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5",fontSize:"10px",p:1},children:"Périodes Totales"}),e.jsx(p,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5",fontSize:"10px",p:1},children:"Présences"}),e.jsx(p,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5",fontSize:"10px",p:1},children:"Absences"}),e.jsx(p,{align:"center",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5",fontSize:"10px",p:1},children:"Taux de Présence (%)"}),e.jsx(p,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5",fontSize:"10px",p:1},children:"Première présence"}),e.jsx(p,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5",fontSize:"10px",p:1},children:"Dernière présence"})]})}),e.jsx(et,{children:v.length===0?e.jsx(fe,{children:e.jsx(p,{colSpan:10,align:"center",sx:{py:3},children:e.jsx(o,{color:"textSecondary",sx:{fontSize:"11px"},children:"Aucune donnée disponible pour la période sélectionnée"})})}):v.map((t,n)=>e.jsx(rt,{item:t,index:n,formatDate:L},`${t.NOM}-${t.PRENOM}-${n}`))})]})}),v.length>0&&e.jsx(u,{sx:{mt:2,pt:1,borderTop:"1px solid #e0e0e0"},children:e.jsxs(D,{container:!0,spacing:1,children:[e.jsx(D,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"caption",color:"textSecondary",sx:{fontSize:"8px"},children:["• ",v.length," apprenants formés",g&&y?` • Période : ${L(h(g))} - ${L(h(y))}`:" • Toute la période",e.jsx("br",{}),j.totalExcludedPeriods>0&&`• ${j.totalExcludedPeriods} période(s) exclue(s) du calcul (${j.excludedFullDayCount} jour(s) complet(s))`,e.jsx("br",{}),"• Trié par présence décroissante (NB: Une période vaut 2hrs)"]})}),e.jsx(D,{item:!0,xs:12,sm:6,sx:{textAlign:"right"},children:e.jsxs(o,{variant:"caption",color:"primary",sx:{fontSize:"25px",fontWeight:"bold"},children:["Taux de présence global: ",z.tauxPresenceGlobal,"% •"]})})]})}),e.jsxs(u,{className:"page-footer",sx:{display:"none"},children:[e.jsx(de,{sx:{my:1}}),e.jsxs(o,{variant:"caption",color:"textSecondary",align:"center",sx:{fontSize:"8px",display:"block",width:"100%"},children:["Généré par DGB-Formation - ",new Date().toLocaleDateString("fr-FR")," à ",new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]})]})})})]})})};export{Ft as default};
