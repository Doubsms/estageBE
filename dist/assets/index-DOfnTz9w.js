import{b as Se,g as Ce,r as p,c as De,a9 as ve,_ as Pe,d as be,j as e,s as ye,e as Te,h as Fe,l as we,Y as b,B as d,H as re,z as B,T as s,v as R,aw as ne,C as H,w as X,G as t,I as te,ax as ie,ay as ae,F as le,D,u as Ne,V as We,A as se,Z as Re,y as O,az as ke,aA as ze,J as ee,L as Oe}from"./index-zHPv1lze.js";import{a as G}from"./index-C3O71W1x.js";import{F as oe,S as ce}from"./Select-DCG_CkE0.js";import{I as de}from"./OutlinedInput-C5vYvqQm.js";import{M as ue}from"./MenuItem-D-1uk7AZ.js";import{A as xe}from"./Alert-D6te_eKs.js";import{B as w}from"./Button-0T1tR8_c.js";import{C as K}from"./CircularProgress-BHFhENdB.js";import{S as Q}from"./Save-ByVVUHNY.js";import{D as me}from"./Description-Dd72SfDg.js";import{T as g}from"./TextField-DNVhVnCv.js";import{G as pe}from"./Group-CKNX0Zix.js";import{L as Ee}from"./LocationOn-We7TmFLi.js";import{E as je}from"./Event-DCg_30F7.js";import{F as _}from"./FormGroup-BSrjtQju.js";import{F as V}from"./FormControlLabel-D_GYa5-T.js";import{C as M}from"./Checkbox-BNRiEFgI.js";import{T as he}from"./Timeline-BXnwFYdk.js";import{A as fe,a as Be,C as Le}from"./AttachMoney-BnH0h83A.js";import{B as Ae}from"./Business-DP4Oq-gt.js";import{A as $e}from"./Autocomplete-DkJdCr17.js";import{P as Ie}from"./Person-CVTBdQV4.js";import{A as Ve}from"./AutoStories-fwsOt3cY.js";import{C as Me}from"./Container-iQUVt9w4.js";import{E as ge,S as Ue,H as Je,P as Ye,A as qe}from"./SwapHoriz-B-zTNYW6.js";import{H as Ge}from"./History-CpgLUztO.js";import{S as He,a as Xe,b as _e,c as Ke,d as Qe}from"./Stepper-lJ9znjCt.js";import{I as Ze}from"./InputAdornment-BgDE6Kz5.js";import{C as er}from"./CalendarToday-BYxDq_1X.js";import{U as rr}from"./CloudUpload-Cg5Zj6Ic.js";import{D as tr}from"./Delete-DRqEtRSt.js";import{C as sr}from"./CheckCircle-BB09QyVE.js";import{S as nr}from"./Send-kcxa8VWl.js";import"./useFormControl-BwsGWz84.js";import"./Close-DS868zx3.js";import"./ButtonGroupButtonContext-BYVHV5Ft.js";import"./FormHelperText-BXMwkblB.js";import"./SwitchBase-CEgujy3G.js";function ir(r){return Se("MuiStepContent",r)}Ce("MuiStepContent",["root","last","transition"]);const ar=["children","className","TransitionComponent","transitionDuration","TransitionProps"],lr=r=>{const{classes:n,last:u}=r;return Fe({root:["root",u&&"last"],transition:["transition"]},ir,n)},or=ye("div",{name:"MuiStepContent",slot:"Root",overridesResolver:(r,n)=>{const{ownerState:u}=r;return[n.root,u.last&&n.last]}})(({ownerState:r,theme:n})=>be({marginLeft:12,paddingLeft:20,paddingRight:8,borderLeft:n.vars?`1px solid ${n.vars.palette.StepContent.border}`:`1px solid ${n.palette.mode==="light"?n.palette.grey[400]:n.palette.grey[600]}`},r.last&&{borderLeft:"none"})),cr=ye(ve,{name:"MuiStepContent",slot:"Transition",overridesResolver:(r,n)=>n.transition})({}),dr=p.forwardRef(function(n,u){const m=De({props:n,name:"MuiStepContent"}),{children:x,className:N,TransitionComponent:a=ve,transitionDuration:j="auto",TransitionProps:y}=m,E=Pe(m,ar),{orientation:c}=p.useContext(He),{active:h,last:v,expanded:k}=p.useContext(Xe),F=be({},m,{last:v}),T=lr(F);let z=j;return j==="auto"&&!a.muiSupportAuto&&(z=void 0),e.jsx(or,be({className:Te(T.root,N),ref:u,ownerState:F},E,{children:e.jsx(cr,be({as:a,in:h||k,className:T.transition,ownerState:F,timeout:z,unmountOnExit:!0},y,{children:x}))}))}),ur=we(e.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),xr=({formation:r,onChange:n,onSave:u,onCancel:m,isSubmitting:x,selectedTriennal:N,headerYears:a})=>{const j=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],y=()=>{if(!N){b.error("Veuillez d'abord sélectionner un plan triennal");return}u()};return e.jsxs(H,{elevation:3,sx:{mb:3,borderRadius:2},children:[e.jsx(ae,{avatar:e.jsx(le,{color:"primary"}),title:e.jsx(s,{variant:"h6",children:"Nouvelle Formation - Centre d'Excellence"}),subheader:"Remplissez les informations de la formation",sx:{bgcolor:"rgba(4, 169, 252, 0.1)"}}),e.jsx(X,{children:e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(me,{sx:{mr:1,verticalAlign:"middle"}}),"Description de la formation"]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(g,{label:"Intitulé de la formation *",name:"intitule",value:r.intitule,onChange:n,fullWidth:!0,required:!0,variant:"outlined",placeholder:"Ex: Formation avancée en gestion de projet"})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Objectifs pédagogiques",name:"objectifs",value:r.objectifs,onChange:n,fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Principaux objectifs de la formation..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Résultats attendus",name:"resultats",value:r.resultats,onChange:n,fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Compétences acquises en fin de formation..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(pe,{sx:{mr:1,verticalAlign:"middle"}}),"Public cible et organisation"]})]}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Cibles",name:"cibles",value:r.cibles,onChange:n,fullWidth:!0,placeholder:"Ex: Managers, Techniciens..."})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Nombre de personnes",name:"nombrePersonnes",type:"number",value:r.nombrePersonnes,onChange:n,fullWidth:!0,InputProps:{inputProps:{min:1}}})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Nombre de vagues",name:"nombreVagues",type:"number",value:r.nombreVagues,onChange:n,fullWidth:!0,InputProps:{inputProps:{min:1}}})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(Ee,{sx:{mr:1,verticalAlign:"middle"}}),"Logistique et planning"]})]}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Lieu",name:"lieu",value:r.lieu,onChange:n,fullWidth:!0,placeholder:"Ex: Salle de formation, En ligne..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Période (jours)",name:"periode",value:r.periode,onChange:n,fullWidth:!0,placeholder:"Ex: 3 jours, 1 semaine..."})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(g,{label:"Prestataire pédagogique",name:"prestations",value:r.prestations,onChange:n,fullWidth:!0,placeholder:"Ex: Cabinet de formation, Interne..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(je,{sx:{mr:1,verticalAlign:"middle"}}),"Planification mensuelle"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(t,{container:!0,spacing:2,children:j.map((E,c)=>e.jsx(t,{item:!0,xs:6,sm:4,md:3,lg:2,children:e.jsx(V,{control:e.jsx(M,{checked:r.jours&&r.jours[c]===1,onChange:()=>{const h=r.jours?[...r.jours]:Array(12).fill(0);h[c]=r.jours[c]?0:1,n({target:{name:"jours",value:h}})}}),label:E})},c))})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(he,{sx:{mr:1,verticalAlign:"middle"}}),"Planification triennale"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(t,{container:!0,spacing:2,children:a.map((E,c)=>e.jsx(t,{item:!0,xs:4,children:e.jsx(V,{control:e.jsx(M,{checked:r.yearData&&r.yearData[`ANNEE${c+1}`]===E,onChange:()=>{const h=r.yearData?{...r.yearData}:{ANNEE1:"",ANNEE2:"",ANNEE3:""},v=`ANNEE${c+1}`;h[v]=h[v]?"":E,n({target:{name:"yearData",value:h}})}}),label:`Année ${c+1} : ${E}`})},c))})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(V,{control:e.jsx(M,{checked:r.improvise===1,onChange:()=>{n({target:{name:"improvise",value:r.improvise===0?1:0}})}}),label:"Formation improvisée (non prévue au plan)"}),r.improvise===1&&e.jsx(s,{variant:"caption",color:"warning.main",sx:{display:"block",ml:4},children:"Cette formation n'était pas prévue au plan initial"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(d,{display:"flex",justifyContent:"flex-end",gap:2,children:[e.jsx(w,{variant:"outlined",onClick:m,disabled:x,children:"Annuler"}),e.jsx(w,{variant:"contained",onClick:y,disabled:x||!r.intitule.trim(),startIcon:x?e.jsx(K,{size:20}):e.jsx(Q,{}),sx:{bgcolor:"green","&:hover":{bgcolor:"darkgreen"}},children:x?"Enregistrement...":"Ajouter à la liste"})]})]})]})})]})},mr=({formation:r,index:n,onDelete:u,onEdit:m,headerYears:x})=>{const N=["J","F","M","A","M","J","J","A","S","O","N","D"];return e.jsx(H,{variant:"outlined",sx:{mb:2,position:"relative",cursor:"pointer","&:hover":{bgcolor:"#f5f5f5"}},children:e.jsx(X,{onClick:()=>m(n),children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(d,{flex:1,children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",children:r.intitule}),r.improvise===1&&e.jsx(R,{label:"Improvisée",size:"small",color:"warning",variant:"outlined"})]}),e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[r.objectifs&&e.jsxs(t,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Objectifs:"}),e.jsx(s,{variant:"body2",children:r.objectifs})]}),e.jsxs(t,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Cibles:"}),e.jsx(s,{variant:"body2",children:r.cibles||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Personnes:"}),e.jsx(s,{variant:"body2",children:r.nombrePersonnes||"-"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Vagues:"}),e.jsx(s,{variant:"body2",children:r.nombreVagues||"-"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Lieu:"}),e.jsx(s,{variant:"body2",children:r.lieu||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Période:"}),e.jsx(s,{variant:"body2",children:r.periode||"Non spécifiée"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Mois prévus:"}),e.jsxs(d,{display:"flex",gap:.5,mt:.5,flexWrap:"wrap",children:[r.jours&&r.jours.map((a,j)=>e.jsx(R,{label:N[j],size:"small",color:a===1?"primary":"default",variant:a===1?"filled":"outlined",sx:{minWidth:30}},j)),(!r.jours||r.jours.every(a=>a===0))&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Aucun mois sélectionné"})]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Années prévues:"}),e.jsxs(d,{display:"flex",gap:1,mt:.5,flexWrap:"wrap",children:[x.map((a,j)=>r.yearData&&r.yearData[`ANNEE${j+1}`]&&e.jsx(R,{label:a,size:"small",color:"secondary",variant:"filled"},j)),(!r.yearData||!r.yearData.ANNEE1&&!r.yearData.ANNEE2&&!r.yearData.ANNEE3)&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Aucune année sélectionnée"})]})]})]})]}),e.jsx(te,{onClick:a=>{a.stopPropagation(),u(n)},color:"error",size:"small",sx:{ml:2},children:e.jsx(ie,{})})]})})})},pr=()=>{const[r,n]=p.useState([]),[u,m]=p.useState({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),[x,N]=p.useState([]),[a,j]=p.useState(""),[y,E]=p.useState(""),[c,h]=p.useState(["ANNEE1","ANNEE2","ANNEE3"]),[v,k]=p.useState(!1),[F,T]=p.useState(!0),[z,W]=p.useState(null),$="";p.useEffect(()=>{U()},[]);const U=async()=>{const l=localStorage.getItem("token");try{const o=await G.get(`${$}/listeplantrienal`,{headers:{Authorization:`Bearer ${l}`}});N(o.data)}catch(o){console.error("Erreur lors de la récupération des triennals:",o),b.error("Impossible de charger les plans triennaux")}},I=l=>{const o=x.find(A=>A.ANNEE1===l.target.value);o&&(E(o.ANNEE1),j(o.IDPLAN),h([o.ANNEE1,o.ANNEE2,o.ANNEE3]))},f=l=>{const{name:o,value:A}=l.target;m(i=>({...i,[o]:A}))},L=()=>{if(!a){b.error("Veuillez d'abord sélectionner un plan triennal");return}if(!u.intitule.trim()){b.error("L'intitulé de la formation est obligatoire");return}if(z!==null){const l=[...r];l[z]={...u},n(l),b.success("Formation mise à jour")}else n([...r,{...u}]),b.success("Formation ajoutée à la liste");m({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),W(null),T(!0)},Y=l=>{m({...r[l]}),W(l),T(!0)},J=l=>{if(window.confirm("Supprimer cette formation de la liste ?")){const o=r.filter((A,i)=>i!==l);n(o),b.info("Formation retirée de la liste")}},q=()=>{m({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),W(null)},S=async()=>{if(!a){b.error("Veuillez sélectionner un plan triennal");return}if(r.length===0){b.error("Veuillez ajouter au moins une formation");return}k(!0);const l=localStorage.getItem("token");try{const o=r.map(i=>({IDPLAN:a,INTITULE:i.intitule,OBJECTIFS:i.objectifs||"",RESULTATATTENDU:i.resultats||"",CIBLES:i.cibles||"",NOMBREPERSONNE:i.nombrePersonnes?parseInt(i.nombrePersonnes):0,NOMBREVAGUE:i.nombreVagues?parseInt(i.nombreVagues):1,LIEU:i.lieu||"À déterminer",PERIODE:i.periode||"",PRESTATATAIREPEDAGOGIQUE:i.prestations||"Interne",TYPEFORMATIONPASSERELLE:"1",PREVUE:i.improvise===1?0:1,MOIS:i.jours||Array(12).fill(0),ANNEE1:i.yearData.ANNEE1||null,ANNEE2:i.yearData.ANNEE2||null,ANNEE3:i.yearData.ANNEE3||null})),A=await G.post(`${$}/nouvelleformation`,o,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},timeout:3e4});(A.status===200||A.status===201)&&(b.success(`${r.length} formation(s) enregistrée(s) avec succès !`),n([]),m({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}))}catch(o){console.error("Erreur:",o),b.error("Erreur lors de l'envoi des données")}finally{k(!1)}};return e.jsxs(d,{sx:{width:"100%",p:3},children:[e.jsx(re,{}),e.jsxs(B,{elevation:1,sx:{p:3,mb:3,borderRadius:2},children:[e.jsxs(d,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,flexWrap:"wrap",gap:2,children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(s,{variant:"h5",fontWeight:"bold",color:"primary",children:"AXE 1: CENTRE D'EXCELLENCE"}),e.jsx(R,{label:"Type 1",color:"primary",size:"small"})]}),e.jsxs(oe,{sx:{minWidth:250},required:!0,children:[e.jsx(de,{children:"Plan Triennal *"}),e.jsx(ce,{value:y,label:"Plan Triennal *",onChange:I,children:x.map((l,o)=>e.jsx(ue,{value:l.ANNEE1,children:`${l.ANNEE1} - ${l.ANNEE2} - ${l.ANNEE3}`},o))})]})]}),!a&&e.jsx(xe,{severity:"warning",sx:{mt:2},children:"Veuillez sélectionner un plan triennal avant d'ajouter des formations"})]}),r.length>0&&e.jsxs(d,{mb:3,children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:["Formations en attente (",r.length,")"]}),r.map((l,o)=>e.jsx(mr,{formation:l,index:o,onDelete:J,onEdit:Y,headerYears:c},o))]}),F&&e.jsx(xr,{formation:u,onChange:f,onSave:L,onCancel:q,isSubmitting:v,selectedTriennal:a,headerYears:c}),!F&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:()=>T(!0),sx:{mb:3},children:"Ajouter une formation"}),r.length>0&&e.jsx(B,{elevation:3,sx:{p:3,bgcolor:"#f5f5f5",borderRadius:2},children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:r.length})," formation(s) prête(s) à être enregistrée(s)"]}),e.jsx(w,{variant:"contained",size:"large",onClick:S,disabled:v||!a,startIcon:v?e.jsx(K,{size:20}):e.jsx(Q,{}),sx:{bgcolor:"green","&:hover":{bgcolor:"darkgreen"}},children:v?"Envoi...":"Enregistrer toutes les formations"})]})})]})},jr=({formation:r,onChange:n,onSave:u,onCancel:m,isSubmitting:x,selectedTriennal:N,headerYears:a})=>{const j=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],y=()=>{if(!N){b.error("Veuillez d'abord sélectionner un plan triennal");return}u()};return e.jsxs(H,{elevation:3,sx:{mb:3,borderRadius:2},children:[e.jsx(ae,{avatar:e.jsx(le,{color:"primary"}),title:e.jsx(s,{variant:"h6",children:"Nouvelle Formation Transversale"}),subheader:"Remplissez les informations de la formation",sx:{bgcolor:"rgba(4, 169, 252, 0.1)"}}),e.jsx(X,{children:e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(me,{sx:{mr:1,verticalAlign:"middle"}}),"Description de la formation"]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(g,{label:"Intitulé de la formation *",name:"intitule",value:r.intitule,onChange:n,fullWidth:!0,required:!0,variant:"outlined",placeholder:"Ex: Formation en communication interpersonnelle"})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Objectifs pédagogiques",name:"objectifs",value:r.objectifs,onChange:n,fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Principaux objectifs de la formation..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Résultats attendus",name:"resultats",value:r.resultats,onChange:n,fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Compétences acquises en fin de formation..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(pe,{sx:{mr:1,verticalAlign:"middle"}}),"Public cible et organisation"]})]}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Cibles",name:"cibles",value:r.cibles,onChange:n,fullWidth:!0,placeholder:"Ex: Managers, Techniciens..."})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Nombre de personnes",name:"nombrePersonnes",type:"number",value:r.nombrePersonnes,onChange:n,fullWidth:!0,InputProps:{inputProps:{min:1}}})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Nombre de vagues",name:"nombreVagues",type:"number",value:r.nombreVagues,onChange:n,fullWidth:!0,InputProps:{inputProps:{min:1}}})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(fe,{sx:{mr:1,verticalAlign:"middle"}}),"Budget et logistique"]})]}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Montant (FCFA)",name:"montant",type:"number",value:r.montant,onChange:n,fullWidth:!0,placeholder:"Ex: 500000"})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Lieu",name:"lieu",value:r.lieu,onChange:n,fullWidth:!0,placeholder:"Ex: Salle de formation, En ligne..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Période (jours)",name:"periode",value:r.periode,onChange:n,fullWidth:!0,placeholder:"Ex: 3 jours, 1 semaine..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Prestataire pédagogique",name:"prestations",value:r.prestations,onChange:n,fullWidth:!0,placeholder:"Ex: Cabinet de formation, Interne..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(je,{sx:{mr:1,verticalAlign:"middle"}}),"Planification mensuelle"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(t,{container:!0,spacing:2,children:j.map((E,c)=>e.jsx(t,{item:!0,xs:6,sm:4,md:3,children:e.jsx(V,{control:e.jsx(M,{checked:r.jours&&r.jours[c]===1,onChange:()=>{const h=r.jours?[...r.jours]:Array(12).fill(0);h[c]=h[c]?0:1,n({target:{name:"jours",value:h}})}}),label:E})},c))})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(he,{sx:{mr:1,verticalAlign:"middle"}}),"Planification triennale"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(t,{container:!0,spacing:2,children:a.map((E,c)=>e.jsx(t,{item:!0,xs:4,children:e.jsx(V,{control:e.jsx(M,{checked:r.yearData&&r.yearData[`ANNEE${c+1}`]===E,onChange:()=>{const h=r.yearData?{...r.yearData}:{ANNEE1:"",ANNEE2:"",ANNEE3:""},v=`ANNEE${c+1}`;h[v]=h[v]?"":E,n({target:{name:"yearData",value:h}})}}),label:`Année ${c+1} : ${E}`})},c))})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(V,{control:e.jsx(M,{checked:r.improvise===1,onChange:()=>{n({target:{name:"improvise",value:r.improvise===0?1:0}})}}),label:"Formation improvisée (non prévue au plan)"}),r.improvise===1&&e.jsx(s,{variant:"caption",color:"warning.main",sx:{display:"block",ml:4},children:"Cette formation n'était pas prévue au plan initial"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(d,{display:"flex",justifyContent:"flex-end",gap:2,children:[e.jsx(w,{variant:"outlined",onClick:m,disabled:x,children:"Annuler"}),e.jsx(w,{variant:"contained",onClick:y,disabled:x||!r.intitule.trim(),startIcon:x?e.jsx(K,{size:20}):e.jsx(Q,{}),sx:{bgcolor:"green","&:hover":{bgcolor:"darkgreen"}},children:x?"Enregistrement...":"Ajouter à la liste"})]})]})]})})]})},hr=({formation:r,index:n,onDelete:u,onEdit:m,headerYears:x})=>{const N=["J","F","M","A","M","J","J","A","S","O","N","D"];return e.jsx(H,{variant:"outlined",sx:{mb:2,position:"relative",cursor:"pointer","&:hover":{bgcolor:"#f5f5f5"}},children:e.jsx(X,{onClick:()=>m(n),children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(d,{flex:1,children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",children:r.intitule}),r.improvise===1&&e.jsx(R,{label:"Improvisée",size:"small",color:"warning",variant:"outlined"})]}),e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[r.objectifs&&e.jsxs(t,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Objectifs:"}),e.jsx(s,{variant:"body2",children:r.objectifs})]}),e.jsxs(t,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Cibles:"}),e.jsx(s,{variant:"body2",children:r.cibles||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Personnes:"}),e.jsx(s,{variant:"body2",children:r.nombrePersonnes||"-"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Vagues:"}),e.jsx(s,{variant:"body2",children:r.nombreVagues||"-"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Montant:"}),e.jsx(s,{variant:"body2",children:r.montant?`${r.montant} FCFA`:"-"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Lieu:"}),e.jsx(s,{variant:"body2",children:r.lieu||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Période:"}),e.jsx(s,{variant:"body2",children:r.periode||"Non spécifiée"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Mois prévus:"}),e.jsxs(d,{display:"flex",gap:.5,mt:.5,flexWrap:"wrap",children:[r.jours&&r.jours.map((a,j)=>e.jsx(R,{label:N[j],size:"small",color:a===1?"primary":"default",variant:a===1?"filled":"outlined",sx:{minWidth:30}},j)),(!r.jours||r.jours.every(a=>a===0))&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Aucun mois sélectionné"})]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Années prévues:"}),e.jsxs(d,{display:"flex",gap:1,mt:.5,flexWrap:"wrap",children:[x.map((a,j)=>r.yearData&&r.yearData[`ANNEE${j+1}`]&&e.jsx(R,{label:a,size:"small",color:"secondary",variant:"filled"},j)),(!r.yearData||!r.yearData.ANNEE1&&!r.yearData.ANNEE2&&!r.yearData.ANNEE3)&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Aucune année sélectionnée"})]})]})]})]}),e.jsx(te,{onClick:a=>{a.stopPropagation(),u(n)},color:"error",size:"small",sx:{ml:2},children:e.jsx(ie,{})})]})})})},br=()=>{const[r,n]=p.useState([]),[u,m]=p.useState({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",montant:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),[x,N]=p.useState([]),[a,j]=p.useState(""),[y,E]=p.useState(""),[c,h]=p.useState(["ANNEE1","ANNEE2","ANNEE3"]),[v,k]=p.useState(!1),[F,T]=p.useState(!0),[z,W]=p.useState(null);p.useEffect(()=>{$()},[]);const $=async()=>{const S=localStorage.getItem("token"),l="";try{const o=await G.get(`${l}/listeplantrienal`,{headers:{Authorization:`Bearer ${S}`}});N(o.data)}catch(o){console.error("Erreur lors de la récupération des triennals:",o),b.error("Impossible de charger les plans triennaux")}},U=S=>{const l=x.find(o=>o.ANNEE1===S.target.value);l&&(E(l.ANNEE1),j(l.IDPLAN),h([l.ANNEE1,l.ANNEE2,l.ANNEE3]))},I=S=>{const{name:l,value:o}=S.target;m(A=>({...A,[l]:o}))},f=()=>{if(!a){b.error("Veuillez d'abord sélectionner un plan triennal");return}if(!u.intitule.trim()){b.error("L'intitulé de la formation est obligatoire");return}if(z!==null){const S=[...r];S[z]={...u},n(S),b.success("Formation mise à jour")}else n([...r,{...u}]),b.success("Formation ajoutée à la liste");m({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",montant:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),W(null),T(!0)},L=S=>{m({...r[S]}),W(S),T(!0)},Y=S=>{if(window.confirm("Supprimer cette formation de la liste ?")){const l=r.filter((o,A)=>A!==S);n(l),b.info("Formation retirée de la liste")}},J=()=>{m({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",montant:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),W(null)},q=async()=>{if(!a){b.error("Veuillez sélectionner un plan triennal");return}if(r.length===0){b.error("Veuillez ajouter au moins une formation");return}k(!0);const S=localStorage.getItem("token"),l="";try{const o=r.map(i=>({IDPLAN:a,INTITULE:i.intitule,OBJECTIFS:i.objectifs||"",RESULTATATTENDU:i.resultats||"",CIBLES:i.cibles||"",NOMBREPERSONNE:i.nombrePersonnes?parseInt(i.nombrePersonnes):0,NOMBREVAGUE:i.nombreVagues?parseInt(i.nombreVagues):1,MONTANT:i.montant?parseInt(i.montant):0,LIEU:i.lieu||"À déterminer",PERIODE:i.periode||"",PRESTATAIREPEDAGOGIQUE:i.prestations||"Interne",TYPEFORMATIONTRANSVERSALLE:"1",PREVUE:i.improvise===1?0:1,MOIS:i.jours||Array(12).fill(0),ANNEE1:i.yearData.ANNEE1||null,ANNEE2:i.yearData.ANNEE2||null,ANNEE3:i.yearData.ANNEE3||null})),A=await G.post(`${l}/nouvelleformation`,o,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`},timeout:3e4});(A.status===200||A.status===201)&&(b.success(`${r.length} formation(s) enregistrée(s) avec succès !`),n([]),m({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",montant:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}))}catch(o){console.error("Erreur:",o),b.error("Erreur lors de l'envoi des données")}finally{k(!1)}};return e.jsxs(d,{sx:{width:"100%",p:3},children:[e.jsx(re,{}),e.jsxs(B,{elevation:1,sx:{p:3,mb:3,borderRadius:2},children:[e.jsxs(d,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,flexWrap:"wrap",gap:2,children:[e.jsxs(d,{children:[e.jsx(s,{variant:"h5",color:"black",gutterBottom:!0,children:"AXE 2 : FORMATIONS PONCTUELLES"}),e.jsx(s,{variant:"h5",color:"blue",children:"A. FORMATIONS TRANSVERSALES"})]}),e.jsx(R,{label:"Type Transversal",color:"secondary",size:"medium"})]}),e.jsxs(oe,{sx:{minWidth:250},required:!0,children:[e.jsx(de,{children:"Plan Triennal *"}),e.jsx(ce,{value:y,label:"Plan Triennal *",onChange:U,children:x.map((S,l)=>e.jsx(ue,{value:S.ANNEE1,children:`${S.ANNEE1} - ${S.ANNEE2} - ${S.ANNEE3}`},l))})]}),!a&&e.jsx(xe,{severity:"warning",sx:{mt:2},children:"Veuillez sélectionner un plan triennal avant d'ajouter des formations"})]}),r.length>0&&e.jsxs(d,{mb:3,children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:["Formations en attente (",r.length,")"]}),r.map((S,l)=>e.jsx(hr,{formation:S,index:l,onDelete:Y,onEdit:L,headerYears:c},l))]}),F&&e.jsx(jr,{formation:u,onChange:I,onSave:f,onCancel:J,isSubmitting:v,selectedTriennal:a,headerYears:c}),!F&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:()=>T(!0),sx:{mb:3},children:"Ajouter une formation"}),r.length>0&&e.jsx(B,{elevation:3,sx:{p:3,bgcolor:"#f5f5f5",borderRadius:2},children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:r.length})," formation(s) prête(s) à être enregistrée(s)"]}),e.jsx(w,{variant:"contained",size:"large",onClick:q,disabled:v||!a,startIcon:v?e.jsx(K,{size:20}):e.jsx(Q,{}),sx:{bgcolor:"green","&:hover":{bgcolor:"darkgreen"}},children:v?"Envoi...":"Enregistrer toutes les formations"})]})})]})},Er=({formation:r,onChange:n,onSave:u,onCancel:m,isSubmitting:x,selectedTriennal:N,headerYears:a,structures:j})=>{const y=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],E=()=>{if(!N){b.error("Veuillez d'abord sélectionner un plan triennal");return}u()};return e.jsxs(H,{elevation:3,sx:{mb:3,borderRadius:2},children:[e.jsx(ae,{avatar:e.jsx(le,{color:"primary"}),title:e.jsx(s,{variant:"h6",children:"Nouvelle Formation - Spécialisation Fonctionnelle"}),subheader:"Remplissez les informations de la formation",sx:{bgcolor:"rgba(4, 169, 252, 0.1)"}}),e.jsx(X,{children:e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(Ae,{sx:{mr:1,verticalAlign:"middle"}}),"Structure bénéficiaire"]})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx($e,{options:j,getOptionLabel:c=>c.ABBREVIATION||"",value:j.find(c=>c.IDSTRUCTURE===r.idStructure)||null,onChange:(c,h)=>{n({target:{name:"idStructure",value:h?h.IDSTRUCTURE:""}}),n({target:{name:"structureBeneficiaire",value:h?h.ABBREVIATION:""}})},renderInput:c=>e.jsx(g,{...c,label:"Structure bénéficiaire *",required:!0,fullWidth:!0})})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Structure (texte libre)",name:"structureBeneficiaire",value:r.structureBeneficiaire,onChange:n,fullWidth:!0,placeholder:"Ou saisissez directement le nom"})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(me,{sx:{mr:1,verticalAlign:"middle"}}),"Description de la formation"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(g,{label:"Intitulé de la formation *",name:"intitule",value:r.intitule,onChange:n,fullWidth:!0,required:!0,variant:"outlined",placeholder:"Ex: Formation spécialisée en analyse financière"})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Objectifs pédagogiques",name:"objectifs",value:r.objectifs,onChange:n,fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Principaux objectifs de la formation..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Résultats attendus",name:"resultats",value:r.resultats,onChange:n,fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Compétences acquises en fin de formation..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(pe,{sx:{mr:1,verticalAlign:"middle"}}),"Public cible et organisation"]})]}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Cibles",name:"cibles",value:r.cibles,onChange:n,fullWidth:!0,placeholder:"Ex: Managers, Techniciens..."})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Nombre de personnes",name:"nombrePersonnes",type:"number",value:r.nombrePersonnes,onChange:n,fullWidth:!0,InputProps:{inputProps:{min:1}}})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Nombre de vagues",name:"nombreVagues",type:"number",value:r.nombreVagues,onChange:n,fullWidth:!0,InputProps:{inputProps:{min:1}}})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(fe,{sx:{mr:1,verticalAlign:"middle"}}),"Budget et logistique"]})]}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Montant (FCFA)",name:"montant",type:"number",value:r.montant,onChange:n,fullWidth:!0,placeholder:"Ex: 500000"})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Lieu",name:"lieu",value:r.lieu,onChange:n,fullWidth:!0,placeholder:"Ex: Salle de formation, En ligne..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Période (jours)",name:"periode",value:r.periode,onChange:n,fullWidth:!0,placeholder:"Ex: 3 jours, 1 semaine..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Prestataire pédagogique",name:"prestations",value:r.prestations,onChange:n,fullWidth:!0,placeholder:"Ex: Cabinet de formation, Interne..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(je,{sx:{mr:1,verticalAlign:"middle"}}),"Planification mensuelle"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(t,{container:!0,spacing:2,children:y.map((c,h)=>e.jsx(t,{item:!0,xs:6,sm:4,md:3,children:e.jsx(V,{control:e.jsx(M,{checked:r.jours&&r.jours[h]===1,onChange:()=>{const v=r.jours?[...r.jours]:Array(12).fill(0);v[h]=v[h]?0:1,n({target:{name:"jours",value:v}})}}),label:c})},h))})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(he,{sx:{mr:1,verticalAlign:"middle"}}),"Planification triennale"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(t,{container:!0,spacing:2,children:a.map((c,h)=>e.jsx(t,{item:!0,xs:4,children:e.jsx(V,{control:e.jsx(M,{checked:r.yearData&&r.yearData[`ANNEE${h+1}`]===c,onChange:()=>{const v=r.yearData?{...r.yearData}:{ANNEE1:"",ANNEE2:"",ANNEE3:""},k=`ANNEE${h+1}`;v[k]=v[k]?"":c,n({target:{name:"yearData",value:v}})}}),label:`Année ${h+1} : ${c}`})},h))})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(V,{control:e.jsx(M,{checked:r.improvise===1,onChange:()=>{n({target:{name:"improvise",value:r.improvise===0?1:0}})}}),label:"Formation improvisée (non prévue au plan)"}),r.improvise===1&&e.jsx(s,{variant:"caption",color:"warning.main",sx:{display:"block",ml:4},children:"Cette formation n'était pas prévue au plan initial"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(d,{display:"flex",justifyContent:"flex-end",gap:2,children:[e.jsx(w,{variant:"outlined",onClick:m,disabled:x,children:"Annuler"}),e.jsx(w,{variant:"contained",onClick:E,disabled:x||!r.intitule.trim(),startIcon:x?e.jsx(K,{size:20}):e.jsx(Q,{}),sx:{bgcolor:"green","&:hover":{bgcolor:"darkgreen"}},children:x?"Enregistrement...":"Ajouter à la liste"})]})]})]})})]})},gr=({formation:r,index:n,onDelete:u,onEdit:m,headerYears:x})=>{const N=["J","F","M","A","M","J","J","A","S","O","N","D"];return e.jsx(H,{variant:"outlined",sx:{mb:2,position:"relative",cursor:"pointer","&:hover":{bgcolor:"#f5f5f5"}},children:e.jsx(X,{onClick:()=>m(n),children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(d,{flex:1,children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",children:r.intitule}),r.improvise===1&&e.jsx(R,{label:"Improvisée",size:"small",color:"warning",variant:"outlined"})]}),e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(d,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Ae,{fontSize:"small",color:"action"}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Structure:"})," ",r.structureBeneficiaire||r.idStructure||"Non spécifiée"]})]})}),r.objectifs&&e.jsxs(t,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Objectifs:"}),e.jsx(s,{variant:"body2",children:r.objectifs})]}),e.jsxs(t,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Cibles:"}),e.jsx(s,{variant:"body2",children:r.cibles||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Personnes:"}),e.jsx(s,{variant:"body2",children:r.nombrePersonnes||"-"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Vagues:"}),e.jsx(s,{variant:"body2",children:r.nombreVagues||"-"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Montant:"}),e.jsx(s,{variant:"body2",children:r.montant?`${r.montant} FCFA`:"-"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Lieu:"}),e.jsx(s,{variant:"body2",children:r.lieu||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Période:"}),e.jsx(s,{variant:"body2",children:r.periode||"Non spécifiée"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Mois prévus:"}),e.jsxs(d,{display:"flex",gap:.5,mt:.5,flexWrap:"wrap",children:[r.jours&&r.jours.map((a,j)=>e.jsx(R,{label:N[j],size:"small",color:a===1?"primary":"default",variant:a===1?"filled":"outlined",sx:{minWidth:30}},j)),(!r.jours||r.jours.every(a=>a===0))&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Aucun mois sélectionné"})]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Années prévues:"}),e.jsxs(d,{display:"flex",gap:1,mt:.5,flexWrap:"wrap",children:[x.map((a,j)=>r.yearData&&r.yearData[`ANNEE${j+1}`]&&e.jsx(R,{label:a,size:"small",color:"secondary",variant:"filled"},j)),(!r.yearData||!r.yearData.ANNEE1&&!r.yearData.ANNEE2&&!r.yearData.ANNEE3)&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Aucune année sélectionnée"})]})]})]})]}),e.jsx(te,{onClick:a=>{a.stopPropagation(),u(n)},color:"error",size:"small",sx:{ml:2},children:e.jsx(ie,{})})]})})})},vr=()=>{const[r,n]=p.useState([]),[u,m]=p.useState({idStructure:"",structureBeneficiaire:"",intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",montant:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),[x,N]=p.useState([]),[a,j]=p.useState(""),[y,E]=p.useState(""),[c,h]=p.useState(["ANNEE1","ANNEE2","ANNEE3"]),[v,k]=p.useState([]),[F,T]=p.useState(!1),[z,W]=p.useState(!0),[$,U]=p.useState(null),I="";p.useEffect(()=>{f(),L()},[]);const f=async()=>{const i=localStorage.getItem("token");try{const C=await G.get(`${I}/listestructures`,{headers:{Authorization:`Bearer ${i}`}});k(C.data)}catch(C){console.error(C),b.error("Erreur lors du chargement des structures")}},L=async()=>{const i=localStorage.getItem("token");try{const C=await G.get(`${I}/listeplantrienal`,{headers:{Authorization:`Bearer ${i}`}});N(C.data)}catch(C){console.error(C),b.error("Erreur lors du chargement des plans triennaux")}},Y=i=>{const C=x.find(Z=>Z.ANNEE1===i.target.value);C&&(E(C.ANNEE1),j(C.IDPLAN),h([C.ANNEE1,C.ANNEE2,C.ANNEE3]))},J=i=>{const{name:C,value:Z}=i.target;m(P=>({...P,[C]:Z}))},q=()=>{if(!a){b.error("Veuillez d'abord sélectionner un plan triennal");return}if(!u.intitule.trim()){b.error("L'intitulé de la formation est obligatoire");return}if($!==null){const i=[...r];i[$]={...u},n(i),b.success("Formation mise à jour")}else n([...r,{...u}]),b.success("Formation ajoutée à la liste");m({idStructure:"",structureBeneficiaire:"",intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",montant:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),U(null),W(!0)},S=i=>{m({...r[i]}),U(i),W(!0)},l=i=>{if(window.confirm("Supprimer cette formation de la liste ?")){const C=r.filter((Z,P)=>P!==i);n(C),b.info("Formation retirée de la liste")}},o=()=>{m({idStructure:"",structureBeneficiaire:"",intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",montant:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),U(null)},A=async()=>{if(!a){b.error("Veuillez sélectionner un plan triennal");return}if(r.length===0){b.error("Veuillez ajouter au moins une formation");return}T(!0);const i=localStorage.getItem("token");try{const C=r.map(P=>({IDPLAN:a,IDSTRUCTUREBENEFICIAIRE:P.idStructure||null,STRUCTUREBENEFICIAIRE:P.structureBeneficiaire||"",INTITULE:P.intitule,OBJECTIFS:P.objectifs||"",RESULTATATTENDU:P.resultats||"",CIBLES:P.cibles||"",NOMBREPERSONNE:P.nombrePersonnes?parseInt(P.nombrePersonnes):0,NOMBREVAGUE:P.nombreVagues?parseInt(P.nombreVagues):1,MONTANT:P.montant?parseInt(P.montant):0,LIEU:P.lieu||"À déterminer",PERIODE:P.periode||"",PRESTATAIREPEDAGOGIQUE:P.prestations||"Interne",TYPEFORMATIONSPECIALISATIONFONCTIONEL:"1",PREVUE:P.improvise===1?0:1,MOIS:P.jours||Array(12).fill(0),ANNEE1:P.yearData.ANNEE1||null,ANNEE2:P.yearData.ANNEE2||null,ANNEE3:P.yearData.ANNEE3||null})),Z=await G.post(`${I}/nouvelleformation`,C,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},timeout:3e4});(Z.status===200||Z.status===201)&&(b.success(`${r.length} formation(s) enregistrée(s) avec succès !`),n([]),m({idStructure:"",structureBeneficiaire:"",intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",montant:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}))}catch(C){console.error("Erreur:",C),b.error("Erreur lors de l'envoi des données")}finally{T(!1)}};return e.jsxs(d,{sx:{width:"100%",p:3},children:[e.jsx(re,{}),e.jsxs(B,{elevation:1,sx:{p:3,mb:3,borderRadius:2},children:[e.jsxs(d,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,flexWrap:"wrap",gap:2,children:[e.jsxs(d,{children:[e.jsx(s,{variant:"h5",color:"black",gutterBottom:!0,children:"AXE 2 : FORMATIONS PONCTUELLES"}),e.jsx(s,{variant:"h5",color:"blue",children:"B. SPÉCIALISATION FONCTIONNELLE"})]}),e.jsx(R,{label:"Spécialisation",color:"info",size:"medium"})]}),e.jsxs(oe,{sx:{minWidth:250},required:!0,children:[e.jsx(de,{children:"Plan Triennal *"}),e.jsx(ce,{value:y,label:"Plan Triennal *",onChange:Y,children:x.map((i,C)=>e.jsx(ue,{value:i.ANNEE1,children:`${i.ANNEE1} - ${i.ANNEE2} - ${i.ANNEE3}`},C))})]}),!a&&e.jsx(xe,{severity:"warning",sx:{mt:2},children:"Veuillez sélectionner un plan triennal avant d'ajouter des formations"})]}),r.length>0&&e.jsxs(d,{mb:3,children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:["Formations en attente (",r.length,")"]}),r.map((i,C)=>e.jsx(gr,{formation:i,index:C,onDelete:l,onEdit:S,headerYears:c},C))]}),z&&e.jsx(Er,{formation:u,onChange:J,onSave:q,onCancel:o,isSubmitting:F,selectedTriennal:a,headerYears:c,structures:v}),!z&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:()=>W(!0),sx:{mb:3},children:"Ajouter une formation"}),r.length>0&&e.jsx(B,{elevation:3,sx:{p:3,bgcolor:"#f5f5f5",borderRadius:2},children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:r.length})," formation(s) prête(s) à être enregistrée(s)"]}),e.jsx(w,{variant:"contained",size:"large",onClick:A,disabled:F||!a,startIcon:F?e.jsx(K,{size:20}):e.jsx(Q,{}),sx:{bgcolor:"green","&:hover":{bgcolor:"darkgreen"}},children:F?"Envoi...":"Enregistrer toutes les formations"})]})})]})},yr=({formation:r,onChange:n,onSave:u,onCancel:m,isSubmitting:x,selectedTriennal:N,headerYears:a})=>{const j=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],y=()=>{if(!N){b.error("Veuillez d'abord sélectionner un plan triennal");return}u()};return e.jsxs(H,{elevation:3,sx:{mb:3,borderRadius:2},children:[e.jsx(ae,{avatar:e.jsx(le,{color:"primary"}),title:e.jsx(s,{variant:"h6",children:"Nouvelle Formation Individuelle"}),subheader:"Remplissez les informations de la formation",sx:{bgcolor:"rgba(4, 169, 252, 0.1)"}}),e.jsx(X,{children:e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(me,{sx:{mr:1,verticalAlign:"middle"}}),"Description de la formation"]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(g,{label:"Modalité de la formation *",name:"intitule",value:r.intitule,onChange:n,fullWidth:!0,required:!0,variant:"outlined",placeholder:"Ex: Coaching individuel, Formation sur mesure..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Objectifs pédagogiques",name:"objectifs",value:r.objectifs,onChange:n,fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Objectifs spécifiques à l'apprenant..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Résultats attendus",name:"resultats",value:r.resultats,onChange:n,fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Compétences attendues en fin de formation..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(pe,{sx:{mr:1,verticalAlign:"middle"}}),"Public cible et organisation"]})]}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Cibles",name:"cibles",value:r.cibles,onChange:n,fullWidth:!0,placeholder:"Ex: Cadres, Agents de maîtrise..."})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Nombre de personnes",name:"nombrePersonnes",type:"number",value:r.nombrePersonnes,onChange:n,fullWidth:!0,InputProps:{inputProps:{min:1}},placeholder:"Ex: 1, 2, 3..."})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsx(g,{label:"Nombre de vagues",name:"nombreVagues",type:"number",value:r.nombreVagues,onChange:n,fullWidth:!0,InputProps:{inputProps:{min:1}},placeholder:"Ex: 1, 2, 3..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(Ee,{sx:{mr:1,verticalAlign:"middle"}}),"Logistique et planning"]})]}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Lieu",name:"lieu",value:r.lieu,onChange:n,fullWidth:!0,placeholder:"Ex: Salle de formation, À distance..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Période (jours)",name:"periode",value:r.periode,onChange:n,fullWidth:!0,placeholder:"Ex: 1 jour, 2 jours..."})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(g,{label:"Prestataire pédagogique",name:"prestations",value:r.prestations,onChange:n,fullWidth:!0,placeholder:"Ex: Formateur interne, Coach externe..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(je,{sx:{mr:1,verticalAlign:"middle"}}),"Planification mensuelle"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(t,{container:!0,spacing:2,children:j.map((E,c)=>e.jsx(t,{item:!0,xs:6,sm:4,md:3,children:e.jsx(V,{control:e.jsx(M,{checked:r.jours&&r.jours[c]===1,onChange:()=>{const h=r.jours?[...r.jours]:Array(12).fill(0);h[c]=h[c]?0:1,n({target:{name:"jours",value:h}})}}),label:E})},c))})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(he,{sx:{mr:1,verticalAlign:"middle"}}),"Planification triennale"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(t,{container:!0,spacing:2,children:a.map((E,c)=>e.jsx(t,{item:!0,xs:4,children:e.jsx(V,{control:e.jsx(M,{checked:r.yearData&&r.yearData[`ANNEE${c+1}`]===E,onChange:()=>{const h=r.yearData?{...r.yearData}:{ANNEE1:"",ANNEE2:"",ANNEE3:""},v=`ANNEE${c+1}`;h[v]=h[v]?"":E,n({target:{name:"yearData",value:h}})}}),label:`Année ${c+1} : ${E}`})},c))})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(V,{control:e.jsx(M,{checked:r.improvise===1,onChange:()=>{n({target:{name:"improvise",value:r.improvise===0?1:0}})}}),label:"Formation improvisée (non prévue au plan)"}),r.improvise===1&&e.jsx(s,{variant:"caption",color:"warning.main",sx:{display:"block",ml:4},children:"Cette formation n'était pas prévue au plan initial"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(d,{display:"flex",justifyContent:"flex-end",gap:2,children:[e.jsx(w,{variant:"outlined",onClick:m,disabled:x,children:"Annuler"}),e.jsx(w,{variant:"contained",onClick:y,disabled:x||!r.intitule.trim(),startIcon:x?e.jsx(K,{size:20}):e.jsx(Q,{}),sx:{bgcolor:"green","&:hover":{bgcolor:"darkgreen"}},children:x?"Enregistrement...":"Ajouter à la liste"})]})]})]})})]})},Nr=({formation:r,index:n,onDelete:u,onEdit:m,headerYears:x})=>{const N=["J","F","M","A","M","J","J","A","S","O","N","D"];return e.jsx(H,{variant:"outlined",sx:{mb:2,position:"relative",cursor:"pointer","&:hover":{bgcolor:"#f5f5f5"}},children:e.jsx(X,{onClick:()=>m(n),children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(d,{flex:1,children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",children:r.intitule}),r.improvise===1&&e.jsx(R,{label:"Improvisée",size:"small",color:"warning",variant:"outlined"})]}),e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[r.objectifs&&e.jsxs(t,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Objectifs:"}),e.jsx(s,{variant:"body2",children:r.objectifs})]}),e.jsxs(t,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Cibles:"}),e.jsx(s,{variant:"body2",children:r.cibles||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Personnes:"}),e.jsx(s,{variant:"body2",children:r.nombrePersonnes||"-"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Vagues:"}),e.jsx(s,{variant:"body2",children:r.nombreVagues||"-"})]}),e.jsxs(t,{item:!0,xs:6,md:2,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Lieu:"}),e.jsx(s,{variant:"body2",children:r.lieu||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Période:"}),e.jsx(s,{variant:"body2",children:r.periode||"Non spécifiée"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Prestataire:"}),e.jsx(s,{variant:"body2",children:r.prestations||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Mois prévus:"}),e.jsxs(d,{display:"flex",gap:.5,mt:.5,flexWrap:"wrap",children:[r.jours&&r.jours.map((a,j)=>e.jsx(R,{label:N[j],size:"small",color:a===1?"primary":"default",variant:a===1?"filled":"outlined",sx:{minWidth:30}},j)),(!r.jours||r.jours.every(a=>a===0))&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Aucun mois sélectionné"})]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Années prévues:"}),e.jsxs(d,{display:"flex",gap:1,mt:.5,flexWrap:"wrap",children:[x.map((a,j)=>r.yearData&&r.yearData[`ANNEE${j+1}`]&&e.jsx(R,{label:a,size:"small",color:"secondary",variant:"filled"},j)),(!r.yearData||!r.yearData.ANNEE1&&!r.yearData.ANNEE2&&!r.yearData.ANNEE3)&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Aucune année sélectionnée"})]})]})]})]}),e.jsx(te,{onClick:a=>{a.stopPropagation(),u(n)},color:"error",size:"small",sx:{ml:2},children:e.jsx(ie,{})})]})})})},fr=()=>{const[r,n]=p.useState([]),[u,m]=p.useState({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),[x,N]=p.useState([]),[a,j]=p.useState(""),[y,E]=p.useState(""),[c,h]=p.useState(["ANNEE1","ANNEE2","ANNEE3"]),[v,k]=p.useState(!1),[F,T]=p.useState(!0),[z,W]=p.useState(null),$="";p.useEffect(()=>{U()},[]);const U=async()=>{const l=localStorage.getItem("token");try{const o=await G.get(`${$}/listeplantrienal`,{headers:{Authorization:`Bearer ${l}`}});N(o.data)}catch(o){console.error("Erreur lors de la récupération des triennals:",o),b.error("Impossible de charger les plans triennaux")}},I=l=>{const o=x.find(A=>A.ANNEE1===l.target.value);o&&(E(o.ANNEE1),j(o.IDPLAN),h([o.ANNEE1,o.ANNEE2,o.ANNEE3]))},f=l=>{const{name:o,value:A}=l.target;m(i=>({...i,[o]:A}))},L=()=>{if(!a){b.error("Veuillez d'abord sélectionner un plan triennal");return}if(!u.intitule.trim()){b.error("La modalité de formation est obligatoire");return}if(z!==null){const l=[...r];l[z]={...u},n(l),b.success("Formation mise à jour")}else n([...r,{...u}]),b.success("Formation ajoutée à la liste");m({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),W(null),T(!0)},Y=l=>{m({...r[l]}),W(l),T(!0)},J=l=>{if(window.confirm("Supprimer cette formation de la liste ?")){const o=r.filter((A,i)=>i!==l);n(o),b.info("Formation retirée de la liste")}},q=()=>{m({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),W(null)},S=async()=>{if(!a){b.error("Veuillez sélectionner un plan triennal");return}if(r.length===0){b.error("Veuillez ajouter au moins une formation");return}k(!0);const l=localStorage.getItem("token");try{const o=r.map(i=>({IDPLAN:a,INTITULE:i.intitule,OBJECTIFS:i.objectifs||"",RESULTATATTENDU:i.resultats||"",CIBLES:i.cibles||"",NOMBREPERSONNE:i.nombrePersonnes?parseInt(i.nombrePersonnes):0,NOMBREVAGUE:i.nombreVagues?parseInt(i.nombreVagues):1,LIEU:i.lieu||"À déterminer",PERIODE:i.periode||"",PRESTATAIREPEDAGOGIQUE:i.prestations||"Interne",TYPEFORMATIONINDIVIDUELLE:"1",PREVUE:i.improvise===1?0:1,MOIS:i.jours||Array(12).fill(0),ANNEE1:i.yearData.ANNEE1||null,ANNEE2:i.yearData.ANNEE2||null,ANNEE3:i.yearData.ANNEE3||null})),A=await G.post(`${$}/nouvelleformation`,o,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},timeout:3e4});(A.status===200||A.status===201)&&(b.success(`${r.length} formation(s) enregistrée(s) avec succès !`),n([]),m({intitule:"",objectifs:"",resultats:"",cibles:"",nombrePersonnes:"",nombreVagues:"",lieu:"",periode:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}))}catch(o){console.error("Erreur:",o),b.error("Erreur lors de l'envoi des données")}finally{k(!1)}};return e.jsxs(d,{sx:{width:"100%",p:3},children:[e.jsx(re,{}),e.jsxs(B,{elevation:1,sx:{p:3,mb:3,borderRadius:2},children:[e.jsxs(d,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,flexWrap:"wrap",gap:2,children:[e.jsxs(d,{children:[e.jsx(s,{variant:"h5",color:"black",gutterBottom:!0,children:"AXE 2 : FORMATIONS PONCTUELLES"}),e.jsx(s,{variant:"h5",color:"blue",children:"C. FORMATION INDIVIDUELLE"})]}),e.jsx(R,{label:"Formation Individuelle",color:"success",size:"medium",icon:e.jsx(Ie,{})})]}),e.jsxs(oe,{sx:{minWidth:250},required:!0,children:[e.jsx(de,{children:"Plan Triennal *"}),e.jsx(ce,{value:y,label:"Plan Triennal *",onChange:I,children:x.map((l,o)=>e.jsx(ue,{value:l.ANNEE1,children:`${l.ANNEE1} - ${l.ANNEE2} - ${l.ANNEE3}`},o))})]}),!a&&e.jsx(xe,{severity:"warning",sx:{mt:2},children:"Veuillez sélectionner un plan triennal avant d'ajouter des formations"})]}),r.length>0&&e.jsxs(d,{mb:3,children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:["Formations individuelles en attente (",r.length,")"]}),r.map((l,o)=>e.jsx(Nr,{formation:l,index:o,onDelete:J,onEdit:Y,headerYears:c},o))]}),F&&e.jsx(yr,{formation:u,onChange:f,onSave:L,onCancel:q,isSubmitting:v,selectedTriennal:a,headerYears:c}),!F&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:()=>T(!0),sx:{mb:3},children:"Ajouter une formation individuelle"}),r.length>0&&e.jsx(B,{elevation:3,sx:{p:3,bgcolor:"#f5f5f5",borderRadius:2},children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:r.length})," formation(s) individuelle(s) prête(s) à être enregistrée(s)"]}),e.jsx(w,{variant:"contained",size:"large",onClick:S,disabled:v||!a,startIcon:v?e.jsx(K,{size:20}):e.jsx(Q,{}),sx:{bgcolor:"green","&:hover":{bgcolor:"darkgreen"}},children:v?"Envoi...":"Enregistrer toutes les formations"})]})})]})},Ar=({formation:r,onChange:n,onSave:u,onCancel:m,isSubmitting:x,selectedTriennal:N,headerYears:a})=>{const j=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],y=()=>{if(!N){b.error("Veuillez d'abord sélectionner un plan triennal");return}u()};return e.jsxs(H,{elevation:3,sx:{mb:3,borderRadius:2},children:[e.jsx(ae,{avatar:e.jsx(le,{color:"primary"}),title:e.jsx(s,{variant:"h6",children:"Nouvelle Auto-Formation"}),subheader:"Remplissez les informations de l'auto-formation",sx:{bgcolor:"rgba(4, 169, 252, 0.1)"}}),e.jsx(X,{children:e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(me,{sx:{mr:1,verticalAlign:"middle"}}),"Description de l'auto-formation"]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(g,{label:"Modalité de l'auto-formation *",name:"intitule",value:r.intitule,onChange:n,fullWidth:!0,required:!0,variant:"outlined",placeholder:"Ex: Formation en ligne, Module e-learning, Cours autodidacte..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Objectifs pédagogiques",name:"objectifs",value:r.objectifs,onChange:n,fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Objectifs d'apprentissage autonome..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Résultats attendus",name:"resultats",value:r.resultats,onChange:n,fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Compétences à acquérir en autonomie..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(pe,{sx:{mr:1,verticalAlign:"middle"}}),"Public cible"]})]}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Cibles",name:"cibles",value:r.cibles,onChange:n,fullWidth:!0,placeholder:"Ex: Tous les collaborateurs, Équipe technique..."})}),e.jsx(t,{item:!0,xs:12,md:6,children:e.jsx(g,{label:"Lieu / Plateforme",name:"lieu",value:r.lieu,onChange:n,fullWidth:!0,placeholder:"Ex: Plateforme en ligne, Bibliothèque, À distance..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(Ee,{sx:{mr:1,verticalAlign:"middle"}}),"Ressources et accompagnement"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(g,{label:"Ressources / Prestataire",name:"prestations",value:r.prestations,onChange:n,fullWidth:!0,placeholder:"Ex: Plateforme Udemy, Bibliothèque en ligne, Mentor..."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(je,{sx:{mr:1,verticalAlign:"middle"}}),"Planification mensuelle"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(t,{container:!0,spacing:2,children:j.map((E,c)=>e.jsx(t,{item:!0,xs:6,sm:4,md:3,children:e.jsx(V,{control:e.jsx(M,{checked:r.jours&&r.jours[c]===1,onChange:()=>{const h=r.jours?[...r.jours]:Array(12).fill(0);h[c]=h[c]?0:1,n({target:{name:"jours",value:h}})}}),label:E})},c))})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:[e.jsx(he,{sx:{mr:1,verticalAlign:"middle"}}),"Planification triennale"]})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_,{children:e.jsx(t,{container:!0,spacing:2,children:a.map((E,c)=>e.jsx(t,{item:!0,xs:4,children:e.jsx(V,{control:e.jsx(M,{checked:r.yearData&&r.yearData[`ANNEE${c+1}`]===E,onChange:()=>{const h=r.yearData?{...r.yearData}:{ANNEE1:"",ANNEE2:"",ANNEE3:""},v=`ANNEE${c+1}`;h[v]=h[v]?"":E,n({target:{name:"yearData",value:h}})}}),label:`Année ${c+1} : ${E}`})},c))})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(V,{control:e.jsx(M,{checked:r.improvise===1,onChange:()=>{n({target:{name:"improvise",value:r.improvise===0?1:0}})}}),label:"Auto-formation improvisée (non prévue au plan)"}),r.improvise===1&&e.jsx(s,{variant:"caption",color:"warning.main",sx:{display:"block",ml:4},children:"Cette auto-formation n'était pas prévue au plan initial"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(D,{sx:{my:2}}),e.jsxs(d,{display:"flex",justifyContent:"flex-end",gap:2,children:[e.jsx(w,{variant:"outlined",onClick:m,disabled:x,children:"Annuler"}),e.jsx(w,{variant:"contained",onClick:y,disabled:x||!r.intitule.trim(),startIcon:x?e.jsx(K,{size:20}):e.jsx(Q,{}),sx:{bgcolor:"green","&:hover":{bgcolor:"darkgreen"}},children:x?"Enregistrement...":"Ajouter à la liste"})]})]})]})})]})},Ir=({formation:r,index:n,onDelete:u,onEdit:m,headerYears:x})=>{const N=["J","F","M","A","M","J","J","A","S","O","N","D"];return e.jsx(H,{variant:"outlined",sx:{mb:2,position:"relative",cursor:"pointer","&:hover":{bgcolor:"#f5f5f5"}},children:e.jsx(X,{onClick:()=>m(n),children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(d,{flex:1,children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",children:[e.jsx(s,{variant:"subtitle1",fontWeight:"bold",color:"primary",children:r.intitule}),r.improvise===1&&e.jsx(R,{label:"Improvisée",size:"small",color:"warning",variant:"outlined"})]}),e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[r.objectifs&&e.jsxs(t,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Objectifs:"}),e.jsx(s,{variant:"body2",children:r.objectifs})]}),e.jsxs(t,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Cibles:"}),e.jsx(s,{variant:"body2",children:r.cibles||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Lieu/Plateforme:"}),e.jsx(s,{variant:"body2",children:r.lieu||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Ressources/Prestataire:"}),e.jsx(s,{variant:"body2",children:r.prestations||"Non spécifié"})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Mois prévus:"}),e.jsxs(d,{display:"flex",gap:.5,mt:.5,flexWrap:"wrap",children:[r.jours&&r.jours.map((a,j)=>e.jsx(R,{label:N[j],size:"small",color:a===1?"primary":"default",variant:a===1?"filled":"outlined",sx:{minWidth:30}},j)),(!r.jours||r.jours.every(a=>a===0))&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Aucun mois sélectionné"})]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Années prévues:"}),e.jsxs(d,{display:"flex",gap:1,mt:.5,flexWrap:"wrap",children:[x.map((a,j)=>r.yearData&&r.yearData[`ANNEE${j+1}`]&&e.jsx(R,{label:a,size:"small",color:"secondary",variant:"filled"},j)),(!r.yearData||!r.yearData.ANNEE1&&!r.yearData.ANNEE2&&!r.yearData.ANNEE3)&&e.jsx(s,{variant:"body2",color:"text.secondary",children:"Aucune année sélectionnée"})]})]})]})]}),e.jsx(te,{onClick:a=>{a.stopPropagation(),u(n)},color:"error",size:"small",sx:{ml:2},children:e.jsx(ie,{})})]})})})},Sr=()=>{const[r,n]=p.useState([]),[u,m]=p.useState({intitule:"",objectifs:"",resultats:"",cibles:"",lieu:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),[x,N]=p.useState([]),[a,j]=p.useState(""),[y,E]=p.useState(""),[c,h]=p.useState(["ANNEE1","ANNEE2","ANNEE3"]),[v,k]=p.useState(!1),[F,T]=p.useState(!0),[z,W]=p.useState(null),$="";p.useEffect(()=>{U()},[]);const U=async()=>{const l=localStorage.getItem("token");try{const o=await G.get(`${$}/listeplantrienal`,{headers:{Authorization:`Bearer ${l}`}});N(o.data)}catch(o){console.error("Erreur lors de la récupération des triennals:",o),b.error("Impossible de charger les plans triennaux")}},I=l=>{const o=x.find(A=>A.ANNEE1===l.target.value);o&&(E(o.ANNEE1),j(o.IDPLAN),h([o.ANNEE1,o.ANNEE2,o.ANNEE3]))},f=l=>{const{name:o,value:A}=l.target;m(i=>({...i,[o]:A}))},L=()=>{if(!a){b.error("Veuillez d'abord sélectionner un plan triennal");return}if(!u.intitule.trim()){b.error("La modalité d'auto-formation est obligatoire");return}if(z!==null){const l=[...r];l[z]={...u},n(l),b.success("Auto-formation mise à jour")}else n([...r,{...u}]),b.success("Auto-formation ajoutée à la liste");m({intitule:"",objectifs:"",resultats:"",cibles:"",lieu:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),W(null),T(!0)},Y=l=>{m({...r[l]}),W(l),T(!0)},J=l=>{if(window.confirm("Supprimer cette auto-formation de la liste ?")){const o=r.filter((A,i)=>i!==l);n(o),b.info("Auto-formation retirée de la liste")}},q=()=>{m({intitule:"",objectifs:"",resultats:"",cibles:"",lieu:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}),W(null)},S=async()=>{if(!a){b.error("Veuillez sélectionner un plan triennal");return}if(r.length===0){b.error("Veuillez ajouter au moins une auto-formation");return}k(!0);const l=localStorage.getItem("token");try{const o=r.map(i=>({IDPLAN:a,INTITULE:i.intitule,OBJECTIFS:i.objectifs||"",RESULTATATTENDU:i.resultats||"",CIBLES:i.cibles||"",NOMBREPERSONNE:0,NOMBREVAGUE:1,LIEU:i.lieu||"À déterminer",PERIODE:"",PRESTATAIREPEDAGOGIQUE:i.prestations||"Auto-formation",TYPEAUTOFORMATION:"1",PREVUE:i.improvise===1?0:1,MOIS:i.jours||Array(12).fill(0),ANNEE1:i.yearData.ANNEE1||null,ANNEE2:i.yearData.ANNEE2||null,ANNEE3:i.yearData.ANNEE3||null})),A=await G.post(`${$}/nouvelleformation`,o,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},timeout:3e4});(A.status===200||A.status===201)&&(b.success(`${r.length} auto-formation(s) enregistrée(s) avec succès !`),n([]),m({intitule:"",objectifs:"",resultats:"",cibles:"",lieu:"",prestations:"",improvise:0,jours:Array(12).fill(0),yearData:{ANNEE1:"",ANNEE2:"",ANNEE3:""}}))}catch(o){console.error("Erreur:",o),b.error("Erreur lors de l'envoi des données")}finally{k(!1)}};return e.jsxs(d,{sx:{width:"100%",p:3},children:[e.jsx(re,{}),e.jsxs(B,{elevation:1,sx:{p:3,mb:3,borderRadius:2},children:[e.jsxs(d,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,flexWrap:"wrap",gap:2,children:[e.jsxs(d,{children:[e.jsx(s,{variant:"h5",color:"black",gutterBottom:!0,children:"AXE 3 : AUTOFORMATION"}),e.jsx(s,{variant:"h5",color:"blue",children:"AUTOFORMATION"})]}),e.jsx(R,{label:"Auto-formation",color:"info",size:"medium",icon:e.jsx(Ve,{})})]}),e.jsxs(oe,{sx:{minWidth:250},required:!0,children:[e.jsx(de,{children:"Plan Triennal *"}),e.jsx(ce,{value:y,label:"Plan Triennal *",onChange:I,children:x.map((l,o)=>e.jsx(ue,{value:l.ANNEE1,children:`${l.ANNEE1} - ${l.ANNEE2} - ${l.ANNEE3}`},o))})]}),!a&&e.jsx(xe,{severity:"warning",sx:{mt:2},children:"Veuillez sélectionner un plan triennal avant d'ajouter des auto-formations"})]}),r.length>0&&e.jsxs(d,{mb:3,children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:["Auto-formations en attente (",r.length,")"]}),r.map((l,o)=>e.jsx(Ir,{formation:l,index:o,onDelete:J,onEdit:Y,headerYears:c},o))]}),F&&e.jsx(Ar,{formation:u,onChange:f,onSave:L,onCancel:q,isSubmitting:v,selectedTriennal:a,headerYears:c}),!F&&e.jsx(w,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:()=>T(!0),sx:{mb:3},children:"Ajouter une auto-formation"}),r.length>0&&e.jsx(B,{elevation:3,sx:{p:3,bgcolor:"#f5f5f5",borderRadius:2},children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:r.length})," auto-formation(s) prête(s) à être enregistrée(s)"]}),e.jsx(w,{variant:"contained",size:"large",onClick:S,disabled:v||!a,startIcon:v?e.jsx(K,{size:20}):e.jsx(Q,{}),sx:{bgcolor:"green","&:hover":{bgcolor:"darkgreen"}},children:v?"Envoi...":"Enregistrer toutes les auto-formations"})]})})]})},Cr=()=>{Ne();const[r,n]=p.useState(""),[u,m]=p.useState({}),[x,N]=p.useState(null),[a,j]=p.useState(!1),[y,E]=p.useState(0),c=["Année de début","Aperçu du plan","Document","Confirmation"],h=I=>{const f=I.target.value;if(n(f),f){const L=parseInt(f,10);m({year1:L,year2:L+1,year3:L+2}),L&&E(1)}else m({}),E(0)},v=I=>{const f=I.target.files[0];N(f),f&&E(2)},k=()=>{document.getElementById("file-input").click()},F=I=>{I.preventDefault(),j(!0)},T=()=>{j(!1)},z=I=>{I.preventDefault(),j(!1);const f=I.dataTransfer.files[0];f&&(N(f),E(2))},W=()=>{N(null),E(1)},$=async I=>{if(I.preventDefault(),!u.year1||!x){b.error("Veuillez sélectionner une année et un fichier.");return}E(3);const f=new FormData;f.append("ANNEE1",u.year1),f.append("ANNEE2",u.year2),f.append("ANNEE3",u.year3),f.append("FICHIERPLAN",x);const L=localStorage.getItem("token"),Y="";try{const J=await fetch(`${Y}/nouveauplantrienal`,{headers:{Authorization:`Bearer ${L}`},method:"POST",body:f});if(!J.ok)throw new Error("Erreur lors de l'envoi des données");const q=await J.json();b.success(q.message),n(""),m({}),N(null),E(0)}catch(J){b.error("Erreur lors de l'envoi des données : "+J.message),E(2)}},U=I=>{switch(I?.split(".").pop()?.toLowerCase()){case"pdf":return"#f44336";case"doc":case"docx":return"#2196f3";case"xls":case"xlsx":return"#4caf50";default:return"#757575"}};return e.jsx(ee.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(B,{elevation:0,sx:{p:{xs:3,md:5},mb:4,borderRadius:4,background:"linear-gradient(145deg, #ffffff 0%, #f8faff 100%)",boxShadow:"0 10px 40px rgba(0,0,0,0.03)",border:"1px solid",borderColor:"rgba(25, 118, 210, 0.1)",position:"relative",overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"4px",background:"linear-gradient(90deg, #1976d2, #64b5f6, #1976d2)"}},children:[e.jsxs(d,{display:"flex",alignItems:"center",mb:4,children:[e.jsx(se,{sx:{width:70,height:70,background:"linear-gradient(135deg, #1976d2 0%, #64b5f6 100%)",boxShadow:"0 10px 20px rgba(25, 118, 210, 0.2)",mr:3},children:e.jsx(Ge,{sx:{fontSize:32,color:"white"}})}),e.jsxs(d,{children:[e.jsx(s,{variant:"h4",fontWeight:"700",color:"#1a237e",gutterBottom:!0,children:"Nouveau Plan Triennal"}),e.jsx(s,{variant:"body1",color:"text.secondary",sx:{maxWidth:600},children:"Créez un plan de formation stratégique sur 3 ans. Téléchargez le document et définissez l'année de début."})]})]}),e.jsx(_e,{activeStep:y,orientation:"vertical",sx:{mb:4},children:c.map((I,f)=>e.jsxs(Ke,{children:[e.jsx(Qe,{children:e.jsx(s,{fontWeight:y===f?"600":"400",children:I})}),e.jsx(dr,{})]},I))}),e.jsx(D,{sx:{mb:4,borderColor:"rgba(25, 118, 210, 0.1)"}}),e.jsx("form",{onSubmit:$,children:e.jsxs(t,{container:!0,spacing:4,children:[e.jsx(t,{item:!0,xs:12,md:6,children:e.jsxs(ee.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.2},children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{fontWeight:600},children:"📅 ÉTAPE 1 - ANNÉE DE DÉBUT"}),e.jsxs(B,{elevation:0,sx:{p:3,bgcolor:O("#1976d2",.02),borderRadius:3,border:"1px solid",borderColor:O("#1976d2",.1)},children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Sélectionnez l'année à partir de laquelle débutera votre plan triennal"}),e.jsx(g,{fullWidth:!0,type:"number",value:r,onChange:h,placeholder:"Ex: 2024",variant:"outlined",InputProps:{startAdornment:e.jsx(Ze,{position:"start",children:e.jsx(er,{color:"primary"})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,bgcolor:"white","&:hover fieldset":{borderColor:"#1976d2"}}}})]})]})}),u.year1&&e.jsx(t,{item:!0,xs:12,md:6,children:e.jsxs(ee.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.3},children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{fontWeight:600},children:"📊 ÉTAPE 2 - APERÇU DU PLAN"}),e.jsx(t,{container:!0,spacing:2,children:Object.values(u).map((I,f)=>e.jsx(t,{item:!0,xs:4,children:e.jsx(ee.div,{whileHover:{y:-5},transition:{type:"spring",stiffness:300},children:e.jsxs(B,{sx:{p:2.5,textAlign:"center",background:`linear-gradient(135deg, ${O(["#1976d2","#2196f3","#64b5f6"][f],.1)} 0%, white 100%)`,border:"1px solid",borderColor:O(["#1976d2","#2196f3","#64b5f6"][f],.2),borderRadius:3,position:"relative",overflow:"hidden","&::after":{content:'""',position:"absolute",top:0,left:0,right:0,height:"3px",background:["#1976d2","#2196f3","#64b5f6"][f]}},children:[e.jsx(s,{variant:"h4",fontWeight:"700",color:["#1976d2","#2196f3","#1976d2"][f],children:I}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Année ",f+1]}),f===0&&e.jsx(R,{label:"Début",size:"small",sx:{mt:1,bgcolor:O("#1976d2",.1),color:"#1976d2",fontWeight:500}})]})})},f))})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(ee.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{fontWeight:600},children:"📄 ÉTAPE 3 - DOCUMENT DU PLAN"}),e.jsxs(B,{elevation:0,onDragOver:F,onDragLeave:T,onDrop:z,sx:{p:4,border:"2px dashed",borderColor:a?"#1976d2":O("#1976d2",.2),borderRadius:3,bgcolor:a?O("#1976d2",.02):O("#1976d2",.01),transition:"all 0.3s ease",cursor:"pointer",textAlign:"center","&:hover":{borderColor:"#1976d2",bgcolor:O("#1976d2",.02)}},onClick:k,children:[e.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.xls,.xlsx",onChange:v,id:"file-input",style:{display:"none"}}),x?e.jsxs(d,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(d,{display:"flex",alignItems:"center",children:[e.jsx(se,{sx:{width:50,height:50,bgcolor:O(U(x.name),.1),color:U(x.name),mr:2},children:e.jsx(ur,{})}),e.jsxs(d,{textAlign:"left",children:[e.jsx(s,{variant:"subtitle1",fontWeight:"600",noWrap:!0,sx:{maxWidth:400},children:x.name}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[(x.size/1024).toFixed(2)," KB"]})]})]}),e.jsx(te,{onClick:I=>{I.stopPropagation(),W()},color:"error",size:"small",children:e.jsx(tr,{})})]}):e.jsxs(d,{children:[e.jsx(rr,{sx:{fontSize:48,color:O("#1976d2",.5),mb:2}}),e.jsx(s,{variant:"h6",color:"text.primary",gutterBottom:!0,children:"Glissez-déposez votre fichier ici"}),e.jsx(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"ou cliquez pour parcourir"}),e.jsx(s,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:2},children:"Formats acceptés : PDF, DOC, DOCX, XLS, XLSX"})]})]})]})}),x&&u.year1&&e.jsx(t,{item:!0,xs:12,children:e.jsx(ee.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.5},children:e.jsxs(B,{elevation:0,sx:{p:3,bgcolor:O("#4caf50",.05),borderRadius:3,border:"1px solid",borderColor:O("#4caf50",.2),display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsxs(d,{display:"flex",alignItems:"center",children:[e.jsx(sr,{sx:{color:"#4caf50",fontSize:32,mr:2}}),e.jsxs(d,{children:[e.jsx(s,{variant:"h6",color:"#4caf50",fontWeight:"600",children:"Prêt à être enregistré !"}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Votre plan triennal ",u.year1,"-",u.year3," est complet"]})]})]}),e.jsx(w,{type:"submit",variant:"contained",size:"large",endIcon:e.jsx(nr,{}),sx:{py:1.5,px:4,background:"linear-gradient(45deg, #1976d2 30%, #64b5f6 90%)",boxShadow:"0 3px 15px rgba(25, 118, 210, 0.3)",borderRadius:2,textTransform:"none",fontSize:"1rem","&:hover":{background:"linear-gradient(45deg, #1565c0 30%, #42a5f5 90%)"}},children:"Enregistrer le plan"})]})})})]})}),e.jsxs(d,{sx:{mt:4},children:[e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Progression"}),e.jsxs(s,{variant:"body2",fontWeight:"600",color:"primary",children:[y*33,"%"]})]}),e.jsx(Oe,{variant:"determinate",value:y*33,sx:{height:6,borderRadius:3,bgcolor:O("#1976d2",.1),"& .MuiLinearProgress-bar":{background:"linear-gradient(90deg, #1976d2, #64b5f6)",borderRadius:3}}})]})]})})},xt=()=>{Ne();const[r,n]=p.useState("home"),[u,m]=p.useState(null),x=[{id:"planTrienal",title:"Plan Triennal",icon:ge,color:"#1976d2",gradient:"linear-gradient(135deg, #1976d2 0%, #64b5f6 100%)",description:"Gestion des plans de formation triennaux",component:e.jsx(Cr,{})},{id:"centreExcellence",title:"Centre d'Excellence",icon:Ue,color:"#2e7d32",gradient:"linear-gradient(135deg, #2e7d32 0%, #4caf50 100%)",description:"Formations de transition entre différents niveaux ou domaines",component:e.jsx(pr,{})},{id:"formationTransversal",title:"Formations Transversales",icon:Je,color:"#ed6c02",gradient:"linear-gradient(135deg, #ed6c02 0%, #ff9800 100%)",description:"Formations multi-disciplinaires et compétences générales",component:e.jsx(br,{})},{id:"specialisation",title:"Spécialisation Fonctionnelle",icon:Ye,color:"#d32f2f",gradient:"linear-gradient(135deg, #d32f2f 0%, #f44336 100%)",description:"Formations spécialisées dans un domaine fonctionnel",component:e.jsx(vr,{})},{id:"formationIndividuelles",title:"Formations Individuelles",icon:Ie,color:"#9c27b0",gradient:"linear-gradient(135deg, #9c27b0 0%, #ba68c8 100%)",description:"Formations personnalisées selon les besoins individuels",component:e.jsx(fr,{})},{id:"autoFormation",title:"Auto-Formation",icon:qe,color:"#e65100",gradient:"linear-gradient(135deg, #e65100 0%, #f57c00 100%)",description:"Formations en autonomie et apprentissage individuel",component:e.jsx(Sr,{})}],N=y=>{const E=x.find(c=>c.id===y);n(y),m(E)},a=()=>{n("home"),m(null)},j=()=>r==="home"?null:x.find(E=>E.id===r)?.component;return e.jsxs(d,{sx:{width:"100%",minHeight:"100vh",bgcolor:"#f5f5f5",py:4},children:[e.jsx(re,{position:"top-right",autoClose:3e3}),e.jsxs(Me,{maxWidth:"xl",children:[e.jsx(We,{in:!0,timeout:1e3,children:e.jsx(B,{elevation:0,sx:{p:4,mb:4,borderRadius:3,border:"1px solid",borderColor:"grey.200",background:"white"},children:e.jsxs(d,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(d,{display:"flex",alignItems:"center",children:r!=="home"&&u?e.jsxs(e.Fragment,{children:[e.jsx(se,{sx:{width:64,height:64,bgcolor:O(u.color,.1),color:u.color,mr:2},children:Re.createElement(u.icon,{sx:{fontSize:32}})}),e.jsxs(d,{children:[e.jsx(s,{variant:"h4",fontWeight:"bold",color:"#1a1a1a",children:u.title}),e.jsx(s,{variant:"body1",color:"text.secondary",children:u.description})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{sx:{width:64,height:64,bgcolor:O("#1976d2",.1),color:"#1976d2",mr:2},children:e.jsx(ge,{sx:{fontSize:32}})}),e.jsxs(d,{children:[e.jsx(s,{variant:"h4",fontWeight:"bold",color:"#1a1a1a",children:"Gestion des Plans de Formation"}),e.jsx(s,{variant:"body1",color:"text.secondary",children:"Sélectionnez un axe de formation pour commencer"})]})]})}),r!=="home"&&e.jsx(w,{variant:"outlined",onClick:a,startIcon:e.jsx(Be,{}),sx:{borderRadius:2,textTransform:"none",px:3,py:1,borderColor:u?.color||"#1976d2",color:u?.color||"#1976d2","&:hover":{borderColor:u?.color||"#1565c0",bgcolor:O(u?.color||"#1976d2",.02)}},children:"Retour à l'accueil"})]})})}),r==="home"?e.jsx(t,{container:!0,spacing:3,children:x.map((y,E)=>{const c=y.icon;return e.jsx(t,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ke,{in:!0,timeout:(E+1)*300,children:e.jsx(H,{sx:{height:"100%",borderRadius:3,border:"1px solid",borderColor:"grey.200",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 24px rgba(0,0,0,0.1)",borderColor:O(y.color,.3)}},children:e.jsxs(Le,{onClick:()=>N(y.id),sx:{height:"100%"},children:[e.jsx(d,{sx:{height:4,background:y.gradient}}),e.jsxs(X,{sx:{p:3},children:[e.jsxs(d,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(se,{sx:{width:48,height:48,bgcolor:O(y.color,.1),color:y.color,mr:2},children:e.jsx(c,{sx:{fontSize:24}})}),e.jsx(s,{variant:"h6",fontWeight:"600",color:"#1a1a1a",children:y.title})]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:2,minHeight:40},children:y.description}),e.jsx(d,{display:"flex",alignItems:"center",color:y.color,children:e.jsx(s,{variant:"body2",fontWeight:"500",children:"Accéder"})})]})]})})})},y.id)})}):e.jsx(ze,{in:!0,children:e.jsx(B,{elevation:0,sx:{p:3,borderRadius:3,border:"1px solid",borderColor:"grey.200",background:"white"},children:j()})})]})]})};export{xt as default};
