import{l as vr,j as e,u as gt,E as jt,$ as St,a0 as yt,a2 as Et,s as J,H as It,G as d,a3 as Nt,T as r,B as s,a4 as vt,a5 as Ot,a6 as Tt,a7 as Rt,a8 as At,x as Cr,r as o,z as Z,D as se,I as de,v as Y,Z as je,R as Ct,U as dr,F as ve,A as kr,S as Pr,a9 as Dt,w as ie,C as oe,Q as jr,N as Ft,aa as zt,ab as kt,ac as Pt,ad as Lt,ae as Mt,af as Lr,ag as Wt}from"./index-zHPv1lze.js";import{B as me}from"./Button-0T1tR8_c.js";import{d as ze}from"./dayjs.min-BzR6NVRV.js";import{a as ae}from"./index-C3O71W1x.js";import{Q as G,E as ce}from"./QueryStats-CBn45aSn.js";import{L as Ae}from"./LocalizationProvider-DMHyi95E.js";import{A as er}from"./fr-BWmqh5xn.js";import{D as ne}from"./DatePicker-_VewKJ-w.js";import{T as ee}from"./TextField-DNVhVnCv.js";import{C as U}from"./CalendarToday-BYxDq_1X.js";import{C as xe}from"./CircularProgress-BHFhENdB.js";import{S as Oe}from"./Send-kcxa8VWl.js";import{a as Se,D as ye}from"./DialogContent-COvIddmc.js";import{D as Ee}from"./DialogTitle-CCgKuUmv.js";import{E as ir}from"./Event-DCg_30F7.js";import{P as Xe}from"./Print-BhcHkGDV.js";import{C as Te}from"./Close-B5GqWx1j.js";import{T as we,a as Ue,b as De,c as te,d as j,e as Be}from"./TableRow-70JfVjDg.js";import{S as Ie}from"./Snackbar-XurLPfxZ.js";import{A as Ne}from"./Alert-D6te_eKs.js";import{d as tr}from"./debounce-CEXHgCrW.js";import{B as ue}from"./Business-DP4Oq-gt.js";import{A as Ge}from"./Autocomplete-DkJdCr17.js";import{f as ke,A as Pe}from"./fr-BqwbHVGE.js";import{D as pe}from"./DateRange-tTFtj54i.js";import{F as Or,S as Tr}from"./Select-DCG_CkE0.js";import{I as Rr,O as lt}from"./OutlinedInput-C5vYvqQm.js";import{M as ur}from"./MenuItem-D-1uk7AZ.js";import{C as ct}from"./Checkbox-BNRiEFgI.js";import{G as Ir}from"./Group-CKNX0Zix.js";import{P as Le}from"./Person-CVTBdQV4.js";import{P as rr}from"./People-RwhYgLWm.js";import{B as Ve}from"./Badge-Q2tdgUxH.js";import{A as dt,a as xt,b as ut}from"./AccordionSummary-2JcKKmJQ.js";import{E as Dr}from"./ExpandMore-DWiDQC_Y.js";import{W as qe,P as sr,A as lr,a as Ar}from"./Work-BOwzzg0q.js";import{E as wt}from"./ExpandLess-BVSXxMnp.js";import{L as Ut}from"./LocationOn-We7TmFLi.js";import{P as Je,W as nr,M as or,S as cr,L as Ye,D as yr,T as hr,a as Mr}from"./Woman-m6hDNIwy.js";import{W as Ke}from"./Warning-Dm-AjjkC.js";import{M as Me,F as We}from"./Male-D6PrUK3l.js";import{I as be}from"./InputAdornment-BgDE6Kz5.js";import{T as Nr}from"./Timeline-BXnwFYdk.js";import{G as $e}from"./Groups-DO3ZmRBj.js";import{C as Re}from"./react-apexcharts.min-rkE0FX8L.js";import{I as Fe}from"./Info-BG_pDBBb.js";import{T as Ze}from"./TrendingUp-CnKnPJ6F.js";import{R as Fr}from"./RestartAlt-Ft-AlI1n.js";import{E as ft,a as mt}from"./EventBusy-Bj-M0_Ng.js";import{D as zr}from"./DialogActions-CZ9LuKoL.js";import{u as gr,w as ht}from"./xlsx-tiLM45nF.js";import{B as Wr}from"./BarChart-CtMQudBV.js";import{D as pt}from"./Download-CCo6S7zV.js";import{C as bt}from"./Container-iQUVt9w4.js";import{L as Bt}from"./ListItem-CSuwil7H.js";import"./ButtonGroupButtonContext-BYVHV5Ft.js";import"./useFormControl-BwsGWz84.js";import"./FormHelperText-BXMwkblB.js";import"./Close-DS868zx3.js";import"./SwitchBase-CEgujy3G.js";const Er=vr(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block"),xr=vr([e.jsx("path",{d:"m12 2-5.5 9h11z"},"0"),e.jsx("circle",{cx:"17.5",cy:"17.5",r:"4.5"},"1"),e.jsx("path",{d:"M3 13.5h8v8H3z"},"2")],"Category"),ar=vr(e.jsx("path",{d:"m20.5 10 .5-2h-4l1-4h-2l-1 4h-4l1-4h-2L9 8H5l-.5 2h4l-1 4h-4L3 16h4l-1 4h2l1-4h4l-1 4h2l1-4h4l.5-2h-4l1-4zm-7 4h-4l1-4h4z"}),"Numbers"),mr=vr(e.jsx("path",{d:"M3 10h11v2H3zm0-4h11v2H3zm0 8h7v2H3zm17.59-2.07-4.25 4.24-2.12-2.12-1.41 1.41L16.34 19 22 13.34z"}),"PlaylistAddCheck"),$t="/assets/logoprincipal-dP-GVAGl.png",Ht=J(s)(({theme:t})=>({height:"100vh",backgroundImage:`url(${$t})`,backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover",color:"#fff",width:"100%",[t.breakpoints.down("sm")]:{height:"auto",minHeight:"100vh",paddingBottom:t.spacing(2)}})),Yt=J(s)(({theme:t})=>({backgroundColor:"rgba(255, 255, 255, 0.8)",width:"100%",height:"100%",backdropFilter:"blur(10px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",[t.breakpoints.down("sm")]:{height:"auto",minHeight:"100vh",padding:t.spacing(1.5)}})),pr=J(s)(({theme:t})=>({display:"flex",alignItems:"center",justifyContent:"center",fontSize:"4rem",marginBottom:t.spacing(2),[t.breakpoints.down("sm")]:{fontSize:"2rem",marginBottom:t.spacing(.75)}})),wr=J(me)(({theme:t})=>({minWidth:"23vw",minHeight:"35vh",margin:t.spacing(2),position:"relative",borderRadius:"15px",border:"5px solid transparent",background:"linear-gradient(white, white), linear-gradient(to right, blue, yellow)",backgroundClip:"padding-box, border-box",backgroundOrigin:"border-box",transition:"transform 0.3s, box-shadow 0.3s",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"none",color:"black",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)","&:hover":{transform:"scale(1.05)",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.3)"},[t.breakpoints.down("sm")]:{minWidth:"calc(100% - 16px)",minHeight:"auto",height:"130px",margin:t.spacing(.75),padding:t.spacing(1),border:"3px solid transparent","&:hover":{transform:"scale(1.02)",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.2)"}}})),Ur=J(me)(({theme:t})=>({minWidth:"23vw",minHeight:"35vh",margin:t.spacing(2),position:"relative",borderRadius:"15px",border:"5px solid transparent",background:"linear-gradient(white, white), linear-gradient(to right, green, yellow)",backgroundClip:"padding-box, border-box",backgroundOrigin:"border-box",transition:"transform 0.3s, box-shadow 0.3s",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"none",color:"black",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)","&:hover":{transform:"scale(1.05)",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.3)"},[t.breakpoints.down("sm")]:{minWidth:"calc(100% - 16px)",minHeight:"auto",height:"130px",margin:t.spacing(.75),padding:t.spacing(1),border:"3px solid transparent","&:hover":{transform:"scale(1.02)",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.2)"}}})),Br=J(me)(({theme:t})=>({minWidth:"23vw",minHeight:"35vh",margin:t.spacing(2),position:"relative",borderRadius:"15px",border:"5px solid transparent",background:"linear-gradient(white, white), linear-gradient(to right, red, yellow)",backgroundClip:"padding-box, border-box",backgroundOrigin:"border-box",transition:"transform 0.3s, box-shadow 0.3s",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"none",color:"black",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)","&:hover":{transform:"scale(1.05)",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.3)"},[t.breakpoints.down("sm")]:{minWidth:"calc(100% - 16px)",minHeight:"auto",height:"130px",margin:t.spacing(.75),padding:t.spacing(1),border:"3px solid transparent","&:hover":{transform:"scale(1.02)",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.2)"}}})),br=J(({className:t,...n})=>e.jsx(Cr,{...n,classes:{tooltip:t}}))({tooltip:{backgroundColor:"#ffffff",color:"#333",border:"1px solid #ccc",borderRadius:"8px",padding:"10px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.2)",fontSize:"0.875rem",maxWidth:"300px"}}),$r=({onComponentChange:t})=>{const n=gt(),l=jt(n.breakpoints.down("sm"));return e.jsxs(St,{theme:yt(),children:[e.jsx(Et,{}),e.jsx(Ht,{children:e.jsxs(Yt,{children:[e.jsx(It,{}),e.jsxs(d,{container:!0,spacing:l?0:2,justifyContent:"center",alignItems:l?"center":"flex-start",sx:{mt:l?0:-10,width:l?"100%":"auto",px:0},children:[e.jsx(d,{item:!0,xs:l?12:6,md:4,children:e.jsx(br,{title:e.jsx(s,{children:e.jsx(r,{variant:"body2",children:"Liste des formations r√©alis√©es sur une p√©riode (toutes cat√©gories confondues)."})}),arrow:!0,placement:l?"bottom":"top",children:e.jsxs(Ur,{onClick:()=>t("FormationsTenues"),children:[e.jsx(pr,{children:e.jsx(Nt,{})}),e.jsx(r,{variant:l?"body2":"h6",align:"center",sx:{fontWeight:"bold"},children:"Formations r√©alis√©es"})]})})}),e.jsx(d,{item:!0,xs:l?12:6,md:4,children:e.jsx(br,{title:e.jsx(r,{variant:"body2",children:"Liste des formations qui ne se sont pas tenues sur une p√©riode (toutes cat√©gories)."}),arrow:!0,placement:l?"bottom":"top",children:e.jsxs(Br,{onClick:()=>t("FormationsNonTenues"),children:[e.jsx(pr,{children:e.jsx(vt,{})}),e.jsx(r,{variant:l?"body2":"h6",align:"center",sx:{fontWeight:"bold"},children:"Formations non r√©alis√©es"})]})})}),e.jsx(d,{item:!0,xs:l?12:6,md:4,children:e.jsx(br,{title:e.jsx(s,{children:e.jsxs(r,{variant:"body2",children:["‚Ä¢ Nombre de personnels form√©s sur une p√©riode ",e.jsx("br",{}),"‚Ä¢ R√©partition par genre et par zone (centrale/d√©concentr√©e) ",e.jsx("br",{}),"‚Ä¢ √âvolution annuelle des formations"]})}),arrow:!0,placement:l?"bottom":"top",children:e.jsxs(wr,{onClick:()=>t("StatistiquesFormation"),children:[e.jsx(pr,{children:e.jsx(Ot,{})}),e.jsx(r,{variant:l?"body2":"h6",align:"center",sx:{fontWeight:"bold"},children:"Statistiques de formation"})]})})}),e.jsx(d,{item:!0,xs:l?12:6,md:4,children:e.jsx(br,{title:e.jsx(s,{children:e.jsxs(r,{variant:"body2",children:["‚Ä¢ Liste du personnel ayant re√ßu au moins une formation ",e.jsx("br",{}),"‚Ä¢ Par structure ou genre ",e.jsx("br",{}),"‚Ä¢ Selon une p√©riode ou un th√®me sp√©cifique"]})}),arrow:!0,placement:l?"bottom":"top",children:e.jsxs(Ur,{onClick:()=>t("PersonnelForme"),children:[e.jsx(pr,{children:e.jsx(Tt,{})}),e.jsx(r,{variant:l?"body2":"h6",align:"center",sx:{fontWeight:"bold"},children:"Personnels form√©s"})]})})}),e.jsx(d,{item:!0,xs:l?12:6,md:4,children:e.jsx(br,{title:e.jsx(s,{children:e.jsx(r,{variant:"body2",children:"‚Ä¢ Liste du personnel n'ayant jamais b√©n√©fici√© d'une formation depuis 1, 2 ou 3 ans"})}),arrow:!0,placement:l?"bottom":"top",children:e.jsxs(Br,{onClick:()=>t("PersonnelNonForme"),children:[e.jsx(pr,{children:e.jsx(Rt,{})}),e.jsx(r,{variant:l?"body2":"h6",align:"center",sx:{fontWeight:"bold"},children:"Personnels non form√©s"})]})})}),e.jsx(d,{item:!0,xs:l?12:6,md:4,children:e.jsx(br,{title:e.jsx(s,{children:e.jsx(r,{variant:"body2",children:"Informations suppl√©mentaires ou outils divers."})}),arrow:!0,placement:l?"bottom":"top",children:e.jsxs(wr,{onClick:()=>t("Autre"),children:[e.jsx(pr,{children:e.jsx(At,{})}),e.jsx(r,{variant:l?"body2":"h6",align:"center",sx:{fontWeight:"bold"},children:"Autre..."})]})})})]})]})})]})},qt=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Vt=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));J(Ct)(({theme:t})=>({"& .MuiBadge-badge":{backgroundColor:"#2e7d32",color:"#2e7d32",boxShadow:`0 0 0 2px ${t.palette.background.paper}`,"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"ripple 1.2s infinite ease-in-out",border:"1px solid currentColor"}},"@keyframes ripple":{"0%":{boxShadow:"0 0 0 0 rgba(46, 125, 50, 0.7)"},"70%":{boxShadow:"0 0 0 10px rgba(46, 125, 50, 0)"},"100%":{boxShadow:"0 0 0 0 rgba(46, 125, 50, 0)"}}}));const Qt=()=>{const[t,n]=o.useState(ze().subtract(1,"month")),[l,x]=o.useState(ze()),[p,P]=o.useState(!1),[u,h]=o.useState([]),[m,y]=o.useState(!1),[C,z]=o.useState(!1),[F,W]=o.useState(""),[D,M]=o.useState("success"),$="",_=localStorage.getItem("token"),Q=()=>!t||!l?null:`
    SELECT 
      fi.IDFORMATIONM,
      fi.INTITULE,
      fi.CIBLES,
      MAX(s.DATE) AS DATE,
      COUNT(s.IDSESSION) AS NOMBRE_SESSIONS
    FROM formationmodifiable fi
    INNER JOIN sessionformation s 
      ON s.IDFORMATION = fi.IDFORMATIONM
    WHERE  (s.DATE >= '${t.format("YYYY-MM-DD")}'
      AND s.DATE <= '${l.format("YYYY-MM-DD")}')
      AND s.CONFIRME = 1
    GROUP BY 
      fi.IDFORMATIONM,
      fi.INTITULE,
      fi.CIBLES
    ORDER BY MAX(s.DATE) DESC;
  `,V=async()=>{if(!t||!l){H("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(t.isAfter(l)){H("La date de fin doit √™tre post√©rieure √† la date de d√©but","error");return}const E=Q();P(!0);try{const v=await ae.post(`${$}/personnaliserrequette`,{query:E},{headers:{Authorization:`Bearer ${_}`}});if(v.data)h(v.data),y(!0),H(`${v.data.length} formation(s) trouv√©e(s)`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(v){H(v.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},q=()=>{const E=document.getElementById("printable-content"),v=document.body.innerHTML;document.body.innerHTML=E.innerHTML,window.print(),document.body.innerHTML=v,window.location.reload()},H=(E,v)=>{W(E),M(v),z(!0)},O=()=>{z(!1)},L=E=>ze(E).format("DD/MM/YYYY"),T=()=>u.reduce((E,v)=>E+(v.NOMBRE_SESSIONS||0),0);return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:900,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(G,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Liste des Formations par P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Ex√©cutez une requ√™te pour obtenir les formations et leurs sessions"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsx(Ae,{dateAdapter:er,children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:t,onChange:E=>n(E),format:"DD/MM/YYYY",enableAccessibleFieldDOMStructure:!1,slots:{textField:E=>e.jsx(ee,{...E,fullWidth:!0,variant:"outlined",InputProps:{...E.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:l,onChange:E=>x(E),format:"DD/MM/YYYY",minDate:t,enableAccessibleFieldDOMStructure:!1,slots:{textField:E=>e.jsx(ee,{...E,fullWidth:!0,variant:"outlined",InputProps:{...E.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]})}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Vt,{onClick:V,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p,children:p?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:m,onClose:()=>y(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(ir,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats des Formations"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:q,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>y(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[u.length," formation(s) trouv√©e(s)"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode du ",e.jsx("strong",{children:L(t)})," au ",e.jsx("strong",{children:L(l)})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Total sessions : ",e.jsx("strong",{children:T()})]})]}),e.jsx(Y,{icon:e.jsx(U,{fontSize:"small"}),label:`${L(t)} ‚Üí ${L(l)}`,color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"Rapport : Formations R√©alis√©es"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",L(t)," - ",L(l)]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total formations :"})," ",u.length]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total sessions :"})," ",T()]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Date"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",borderBottom:"2px solid #bbdefb"},children:"Sessions"})]})}),e.jsx("tbody",{children:u.map((E,v)=>e.jsxs("tr",{style:{backgroundColor:v%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:v+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:E.INTITULE?.toUpperCase()||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",color:"#1976d2"},children:L(E.DATE)}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",textAlign:"center",fontWeight:"bold"},children:E.NOMBRE_SESSIONS||0})]},v))})]})]}),e.jsx(we,{sx:{maxHeight:500,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3},overflow:"auto"},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Date"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb",textAlign:"center"},children:"Sessions"})]})}),e.jsx(Be,{children:u.length>0?u.map((E,v)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:v+1}),e.jsx(j,{sx:{fontWeight:"bold",color:"dark",textTransform:"uppercase",letterSpacing:"0.5px"},children:E.INTITULE||"-"}),e.jsx(j,{children:e.jsxs(s,{display:"flex",alignItems:"center",color:"text.primary",children:[e.jsx(ir,{fontSize:"small",color:"primary",sx:{mr:1}}),L(E.DATE)]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsx(Y,{label:E.NOMBRE_SESSIONS||0,sx:{background:"linear-gradient(135deg, #64b5f6 0%, #42a5f5 50%, #2196f3 100%)",color:"white",fontWeight:"bold",fontSize:"1rem",boxShadow:"0 4px 12px rgba(33, 150, 243, 0.3)",border:"1px solid rgba(33, 150, 243, 0.5)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 6px 16px rgba(33, 150, 243, 0.5)",transform:"scale(1.05)"}}})})]},v)):e.jsx(te,{children:e.jsx(j,{colSpan:4,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucune formation trouv√©e"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez une autre p√©riode ou v√©rifiez les filtres."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:C,onClose:O,autoHideDuration:5e3,children:e.jsx(qt,{onClose:O,severity:D,sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:F})})})]})},_t=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Jt=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const Gt=()=>{const[t,n]=o.useState(null),[l,x]=o.useState([]),[p,P]=o.useState(""),[u,h]=o.useState(!1),[m,y]=o.useState([]),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState(""),[$,_]=o.useState("success"),[Q,V]=o.useState(!1),[q,H]=o.useState(!1),[O,L]=o.useState(!1),T="",E=o.useCallback(async()=>{try{V(!0);const f=localStorage.getItem("token"),g=await ae.get(`${T}/listestructures`,{params:{limit:10},headers:{Authorization:`Bearer ${f}`}});x(g.data),L(!0)}catch(f){k("Erreur lors du chargement des structures par d√©faut","error"),console.error("Error fetching default structures:",f)}finally{V(!1)}},[T]),v=o.useCallback(tr(async f=>{try{V(!0);const g=localStorage.getItem("token"),B=await ae.get(`${T}/listestructures`,{params:{search:f},headers:{Authorization:`Bearer ${g}`}});x(B.data)}catch(g){k("Erreur lors du chargement des structures","error"),console.error("Error fetching structures:",g)}finally{V(!1)}},300),[T]),i=()=>{H(!0),!O&&l.length===0&&E()},c=()=>{H(!1)};o.useEffect(()=>{p.length>=2?v(p):p.length===0&&q&&!O&&E()},[p,v,E,q,O]);const a=(f,{inputValue:g})=>{const B=g.toLowerCase();return f.filter(he=>{const fe=he.NOMSTRUCTURE?.toLowerCase().includes(B),Ce=he.ABBREVIATION?.toLowerCase().includes(B);return fe||Ce})},S=()=>t?`SELECT 
    fm.INTITULE,
    fm.CIBLES,
    MAX(sf.DATE) AS DATE,
    s.NOMSTRUCTURE AS Structure,
    COUNT(sf.IDSESSION) AS NOMBRE_SESSIONS
FROM 
    formationmodifiable fm
JOIN 
    structure s ON fm.IDSTRUCTUREBENEFICIAIRE = s.IDSTRUCTURE
JOIN 
    sessionformation sf ON fm.IDFORMATIONM = sf.IDFORMATION
WHERE 
    fm.IDSTRUCTUREBENEFICIAIRE = '${t.IDSTRUCTURE}'
    AND sf.DATE IS NOT NULL
      AND sf.CONFIRME = 1
GROUP BY
    fm.IDFORMATIONM, fm.INTITULE, fm.CIBLES, s.NOMSTRUCTURE
HAVING 
    COUNT(sf.IDSESSION) > 0
ORDER BY 
    DATE DESC;
`:null,R=async()=>{if(!t){k("Veuillez s√©lectionner une structure","error");return}const f=S();h(!0);const g=localStorage.getItem("token");try{const B=await ae.post(`${T}/personnaliserrequette`,{query:f},{headers:{Authorization:`Bearer ${g}`}});if(B.data)y(B.data),z(!0),k(`${B.data.length} formations trouv√©es`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(B){k(B.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{h(!1)}},b=()=>{const f=document.getElementById("printable-content"),g=document.body.innerHTML;document.body.innerHTML=f.innerHTML,window.print(),document.body.innerHTML=g,window.location.reload()},k=(f,g)=>{M(f),_(g),W(!0)},w=()=>{W(!1)},I=f=>new Date(f).toLocaleDateString("fr-FR"),N=m.reduce((f,g)=>f+(g.NOMBRE_SESSIONS||0),0);return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:800,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(ue,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Formations par Structure"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"S√©lectionnez une structure pour voir les formations b√©n√©fici√©es et leurs sessions"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsx(d,{container:!0,spacing:3,children:e.jsx(d,{item:!0,xs:12,children:e.jsx(Ge,{options:l,getOptionLabel:f=>f.NOMSTRUCTURE,value:t,open:q,onOpen:i,onClose:c,onChange:(f,g)=>{n(g)},onInputChange:(f,g)=>{P(g)},loading:Q,filterOptions:a,renderInput:f=>e.jsx(ee,{...f,label:"Rechercher une structure",variant:"outlined",fullWidth:!0,placeholder:"Tapez le nom ou l'abr√©viation de la structure...",InputProps:{...f.InputProps,startAdornment:e.jsx(ue,{color:"action",sx:{mr:1}}),endAdornment:e.jsxs(e.Fragment,{children:[Q?e.jsx(xe,{color:"inherit",size:20}):null,f.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(f,g)=>o.createElement(s,{component:"li",...f,key:g.IDSTRUCTURE},e.jsx(ue,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{sx:{flexGrow:1},children:[e.jsx(r,{variant:"body1",children:g.NOMSTRUCTURE}),g.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Abr√©viation: ",g.ABBREVIATION]})]})),noOptionsText:p.length>=2?"Aucune structure trouv√©e":"Tapez au moins 2 caract√®res pour rechercher",loadingText:"Chargement des structures..."})})}),t&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,color:"primary.main"}}),"Structure s√©lectionn√©e:"]}),e.jsx(r,{variant:"h6",sx:{ml:3,mt:1},children:t.NOMSTRUCTURE}),t.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3},children:["Abr√©viation: ",t.ABBREVIATION]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Jt,{onClick:R,startIcon:u?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:u||!t,children:u?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:C,onClose:()=>z(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(ue,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats des Formations"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:b,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>z(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[m.length," formation",m.length>1?"s":""," trouv√©e",m.length>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Structure: ",e.jsx("strong",{children:t?.NOMSTRUCTURE})]})]}),e.jsxs(s,{display:"flex",gap:2,alignItems:"center",children:[e.jsx(Y,{icon:e.jsx(mr,{fontSize:"small"}),label:`${N} session${N>1?"s":""} au total`,color:"secondary",variant:"outlined",sx:{borderColor:"secondary.light",color:"secondary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}}),e.jsx(Y,{icon:e.jsx(ue,{fontSize:"small"}),label:t?.ABBREVIATION||t?.NOMSTRUCTURE,color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Formations R√©alis√©es"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structure :"})," ",t?.NOMSTRUCTURE]}),t?.ABBREVIATION&&e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Abr√©viation :"})," ",t?.ABBREVIATION]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total :"})," ",m.length," formation",m.length>1?"s":""]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Sessions totales :"})," ",N," session",N>1?"s":""]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Date"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",borderBottom:"2px solid #bbdefb"},children:"Sessions"})]})}),e.jsx("tbody",{children:m.map((f,g)=>e.jsxs("tr",{style:{backgroundColor:g%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:g+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:f.INTITULE?.toUpperCase()||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",color:"#1976d2"},children:I(f.DATE)}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",textAlign:"center",color:"#d32f2f",fontWeight:"bold"},children:f.NOMBRE_SESSIONS||0})]},g))})]})]}),e.jsx(we,{sx:{maxHeight:500,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Date"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb",textAlign:"center",width:"100px"},children:"Sessions"})]})}),e.jsx(Be,{children:m.length>0?m.map((f,g)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:g+1}),e.jsx(j,{sx:{fontWeight:"bold",color:"dark",textTransform:"uppercase",letterSpacing:"0.5px"},children:f.INTITULE||"-"}),e.jsx(j,{children:e.jsxs(s,{display:"flex",alignItems:"center",color:"text.primary",children:[e.jsx(ir,{fontSize:"small",color:"primary",sx:{mr:1}}),I(f.DATE)]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"center",sx:{color:"secondary.main",fontWeight:"bold",fontSize:"1rem"},children:[e.jsx(mr,{fontSize:"small",sx:{mr:.5}}),f.NOMBRE_SESSIONS||0]})})]},g)):e.jsx(te,{children:e.jsx(j,{colSpan:5,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucune formation trouv√©e"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez une autre structure ou v√©rifiez les filtres."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:F,onClose:w,autoHideDuration:5e3,children:e.jsx(_t,{onClose:w,severity:$,iconMapping:{success:e.jsx(ue,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:D})})})]})},Xt=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Zt=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Kt=()=>{const[t,n]=o.useState(null),[l,x]=o.useState([]),[p,P]=o.useState(""),u=new Date,[h,m]=o.useState(u),[y,C]=o.useState(u),[z,F]=o.useState(!1),[W,D]=o.useState([]),[M,$]=o.useState(!1),[_,Q]=o.useState(!1),[V,q]=o.useState(""),[H,O]=o.useState("success"),[L,T]=o.useState(!1),[E,v]=o.useState(!1),[i,c]=o.useState(!1),a="",S=o.useCallback(async()=>{try{T(!0);const K=localStorage.getItem("token"),A=await ae.get(`${a}/listestructures`,{params:{limit:10},headers:{Authorization:`Bearer ${K}`}});x(A.data),c(!0)}catch(K){B("Erreur lors du chargement des structures par d√©faut","error"),console.error("Error fetching default structures:",K)}finally{T(!1)}},[a]),R=o.useCallback(tr(async K=>{try{T(!0);const A=localStorage.getItem("token"),X=await ae.get(`${a}/listestructures`,{params:{search:K},headers:{Authorization:`Bearer ${A}`}});x(X.data)}catch(A){B("Erreur lors du chargement des structures","error"),console.error("Error fetching structures:",A)}finally{T(!1)}},300),[a]),b=()=>{v(!0),!i&&l.length===0&&S()},k=()=>{v(!1)};o.useEffect(()=>{p.length>=2?R(p):p.length===0&&E&&!i&&S()},[p,R,S,E,i]);const w=(K,{inputValue:A})=>{const X=A.toLowerCase();return K.filter(re=>{const ge=re.NOMSTRUCTURE?.toLowerCase().includes(X),_e=re.ABBREVIATION?.toLowerCase().includes(X);return ge||_e})},I=K=>K?K.toISOString().split("T")[0]:null,N=()=>{if(!t||!h||!y)return null;const K=I(h),A=I(y);return`
      SELECT 
        fm.INTITULE,
        fm.CIBLES,
        MAX(sf.DATE) AS DATE,
        s.NOMSTRUCTURE AS Structure,
        COUNT(sf.IDSESSION) AS NOMBRE_SESSIONS
      FROM 
        formationmodifiable fm
      JOIN 
        structure s ON fm.IDSTRUCTUREBENEFICIAIRE = s.IDSTRUCTURE
      JOIN 
        sessionformation sf ON sf.IDFORMATION = fm.IDFORMATIONM
      WHERE 
        fm.IDSTRUCTUREBENEFICIAIRE = '${t.IDSTRUCTURE}'
        AND sf.DATE >= '${K}'
        AND sf.DATE <= '${A}'
        AND sf.CONFIRME = 1
      GROUP BY 
        fm.IDFORMATIONM,
        fm.INTITULE,
        fm.CIBLES,
        s.NOMSTRUCTURE
      ORDER BY 
        MAX(sf.DATE) DESC;
    `},f=async()=>{if(!t){B("Veuillez s√©lectionner une structure","error");return}if(!h||!y){B("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(h>y){B("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const K=N();F(!0);const A=localStorage.getItem("token");try{const X=await ae.post(`${a}/personnaliserrequette`,{query:K},{headers:{Authorization:`Bearer ${A}`}});if(X.data)D(X.data),$(!0),B(`${X.data.length} formations trouv√©es`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(X){B(X.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{F(!1)}},g=()=>{const K=document.getElementById("printable-content"),A=document.body.innerHTML;document.body.innerHTML=K.innerHTML,window.print(),document.body.innerHTML=A,window.location.reload()},B=(K,A)=>{q(K),O(A),Q(!0)},he=()=>{Q(!1)},fe=K=>new Date(K).toLocaleDateString("fr-FR"),Ce=()=>h&&y?`du ${fe(h)} au ${fe(y)}`:"P√©riode non d√©finie",le=W.reduce((K,A)=>K+(A.NOMBRE_SESSIONS||0),0);return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:900,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(pe,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Formations par P√©riode et Structure"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Consultez les formations r√©alis√©es sur une p√©riode donn√©e par structure"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(Ge,{options:l,getOptionLabel:K=>K.NOMSTRUCTURE,value:t,open:E,onOpen:b,onClose:k,onChange:(K,A)=>{n(A)},onInputChange:(K,A)=>{P(A)},loading:L,filterOptions:w,renderInput:K=>e.jsx(ee,{...K,label:"S√©lectionner une structure",variant:"outlined",fullWidth:!0,placeholder:"Tapez le nom ou l'abr√©viation de la structure...",InputProps:{...K.InputProps,startAdornment:e.jsx(ue,{color:"action",sx:{mr:1}}),endAdornment:e.jsxs(e.Fragment,{children:[L?e.jsx(xe,{color:"inherit",size:20}):null,K.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(K,A)=>o.createElement(s,{component:"li",...K,key:A.IDSTRUCTURE},e.jsx(ue,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{sx:{flexGrow:1},children:[e.jsx(r,{variant:"body1",children:A.NOMSTRUCTURE}),A.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Abr√©viation: ",A.ABBREVIATION]})]})),noOptionsText:p.length>=2?"Aucune structure trouv√©e":"Tapez au moins 2 caract√®res pour rechercher",loadingText:"Chargement des structures..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:h,onChange:K=>m(K),format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:K=>e.jsx(ee,{...K,fullWidth:!0,variant:"outlined",InputProps:{...K.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:y,onChange:K=>C(K),minDate:h,format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:K=>e.jsx(ee,{...K,fullWidth:!0,variant:"outlined",InputProps:{...K.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]}),t&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,color:"primary.main"}}),"Structure s√©lectionn√©e:"]}),e.jsx(r,{variant:"h6",sx:{ml:3,mt:1},children:t.NOMSTRUCTURE}),t.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3},children:["Abr√©viation: ",t.ABBREVIATION]}),(h||y)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center",mt:1},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",Ce()]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Zt,{onClick:f,startIcon:z?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:z||!t||!h||!y,children:z?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:M,onClose:()=>$(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(pe,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats des Formations"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:g,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>$(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[W.length," formation",W.length>1?"s":""," trouv√©e",W.length>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Structure: ",e.jsx("strong",{children:t?.NOMSTRUCTURE})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode: ",e.jsx("strong",{children:Ce()})]})]}),e.jsxs(s,{display:"flex",gap:2,alignItems:"center",children:[e.jsx(Y,{icon:e.jsx(mr,{fontSize:"small"}),label:`${le} session${le>1?"s":""} au total`,color:"secondary",variant:"outlined",sx:{borderColor:"secondary.light",color:"secondary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}}),e.jsx(Y,{icon:e.jsx(pe,{fontSize:"small"}),label:Ce(),color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Formations R√©alis√©es"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structure :"})," ",t?.NOMSTRUCTURE]}),t?.ABBREVIATION&&e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Abr√©viation :"})," ",t?.ABBREVIATION]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",Ce()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total :"})," ",W.length," formation",W.length>1?"s":""]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Sessions totales :"})," ",le," session",le>1?"s":""]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Date"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",borderBottom:"2px solid #bbdefb"},children:"Sessions"})]})}),e.jsx("tbody",{children:W.map((K,A)=>e.jsxs("tr",{style:{backgroundColor:A%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:A+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:K.INTITULE?.toUpperCase()||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",color:"#1976d2"},children:fe(K.DATE)}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",textAlign:"center",color:"#d32f2f",fontWeight:"bold"},children:K.NOMBRE_SESSIONS||0})]},A))})]})]}),e.jsx(we,{sx:{maxHeight:500,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Date"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb",textAlign:"center",width:"100px"},children:"Sessions"})]})}),e.jsx(Be,{children:W.length>0?W.map((K,A)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:A+1}),e.jsx(j,{sx:{fontWeight:"bold",color:"dark",textTransform:"uppercase",letterSpacing:"0.5px"},children:K.INTITULE||"-"}),e.jsx(j,{children:e.jsxs(s,{display:"flex",alignItems:"center",color:"text.primary",children:[e.jsx(ir,{fontSize:"small",color:"primary",sx:{mr:1}}),fe(K.DATE)]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"center",sx:{color:"secondary.main",fontWeight:"bold",fontSize:"1rem"},children:[e.jsx(mr,{fontSize:"small",sx:{mr:.5}}),K.NOMBRE_SESSIONS||0]})})]},A)):e.jsx(te,{children:e.jsx(j,{colSpan:5,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucune formation trouv√©e"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez une autre p√©riode ou structure."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:_,onClose:he,autoHideDuration:5e3,children:e.jsx(Xt,{onClose:he,severity:H,iconMapping:{success:e.jsx(ce,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(ce,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:H==="error"?"#d32f2f":"background.paper",color:H==="error"?"white":"inherit","& .MuiAlert-icon":{color:H==="error"?"white":"inherit"},"& .MuiAlert-message":{color:H==="error"?"white":"inherit"},"& .MuiAlert-action .MuiIconButton-root":{color:H==="error"?"white":"inherit"}},children:e.jsx(r,{fontWeight:500,children:V})})})]})})},es=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),rs=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),ts=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(ze().subtract(1,"month")),[p,P]=o.useState(ze()),[u,h]=o.useState(!1),[m,y]=o.useState([]),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState(""),[$,_]=o.useState("success"),Q=[{value:"TYPEFORMATIONPASSERELLE",label:"Formation Passerelle"},{value:"TYPEAUTOFORMATION",label:"Autoformation"},{value:"TYPEFORMATIONTRANSVERSALLE",label:"Formation Transversale"},{value:"TYPEFORMATIONSPECIALISATIONFONCTIONEL",label:"Sp√©cialisation Fonctionnelle"},{value:"TYPEFORMATIONINDIVIDUELLE",label:"Formation Individuelle"}],V=()=>{if(t.length===0||!l||!p)return null;const i=t.map(c=>`fi.${c} = 1`).join(" OR ");return`
      SELECT 
        fi.INTITULE,
        fi.CIBLES,
        MAX(sf.DATE) AS DATE,
        ${t.map(c=>`fi.${c}`).join(", ")}
      FROM formationmodifiable fi
      INNER JOIN sessionformation sf 
        ON sf.IDFORMATION = fi.IDFORMATIONM
      WHERE (${i})
        AND sf.DATE >= '${l.format("YYYY-MM-DD")}'
        AND sf.DATE <= '${p.format("YYYY-MM-DD")}'
          AND sf.CONFIRME = 1
      GROUP BY 
        fi.IDFORMATIONM,
        fi.INTITULE,
        fi.CIBLES,
        ${t.map(c=>`fi.${c}`).join(", ")}
      ORDER BY MAX(sf.DATE) DESC;
    `},q=async()=>{if(t.length===0){O("Veuillez s√©lectionner au moins une cat√©gorie","error");return}if(!l||!p){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(l.isAfter(p)){O("La date de fin doit √™tre post√©rieure √† la date de d√©but","error");return}const i=V();h(!0);const c=localStorage.getItem("token"),a="";try{const S=await ae.post(`${a}/personnaliserrequette`,{query:i},{headers:{Authorization:`Bearer ${c}`}});if(S.data)y(S.data),z(!0),O(`${S.data.length} formations trouv√©es`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(S){O(S.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{h(!1)}},H=()=>{const i=document.getElementById("printable-content"),c=document.body.innerHTML;document.body.innerHTML=i.innerHTML,window.print(),document.body.innerHTML=c,window.location.reload()},O=(i,c)=>{M(i),_(c),W(!0)},L=()=>{W(!1)},T=i=>ze(i).format("DD/MM/YYYY"),E=()=>t.map(i=>{const c=Q.find(a=>a.value===i);return c?c.label:i}),v=i=>Q.filter(c=>i[c.value]===1).map(c=>c.label);return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:900,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(xr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Formations par Cat√©gories Multiples"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"S√©lectionnez une ou plusieurs cat√©gories de formation et une p√©riode pour afficher les r√©sultats"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,children:e.jsxs(Or,{fullWidth:!0,children:[e.jsx(Rr,{id:"categories-label",children:"Cat√©gories de formation"}),e.jsx(Tr,{labelId:"categories-label",multiple:!0,value:t,onChange:i=>n(i.target.value),input:e.jsx(lt,{label:"Cat√©gories de formation"}),renderValue:i=>i.map(c=>{const a=Q.find(S=>S.value===c);return a?a.label:c}).join(", "),sx:{bgcolor:"#f9f9f9"},children:Q.map(i=>e.jsxs(ur,{value:i.value,children:[e.jsx(ct,{checked:t.indexOf(i.value)>-1}),e.jsx(dr,{primary:i.label})]},i.value))})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ae,{dateAdapter:er,children:e.jsx(ne,{label:"Date de d√©but",value:l,onChange:i=>x(i),format:"DD/MM/YYYY",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",sx:{bgcolor:"#f9f9f9"}})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ae,{dateAdapter:er,children:e.jsx(ne,{label:"Date de fin",value:p,onChange:i=>P(i),format:"DD/MM/YYYY",minDate:l,enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",sx:{bgcolor:"#f9f9f9"}})}})})})]}),t.length>0&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(xr,{sx:{mr:1,color:"primary.main"}}),"Cat√©gories s√©lectionn√©es:"]}),e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1,ml:3},children:E().map((i,c)=>e.jsx(Y,{label:i,color:"primary",variant:"outlined",size:"small",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500}},c))})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(rs,{onClick:q,startIcon:u?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:u||t.length===0,children:u?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:C,onClose:()=>z(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(xr,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"Formations par Cat√©gories"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:H,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>z(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[m.length," formation",m.length>1?"s":""," trouv√©e",m.length>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Cat√©gories: ",e.jsx("strong",{children:E().join(", ")})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode du ",e.jsx("strong",{children:T(l)})," au ",e.jsx("strong",{children:T(p)})]})]}),e.jsx(s,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:E().map((i,c)=>e.jsx(Y,{icon:e.jsx(xr,{fontSize:"small"}),label:i,color:"primary",variant:"outlined",size:"small",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.75rem",height:28}},c))})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Formations par Cat√©gories"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Cat√©gories :"})," ",E().join(", ")]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," du ",T(l)," au ",T(p)]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total :"})," ",m.length," formation",m.length>1?"s":""]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Cat√©gories"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Date"})]})}),e.jsx("tbody",{children:m.map((i,c)=>e.jsxs("tr",{style:{backgroundColor:c%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:c+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:i.INTITULE?.toUpperCase()||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:v(i).join(", ")}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",color:"#1976d2"},children:T(i.DATE)})]},c))})]})]}),e.jsx(we,{sx:{maxHeight:500,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Cat√©gories"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Date"})]})}),e.jsx(Be,{children:m.length>0?m.map((i,c)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:c+1}),e.jsx(j,{sx:{fontWeight:"bold",color:"dark",textTransform:"uppercase",letterSpacing:"0.5px"},children:i.INTITULE||"-"}),e.jsx(j,{children:e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:v(i).map((a,S)=>e.jsx(Y,{label:a,color:"primary",variant:"outlined",size:"small",sx:{fontSize:"0.7rem",height:24,mb:.5}},S))})}),e.jsx(j,{children:e.jsxs(s,{display:"flex",alignItems:"center",color:"text.primary",children:[e.jsx(ir,{fontSize:"small",color:"primary",sx:{mr:1}}),T(i.DATE)]})})]},c)):e.jsx(te,{children:e.jsx(j,{colSpan:5,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucune formation trouv√©e"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez d'autres cat√©gories ou v√©rifiez les filtres."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:F,onClose:L,autoHideDuration:5e3,children:e.jsx(es,{onClose:L,severity:$,iconMapping:{success:e.jsx(xr,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:$==="error"?"#d32f2f":"background.paper",color:$==="error"?"white":"inherit","& .MuiAlert-icon":{color:$==="error"?"white":"inherit"},"& .MuiAlert-message":{color:$==="error"?"white":"inherit"},"& .MuiAlert-action .MuiIconButton-root":{color:$==="error"?"white":"inherit"}},children:e.jsx(r,{fontWeight:500,children:D})})})]})},ss=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),os=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const ns=()=>{const[t,n]=o.useState(ze().subtract(1,"month")),[l,x]=o.useState(ze()),[p,P]=o.useState(!1),[u,h]=o.useState([]),[m,y]=o.useState(!1),[C,z]=o.useState(!1),[F,W]=o.useState(""),[D,M]=o.useState("success"),$=()=>!t||!l?null:`
      SELECT 
        fm.INTITULE,
        fm.CIBLES,
        MAX(sf.DATE) AS DATE
      FROM formationmodifiable fm
      INNER JOIN sessionformation sf 
        ON sf.IDFORMATION = fm.IDFORMATIONM
      WHERE sf.DATE >= '${t.format("YYYY-MM-DD")}'
        AND sf.DATE <= '${l.format("YYYY-MM-DD")}'
        AND fm.PREVUE <> '1'
        AND sf.CONFIRME = 1
      GROUP BY 
        fm.IDFORMATIONM,
        fm.INTITULE,
        fm.CIBLES
      ORDER BY MAX(sf.DATE) DESC;
`,_=async()=>{if(!t||!l){V("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(t.isAfter(l)){V("La date de fin doit √™tre post√©rieure √† la date de d√©but","error");return}const O=$();P(!0);const L=localStorage.getItem("token"),T="";try{const E=await ae.post(`${T}/personnaliserrequette`,{query:O},{headers:{Authorization:`Bearer ${L}`}});if(E.data)h(E.data),y(!0),V(`${E.data.length} formations trouv√©es`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(E){V(E.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},Q=()=>{const O=document.getElementById("printable-content"),L=document.body.innerHTML;document.body.innerHTML=O.innerHTML,window.print(),document.body.innerHTML=L,window.location.reload()},V=(O,L)=>{W(O),M(L),z(!0)},q=()=>{z(!1)},H=O=>ze(O).format("DD/MM/YYYY");return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:800,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(G,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Liste des Formations Improvis√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Ex√©cutez une requ√™te pour obtenir ces formations improvis√©es sur une p√©riode sp√©cifique"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsx(Ae,{dateAdapter:er,children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:t,onChange:O=>n(O),format:"DD/MM/YYYY",enableAccessibleFieldDOMStructure:!1,slots:{textField:O=>e.jsx(ee,{...O,fullWidth:!0,variant:"outlined",InputProps:{...O.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:l,onChange:O=>x(O),format:"DD/MM/YYYY",minDate:t,enableAccessibleFieldDOMStructure:!1,slots:{textField:O=>e.jsx(ee,{...O,fullWidth:!0,variant:"outlined",InputProps:{...O.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]})}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(os,{onClick:_,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p,children:p?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:m,onClose:()=>y(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(ir,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats des Formations"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:Q,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>y(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[u.length," formation",u.length>1?"s":""," trouv√©e",u.length>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode du ",e.jsx("strong",{children:H(t)})," au ",e.jsx("strong",{children:H(l)})]})]}),e.jsx(Y,{icon:e.jsx(U,{fontSize:"small"}),label:`${H(t)} ‚Üí ${H(l)}`,color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Formations Improvis√©es R√©alis√©es"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",H(t)," - ",H(l)]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total :"})," ",u.length," formation",u.length>1?"s":""]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Date"})]})}),e.jsx("tbody",{children:u.map((O,L)=>e.jsxs("tr",{style:{backgroundColor:L%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:L+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:O.INTITULE?.toUpperCase()||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",color:"#1976d2"},children:H(O.DATE)})]},L))})]})]}),e.jsx(we,{sx:{maxHeight:500,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Date"})]})}),e.jsx(Be,{children:u.length>0?u.map((O,L)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:L+1}),e.jsx(j,{sx:{fontWeight:"bold",color:"dark",textTransform:"uppercase",letterSpacing:"0.5px"},children:O.INTITULE||"-"}),e.jsx(j,{children:e.jsxs(s,{display:"flex",alignItems:"center",color:"text.primary",children:[e.jsx(ir,{fontSize:"small",color:"primary",sx:{mr:1}}),H(O.DATE)]})})]},L)):e.jsx(te,{children:e.jsx(j,{colSpan:4,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucune formation improvis√©e trouv√©e"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez une autre p√©riode ou v√©rifiez les filtres."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:C,onClose:q,autoHideDuration:5e3,children:e.jsx(ss,{onClose:q,severity:D,iconMapping:{success:e.jsx(ir,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:D==="error"?"#d32f2f":"background.paper",color:D==="error"?"white":"inherit","& .MuiAlert-icon":{color:D==="error"?"white":"inherit"},"& .MuiAlert-message":{color:D==="error"?"white":"inherit"},"& .MuiAlert-action .MuiIconButton-root":{color:D==="error"?"white":"inherit"}},children:e.jsx(r,{fontWeight:500,children:F})})})]})},is=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),as=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const ls=J(ut)(({theme:t})=>({mb:1,border:"1px solid #e0e0e0",borderRadius:"12px !important",boxShadow:"0 2px 8px rgba(0,0,0,0.03)",overflow:"hidden",transition:"box-shadow 0.3s ease","&:hover":{boxShadow:"0 4px 16px rgba(0,0,0,0.08)"},"&:before":{display:"none"}})),cs=()=>{const[t,n]=o.useState([]),[l,x]=o.useState([]),[p,P]=o.useState(""),[u,h]=o.useState(!1),[m,y]=o.useState([]),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState(""),[$,_]=o.useState("success"),[Q,V]=o.useState(!1),[q,H]=o.useState(!1),[O,L]=o.useState(!1),T="",E=o.useCallback(async()=>{try{V(!0);const f=localStorage.getItem("token"),g=await ae.get(`${T}/listepersonels`,{params:{limit:20},headers:{Authorization:`Bearer ${f}`}});x(g.data),L(!0)}catch(f){console.error("Error fetching default personnels:",f)}finally{V(!1)}},[T]),v=o.useCallback(tr(async f=>{try{V(!0);const g=localStorage.getItem("token"),B=await ae.get(`${T}/listepersonels`,{params:{search:f},headers:{Authorization:`Bearer ${g}`}});x(B.data)}catch(g){k("Erreur lors du chargement des personnels","error"),console.error("Error fetching personnels:",g)}finally{V(!1)}},300),[T]),i=()=>{H(!0),!O&&l.length===0&&E()},c=()=>{H(!1)};o.useEffect(()=>{p.length>=2?v(p):p.length===0&&q&&!O&&E()},[p,v,E,q,O]);const a=(f,{inputValue:g})=>{const B=g.toLowerCase();return f.filter(he=>{const fe=he.NOM?.toLowerCase().includes(B),Ce=he.NOMMARI?.toLowerCase().includes(B),le=he.PRENOM?.toLowerCase().includes(B),K=he.MATRICULE?.toLowerCase().includes(B);return fe||Ce||le||K})},S=()=>!t||t.length===0?null:`
        SELECT 
            p.MATRICULE,
            p.NOM,
            p.PRENOM,
            p.NOMMARI,
            p.FONCTION,
            p.TELEPHONE,
            p.GRADE,
            s.NOMSTRUCTURE AS Structure,
            fm.INTITULE AS Formation,
            sf.DATE AS DateFormation,  -- ‚úÖ Date r√©elle de la session
            fm.LIEU,
            fm.CIBLES
        FROM 
            personel p
        INNER JOIN participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
        INNER JOIN sessionformation sf ON ps.IDSESSION = sf.IDSESSION
        INNER JOIN formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
        INNER JOIN structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
        WHERE 
            p.IDPERSONNEL IN (${t.map(g=>`'${g.IDPERSONNEL}'`).join(", ")})
              AND sf.CONFIRME = 1
        ORDER BY 
            p.NOM, p.PRENOM, sf.DATE DESC;
    `,R=async()=>{if(!t||t.length===0){k("Veuillez s√©lectionner au moins un personnel","error");return}const f=S();h(!0);const g=localStorage.getItem("token");try{const B=await ae.post(`${T}/personnaliserrequette`,{query:f},{headers:{Authorization:`Bearer ${g}`}});if(B.data)y(B.data),z(!0),k(`${B.data.length} formations trouv√©es`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(B){k(B.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{h(!1)}},b=()=>{const f=document.getElementById("printable-content"),g=document.body.innerHTML;document.body.innerHTML=f.innerHTML,window.print(),document.body.innerHTML=g,window.location.reload()},k=(f,g)=>{M(f),_(g),W(!0)},w=()=>{W(!1)},I=f=>f?new Date(f).toLocaleDateString("fr-FR"):"-",N=m.reduce((f,g)=>{const B=`${g.MATRICULE}_${g.NOM}_${g.PRENOM}`;return f[B]||(f[B]={personnel:{MATRICULE:g.MATRICULE,NOM:g.NOM,PRENOM:g.PRENOM,FONCTION:g.FONCTION,TELEPHONE:g.TELEPHONE,GRADE:g.GRADE,Structure:g.Structure},formations:[]}),f[B].formations.push({Formation:g.Formation,DateFormation:g.DateFormation,LIEU:g.LIEU,CIBLES:g.CIBLES}),f},{});return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:900,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Ir,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Formations par Personnel"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des formations b√©n√©fici√©es par plusieurs personnels"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsx(d,{container:!0,spacing:3,children:e.jsx(d,{item:!0,xs:12,children:e.jsx(Ge,{multiple:!0,options:l,getOptionLabel:f=>`${f.NOM} ${f.PRENOM} (${f.MATRICULE})`,value:t,open:q,onOpen:i,onClose:c,onChange:(f,g)=>{n(g)},onInputChange:(f,g)=>{P(g)},loading:Q,filterOptions:a,renderInput:f=>e.jsx(ee,{...f,label:"S√©lectionner les personnels",variant:"outlined",fullWidth:!0,placeholder:"Tapez le nom, pr√©nom ou matricule du personnel...",InputProps:{...f.InputProps,startAdornment:e.jsx(rr,{color:"action",sx:{mr:1}}),endAdornment:e.jsxs(e.Fragment,{children:[Q?e.jsx(xe,{color:"inherit",size:20}):null,f.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(f,g)=>o.createElement(s,{component:"li",...f,key:g.IDPERSONNEL},e.jsx(Le,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{sx:{flexGrow:1},children:[e.jsx(r,{variant:"body1",children:`${g.NOM||""} ${g.PRENOM||""}${g.NOMMARI?" √âpse. "+g.NOMMARI:""}`.trim()||"Nom inconnu"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Matricule: ",g.MATRICULE," ‚Ä¢ ",g.FONCTION]})]})),renderTags:(f,g)=>f.map((B,he)=>o.createElement(Y,{label:`${B.NOM} ${B.PRENOM}`,...g({index:he}),key:B.IDPERSONNEL,variant:"outlined",icon:e.jsx(Le,{fontSize:"small"}),sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",height:32}})),noOptionsText:p.length>=2?"Aucun personnel trouv√©":"Tapez au moins 2 caract√®res pour rechercher",loadingText:"Chargement des personnels..."})})}),t.length>0&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(rr,{sx:{mr:1,color:"primary.main"}}),"Personnels s√©lectionn√©s:"]}),e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,ml:3,mt:1},children:t.map(f=>e.jsx(Y,{label:`${f.NOM} ${f.PRENOM}`,variant:"outlined",size:"small",icon:e.jsx(Ve,{fontSize:"small"}),sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.8rem",height:28}},f.IDPERSONNEL))})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(as,{onClick:R,startIcon:u?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:u||t.length===0,children:u?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:C,onClose:()=>z(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Ir,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats des Formations"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:b,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>z(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[Object.keys(N).length," personnel",Object.keys(N).length>1?"s":""," ‚Ä¢ ",m.length," formation",m.length>1?"s":""]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Formations suivies par les personnels s√©lectionn√©s"})]}),e.jsx(Y,{icon:e.jsx(rr,{fontSize:"small"}),label:`${t.length} personnels`,color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Formations par Personnel"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Personnels s√©lectionn√©s :"})," ",t.length]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total formations :"})," ",m.length]}),Object.entries(N).map(([f,g])=>e.jsxs("div",{style:{pageBreakInside:"avoid",marginTop:"30px"},children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{color:"#0d47a1",borderBottom:"2px solid #bbdefb",paddingBottom:"8px"},children:[g.personnel.NOM," ",g.personnel.PRENOM]}),e.jsxs(r,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Matricule :"})," ",g.personnel.MATRICULE]}),e.jsxs(r,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Fonction :"})," ",g.personnel.FONCTION]}),e.jsxs(r,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Structure :"})," ",g.personnel.Structure]}),e.jsxs(r,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Grade :"})," ",g.personnel.GRADE||"-"]}),e.jsxs(r,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"T√©l√©phone :"})," ",g.personnel.TELEPHONE||"-"]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Formation"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Date"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Lieu"})]})}),e.jsx("tbody",{children:g.formations.map((B,he)=>e.jsxs("tr",{style:{backgroundColor:he%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:B.Formation?.toUpperCase()||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:I(B.DateFormation)}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:B.LIEU||"-"})]},he))})]})]},f))]}),e.jsx(s,{sx:{maxHeight:600,overflow:"auto"},children:Object.keys(N).length>0?Object.entries(N).map(([f,g],B)=>e.jsxs(ls,{children:[e.jsx(dt,{expandIcon:e.jsx(Dr,{}),sx:{bgcolor:"#e3f2fd","&:hover":{bgcolor:"#bbdefb"},transition:"background-color 0.2s"},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(Le,{sx:{mr:2,color:"primary.main"}}),e.jsxs(s,{sx:{flexGrow:1},children:[e.jsxs(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:[g.personnel.NOM," ",g.personnel.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[g.personnel.MATRICULE," ‚Ä¢ ",g.personnel.FONCTION]})]}),e.jsx(Y,{label:`${g.formations.length} formation${g.formations.length>1?"s":""}`,color:"primary",size:"small",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.8rem",height:28}})]})}),e.jsxs(xt,{sx:{pt:2},children:[e.jsxs(d,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"text.secondary"}}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Grade:"})," ",g.personnel.GRADE||"-"]})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"text.secondary"}}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"T√©l√©phone:"})," ",g.personnel.TELEPHONE||"-"]})]})})]}),e.jsx(se,{sx:{mb:2}}),e.jsxs(r,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:18,color:"primary.main"}}),"Formations suivies"]}),e.jsx(we,{sx:{maxHeight:300,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsxs(Ue,{size:"medium",stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Formation"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Date"})]})}),e.jsx(Be,{children:g.formations.map((he,fe)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",color:"dark",textTransform:"uppercase",letterSpacing:"0.5px"},children:he.Formation||"-"}),e.jsx(j,{children:I(he.DateFormation)})]},fe))})]})})]})]},f)):e.jsxs(s,{textAlign:"center",py:5,children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucune formation trouv√©e"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez avec d'autres personnels ou v√©rifiez les filtres."})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:F,onClose:w,autoHideDuration:5e3,children:e.jsx(is,{onClose:w,severity:$,iconMapping:{success:e.jsx(Ir,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:D})})})]})},ds=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),xs=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(135deg, #B8E1FF 0%, #DAF0FF 100%)",color:"#2C5282",border:"none",borderRadius:"30px",fontSize:"1.1rem",padding:t.spacing(1.5,5),boxShadow:"0 8px 20px rgba(184, 225, 255, 0.4)",transition:"all 0.3s ease",height:"7vh",width:"20vw",textTransform:"none",fontWeight:600,"&:hover":{background:"linear-gradient(135deg, #A5D8FF 0%, #C5E6FF 100%)",transform:"translateY(-2px)",boxShadow:"0 12px 25px rgba(184, 225, 255, 0.6)"},"&:disabled":{background:"linear-gradient(135deg, #E8F0FE 0%, #F0F5FF 100%)",color:"#90A4C7",boxShadow:"none"}})),us=J(oe)(({theme:t})=>({marginBottom:t.spacing(2),borderRadius:"16px",overflow:"hidden",transition:"all 0.3s ease",border:"1px solid #E3F0FF",boxShadow:"0 4px 12px rgba(184, 225, 255, 0.2)","&:hover":{boxShadow:"0 8px 24px rgba(184, 225, 255, 0.4)",transform:"translateY(-2px)",borderColor:"#9AC9FF"}})),fs=J(oe)(({theme:t})=>({marginBottom:t.spacing(1.5),borderRadius:"12px",backgroundColor:"#F8FCFF",border:"1px solid #E3F0FF",transition:"all 0.2s ease","&:hover":{backgroundColor:"#F0F9FF",transform:"translateX(4px)",borderColor:"#B8E1FF"}})),ms=()=>{const[t,n]=o.useState(ze().subtract(1,"month")),[l,x]=o.useState(ze()),[p,P]=o.useState(!1),[u,h]=o.useState([]),[m,y]=o.useState(null),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState(""),[$,_]=o.useState("success"),Q=()=>!t||!l?null:`
      SELECT 
        f.IDFORMATIONM,
        f.INTITULE AS formation_intitule,
        f.CIBLES AS formation_cibles,
        MAX(s.DATE) AS formation_date,
        COUNT(DISTINCT s.IDSESSION) AS nombre_sessions,
        COUNT(DISTINCT p.IDPERSONNEL) AS nombre_participants,
        -- Concat√©nation manuelle des participants (alternative √† JSON_ARRAYAGG)
        GROUP_CONCAT(
          DISTINCT CONCAT(
            p.MATRICULE, '||',
            COALESCE(p.NOM, ''), '||',
            COALESCE(p.PRENOM, ''), '||',
            COALESCE(p.NOMMARI, ''), '||',
            COALESCE(p.FONCTION, ''), '||',
            COALESCE(p.TELEPHONE, ''), '||',
            COALESCE(p.GRADE, ''), '||',
            COALESCE(st.NOMSTRUCTURE, '')
          ) SEPARATOR ';;'
        ) AS participants_data
      FROM formationmodifiable f
      INNER JOIN sessionformation s ON s.IDFORMATION = f.IDFORMATIONM
      LEFT JOIN participer_session ps ON ps.IDSESSION = s.IDSESSION
      LEFT JOIN personel p ON p.IDPERSONNEL = ps.IDPERSONNEL
      LEFT JOIN structure st ON p.IDSTRUCTURE = st.IDSTRUCTURE
      WHERE f.TYPEFORMATIONINDIVIDUELLE = 1
          AND s.CONFIRME = 1
        AND s.DATE >= '${t.format("YYYY-MM-DD")}'
        AND s.DATE <= '${l.format("YYYY-MM-DD")}'
      GROUP BY f.IDFORMATIONM, f.INTITULE, f.CIBLES
      ORDER BY formation_date DESC;
    `,V=i=>i?i.split(";;").map(a=>{const[S,R,b,k,w,I,N,f]=a.split("||");return S?{MATRICULE:S,NOM:R,PRENOM:b,NOMMARI:k||null,FONCTION:w||"-",TELEPHONE:I||"-",GRADE:N||"-",structure:f||"-"}:null}).filter(a=>a!==null):[],q=async()=>{if(!t||!l){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(t.isAfter(l)){O("La date de fin doit √™tre post√©rieure √† la date de d√©but","error");return}const i=Q();P(!0);const c=localStorage.getItem("token"),a="";try{const S=await ae.post(`${a}/personnaliserrequette`,{query:i},{headers:{Authorization:`Bearer ${c}`}});if(S.data&&S.data.length>0){const R=S.data.map(b=>({id:b.IDFORMATIONM,intitule:b.formation_intitule,cibles:b.formation_cibles,date:b.formation_date,nombre_sessions:b.nombre_sessions||0,nombre_participants:b.nombre_participants||0,participants:V(b.participants_data)}));h(R),z(!0),O(`${R.length} formations trouv√©es avec ${R.reduce((b,k)=>b+k.participants.length,0)} participants`,"success")}else h([]),z(!0),O("Aucune formation trouv√©e pour cette p√©riode","info")}catch(S){console.error("Erreur:",S),O(S.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},H=()=>{const i=document.getElementById("printable-content"),c=document.body.innerHTML;document.body.innerHTML=i.innerHTML,window.print(),document.body.innerHTML=c,window.location.reload()},O=(i,c)=>{M(i),_(c),W(!0)},L=()=>{W(!1)},T=i=>ze(i).format("DD/MM/YYYY"),E=i=>{y(m===i?null:i)},v=u.reduce((i,c)=>i+(c.participants?.length||0),0);return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:4,bgcolor:"#FFFFFF",boxShadow:"0px 10px 40px rgba(184, 225, 255, 0.3)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:4,pb:2,borderBottom:"2px solid #E3F0FF"},children:[e.jsx(kr,{sx:{bgcolor:"#DAF0FF",width:56,height:56,mr:2,color:"#2C5282",boxShadow:"0 4px 10px rgba(184, 225, 255, 0.4)"},children:e.jsx(rr,{})}),e.jsxs(s,{children:[e.jsx(r,{variant:"h4",fontWeight:"700",sx:{color:"#2C5282"},children:"Formations Individuelles"}),e.jsx(r,{variant:"body1",sx:{color:"#5A7D9C"},children:"Une seule requ√™te - formations et participants"})]})]}),e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Ae,{dateAdapter:er,children:e.jsx(ne,{label:"Date de d√©but",value:t,onChange:i=>n(i),format:"DD/MM/YYYY",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:"12px",backgroundColor:"#F8FCFF","& fieldset":{borderColor:"#B8E1FF"},"&:hover fieldset":{borderColor:"#7FB4D9"}},"& .MuiInputLabel-root":{color:"#5A7D9C"}}})}})})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Ae,{dateAdapter:er,children:e.jsx(ne,{label:"Date de fin",value:l,onChange:i=>x(i),format:"DD/MM/YYYY",minDate:t,enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:"12px",backgroundColor:"#F8FCFF","& fieldset":{borderColor:"#B8E1FF"},"&:hover fieldset":{borderColor:"#7FB4D9"}},"& .MuiInputLabel-root":{color:"#5A7D9C"}}})}})})}),e.jsx(d,{item:!0,xs:12,md:2,sx:{display:"flex",alignItems:"center"},children:e.jsx(xs,{onClick:q,startIcon:p?e.jsx(xe,{size:20,sx:{color:"#2C5282"}}):e.jsx(Oe,{}),disabled:p,fullWidth:!0,children:p?"Chargement...":"Rechercher"})})]}),e.jsxs(Se,{open:C,onClose:()=>z(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:4,maxHeight:"90vh",background:"linear-gradient(145deg, #FFFFFF 0%, #F8FCFF 100%)"}},children:[e.jsxs(Ee,{sx:{background:"linear-gradient(135deg, #DAF0FF 0%, #B8E1FF 100%)",color:"#2C5282",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(rr,{sx:{mr:1.5,fontSize:28,color:"#2C5282"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h6",fontWeight:"bold",children:"R√©sultats"}),e.jsxs(r,{variant:"caption",sx:{opacity:.9,color:"#2C5282"},children:[u.length," formation",u.length>1?"s":""," ‚Ä¢ ",v," participant",v>1?"s":""]})]})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:H,size:"small",sx:{bgcolor:"rgba(255,255,255,0.5)",color:"#2C5282",mr:1,"&:hover":{bgcolor:"rgba(255,255,255,0.8)"}},children:e.jsx(Xe,{})}),e.jsx(de,{onClick:()=>z(!1),size:"small",sx:{bgcolor:"rgba(255,255,255,0.5)",color:"#2C5282","&:hover":{bgcolor:"rgba(255,255,255,0.8)"}},children:e.jsx(Te,{})})]})]}),e.jsxs(ye,{sx:{p:3,bgcolor:"#F8FCFF"},children:[e.jsx(Z,{sx:{p:2,mb:3,borderRadius:3,background:"linear-gradient(145deg, #FFFFFF 0%, #F0F9FF 100%)",border:"1px solid #DAF0FF"},children:e.jsxs(d,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(ir,{sx:{color:"#5A9BCF",mr:1}}),e.jsxs(r,{variant:"body1",sx:{color:"#2C5282"},children:[e.jsx("strong",{children:"P√©riode :"})," du ",T(t)," au ",T(l)]})]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"center",children:[e.jsx(rr,{sx:{color:"#5A9BCF",mr:1}}),e.jsxs(r,{variant:"body1",sx:{color:"#2C5282"},children:[e.jsx("strong",{children:"Formations :"})," ",u.length]})]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:[e.jsx(Le,{sx:{color:"#5A9BCF",mr:1}}),e.jsxs(r,{variant:"body1",sx:{color:"#2C5282"},children:[e.jsx("strong",{children:"Participants :"})," ",v]})]})})]})}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h4",gutterBottom:!0,children:"Rapport des Formations Individuelles"}),e.jsxs(r,{variant:"body1",children:["P√©riode du ",T(t)," au ",T(l)]}),e.jsxs(r,{variant:"body1",children:["Total formations: ",u.length]}),e.jsxs(r,{variant:"body1",children:["Total participants: ",v]}),u.map((i,c)=>e.jsxs("div",{style:{marginTop:30,pageBreakAfter:"always"},children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:[c+1,". ",i.intitule]}),e.jsxs(r,{variant:"body2",children:["Date derni√®re session: ",T(i.date)]}),e.jsxs(r,{variant:"body2",children:["Nombre de sessions: ",i.nombre_sessions]}),e.jsxs(r,{variant:"body2",children:["Cibles: ",i.cibles||"Non sp√©cifi√©"]}),e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:["Participants (",i.participants.length,")"]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:10},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[e.jsx("th",{style:{padding:8,border:"1px solid #ddd"},children:"N¬∞"}),e.jsx("th",{style:{padding:8,border:"1px solid #ddd"},children:"Matricule"}),e.jsx("th",{style:{padding:8,border:"1px solid #ddd"},children:"Nom & Pr√©noms"}),e.jsx("th",{style:{padding:8,border:"1px solid #ddd"},children:"Fonction"}),e.jsx("th",{style:{padding:8,border:"1px solid #ddd"},children:"Grade"}),e.jsx("th",{style:{padding:8,border:"1px solid #ddd"},children:"Structure"})]})}),e.jsx("tbody",{children:i.participants.map((a,S)=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:6,border:"1px solid #ddd"},children:S+1}),e.jsx("td",{style:{padding:6,border:"1px solid #ddd"},children:a.MATRICULE}),e.jsxs("td",{style:{padding:6,border:"1px solid #ddd"},children:[a.NOM," ",a.PRENOM," ",a.NOMMARI?`(√©p. ${a.NOMMARI})`:""]}),e.jsx("td",{style:{padding:6,border:"1px solid #ddd"},children:a.FONCTION}),e.jsx("td",{style:{padding:6,border:"1px solid #ddd"},children:a.GRADE}),e.jsx("td",{style:{padding:6,border:"1px solid #ddd"},children:a.structure})]},S))})]})]},c))]}),e.jsx(Pr,{spacing:2,children:u.length>0?u.map((i,c)=>e.jsxs(us,{children:[e.jsxs(s,{onClick:()=>E(i.id),sx:{p:2.5,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:m===i.id?"#F0F9FF":"white",transition:"all 0.2s"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",flex:1},children:[e.jsx(kr,{sx:{bgcolor:"#DAF0FF",mr:2,width:40,height:40,fontSize:"1rem",color:"#2C5282"},children:c+1}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h6",fontWeight:"600",sx:{color:"#2C5282"},children:i.intitule}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5,gap:2,flexWrap:"wrap"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(ir,{sx:{fontSize:16,color:"#7FB4D9",mr:.5}}),e.jsx(r,{variant:"body2",sx:{color:"#5A7D9C"},children:T(i.date)})]}),e.jsx(Y,{size:"small",label:`${i.nombre_sessions} session${i.nombre_sessions>1?"s":""}`,sx:{bgcolor:"#E3F0FF",color:"#2C5282",height:22,fontSize:"0.7rem"}}),i.cibles&&e.jsx(Y,{label:i.cibles,size:"small",sx:{bgcolor:"#F0F0FF",color:"#4A6FA5",height:22,fontSize:"0.7rem"}})]})]})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Y,{icon:e.jsx(rr,{sx:{fontSize:14}}),label:i.participants.length,size:"small",sx:{bgcolor:"#E3F0FF",color:"#2C5282",fontWeight:600,height:24}}),m===i.id?e.jsx(wt,{sx:{color:"#5A9BCF"}}):e.jsx(Dr,{sx:{color:"#7FB4D9"}})]})]}),e.jsxs(Dt,{in:m===i.id,children:[e.jsx(se,{sx:{borderColor:"#DAF0FF"}}),e.jsx(s,{sx:{p:2.5,bgcolor:"#F8FCFF"},children:i.participants.length>0?e.jsx(Pr,{spacing:1.5,children:i.participants.map((a,S)=>e.jsx(fs,{children:e.jsx(ie,{sx:{p:2,"&:last-child":{pb:2}},children:e.jsxs(d,{container:!0,spacing:1,alignItems:"center",children:[e.jsxs(d,{item:!0,xs:12,md:4,children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Ve,{sx:{fontSize:18,color:"#7FB4D9",mr:1}}),e.jsxs(r,{variant:"body2",fontWeight:"600",sx:{color:"#2C5282"},children:[a.NOM," ",a.PRENOM,a.NOMMARI&&e.jsx(Y,{size:"small",label:`√©p. ${a.NOMMARI}`,sx:{ml:1,fontSize:"0.6rem",height:18,bgcolor:"#F0F9FF",color:"#4A6FA5"}})]})]}),e.jsx(s,{display:"flex",alignItems:"center",ml:3.5,children:e.jsx(r,{variant:"caption",sx:{color:"#7FB4D9"},children:a.MATRICULE||"N/A"})})]}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(qe,{sx:{fontSize:16,color:"#7FB4D9",mr:1}}),e.jsx(r,{variant:"body2",sx:{color:"#5A7D9C"},children:a.FONCTION||"-"})]})}),e.jsx(d,{item:!0,xs:12,md:2,children:e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(ve,{sx:{fontSize:16,color:"#7FB4D9",mr:1}}),e.jsx(r,{variant:"body2",sx:{color:"#5A7D9C"},children:a.GRADE||"-"})]})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(sr,{sx:{fontSize:16,color:"#7FB4D9",mr:1}}),e.jsx(r,{variant:"body2",sx:{color:"#5A7D9C"},children:a.TELEPHONE||"-"}),e.jsx(Ut,{sx:{fontSize:16,color:"#7FB4D9",ml:1,mr:.5}}),e.jsx(r,{variant:"caption",noWrap:!0,sx:{color:"#5A7D9C"},children:a.structure?.split(" ").slice(0,2).join(" ")||"-"})]})})]})})},S))}):e.jsxs(s,{sx:{textAlign:"center",py:3,bgcolor:"white",borderRadius:2,border:"1px dashed #DAF0FF"},children:[e.jsx(rr,{sx:{fontSize:40,color:"#B8E1FF",mb:1}}),e.jsx(r,{sx:{color:"#7FB4D9"},children:"Aucun participant pour cette formation"})]})})]})]},i.id)):e.jsxs(Z,{sx:{p:5,textAlign:"center",borderRadius:3,bgcolor:"#F8FCFF"},children:[e.jsx(ce,{sx:{fontSize:60,color:"#B8E1FF",mb:2}}),e.jsx(r,{variant:"h6",sx:{color:"#5A7D9C"},gutterBottom:!0,children:"Aucune formation trouv√©e"}),e.jsx(r,{variant:"body2",sx:{color:"#7FB4D9"},children:"Essayez de modifier la p√©riode de recherche"})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:F,onClose:L,autoHideDuration:4e3,children:e.jsx(ds,{onClose:L,severity:$,sx:{borderRadius:2,boxShadow:"0 8px 20px rgba(184, 225, 255, 0.3)",minWidth:300,"& .MuiAlert-standardSuccess":{backgroundColor:"#E3F0FF"},"& .MuiAlert-standardError":{backgroundColor:"#FFE8E8"},"& .MuiAlert-standardInfo":{backgroundColor:"#F0F9FF"}},children:e.jsx(r,{fontWeight:500,sx:{color:$==="success"?"#2C5282":"#5A7D9C"},children:D})})})]})},hs=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),ps=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const bs=()=>{const[t,n]=o.useState(ze().subtract(1,"month")),[l,x]=o.useState(ze()),[p,P]=o.useState(!1),[u,h]=o.useState([]),[m,y]=o.useState(!1),[C,z]=o.useState(!1),[F,W]=o.useState(""),[D,M]=o.useState("success"),$=()=>!t||!l?null:`SELECT 
                fm.INTITULE,
                fm.CIBLES,
                COUNT(sf.IDSESSION) AS NOMBRE_SESSIONS
            FROM 
                formationmodifiable fm
            LEFT JOIN 
                sessionformation sf ON fm.IDFORMATIONM = sf.IDFORMATION
            WHERE 
                fm.PREVUE = '1'
                AND (sf.IDSESSION IS NULL  -- Aucune session existante
                OR sf.CONFIRME=0)
                AND (
                    (fm.ANNEE1 >= YEAR('${t.format("YYYY-MM-DD")}') AND fm.ANNEE1 <= YEAR('${l.format("YYYY-MM-DD")}'))
                    OR (fm.ANNEE2 >= YEAR('${t.format("YYYY-MM-DD")}') AND fm.ANNEE2 <= YEAR('${l.format("YYYY-MM-DD")}'))
                    OR (fm.ANNEE3 >= YEAR('${t.format("YYYY-MM-DD")}') AND fm.ANNEE3 <= YEAR('${l.format("YYYY-MM-DD")}'))
                )
            GROUP BY
                fm.IDFORMATIONM, fm.INTITULE, fm.CIBLES
            ORDER BY 
                fm.INTITULE ASC;
           `,_=async()=>{if(!t||!l){V("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(t.isAfter(l)){V("La date de fin doit √™tre post√©rieure √† la date de d√©but","error");return}const O=$();P(!0);const L=localStorage.getItem("token"),T="";try{const E=await ae.post(`${T}/personnaliserrequette`,{query:O},{headers:{Authorization:`Bearer ${L}`}});if(E.data)h(E.data),y(!0),V(`${E.data.length} formations trouv√©es`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(E){V(E.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},Q=()=>{const O=document.getElementById("printable-content"),L=document.body.innerHTML;document.body.innerHTML=O.innerHTML,window.print(),document.body.innerHTML=L,window.location.reload()},V=(O,L)=>{W(O),M(L),z(!0)},q=()=>{z(!1)},H=O=>O?ze(O).format("DD/MM/YYYY"):"Non r√©alis√©e";return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:800,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(G,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Liste des Formations Non R√©alis√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Ex√©cutez une requ√™te pour obtenir les formations pr√©vues mais non tenues"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsx(Ae,{dateAdapter:er,children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:t,onChange:O=>n(O),format:"DD/MM/YYYY",enableAccessibleFieldDOMStructure:!1,slots:{textField:O=>e.jsx(ee,{...O,fullWidth:!0,variant:"outlined",InputProps:{...O.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:l,onChange:O=>x(O),format:"DD/MM/YYYY",minDate:t,enableAccessibleFieldDOMStructure:!1,slots:{textField:O=>e.jsx(ee,{...O,fullWidth:!0,variant:"outlined",InputProps:{...O.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]})}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(ps,{onClick:_,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p,children:p?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:m,onClose:()=>y(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(ir,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats des Formations"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:Q,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>y(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[u.length," formation",u.length>1?"s":""," trouv√©e",u.length>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode du ",e.jsx("strong",{children:H(t)})," au ",e.jsx("strong",{children:H(l)})]})]}),e.jsx(Y,{icon:e.jsx(U,{fontSize:"small"}),label:`${H(t)} ‚Üí ${H(l)}`,color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Formations Non R√©alis√©es"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," du ",H(t)," au ",H(l)]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total :"})," ",u.length," formation",u.length>1?"s":""]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"B√©n√©ficiaires"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Statut"})]})}),e.jsx("tbody",{children:u.map((O,L)=>e.jsxs("tr",{style:{backgroundColor:L%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:L+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:O.INTITULE?.toUpperCase()||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:O.CIBLES||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",color:"#d32f2f",fontWeight:"bold"},children:"Non r√©alis√©e"})]},L))})]})]}),e.jsx(we,{sx:{maxHeight:500,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"B√©n√©ficiaires"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Statut"})]})}),e.jsx(Be,{children:u.length>0?u.map((O,L)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:L+1}),e.jsx(j,{sx:{fontWeight:"bold",color:"dark",textTransform:"uppercase",letterSpacing:"0.5px"},children:O.INTITULE||"-"}),e.jsx(j,{children:O.CIBLES||"-"}),e.jsx(j,{children:e.jsxs(s,{display:"flex",alignItems:"center",color:"error.main",children:[e.jsx(ce,{fontSize:"small",sx:{mr:1}}),"Non r√©alis√©e"]})})]},L)):e.jsx(te,{children:e.jsx(j,{colSpan:4,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucune formation non r√©alis√©e trouv√©e"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez une autre p√©riode ou v√©rifiez les filtres."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:C,onClose:q,autoHideDuration:5e3,children:e.jsx(hs,{onClose:q,severity:D,iconMapping:{success:e.jsx(ir,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:F})})})]})},gs=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),js=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const Ss=()=>{const[t,n]=o.useState(null),[l,x]=o.useState([]),[p,P]=o.useState(""),u=new Date,[h,m]=o.useState(u),[y,C]=o.useState(u),[z,F]=o.useState(!1),[W,D]=o.useState([]),[M,$]=o.useState(!1),[_,Q]=o.useState(!1),[V,q]=o.useState(""),[H,O]=o.useState("success"),[L,T]=o.useState(!1),[E,v]=o.useState(!1),[i,c]=o.useState(!1),a="",S=o.useCallback(async()=>{try{T(!0);const le=localStorage.getItem("token"),K=await ae.get(`${a}/listestructures`,{params:{limit:10},headers:{Authorization:`Bearer ${le}`}});x(K.data),c(!0)}catch(le){B("Erreur lors du chargement des structures par d√©faut","error"),console.error("Error fetching default structures:",le)}finally{T(!1)}},[a]),R=o.useCallback(tr(async le=>{try{T(!0);const K=localStorage.getItem("token"),A=await ae.get(`${a}/listestructures`,{params:{search:le},headers:{Authorization:`Bearer ${K}`}});x(A.data)}catch(K){B("Erreur lors du chargement des structures","error"),console.error("Error fetching structures:",K)}finally{T(!1)}},300),[a]),b=()=>{v(!0),!i&&l.length===0&&S()},k=()=>{v(!1)};o.useEffect(()=>{p.length>=2?R(p):p.length===0&&E&&!i&&S()},[p,R,S,E,i]);const w=(le,{inputValue:K})=>{const A=K.toLowerCase();return le.filter(X=>{const re=X.NOMSTRUCTURE?.toLowerCase().includes(A),ge=X.ABBREVIATION?.toLowerCase().includes(A);return re||ge})},I=le=>le?le.toISOString().split("T")[0]:null,N=()=>{if(!t||!h||!y)return null;const le=I(h),K=I(y);return`
      SELECT 
          fm.INTITULE,
          fm.CIBLES,
          s.NOMSTRUCTURE AS Structure,
          COUNT(sf.IDSESSION) AS NOMBRE_SESSIONS
      FROM 
          formationmodifiable fm
      JOIN 
          structure s ON fm.IDSTRUCTUREBENEFICIAIRE = s.IDSTRUCTURE
      LEFT JOIN 
          sessionformation sf ON fm.IDFORMATIONM = sf.IDFORMATION
      WHERE 
          fm.IDSTRUCTUREBENEFICIAIRE = '${t.IDSTRUCTURE}'
          AND (
              (fm.ANNEE1 >= YEAR('${le}') AND fm.ANNEE1 <= YEAR('${K}'))
              OR (fm.ANNEE2 >= YEAR('${le}') AND fm.ANNEE2 <= YEAR('${K}'))
              OR (fm.ANNEE3 >= YEAR('${le}') AND fm.ANNEE3 <= YEAR('${K}'))
          )
          AND fm.PREVUE = '1'
          AND (sf.IDSESSION IS NULL  -- Aucune session existante
                OR sf.CONFIRME=0)
      GROUP BY
          fm.IDFORMATIONM, fm.INTITULE, fm.CIBLES, s.NOMSTRUCTURE
      ORDER BY 
          fm.INTITULE ASC;
    `},f=async()=>{if(!t){B("Veuillez s√©lectionner une structure","error");return}if(!h||!y){B("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(h>y){B("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const le=N();F(!0);const K=localStorage.getItem("token");try{const A=await ae.post(`${a}/personnaliserrequette`,{query:le},{headers:{Authorization:`Bearer ${K}`}});if(A.data)D(A.data),$(!0),B(`${A.data.length} formations trouv√©es`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(A){B(A.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{F(!1)}},g=()=>{const le=document.getElementById("printable-content"),K=document.body.innerHTML;document.body.innerHTML=le.innerHTML,window.print(),document.body.innerHTML=K,window.location.reload()},B=(le,K)=>{q(le),O(K),Q(!0)},he=()=>{Q(!1)},fe=le=>new Date(le).toLocaleDateString("fr-FR"),Ce=()=>h&&y?`du ${fe(h)} au ${fe(y)}`:"P√©riode non d√©finie";return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:900,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(pe,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Formations Non R√©alis√©es par Structure"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Consultez les formations pr√©vues mais non tenues par structure et p√©riode"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(Ge,{options:l,getOptionLabel:le=>le.NOMSTRUCTURE,value:t,open:E,onOpen:b,onClose:k,onChange:(le,K)=>{n(K)},onInputChange:(le,K)=>{P(K)},loading:L,filterOptions:w,renderInput:le=>e.jsx(ee,{...le,label:"S√©lectionner une structure",variant:"outlined",fullWidth:!0,placeholder:"Tapez le nom ou l'abr√©viation de la structure...",InputProps:{...le.InputProps,startAdornment:e.jsx(ue,{color:"action",sx:{mr:1}}),endAdornment:e.jsxs(e.Fragment,{children:[L?e.jsx(xe,{color:"inherit",size:20}):null,le.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(le,K)=>o.createElement(s,{component:"li",...le,key:K.IDSTRUCTURE},e.jsx(ue,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{sx:{flexGrow:1},children:[e.jsx(r,{variant:"body1",children:K.NOMSTRUCTURE}),K.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Abr√©viation: ",K.ABBREVIATION]})]})),noOptionsText:p.length>=2?"Aucune structure trouv√©e":"Tapez au moins 2 caract√®res pour rechercher",loadingText:"Chargement des structures..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:h,onChange:le=>m(le),format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:le=>e.jsx(ee,{...le,fullWidth:!0,variant:"outlined",InputProps:{...le.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:y,onChange:le=>C(le),minDate:h,format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:le=>e.jsx(ee,{...le,fullWidth:!0,variant:"outlined",InputProps:{...le.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]}),t&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,color:"primary.main"}}),"Structure s√©lectionn√©e:"]}),e.jsx(r,{variant:"h6",sx:{ml:3,mt:1},children:t.NOMSTRUCTURE}),t.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3},children:["Abr√©viation: ",t.ABBREVIATION]}),(h||y)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center",mt:1},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",Ce()]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(js,{onClick:f,startIcon:z?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:z||!t||!h||!y,children:z?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:M,onClose:()=>$(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(pe,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats des Formations"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:g,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>$(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[W.length," formation",W.length>1?"s":""," trouv√©e",W.length>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Structure: ",e.jsx("strong",{children:t?.NOMSTRUCTURE})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode: ",e.jsx("strong",{children:Ce()})]})]}),e.jsx(Y,{icon:e.jsx(pe,{fontSize:"small"}),label:Ce(),color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Formations Non R√©alis√©es"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structure :"})," ",t?.NOMSTRUCTURE]}),t?.ABBREVIATION&&e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Abr√©viation :"})," ",t?.ABBREVIATION]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",Ce()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total :"})," ",W.length," formation",W.length>1?"s":""]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"B√©n√©ficiaires"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Statut"})]})}),e.jsx("tbody",{children:W.map((le,K)=>e.jsxs("tr",{style:{backgroundColor:K%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:K+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:le.INTITULE?.toUpperCase()||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:le.CIBLES||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",color:"#d32f2f",fontWeight:"bold"},children:"Non r√©alis√©e"})]},K))})]})]}),e.jsx(we,{sx:{maxHeight:500,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Intitul√©"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"B√©n√©ficiaires"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Statut"})]})}),e.jsx(Be,{children:W.length>0?W.map((le,K)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:K+1}),e.jsx(j,{sx:{fontWeight:"bold",color:"dark",textTransform:"uppercase",letterSpacing:"0.5px"},children:le.INTITULE||"-"}),e.jsx(j,{children:le.CIBLES||"-"}),e.jsx(j,{children:e.jsxs(s,{display:"flex",alignItems:"center",color:"error.main",children:[e.jsx(ce,{fontSize:"small",sx:{mr:1}}),"Non r√©alis√©e"]})})]},K)):e.jsx(te,{children:e.jsx(j,{colSpan:4,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucune formation non r√©alis√©e trouv√©e"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez une autre p√©riode ou structure."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:_,onClose:he,autoHideDuration:5e3,children:e.jsx(gs,{onClose:he,severity:H,iconMapping:{success:e.jsx(pe,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:V})})})]})})},ys=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Es=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 200, 200, 0.47), rgba(255, 200, 200, 0))",color:"#d32f2f",border:"2px solid #d32f2f",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(255, 200, 200, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 200, 200, 0.7), rgba(255, 200, 200, 0))",transform:"translateY(-2px)"}})),Is=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(ze().subtract(1,"year")),[p,P]=o.useState(ze()),[u,h]=o.useState(!1),[m,y]=o.useState([]),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState(""),[$,_]=o.useState("success"),Q=[{value:"TYPEFORMATIONPASSERELLE",label:"Formation Passerelle"},{value:"TYPEAUTOFORMATION",label:"Autoformation"},{value:"TYPEFORMATIONTRANSVERSALLE",label:"Formation Transversale"},{value:"TYPEFORMATIONSPECIALISATIONFONCTIONEL",label:"Sp√©cialisation Fonctionnelle"},{value:"TYPEFORMATIONINDIVIDUELLE",label:"Formation Individuelle"}],V=()=>{if(t.length===0||!l||!p)return null;const i=t.map(S=>`fi.${S} = 1`).join(" OR "),c=l.year(),a=p.year();return`
      SELECT 
          fi.INTITULE,
          fi.CIBLES,
          fi.ANNEE1,
          fi.ANNEE2,
          fi.ANNEE3,
          COUNT(sf.IDSESSION) AS NOMBRE_SESSIONS,
          ${t.map(S=>`fi.${S}`).join(", ")}
      FROM formationmodifiable fi
      LEFT JOIN sessionformation sf ON fi.IDFORMATIONM = sf.IDFORMATION
      WHERE (${i})
          AND (
              (fi.ANNEE1 BETWEEN ${c} AND ${a})
              OR (fi.ANNEE2 BETWEEN ${c} AND ${a})
              OR (fi.ANNEE3 BETWEEN ${c} AND ${a})
          )
          AND (sf.IDSESSION IS NULL  -- Aucune session existante
                OR sf.CONFIRME=0)
      GROUP BY
          fi.IDFORMATIONM, fi.INTITULE, fi.CIBLES, fi.ANNEE1, fi.ANNEE2, fi.ANNEE3
          ${t.length>0?`, ${t.map(S=>`fi.${S}`).join(", ")}`:""}
      ORDER BY fi.ANNEE1, fi.ANNEE2, fi.ANNEE3;
    `},q=async()=>{if(t.length===0){O("Veuillez s√©lectionner au moins une cat√©gorie","error");return}const i=V();h(!0);const c=localStorage.getItem("token"),a="";try{const S=await ae.post(`${a}/personnaliserrequette`,{query:i},{headers:{Authorization:`Bearer ${c}`}});if(S.data)y(S.data),z(!0),O(`${S.data.length} formation${S.data.length>1?"s":""} non r√©alis√©e${S.data.length>1?"s":""} trouv√©e${S.data.length>1?"s":""}`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(S){O(S.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{h(!1)}},H=()=>{const i=document.getElementById("printable-content"),c=document.body.innerHTML;document.body.innerHTML=i.innerHTML,window.print(),document.body.innerHTML=c,window.location.reload()},O=(i,c)=>{M(i),_(c),W(!0)},L=()=>{W(!1)},T=(i,c,a)=>{const S=l.year(),R=p.year(),b=[i,c,a].filter(k=>k!=null&&k!==0).filter(k=>k>=S&&k<=R);return b.length>0?b.join(", "):"-"},E=()=>t.map(i=>{const c=Q.find(a=>a.value===i);return c?c.label:i}),v=i=>Q.filter(c=>i[c.value]===1).map(c=>c.label);return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:900,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Er,{color:"error",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"error",children:"Formations Non R√©alis√©es par Cat√©gories"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Formations pr√©vues dans la p√©riode mais non r√©alis√©es durant celle-ci"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,children:e.jsxs(Or,{fullWidth:!0,children:[e.jsx(Rr,{id:"categories-label",children:"Cat√©gories de formation"}),e.jsx(Tr,{labelId:"categories-label",multiple:!0,value:t,onChange:i=>n(i.target.value),input:e.jsx(lt,{label:"Cat√©gories de formation"}),renderValue:i=>i.map(c=>{const a=Q.find(S=>S.value===c);return a?a.label:c}).join(", "),sx:{bgcolor:"#fff8f8"},children:Q.map(i=>e.jsxs(ur,{value:i.value,children:[e.jsx(ct,{checked:t.indexOf(i.value)>-1}),e.jsx(dr,{primary:i.label})]},i.value))})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ae,{dateAdapter:er,children:e.jsx(ne,{label:"D√©but de p√©riode",views:["year"],value:l,onChange:i=>x(i),format:"YYYY",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",sx:{bgcolor:"#fff8f8"}})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ae,{dateAdapter:er,children:e.jsx(ne,{label:"Fin de p√©riode",views:["year"],value:p,onChange:i=>P(i),format:"YYYY",minDate:l,enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",sx:{bgcolor:"#fff8f8"}})}})})})]}),t.length>0&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#ffebee",borderRadius:2,border:"1px solid #ffcdd2"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",color:"error.main"},children:[e.jsx(Er,{sx:{mr:1}}),"Cat√©gories s√©lectionn√©es:"]}),e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1,ml:3},children:E().map((i,c)=>e.jsx(Y,{label:i,color:"error",variant:"outlined",size:"small",sx:{borderColor:"error.light",color:"error.main",fontWeight:500}},c))})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Es,{onClick:q,startIcon:u?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:u||t.length===0,children:u?"Traitement...":"Executer"})}),e.jsxs(Se,{open:C,onClose:()=>z(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(244, 67, 54, 0.1)",overflow:"hidden",border:"1px solid #ffcdd2"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#ffebee",color:"error.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #ffcdd2"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Er,{sx:{mr:1.5,fontSize:30,color:"error.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"error.main",children:"Formations Non R√©alis√©es"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:H,size:"small",sx:{bgcolor:"white",color:"error.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>z(!1),size:"small",sx:{bgcolor:"white",color:"error.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fdf6f6"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[m.length," formation",m.length>1?"s":""," non r√©alis√©e",m.length>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Cat√©gories: ",e.jsx("strong",{children:E().join(", ")})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode: ",e.jsx("strong",{children:l.year()})," ‚Äì ",e.jsx("strong",{children:p.year()})]})]}),e.jsx(s,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:E().map((i,c)=>e.jsx(Y,{icon:e.jsx(Er,{fontSize:"small"}),label:i,color:"error",variant:"outlined",size:"small",sx:{borderColor:"error.light",color:"error.main",fontWeight:500,fontSize:"0.75rem",height:28}},c))})]}),e.jsx(se,{sx:{my:2.5,borderColor:"#ffcdd2"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#d32f2f"},children:"üî¥ Rapport : Formations Non R√©alis√©es par Cat√©gories"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Cat√©gories :"})," ",E().join(", ")]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",l.year()," ‚Äì ",p.year()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total :"})," ",m.length," formation",m.length>1?"s":""," non r√©alis√©e",m.length>1?"s":""]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#ffebee",color:"#d32f2f"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #ffcdd2"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #ffcdd2"},children:"Intitul√©"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #ffcdd2"},children:"B√©n√©ficiaires"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #ffcdd2"},children:"Ann√©es Pr√©vue(s)"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #ffcdd2"},children:"Cat√©gories"})]})}),e.jsx("tbody",{children:m.map((i,c)=>e.jsxs("tr",{style:{backgroundColor:c%2===0?"#fff8f8":"#ffffff"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #ffcdd2"},children:c+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #ffcdd2",fontWeight:"bold"},children:i.INTITULE?.toUpperCase()||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #ffcdd2"},children:i.CIBLES||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #ffcdd2",color:"#d32f2f"},children:T(i.ANNEE1,i.ANNEE2,i.ANNEE3)}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #ffcdd2"},children:v(i).join(", ")})]},c))})]})]}),e.jsx(we,{sx:{maxHeight:500,border:"1px solid #ffcdd2",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(244, 67, 54, 0.05)"},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",bgcolor:"#ffebee",color:"error.main",borderBottom:"2px solid #ffcdd2"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",bgcolor:"#ffebee",color:"error.main",borderBottom:"2px solid #ffcdd2"},children:"Intitul√©"}),e.jsx(j,{sx:{fontWeight:"bold",bgcolor:"#ffebee",color:"error.main",borderBottom:"2px solid #ffcdd2"},children:"Ann√©es Pr√©vue(s)"}),e.jsx(j,{sx:{fontWeight:"bold",bgcolor:"#ffebee",color:"error.main",borderBottom:"2px solid #ffcdd2"},children:"Cat√©gories"})]})}),e.jsx(Be,{children:m.length>0?m.map((i,c)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#fff8f8"},"&:hover":{bgcolor:"#ffebee !important"}},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"error.main"},children:c+1}),e.jsx(j,{sx:{fontWeight:"bold",textTransform:"uppercase"},children:i.INTITULE||"-"}),e.jsx(j,{sx:{color:"error.main",fontWeight:"bold"},children:T(i.ANNEE1,i.ANNEE2,i.ANNEE3)}),e.jsx(j,{children:e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:v(i).map((a,S)=>e.jsx(Y,{label:a,color:"error",variant:"outlined",size:"small",sx:{fontSize:"0.7rem",height:24}},S))})})]},c)):e.jsx(te,{children:e.jsx(j,{colSpan:5,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucune formation non r√©alis√©e trouv√©e"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"V√©rifiez les cat√©gories et la p√©riode s√©lectionn√©e."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:F,onClose:L,autoHideDuration:5e3,children:e.jsx(ys,{onClose:L,severity:$,iconMapping:{success:e.jsx(Er,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(244, 67, 54, 0.1)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:D})})})]})},Ns=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),vs=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const Os=()=>{const t=new Date,[n,l]=o.useState(t),[x,p]=o.useState(t),[P,u]=o.useState(!1),[h,m]=o.useState([]),[y,C]=o.useState(!1),[z,F]=o.useState(!1),[W,D]=o.useState(""),[M,$]=o.useState("success"),_="",Q=i=>i?i.toISOString().split("T")[0]:null,V=()=>{if(!n||!x)return null;const i=Q(n),c=Q(x);return`
      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          COALESCE(formations_periode.NombreFormations, 0) as FormationsPeriode,
          COALESCE(formations_total.TotalFormations, 0) as TotalFormations
      FROM 
          personel p
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(DISTINCT sf.IDFORMATION) as NombreFormations
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE 
              sf.DATE >= '${i}' 
              AND sf.DATE <= '${c}'
              AND sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) formations_periode ON p.IDPERSONNEL = formations_periode.IDPERSONNEL
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(DISTINCT sf.IDFORMATION) as TotalFormations
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE
            sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) formations_total ON p.IDPERSONNEL = formations_total.IDPERSONNEL
      WHERE 
          (formations_periode.NombreFormations IS NULL OR formations_periode.NombreFormations = 0) 
          AND s.NOMSTRUCTURE <> 'AUTRE'
      ORDER BY 
          s.NOMSTRUCTURE, p.NOM, p.PRENOM;
    `},q=async()=>{if(!n||!x){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const i=V();u(!0);const c=localStorage.getItem("token");try{const a=await ae.post(`${_}/personnaliserrequette`,{query:i},{headers:{Authorization:`Bearer ${c}`}});if(a.data)m(a.data),C(!0),O(`${a.data.length} personnels trouv√©s sans formation sur la p√©riode`,"info");else throw new Error("Aucun r√©sultat trouv√©.")}catch(a){O(a.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},H=()=>{const i=document.getElementById("printable-content"),c=document.body.innerHTML;document.body.innerHTML=i.innerHTML,window.print(),document.body.innerHTML=c,window.location.reload()},O=(i,c)=>{D(i),$(c),F(!0)},L=()=>{F(!1)},T=i=>i?new Date(i).toLocaleDateString("fr-FR"):"-",E=()=>n&&x?`du ${T(n)} au ${T(x)}`:"P√©riode non d√©finie",v=()=>[...new Set(h.map(c=>c.StructureAbbreviation||c.Structure))].length;return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Je,{color:"warning",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels Sans Formation sur P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste globale de tous les personnels n'ayant pas b√©n√©fici√© d'une formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:i=>l(i),format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",InputProps:{...i.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:i=>p(i),minDate:n,format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",InputProps:{...i.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fff3e0",borderRadius:2,border:"1px solid #ffcc80"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"warning.main"}}),"Crit√®res de recherche:"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode d'absence de formation: ",E()]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mt:.5},children:"‚Ä¢ Recherche dans toutes les structures"})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(vs,{onClick:q,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:y,onClose:()=>C(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Je,{sx:{mr:1.5,fontSize:30,color:"warning.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats des Personnels non form√©s"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:H,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>C(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ke,{sx:{mr:1,color:"warning.main"}}),h.length," personnel",h.length>1?"s":""," sans formation"]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse globale de toutes les structures"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode: ",e.jsx("strong",{children:E()})]})]}),e.jsx(Y,{icon:e.jsx(pe,{fontSize:"small"}),label:E(),color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Personnels Sans Formation"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",E()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structures concern√©es :"})," ",v()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total personnels :"})," ",h.length]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Nom & Pr√©nom"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Matricule"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Structure"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Fonction"})]})}),e.jsx("tbody",{children:h.map((i,c)=>e.jsxs("tr",{style:{backgroundColor:c%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:c+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:`${i.NOM} ${i.PRENOM}`.toUpperCase()}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.MATRICULE}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.StructureAbbreviation||i.Structure}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.FONCTION||"-"})]},c))})]})]}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Structure"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Contact"})]})}),e.jsx(Be,{children:h.length>0?h.map((i,c)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:c+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[i.NOM," ",i.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),i.MATRICULE,i.SEXE&&e.jsx(Y,{label:i.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:i.StructureAbbreviation||i.Structure}),i.StructureAbbreviation&&e.jsx(r,{variant:"caption",color:"text.secondary",children:i.Structure})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:i.FONCTION||"-"}),i.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",i.GRADE," ",e.jsx("br",{}),"Structure: ",i.StructureAbbreviation]})]})]})}),e.jsx(j,{children:i.TELEPHONE&&e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:i.TELEPHONE})]})})]},c)):e.jsx(te,{children:e.jsx(j,{colSpan:7,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ve,{sx:{fontSize:48,color:"success.main",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Excellent ! Tous les personnels ont √©t√© form√©s"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Aucun personnel sans formation trouv√© pour cette p√©riode."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:z,onClose:L,autoHideDuration:5e3,children:e.jsx(Ns,{onClose:L,severity:M,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(Ke,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:W})})})]})})},Ts=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Rs=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const As=()=>{const t=new Date,[n,l]=o.useState(t),[x,p]=o.useState(t),[P,u]=o.useState(!1),[h,m]=o.useState([]),[y,C]=o.useState(!1),[z,F]=o.useState(!1),[W,D]=o.useState(""),[M,$]=o.useState("success"),_="",Q=i=>i?i.toISOString().split("T")[0]:null,V=()=>{if(!n||!x)return null;const i=Q(n),c=Q(x);return`
      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          COALESCE(formations_periode.NombreFormations, 0) as FormationsPeriode,
          COALESCE(formations_total.TotalFormations, 0) as TotalFormations
      FROM 
          personel p
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(DISTINCT sf.IDFORMATION) as NombreFormations
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE 
              sf.DATE >= '${i}' 
              AND sf.DATE <= '${c}'
              AND sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) formations_periode ON p.IDPERSONNEL = formations_periode.IDPERSONNEL
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(DISTINCT sf.IDFORMATION) as TotalFormations
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE
              sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) formations_total ON p.IDPERSONNEL = formations_total.IDPERSONNEL
      WHERE 
          p.SEXE = 'F√©minin'  -- ‚úÖ Filtre conserv√© ici
          AND (formations_periode.NombreFormations IS NULL OR formations_periode.NombreFormations = 0)
          AND s.NOMSTRUCTURE <> 'AUTRE'
      ORDER BY 
          s.NOMSTRUCTURE, p.NOM, p.PRENOM;
    `},q=async()=>{if(!n||!x){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const i=V();u(!0);const c=localStorage.getItem("token");try{const a=await ae.post(`${_}/personnaliserrequette`,{query:i},{headers:{Authorization:`Bearer ${c}`}});if(a.data)m(a.data),C(!0),O(`${a.data.length} personnels f√©minins trouv√©s sans formation sur la p√©riode`,"info");else throw new Error("Aucun r√©sultat trouv√©.")}catch(a){O(a.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},H=()=>{const i=document.getElementById("printable-content"),c=document.body.innerHTML;document.body.innerHTML=i.innerHTML,window.print(),document.body.innerHTML=c,window.location.reload()},O=(i,c)=>{D(i),$(c),F(!0)},L=()=>{F(!1)},T=i=>i?new Date(i).toLocaleDateString("fr-FR"):"-",E=()=>n&&x?`du ${T(n)} au ${T(x)}`:"P√©riode non d√©finie",v=()=>[...new Set(h.map(c=>c.StructureAbbreviation||c.Structure))].length;return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(nr,{color:"primary",sx:{fontSize:36,mr:2}})," ",e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnel F√©minin Sans Formation sur P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels f√©minins n'ayant pas b√©n√©fici√© d'une formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:i=>l(i),format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",InputProps:{...i.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:i=>p(i),minDate:n,format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",InputProps:{...i.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#e3f2fd",borderRadius:2,border:"1px solid #bbdefb"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode d'absence de formation: ",E()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mt:.5},children:["‚Ä¢ Personnel: ",e.jsx("strong",{children:"F√©minin uniquement"})]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{ml:3},children:"‚Ä¢ Recherche dans toutes les structures"})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Rs,{onClick:q,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:y,onClose:()=>C(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(nr,{sx:{mr:1.5,fontSize:30,color:"primary.main"}})," ",e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats du Personnel F√©minin non form√©"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:H,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>C(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(nr,{sx:{mr:1,color:"primary.main"}}),h.length," personnel",h.length>1?"s":""," f√©minin",h.length>1?"s":""," sans formation"]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse globale de toutes les structures"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode: ",e.jsx("strong",{children:E()})]})]}),e.jsx(Y,{icon:e.jsx(pe,{fontSize:"small"}),label:E(),color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Personnel F√©minin Sans Formation"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",E()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structures concern√©es :"})," ",v()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total personnels f√©minins :"})," ",h.length]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Nom & Pr√©nom"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Matricule"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Structure"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Fonction"})]})}),e.jsx("tbody",{children:h.map((i,c)=>e.jsxs("tr",{style:{backgroundColor:c%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:c+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:`${i.NOM} ${i.PRENOM}`.toUpperCase()}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.MATRICULE}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.StructureAbbreviation||i.Structure}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.FONCTION||"-"})]},c))})]})]}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Structure"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Contact"})]})}),e.jsx(Be,{children:h.length>0?h.map((i,c)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important"}},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:c+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[i.NOM," ",i.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),i.MATRICULE,e.jsx(Y,{label:"F√©minin",size:"small",color:"secondary",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(s,{children:e.jsx(r,{variant:"body2",fontWeight:"500",children:i.StructureAbbreviation||i.Structure})})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(s,{children:e.jsx(r,{variant:"body2",fontWeight:"500",children:i.FONCTION||"-"})})]})}),e.jsx(j,{children:i.TELEPHONE&&e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:i.TELEPHONE})]})})]},c)):e.jsx(te,{children:e.jsx(j,{colSpan:5,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ve,{sx:{fontSize:48,color:"success.main",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Excellent ! Toutes les personnels f√©minins ont √©t√© form√©es"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Aucune personnels f√©minin sans formation trouv√©e pour cette p√©riode."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:z,onClose:L,autoHideDuration:5e3,children:e.jsx(Ts,{onClose:L,severity:M,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(nr,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:W})})})]})})},Cs=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Ds=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const Fs=()=>{const t=new Date,[n,l]=o.useState(t),[x,p]=o.useState(t),[P,u]=o.useState(!1),[h,m]=o.useState([]),[y,C]=o.useState(!1),[z,F]=o.useState(!1),[W,D]=o.useState(""),[M,$]=o.useState("success"),_="",Q=i=>i?i.toISOString().split("T")[0]:null,V=()=>{if(!n||!x)return null;const i=Q(n),c=Q(x);return`
      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          COALESCE(formations_periode.NombreFormations, 0) as FormationsPeriode,
          COALESCE(formations_total.TotalFormations, 0) as TotalFormations
      FROM 
          personel p
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(DISTINCT sf.IDFORMATION) as NombreFormations
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE 
              sf.DATE >= '${i}' 
              AND sf.DATE <= '${c}'
              AND sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) formations_periode ON p.IDPERSONNEL = formations_periode.IDPERSONNEL
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(DISTINCT sf.IDFORMATION) as TotalFormations
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE
              sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) formations_total ON p.IDPERSONNEL = formations_total.IDPERSONNEL
      WHERE 
          p.SEXE = 'Masculin'  -- ‚úÖ Filtre conserv√© ici
          AND (formations_periode.NombreFormations IS NULL OR formations_periode.NombreFormations = 0)
          AND s.NOMSTRUCTURE <> 'AUTRE'
      ORDER BY 
          s.NOMSTRUCTURE, p.NOM, p.PRENOM;
    `},q=async()=>{if(!n||!x){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const i=V();u(!0);const c=localStorage.getItem("token");try{const a=await ae.post(`${_}/personnaliserrequette`,{query:i},{headers:{Authorization:`Bearer ${c}`}});if(a.data)m(a.data),C(!0),O(`${a.data.length} personnels masculins trouv√©s sans formation sur la p√©riode`,"info");else throw new Error("Aucun r√©sultat trouv√©.")}catch(a){O(a.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},H=()=>{const i=document.getElementById("printable-content"),c=document.body.innerHTML;document.body.innerHTML=i.innerHTML,window.print(),document.body.innerHTML=c,window.location.reload()},O=(i,c)=>{D(i),$(c),F(!0)},L=()=>{F(!1)},T=i=>i?new Date(i).toLocaleDateString("fr-FR"):"-",E=()=>n&&x?`du ${T(n)} au ${T(x)}`:"P√©riode non d√©finie",v=()=>[...new Set(h.map(c=>c.StructureAbbreviation||c.Structure))].length;return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Me,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels Masculins Sans Formation sur P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste globale de tous les personnels masculins n'ayant pas b√©n√©fici√© d'une formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:i=>l(i),format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",InputProps:{...i.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:i=>p(i),minDate:n,format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",InputProps:{...i.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#e3f2fd",borderRadius:2,border:"1px solid #90caf9"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(Me,{sx:{mr:1,fontSize:16,color:"primary.main"}}),"Personnels masculins uniquement"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode d'absence de formation: ",E()]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mt:.5},children:"‚Ä¢ Recherche dans toutes les structures"})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Ds,{onClick:q,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:y,onClose:()=>C(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Me,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats des Personnels Masculins non form√©s"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:H,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>C(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Me,{sx:{mr:1,color:"primary.main"}}),h.length," personnel",h.length>1?"s":""," masculin",h.length>1?"s":""," sans formation"]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse globale de toutes les structures"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode: ",e.jsx("strong",{children:E()})]})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:[e.jsx(Y,{icon:e.jsx(Me,{fontSize:"small"}),label:"Personnels masculins",color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}}),e.jsx(Y,{icon:e.jsx(pe,{fontSize:"small"}),label:E(),color:"secondary",variant:"outlined",sx:{fontSize:"0.8rem",height:28}})]})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üë® Rapport : Personnels Masculins Sans Formation"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",E()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structures concern√©es :"})," ",v()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total personnels masculins :"})," ",h.length]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Nom & Pr√©nom"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Matricule"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Structure"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Fonction"})]})}),e.jsx("tbody",{children:h.map((i,c)=>e.jsxs("tr",{style:{backgroundColor:c%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:c+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:`${i.NOM} ${i.PRENOM}`.toUpperCase()}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.MATRICULE}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.StructureAbbreviation||i.Structure}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.FONCTION||"-"})]},c))})]})]}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Structure"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Contact"})]})}),e.jsx(Be,{children:h.length>0?h.map((i,c)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:c+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[i.NOM," ",i.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),i.MATRICULE,e.jsx(Y,{label:"Masculin",size:"small",color:"primary",variant:"filled",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:i.StructureAbbreviation||i.Structure}),i.StructureAbbreviation&&e.jsx(r,{variant:"caption",color:"text.secondary",children:i.Structure})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:i.FONCTION||"-"}),i.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",i.GRADE]})]})]})}),e.jsx(j,{children:i.TELEPHONE&&e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:i.TELEPHONE})]})})]},c)):e.jsx(te,{children:e.jsx(j,{colSpan:7,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ve,{sx:{fontSize:48,color:"success.main",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Excellent ! Tous les personnels masculins ont √©t√© form√©s"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Aucun personnel masculin sans formation trouv√© pour cette p√©riode."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:z,onClose:L,autoHideDuration:5e3,children:e.jsx(Cs,{onClose:L,severity:M,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(Me,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:M==="error"?"#d32f2f":"background.paper",color:M==="error"?"white":"inherit","& .MuiAlert-icon":{color:M==="error"?"white":"inherit"},"& .MuiAlert-message":{color:M==="error"?"white":"inherit"},"& .MuiAlert-action .MuiIconButton-root":{color:M==="error"?"white":"inherit"}},children:e.jsx(r,{fontWeight:500,children:W})})})]})})},zs=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),ks=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Ps=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(null),[p,P]=o.useState(""),[u,h]=o.useState(new Date),[m,y]=o.useState(new Date),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState([]),[$,_]=o.useState(!1),[Q,V]=o.useState(!1),[q,H]=o.useState(""),[O,L]=o.useState("success"),T="";o.useEffect(()=>{E()},[]),o.useEffect(()=>{p.length>=2?E(p):p.length===0&&E()},[p]);const E=async(I="")=>{W(!0);const N=localStorage.getItem("token");try{const f=await ae.get(`${T}/listestructures`,{headers:{Authorization:`Bearer ${N}`},params:I?{search:I}:{}});f.data&&n(f.data)}catch{S("Erreur lors du chargement des structures","error")}finally{W(!1)}},v=I=>I?I.toISOString().split("T")[0]:null,i=()=>{if(!l||!u||!m)return null;const I=v(u),N=v(m);return`
      WITH RECURSIVE StructuresDescendantes AS (
          SELECT IDSTRUCTURE
          FROM structure
          WHERE IDSTRUCTURE = ${l.IDSTRUCTURE}
          
          UNION ALL
          
          SELECT s.IDSTRUCTURE
          FROM structure s
          INNER JOIN StructuresDescendantes sd ON s.IDPARENT = sd.IDSTRUCTURE
      )

      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          COALESCE(formations_periode.NombreFormations, 0) as FormationsPeriode,
          COALESCE(formations_total.TotalFormations, 0) as TotalFormations
      FROM 
          personel p
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(DISTINCT sf.IDFORMATION) as NombreFormations
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE 
              sf.DATE >= '${I}' 
              AND sf.DATE <= '${N}'
              AND sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) formations_periode ON p.IDPERSONNEL = formations_periode.IDPERSONNEL
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(DISTINCT sf.IDFORMATION) as TotalFormations
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE
              sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) formations_total ON p.IDPERSONNEL = formations_total.IDPERSONNEL
      WHERE 
          p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
          AND (formations_periode.NombreFormations IS NULL OR formations_periode.NombreFormations = 0)
          AND s.NOMSTRUCTURE <> 'AUTRE'
      ORDER BY 
          p.NOM, p.PRENOM;
    `},c=async()=>{if(!l){S("Veuillez s√©lectionner une structure","error");return}if(!u||!m){S("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(u>m){S("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const I=i();z(!0);const N=localStorage.getItem("token");try{const f=await ae.post(`${T}/personnaliserrequette`,{query:I},{headers:{Authorization:`Bearer ${N}`}});if(f.data)M(f.data),_(!0),S(`${f.data.length} personnels trouv√©s sans formation sur la p√©riode`,"info");else throw new Error("Aucun r√©sultat trouv√©.")}catch(f){S(f.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{z(!1)}},a=()=>{const I=document.getElementById("printable-content"),N=document.body.innerHTML;document.body.innerHTML=I.innerHTML,window.print(),document.body.innerHTML=N,window.location.reload()},S=(I,N)=>{H(I),L(N),V(!0)},R=()=>{V(!1)},b=I=>I?new Date(I).toLocaleDateString("fr-FR"):"-",k=()=>u&&m?`du ${b(u)} au ${b(m)}`:"P√©riode non d√©finie",w=()=>l?l.ABBREVIATION||l.NOMSTRUCTURE:"";return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Je,{color:"warning",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels Sans Formation sur P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels d'une structure n'ayant pas b√©n√©fici√© d'une formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(Ge,{fullWidth:!0,value:l,onChange:(I,N)=>{x(N)},inputValue:p,onInputChange:(I,N)=>{P(N)},options:t,getOptionLabel:I=>I.ABBREVIATION||I.NOMSTRUCTURE,renderOption:(I,N)=>e.jsxs(s,{component:"li",...I,children:[e.jsx(jr,{children:e.jsx(ue,{fontSize:"small"})}),e.jsx(dr,{primary:N.ABBREVIATION||N.NOMSTRUCTURE,secondary:N.ABBREVIATION?N.NOMSTRUCTURE:null})]}),loading:F,loadingText:"Chargement des structures...",noOptionsText:p.length<2?"Tapez au moins 2 caract√®res":"Aucune structure trouv√©e",renderInput:I=>e.jsx(ee,{...I,label:"Structure",variant:"outlined",sx:{bgcolor:"#f9f9f9"},placeholder:"Commencez √† saisir le nom d'une structure...",InputProps:{...I.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(lr,{color:"action"})}),I.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[F?e.jsx(xe,{color:"inherit",size:20}):null,I.InputProps.endAdornment]})}}),isOptionEqualToValue:(I,N)=>I.IDSTRUCTURE===N?.IDSTRUCTURE})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:u,onChange:I=>h(I),renderInput:I=>e.jsx(ee,{...I,fullWidth:!0,InputProps:{...I.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:m,onChange:I=>y(I),minDate:u,renderInput:I=>e.jsx(ee,{...I,fullWidth:!0,InputProps:{...I.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(l||u||m)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fff3e0",borderRadius:2,border:"1px solid #ffcc80"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"warning.main"}}),"Crit√®res de recherche:"]}),l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16}}),"Structure: ",w()]}),(u||m)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode d'absence de formation: ",k()]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(ks,{onClick:c,startIcon:C?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:C||!l||!u||!m,children:C?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:$,onClose:()=>_(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Je,{sx:{mr:1.5,fontSize:30,color:"warning.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"Personnels Sans Formation sur P√©riode"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:a,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>_(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[D.length," personnel",D.length>1?"s":""," sans formation sur la p√©riode"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Structure: ",e.jsx("strong",{children:w()})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),"P√©riode: ",k()]})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:[e.jsx(Y,{icon:e.jsx(ue,{fontSize:"small"}),label:w(),color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}}),e.jsx(Y,{icon:e.jsx(Je,{fontSize:"small"}),label:`${D.length} sans formation`,color:"warning",variant:"outlined",sx:{fontWeight:500,fontSize:"0.75rem",height:28}})]})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Personnels Sans Formation"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structure :"})," ",w()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",k()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total :"})," ",D.length," personnel",D.length>1?"s":""," sans formation"]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Personnel"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Matricule"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Fonction"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Contact"})]})}),e.jsx("tbody",{children:D.map((I,N)=>e.jsxs("tr",{style:{backgroundColor:N%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:N+1}),e.jsxs("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:[I.NOM," ",I.PRENOM]}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:I.MATRICULE}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:I.FONCTION||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:I.TELEPHONE||"-"})]},N))})]})]}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Contact"})]})}),e.jsx(Be,{children:D.length>0?D.map((I,N)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:N+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[I.NOM," ",I.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),I.MATRICULE,I.SEXE&&e.jsx(Y,{label:I.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:I.FONCTION||"-"}),I.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",I.GRADE," ",e.jsx("br",{}),"Structure: ",I.StructureAbbreviation]})]})]})}),e.jsx(j,{children:I.TELEPHONE&&e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:I.TELEPHONE})]})})]},N)):e.jsx(te,{children:e.jsx(j,{colSpan:5,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ve,{sx:{fontSize:48,color:"success.main",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Excellent !"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Tous les personnels de cette structure ont b√©n√©fici√© d'au moins une formation sur la p√©riode"})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:Q,onClose:R,autoHideDuration:5e3,children:e.jsx(zs,{onClose:R,severity:O,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:O==="error"?"#ff0000":"background.paper",color:O==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:q})})})]})})},Ls=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Ms=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Ws=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(null),[p,P]=o.useState(""),[u,h]=o.useState(new Date),[m,y]=o.useState(new Date),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState([]),[$,_]=o.useState(!1),[Q,V]=o.useState(!1),[q,H]=o.useState(""),[O,L]=o.useState("success"),T="";o.useEffect(()=>{E()},[]),o.useEffect(()=>{p.length>=2?E(p):p.length===0&&E()},[p]);const E=async(I="")=>{W(!0);const N=localStorage.getItem("token");try{const f=await ae.get(`${T}/listestructures`,{headers:{Authorization:`Bearer ${N}`},params:I?{search:I}:{}});f.data&&n(f.data)}catch{S("Erreur lors du chargement des structures","error")}finally{W(!1)}},v=I=>I?I.toISOString().split("T")[0]:null,i=()=>{if(!l||!u||!m)return null;const I=v(u),N=v(m);return`
      WITH RECURSIVE StructuresDescendantes AS (
    SELECT IDSTRUCTURE
    FROM structure
    WHERE IDSTRUCTURE = ${l.IDSTRUCTURE}
    
    UNION ALL
    
    SELECT s.IDSTRUCTURE
    FROM structure s
    INNER JOIN StructuresDescendantes sd ON s.IDPARENT = sd.IDSTRUCTURE
)

SELECT 
    p.MATRICULE,
    p.NOM,
    p.PRENOM,
    p.FONCTION,
    p.TELEPHONE,
    p.GRADE,
    p.SEXE,
    s.NOMSTRUCTURE as Structure,
    s.ABBREVIATION as StructureAbbreviation,
    COALESCE(formations_periode.NombreFormations, 0) as FormationsPeriode,
    COALESCE(formations_total.TotalFormations, 0) as TotalFormations
FROM 
    personel p
JOIN 
    structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
LEFT JOIN (
    SELECT 
        ps.IDPERSONNEL,
        COUNT(DISTINCT sf.IDFORMATION) as NombreFormations
    FROM 
        participer_session ps
    JOIN 
        sessionformation sf ON ps.IDSESSION = sf.IDSESSION
    WHERE 
        sf.DATE >= '${I}' 
        AND sf.DATE <= '${N}'
        AND sf.CONFIRME<>1
    GROUP BY 
        ps.IDPERSONNEL
) formations_periode ON p.IDPERSONNEL = formations_periode.IDPERSONNEL
LEFT JOIN (
    SELECT 
        ps.IDPERSONNEL,
        COUNT(DISTINCT sf.IDFORMATION) as TotalFormations
    FROM 
        participer_session ps
    JOIN 
        sessionformation sf ON ps.IDSESSION = sf.IDSESSION
    WHERE
        sf.CONFIRME<>1
    GROUP BY 
        ps.IDPERSONNEL
) formations_total ON p.IDPERSONNEL = formations_total.IDPERSONNEL
WHERE 
    p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
    AND (formations_periode.NombreFormations IS NULL OR formations_periode.NombreFormations = 0)
    AND p.SEXE = 'F√©minin'
    AND s.NOMSTRUCTURE <> 'AUTRE'
ORDER BY 
    p.NOM, p.PRENOM;
    `},c=async()=>{if(!l){S("Veuillez s√©lectionner une structure","error");return}if(!u||!m){S("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(u>m){S("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const I=i();z(!0);const N=localStorage.getItem("token");try{const f=await ae.post(`${T}/personnaliserrequette`,{query:I},{headers:{Authorization:`Bearer ${N}`}});if(f.data)M(f.data),_(!0),S(`${f.data.length} personnels f√©minins trouv√©s sans formation sur la p√©riode`,"info");else throw new Error("Aucun r√©sultat trouv√©.")}catch(f){S(f.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{z(!1)}},a=()=>{const I=document.getElementById("printable-content"),N=document.body.innerHTML;document.body.innerHTML=I.innerHTML,window.print(),document.body.innerHTML=N,window.location.reload()},S=(I,N)=>{H(I),L(N),V(!0)},R=()=>{V(!1)},b=I=>I?new Date(I).toLocaleDateString("fr-FR"):"-",k=()=>u&&m?`du ${b(u)} au ${b(m)}`:"P√©riode non d√©finie",w=()=>l?l.ABBREVIATION||l.NOMSTRUCTURE:"";return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(We,{color:"secondary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels F√©minins Sans Formation sur P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels f√©minins d'une structure n'ayant pas b√©n√©fici√© d'une formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(Ge,{fullWidth:!0,value:l,onChange:(I,N)=>{x(N)},inputValue:p,onInputChange:(I,N)=>{P(N)},options:t,getOptionLabel:I=>I.ABBREVIATION||I.NOMSTRUCTURE,renderOption:(I,N)=>e.jsxs(s,{component:"li",...I,children:[e.jsx(jr,{children:e.jsx(ue,{fontSize:"small"})}),e.jsx(dr,{primary:N.ABBREVIATION||N.NOMSTRUCTURE,secondary:N.ABBREVIATION?N.NOMSTRUCTURE:null})]}),loading:F,loadingText:"Chargement des structures...",noOptionsText:p.length<2?"Tapez au moins 2 caract√®res":"Aucune structure trouv√©e",renderInput:I=>e.jsx(ee,{...I,label:"Structure",variant:"outlined",sx:{bgcolor:"#f9f9f9"},placeholder:"Commencez √† saisir le nom d'une structure...",InputProps:{...I.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(lr,{color:"action"})}),I.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[F?e.jsx(xe,{color:"inherit",size:20}):null,I.InputProps.endAdornment]})}}),isOptionEqualToValue:(I,N)=>I.IDSTRUCTURE===N?.IDSTRUCTURE})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:u,onChange:I=>h(I),renderInput:I=>e.jsx(ee,{...I,fullWidth:!0,InputProps:{...I.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:m,onChange:I=>y(I),minDate:u,renderInput:I=>e.jsx(ee,{...I,fullWidth:!0,InputProps:{...I.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(l||u||m)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fce4ec",borderRadius:2,border:"1px solid #f8bbd9"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"secondary.main"}}),"Crit√®res de recherche:"]}),l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16}}),"Structure: ",w()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(We,{sx:{mr:1,fontSize:16,color:"secondary.main"}}),"Personnels f√©minins uniquement"]}),(u||m)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode d'absence de formation: ",k()]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Ms,{onClick:c,startIcon:C?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:C||!l||!u||!m,sx:{background:"linear-gradient(to top, rgba(236, 64, 122, 0.47), rgba(236, 64, 122, 0))",color:"#c2185b",border:"2px solid #c2185b","&:hover":{background:"linear-gradient(to top, rgba(236, 64, 122, 0.7), rgba(236, 64, 122, 0))"}},children:C?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:$,onClose:()=>_(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#fce4ec",color:"secondary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #f8bbd9"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(We,{sx:{mr:1.5,fontSize:30,color:"secondary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"secondary.main",children:"Personnels F√©minins Sans Formation sur P√©riode"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:a,size:"small",sx:{bgcolor:"white",color:"secondary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#fce4ec",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>_(!1),size:"small",sx:{bgcolor:"white",color:"secondary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[D.length," personnel",D.length>1?"s":""," f√©minin",D.length>1?"s":""," sans formation sur la p√©riode"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Structure: ",e.jsx("strong",{children:w()})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),"P√©riode: ",k()]})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:[e.jsx(Y,{icon:e.jsx(ue,{fontSize:"small"}),label:w(),color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}}),e.jsx(Y,{icon:e.jsx(We,{fontSize:"small"}),label:`${D.length} f√©minin${D.length>1?"s":""} sans formation`,color:"secondary",variant:"outlined",sx:{fontWeight:500,fontSize:"0.75rem",height:28}})]})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#c2185b"},children:"üë© Rapport : Personnels F√©minins Sans Formation"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structure :"})," ",w()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",k()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total :"})," ",D.length," personnel",D.length>1?"s":""," f√©minin",D.length>1?"s":""," sans formation"]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#fce4ec",color:"#c2185b"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #f8bbd9"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #f8bbd9"},children:"Personnel"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #f8bbd9"},children:"Matricule"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #f8bbd9"},children:"Fonction"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #f8bbd9"},children:"Contact"})]})}),e.jsx("tbody",{children:D.map((I,N)=>e.jsxs("tr",{style:{backgroundColor:N%2===0?"#fef5f9":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #f8bbd9"},children:N+1}),e.jsxs("td",{style:{padding:"10px",borderBottom:"1px solid #f8bbd9",fontWeight:"bold"},children:[I.NOM," ",I.PRENOM]}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #f8bbd9"},children:I.MATRICULE}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #f8bbd9"},children:I.FONCTION||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #f8bbd9"},children:I.TELEPHONE||"-"})]},N))})]})]}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid #f8bbd9",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(194, 24, 91, 0.1)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#f48fb1",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#fce4ec",color:"#060606ff",borderBottom:"2px solid #f8bbd9"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#fce4ec",color:"secondary.main",borderBottom:"2px solid #f8bbd9"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#fce4ec",color:"secondary.main",borderBottom:"2px solid #f8bbd9"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#fce4ec",color:"secondary.main",borderBottom:"2px solid #f8bbd9"},children:"Contact"})]})}),e.jsx(Be,{children:D.length>0?D.map((I,N)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#fef5f9"},"&:hover":{bgcolor:"#fce4ec !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"secondary.main"},children:N+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[I.NOM," ",I.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),I.MATRICULE,e.jsx(Y,{label:"F√©minin",size:"small",color:"secondary",variant:"filled",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:I.FONCTION||"-"}),I.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",I.GRADE," ",e.jsx("br",{}),"Structure: ",I.StructureAbbreviation]})]})]})}),e.jsx(j,{children:I.TELEPHONE&&e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:I.TELEPHONE})]})})]},N)):e.jsx(te,{children:e.jsx(j,{colSpan:5,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ve,{sx:{fontSize:48,color:"success.main",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Excellent !"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Toutes les personnels f√©minins de cette structure ont b√©n√©fici√© d'au moins une formation sur la p√©riode"})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:Q,onClose:R,autoHideDuration:5e3,children:e.jsx(Ls,{onClose:R,severity:O,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(We,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:O==="error"?"#ff0000":"background.paper",color:O==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:q})})})]})})},ws=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Us=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Bs=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(null),[p,P]=o.useState(""),[u,h]=o.useState(new Date),[m,y]=o.useState(new Date),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState([]),[$,_]=o.useState(!1),[Q,V]=o.useState(!1),[q,H]=o.useState(""),[O,L]=o.useState("success"),T="";o.useEffect(()=>{E()},[]),o.useEffect(()=>{p.length>=2?E(p):p.length===0&&E()},[p]);const E=async(I="")=>{W(!0);const N=localStorage.getItem("token");try{const f=await ae.get(`${T}/listestructures`,{headers:{Authorization:`Bearer ${N}`},params:I?{search:I}:{}});f.data&&n(f.data)}catch{S("Erreur lors du chargement des structures","error")}finally{W(!1)}},v=I=>I?I.toISOString().split("T")[0]:null,i=()=>{if(!l||!u||!m)return null;const I=v(u),N=v(m);return`
            WITH RECURSIVE StructuresDescendantes AS (
          SELECT IDSTRUCTURE
          FROM structure
          WHERE IDSTRUCTURE = ${l.IDSTRUCTURE}
          
          UNION ALL
          
          SELECT s.IDSTRUCTURE
          FROM structure s
          INNER JOIN StructuresDescendantes sd ON s.IDPARENT = sd.IDSTRUCTURE
      )

      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          COALESCE(formations_periode.NombreFormations, 0) as FormationsPeriode,
          COALESCE(formations_total.TotalFormations, 0) as TotalFormations
      FROM 
          personel p
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(DISTINCT sf.IDFORMATION) as NombreFormations
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE 
              sf.DATE >= '${I}' 
              AND sf.DATE <= '${N}'
              AND sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) formations_periode ON p.IDPERSONNEL = formations_periode.IDPERSONNEL
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(DISTINCT sf.IDFORMATION) as TotalFormations
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE
              sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) formations_total ON p.IDPERSONNEL = formations_total.IDPERSONNEL
      WHERE 
          p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
          AND (formations_periode.NombreFormations IS NULL OR formations_periode.NombreFormations = 0)
          AND p.SEXE = 'Masculin'
          AND s.NOMSTRUCTURE <> 'AUTRE'
      ORDER BY 
          p.NOM, p.PRENOM;
    `},c=async()=>{if(!l){S("Veuillez s√©lectionner une structure","error");return}if(!u||!m){S("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(u>m){S("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const I=i();z(!0);const N=localStorage.getItem("token");try{const f=await ae.post(`${T}/personnaliserrequette`,{query:I},{headers:{Authorization:`Bearer ${N}`}});if(f.data)M(f.data),_(!0),S(`${f.data.length} personnels masculins trouv√©s sans formation sur la p√©riode`,"info");else throw new Error("Aucun r√©sultat trouv√©.")}catch(f){S(f.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{z(!1)}},a=()=>{const I=document.getElementById("printable-content"),N=document.body.innerHTML;document.body.innerHTML=I.innerHTML,window.print(),document.body.innerHTML=N,window.location.reload()},S=(I,N)=>{H(I),L(N),V(!0)},R=()=>{V(!1)},b=I=>I?new Date(I).toLocaleDateString("fr-FR"):"-",k=()=>u&&m?`du ${b(u)} au ${b(m)}`:"P√©riode non d√©finie",w=()=>l?l.ABBREVIATION||l.NOMSTRUCTURE:"";return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(or,{color:"primary",sx:{fontSize:36,mr:2}})," ",e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnel Masculin Sans Formation sur P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels masculins d'une structure n'ayant pas b√©n√©fici√© d'une formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(Ge,{fullWidth:!0,value:l,onChange:(I,N)=>{x(N)},inputValue:p,onInputChange:(I,N)=>{P(N)},options:t,getOptionLabel:I=>I.ABBREVIATION||I.NOMSTRUCTURE,renderOption:(I,N)=>e.jsxs(s,{component:"li",...I,children:[e.jsx(jr,{children:e.jsx(ue,{fontSize:"small"})}),e.jsx(dr,{primary:N.ABBREVIATION||N.NOMSTRUCTURE,secondary:N.ABBREVIATION?N.NOMSTRUCTURE:null})]}),loading:F,loadingText:"Chargement des structures...",noOptionsText:p.length<2?"Tapez au moins 2 caract√®res":"Aucune structure trouv√©e",renderInput:I=>e.jsx(ee,{...I,label:"Structure",variant:"outlined",sx:{bgcolor:"#f9f9f9"},placeholder:"Commencez √† saisir le nom d'une structure...",InputProps:{...I.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(lr,{color:"action"})}),I.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[F?e.jsx(xe,{color:"inherit",size:20}):null,I.InputProps.endAdornment]})}}),isOptionEqualToValue:(I,N)=>I.IDSTRUCTURE===N?.IDSTRUCTURE})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:u,onChange:I=>h(I),renderInput:I=>e.jsx(ee,{...I,fullWidth:!0,InputProps:{...I.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:m,onChange:I=>y(I),minDate:u,renderInput:I=>e.jsx(ee,{...I,fullWidth:!0,InputProps:{...I.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(l||u||m)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#e3f2fd",borderRadius:2,border:"1px solid #bbdefb"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16}}),"Structure: ",w()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(or,{sx:{mr:1,fontSize:16}}),"Personnel: ",e.jsx("strong",{children:"Masculin uniquement"})]}),(u||m)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode d'absence de formation: ",k()]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Us,{onClick:c,startIcon:C?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:C||!l||!u||!m,children:C?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:$,onClose:()=>_(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(or,{sx:{mr:1.5,fontSize:30,color:"primary.main"}})," ",e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"Personnel Masculin Sans Formation sur P√©riode"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:a,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>_(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[D.length," personnel",D.length>1?"s":""," masculin",D.length>1?"s":""," sans formation"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Structure: ",e.jsx("strong",{children:w()})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),"P√©riode: ",k()]})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:[e.jsx(Y,{icon:e.jsx(ue,{fontSize:"small"}),label:w(),color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}}),e.jsx(Y,{icon:e.jsx(or,{fontSize:"small"}),label:`${D.length} sans formation`,color:"primary",variant:"outlined",sx:{fontWeight:500,fontSize:"0.75rem",height:28}})]})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Personnel Masculin Sans Formation"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structure :"})," ",w()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",k()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total :"})," ",D.length," personnel",D.length>1?"s":""," masculin",D.length>1?"s":""," sans formation"]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Personnel"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Matricule"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Fonction"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Contact"})]})}),e.jsx("tbody",{children:D.map((I,N)=>e.jsxs("tr",{style:{backgroundColor:N%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:N+1}),e.jsxs("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:[I.NOM," ",I.PRENOM]}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:I.MATRICULE}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:I.FONCTION||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:I.TELEPHONE||"-"})]},N))})]})]}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Contact"})]})}),e.jsx(Be,{children:D.length>0?D.map((I,N)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important"}},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:N+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[I.NOM," ",I.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),I.MATRICULE,e.jsx(Y,{label:"Masculin",size:"small",color:"primary",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(s,{children:e.jsx(r,{variant:"body2",fontWeight:"500",children:I.FONCTION||"-"})})]})}),e.jsx(j,{children:I.TELEPHONE&&e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:I.TELEPHONE})]})})]},N)):e.jsx(te,{children:e.jsx(j,{colSpan:4,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ve,{sx:{fontSize:48,color:"success.main",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Excellent !"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Tous les personnels masculins de cette structure ont √©t√© form√©s sur la p√©riode"})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:Q,onClose:R,autoHideDuration:5e3,children:e.jsx(ws,{onClose:R,severity:O,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(or,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:q})})})]})})},$s=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Hs=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const Ys=()=>{const t=new Date,[n,l]=o.useState(t),[x,p]=o.useState(t),[P,u]=o.useState(!1),[h,m]=o.useState([]),[y,C]=o.useState(!1),[z,F]=o.useState(!1),[W,D]=o.useState(""),[M,$]=o.useState("success"),_="",Q=i=>i?i.toISOString().split("T")[0]:null,V=()=>{if(!n||!x)return null;const i=Q(n),c=Q(x);return`
      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          COALESCE(sessions_periode.NombreSessions, 0) as SessionsPeriode,
          COALESCE(sessions_total.TotalSessions, 0) as TotalSessions
      FROM 
          personel p
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(ps.IDSESSION) as NombreSessions
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE 
              sf.DATE >= '${i}' 
              AND sf.DATE <= '${c}'
              AND sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) sessions_periode ON p.IDPERSONNEL = sessions_periode.IDPERSONNEL
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(ps.IDSESSION) as TotalSessions
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
           WHERE 
              sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) sessions_total ON p.IDPERSONNEL = sessions_total.IDPERSONNEL
      WHERE 
          p.SERVICECENTRAL = 'Service Central'  -- ‚úÖ Filtre conserv√© ici
          AND (sessions_periode.NombreSessions IS NULL OR sessions_periode.NombreSessions = 0)
          AND s.NOMSTRUCTURE <> 'AUTRE'
      ORDER BY 
          s.NOMSTRUCTURE, p.NOM, p.PRENOM;
    `},q=async()=>{if(!n||!x){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const i=V();u(!0);const c=localStorage.getItem("token");try{const a=await ae.post(`${_}/personnaliserrequette`,{query:i},{headers:{Authorization:`Bearer ${c}`}});if(a.data)m(a.data),C(!0),O(`${a.data.length} personnels des services centraux trouv√©s sans formation sur la p√©riode`,"info");else throw new Error("Aucun r√©sultat trouv√©.")}catch(a){O(a.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},H=()=>{const i=document.getElementById("printable-content"),c=document.body.innerHTML;document.body.innerHTML=i.innerHTML,window.print(),document.body.innerHTML=c,window.location.reload()},O=(i,c)=>{D(i),$(c),F(!0)},L=()=>{F(!1)},T=i=>i?new Date(i).toLocaleDateString("fr-FR"):"-",E=()=>n&&x?`du ${T(n)} au ${T(x)}`:"P√©riode non d√©finie",v=()=>[...new Set(h.map(c=>c.StructureAbbreviation||c.Structure))].length;return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(cr,{color:"primary",sx:{fontSize:36,mr:2}})," ",e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels des Services Centraux Sans Formation"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels des services centraux n'ayant pas b√©n√©fici√© d'une formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:i=>l(i),format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",InputProps:{...i.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:i=>p(i),minDate:n,format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",InputProps:{...i.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#e3f2fd",borderRadius:2,border:"1px solid #bbdefb"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(cr,{sx:{mr:1,fontSize:16}}),"Services centraux uniquement"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode d'absence de formation: ",E()]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Hs,{onClick:q,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:y,onClose:()=>C(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(cr,{sx:{mr:1.5,fontSize:30,color:"primary.main"}})," ",e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"Personnels des Services Centraux Sans Formation"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:H,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>C(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(cr,{sx:{mr:1,color:"primary.main"}}),h.length," personnel",h.length>1?"s":""," des services centraux sans formation"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode: ",e.jsx("strong",{children:E()})]})]}),e.jsx(Y,{icon:e.jsx(pe,{fontSize:"small"}),label:E(),color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Personnels des Services Centraux Sans Formation"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",E()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structures concern√©es :"})," ",v()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total personnels :"})," ",h.length]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Nom & Pr√©nom"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Matricule"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Structure"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Fonction"})]})}),e.jsx("tbody",{children:h.map((i,c)=>e.jsxs("tr",{style:{backgroundColor:c%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:c+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:`${i.NOM} ${i.PRENOM}`.toUpperCase()}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.MATRICULE}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.StructureAbbreviation||i.Structure}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:i.FONCTION||"-"})]},c))})]})]}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Structure"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Contact"})]})}),e.jsx(Be,{children:h.length>0?h.map((i,c)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important"}},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:c+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[i.NOM," ",i.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),i.MATRICULE,i.SEXE&&e.jsx(Y,{label:i.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(s,{children:e.jsx(r,{variant:"body2",fontWeight:"500",children:i.StructureAbbreviation||i.Structure})})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(s,{children:e.jsx(r,{variant:"body2",fontWeight:"500",children:i.FONCTION||"-"})})]})}),e.jsx(j,{children:i.TELEPHONE&&e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:i.TELEPHONE})]})})]},c)):e.jsx(te,{children:e.jsx(j,{colSpan:5,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ve,{sx:{fontSize:48,color:"success.main",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Excellent ! Tous les personnels des services centraux ont √©t√© form√©s"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Aucun personnel des services centraux sans formation trouv√© pour cette p√©riode."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:z,onClose:L,autoHideDuration:5e3,children:e.jsx($s,{onClose:L,severity:M,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(cr,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:W})})})]})})},qs=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Vs=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const Qs=()=>{const t=new Date,[n,l]=o.useState(t),[x,p]=o.useState(t),[P,u]=o.useState(!1),[h,m]=o.useState([]),[y,C]=o.useState(!1),[z,F]=o.useState(!1),[W,D]=o.useState(""),[M,$]=o.useState("success"),_="",Q=i=>i?i.toISOString().split("T")[0]:null,V=()=>{if(!n||!x)return null;const i=Q(n),c=Q(x);return`
      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          COALESCE(sessions_periode.NombreSessions, 0) as SessionsPeriode,
          COALESCE(sessions_total.TotalSessions, 0) as TotalSessions
      FROM 
          personel p
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(ps.IDSESSION) as NombreSessions
          FROM 
              participer_session ps
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE 
              sf.DATE >= '${i}' 
              AND sf.DATE <= '${c}'
              AND sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) sessions_periode ON p.IDPERSONNEL = sessions_periode.IDPERSONNEL
      LEFT JOIN (
          SELECT 
              ps.IDPERSONNEL,
              COUNT(ps.IDSESSION) as TotalSessions
          FROM 
              participer_session ps
          JOIN
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          WHERE 
              sf.CONFIRME<>1
          GROUP BY 
              ps.IDPERSONNEL
      ) sessions_total ON p.IDPERSONNEL = sessions_total.IDPERSONNEL
      WHERE 
          p.SERVICECENTRAL = 'Service Deconcentr√©'  -- ‚úÖ Filtre conserv√© ici
          AND (sessions_periode.NombreSessions IS NULL OR sessions_periode.NombreSessions = 0)
          AND s.NOMSTRUCTURE <> 'AUTRE'
      ORDER BY 
          s.NOMSTRUCTURE, p.NOM, p.PRENOM;
    `},q=async()=>{if(!n||!x){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const i=V();u(!0);const c=localStorage.getItem("token");try{const a=await ae.post(`${_}/personnaliserrequette`,{query:i},{headers:{Authorization:`Bearer ${c}`}});if(a.data)m(a.data),C(!0),O(`${a.data.length} personnels des services d√©concentr√©s trouv√©s sans formation sur la p√©riode`,"info");else throw new Error("Aucun r√©sultat trouv√©.")}catch(a){O(a.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},H=()=>{const i=document.getElementById("printable-content"),c=document.body.innerHTML;document.body.innerHTML=i.innerHTML,window.print(),document.body.innerHTML=c,window.location.reload()},O=(i,c)=>{D(i),$(c),F(!0)},L=()=>{F(!1)},T=i=>i?new Date(i).toLocaleDateString("fr-FR"):"-",E=()=>n&&x?`du ${T(n)} au ${T(x)}`:"P√©riode non d√©finie",v=()=>[...new Set(h.map(c=>c.StructureAbbreviation||c.Structure))].length;return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Ye,{color:"info",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels des Services D√©concentr√©s Sans Formation"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels des services d√©concentr√©s n'ayant pas b√©n√©fici√© d'une formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:i=>l(i),format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",InputProps:{...i.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:i=>p(i),minDate:n,format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:i=>e.jsx(ee,{...i,fullWidth:!0,variant:"outlined",InputProps:{...i.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#e1f5fe",borderRadius:2,border:"1px solid #81d4fa"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"info.main"}}),"Crit√®res de recherche:"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(Ye,{sx:{mr:1,fontSize:16,color:"info.main"}}),"Services d√©concentr√©s uniquement"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode d'absence de formation: ",E()]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mt:.5},children:"‚Ä¢ Recherche dans toutes les structures d√©concentr√©es"})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Vs,{onClick:q,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,sx:{background:"linear-gradient(to top, rgba(3, 169, 244, 0.47), rgba(3, 169, 244, 0))",color:"#0288d1",border:"2px solid #0288d1","&:hover":{background:"linear-gradient(to top, rgba(3, 169, 244, 0.7), rgba(3, 169, 244, 0))"}},children:P?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:y,onClose:()=>C(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e1f5fe",color:"info.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #81d4fa"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Ye,{sx:{mr:1.5,fontSize:30,color:"info.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"info.main",children:"Personnels des Services D√©concentr√©s Sans Formation"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:H,size:"small",sx:{bgcolor:"white",color:"info.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>C(!1),size:"small",sx:{bgcolor:"white",color:"info.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ke,{sx:{mr:1,color:"info.main"}}),h.length," personnel",h.length>1?"s":""," des services d√©concentr√©s sans formation"]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des services d√©concentr√©s uniquement"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode: ",e.jsx("strong",{children:E()})]})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:[e.jsx(Y,{icon:e.jsx(Ye,{fontSize:"small"}),label:"Services D√©concentr√©s",color:"info",variant:"outlined",sx:{borderColor:"info.light",color:"info.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}}),e.jsx(Y,{icon:e.jsx(pe,{fontSize:"small"}),label:E(),color:"primary",variant:"outlined",sx:{fontSize:"0.8rem",height:28}})]})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#0288d1"},children:"üè¢ Rapport : Personnels des Services D√©concentr√©s Sans Formation"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",E()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Structures concern√©es :"})," ",v()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total personnels :"})," ",h.length]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e1f5fe",color:"#0288d1"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #81d4fa"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #81d4fa"},children:"Nom & Pr√©nom"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #81d4fa"},children:"Matricule"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #81d4fa"},children:"Structure"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #81d4fa"},children:"Fonction"})]})}),e.jsx("tbody",{children:h.map((i,c)=>e.jsxs("tr",{style:{backgroundColor:c%2===0?"#f4fafe":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e1f5fe"},children:c+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e1f5fe",fontWeight:"bold"},children:`${i.NOM} ${i.PRENOM}`.toUpperCase()}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e1f5fe"},children:i.MATRICULE}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e1f5fe"},children:i.StructureAbbreviation||i.Structure}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e1f5fe"},children:i.FONCTION||"-"})]},c))})]})]}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid #81d4fa",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(2, 136, 209, 0.1)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#4fc3f7",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e1f5fe",color:"#060606ff",borderBottom:"2px solid #81d4fa"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e1f5fe",color:"info.main",borderBottom:"2px solid #81d4fa"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e1f5fe",color:"info.main",borderBottom:"2px solid #81d4fa"},children:"Structure"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e1f5fe",color:"info.main",borderBottom:"2px solid #81d4fa"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e1f5fe",color:"info.main",borderBottom:"2px solid #81d4fa"},children:"Contact"})]})}),e.jsx(Be,{children:h.length>0?h.map((i,c)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f4fafe"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"info.main"},children:c+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[i.NOM," ",i.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),i.MATRICULE,i.SEXE&&e.jsx(Y,{label:i.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:i.StructureAbbreviation||i.Structure}),i.StructureAbbreviation&&e.jsx(r,{variant:"caption",color:"text.secondary",children:i.Structure})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:i.FONCTION||"-"}),i.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",i.GRADE]})]})]})}),e.jsx(j,{children:i.TELEPHONE&&e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:i.TELEPHONE})]})})]},c)):e.jsx(te,{children:e.jsx(j,{colSpan:7,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ve,{sx:{fontSize:48,color:"success.main",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Excellent ! Tous les personnels des services d√©concentr√©s ont √©t√© form√©s"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Aucun personnel des services d√©concentr√©s sans formation trouv√© pour cette p√©riode."})]})})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:z,onClose:L,autoHideDuration:5e3,children:e.jsx(qs,{onClose:L,severity:M,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(Ye,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:M==="error"?"#ff0000":"background.paper",color:M==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:W})})})]})})},_s=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Js=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}}));J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const Gs=()=>{const[t,n]=o.useState(""),[l,x]=o.useState(new Date),[p,P]=o.useState(new Date),[u,h]=o.useState(!1),[m,y]=o.useState([]),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState(""),[$,_]=o.useState("success"),Q="",V=a=>a?a.toISOString().split("T")[0]:null,q=()=>{if(!t||!l||!p)return null;const a=V(l),S=V(p);return`
          SELECT 
            p.MATRICULE,
            p.NOM,
            p.PRENOM,
            p.FONCTION,
            p.TELEPHONE,
            p.GRADE,
            p.SEXE,
            s.NOMSTRUCTURE as Structure,
            s.ABBREVIATION as StructureAbbreviation,
            COUNT(DISTINCT sf.IDFORMATION) as NombreFormations,
            GROUP_CONCAT(DISTINCT fm.INTITULE ORDER BY fm.INTITULE SEPARATOR ' | ') as ListeFormations
        FROM 
            personel p
        JOIN 
            participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
        JOIN 
            sessionformation sf ON ps.IDSESSION = sf.IDSESSION
        JOIN 
            formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
        JOIN 
            structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
        WHERE 
            sf.DATE >= '${a}'
            AND sf.DATE <= '${S}'
            AND sf.CONFIRME = 1
        GROUP BY 
            p.IDPERSONNEL, p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION, 
            p.TELEPHONE, p.GRADE, p.SEXE, s.NOMSTRUCTURE, s.ABBREVIATION
        HAVING 
            COUNT(DISTINCT sf.IDFORMATION) >= ${t}
        ORDER BY 
            NombreFormations DESC, p.NOM, p.PRENOM;

`},H=async()=>{if(!t||t<1){L("Veuillez saisir un nombre de formations valide (minimum 1)","error");return}if(!l||!p){L("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(l>p){L("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();h(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${Q}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data)y(R.data),z(!0),L(`${R.data.length} personnels trouv√©s`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(R){L(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{h(!1)}},O=()=>{const a=document.getElementById("printable-content"),S=document.body.innerHTML;document.body.innerHTML=a.innerHTML,window.print(),document.body.innerHTML=S,window.location.reload()},L=(a,S)=>{M(a),_(S),W(!0)},T=()=>{W(!1)},E=a=>a?new Date(a).toLocaleDateString("fr-FR"):"-",v=()=>l&&p?`du ${E(l)} au ${E(p)}`:"P√©riode non d√©finie",i=()=>m.reduce((a,S)=>a+(S.NombreFormations||0),0),c=a=>{const S=a.target.value;(S===""||Number(S)>=1&&Number.isInteger(Number(S)))&&n(S)};return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:900,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Nr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels par Nombre de Formations"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels ayant b√©n√©fici√© d'au moins X formations sur une p√©riode"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(ee,{fullWidth:!0,label:"Nombre minimum de formations",type:"number",value:t,onChange:c,variant:"outlined",inputProps:{min:0,step:1},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(ar,{color:"action"})})},sx:{bgcolor:"#f9f9f9"},placeholder:"Ex: 3"})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(ne,{label:"Date de d√©but",value:l,onChange:a=>x(a),format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:a=>e.jsx(ee,{...a,fullWidth:!0,variant:"outlined",InputProps:{...a.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(ne,{label:"Date de fin",value:p,onChange:a=>P(a),minDate:l,format:"dd/MM/yyyy",enableAccessibleFieldDOMStructure:!1,slots:{textField:a=>e.jsx(ee,{...a,fullWidth:!0,variant:"outlined",InputProps:{...a.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})}})})]}),(t||l||p)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),t&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5},children:["‚Ä¢ Minimum ",t," formation",t>1?"s":""]}),(l||p)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",v()]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Js,{onClick:H,startIcon:u?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:u||!t||!l||!p,children:u?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:C,onClose:()=>z(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Nr,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats des Personnels"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:O,size:"small",sx:{bgcolor:"white",color:"primary.main",mr:1,boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#e1f5fe",transform:"scale(1.05)"}},title:"Imprimer",children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(de,{onClick:()=>z(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:[m.length," personnel",m.length>1?"s":""," trouv√©",m.length>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Ayant b√©n√©fici√© d'au moins ",e.jsx("strong",{children:t})," formation",t>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode: ",e.jsx("strong",{children:v()})]})]}),e.jsx(Y,{icon:e.jsx(ar,{fontSize:"small"}),label:`‚â• ${t} formations`,color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,sx:{color:"#1976d2"},children:"üîπ Rapport : Personnels par Nombre de Formations"}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Nombre minimum :"})," ",t," formation",t>1?"s":""]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"P√©riode :"})," ",v()]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total personnels :"})," ",m.length]}),e.jsxs(r,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Total formations :"})," ",i()]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",fontFamily:"Arial, sans-serif",fontSize:"12pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",color:"#1976d2"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Nom & Pr√©nom"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Matricule"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Fonction"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Structure"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"2px solid #bbdefb"},children:"Nb Formations"})]})}),e.jsx("tbody",{children:m.map((a,S)=>e.jsxs("tr",{style:{backgroundColor:S%2===0?"#f8fdff":"#ffffff",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:S+1}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",fontWeight:"bold"},children:`${a.NOM} ${a.PRENOM}`.toUpperCase()}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:a.MATRICULE}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:a.FONCTION||"-"}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0"},children:a.StructureAbbreviation||a.Structure}),e.jsx("td",{style:{padding:"10px",borderBottom:"1px solid #e0e0e0",textAlign:"center",fontWeight:"bold",color:"#1976d2"},children:a.NombreFormations})]},S))})]})]}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid #e0e0e0",borderRadius:"12px",bgcolor:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.05)","&::-webkit-scrollbar":{height:6,width:6},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:3}},children:e.jsxs(Ue,{stickyHeader:!0,size:"medium",children:[e.jsx(De,{children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center",bgcolor:"#e3f2fd",color:"#060606ff",borderBottom:"2px solid #bbdefb"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Structure"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb",textAlign:"center"},children:"Nb Formations"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",bgcolor:"#e3f2fd",color:"primary.main",borderBottom:"2px solid #bbdefb"},children:"Contact"})]})}),e.jsx(Be,{children:m.length>0?m.map((a,S)=>e.jsxs(te,{hover:!0,sx:{"&:nth-of-type(odd)":{bgcolor:"#f8fdff"},"&:hover":{bgcolor:"#e1f5fe !important",color:"black",transform:"scale(1.005)",transition:"all 0.15s ease-in-out"},transition:"background-color 0.2s"},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"blue"},children:S+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[a.NOM," ",a.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),a.MATRICULE,a.SEXE&&e.jsx(Y,{label:a.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:a.FONCTION||"-"}),a.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",a.GRADE]})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:a.StructureAbbreviation||a.Structure}),a.StructureAbbreviation&&a.Structure!==a.StructureAbbreviation&&e.jsx(r,{variant:"caption",color:"text.secondary",children:a.Structure})]})]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsx(Y,{label:a.NombreFormations,color:"primary",variant:"filled",size:"small",sx:{fontWeight:"bold",minWidth:40}})}),e.jsx(j,{children:a.TELEPHONE&&e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:a.TELEPHONE})]})})]},S)):e.jsx(te,{children:e.jsx(j,{colSpan:6,align:"center",sx:{py:5},children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucun personnel trouv√©"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez avec d'autres crit√®res."})]})})})})]})}),m.length>0&&e.jsxs(s,{sx:{mt:3,p:2,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:18}}),"Statistiques"]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total personnels:"})," ",m.length]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total formations:"})," ",i()]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Moyenne par personnel:"})," ",(i()/m.length).toFixed(1)]})})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:F,onClose:T,autoHideDuration:5e3,children:e.jsx(_s,{onClose:T,severity:$,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:$==="error"?"#ff0000":"background.paper",color:$==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:D})})})]})})},Xs=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Zs=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Ks=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(null),[p,P]=o.useState(""),[u,h]=o.useState(""),[m,y]=o.useState(new Date),[C,z]=o.useState(new Date),[F,W]=o.useState(!1),[D,M]=o.useState(!1),[$,_]=o.useState([]),[Q,V]=o.useState(!1),[q,H]=o.useState(!1),[O,L]=o.useState(""),[T,E]=o.useState("success"),v="";o.useEffect(()=>{i()},[]),o.useEffect(()=>{p.length>=2?i(p):p.length===0&&i()},[p]);const i=async(g="")=>{M(!0);const B=localStorage.getItem("token");try{const he=await ae.get(`${v}/listestructures`,{headers:{Authorization:`Bearer ${B}`},params:g?{search:g}:{}});he.data&&n(he.data)}catch{R("Erreur lors du chargement des structures","error")}finally{M(!1)}},c=g=>g?g.toISOString().split("T")[0]:null,a=()=>{if(!l||!u||!m||!C)return null;const g=c(m),B=c(C);return`
WITH RECURSIVE StructuresDescendantes AS (
    SELECT IDSTRUCTURE
    FROM structure
    WHERE IDSTRUCTURE = ${l.IDSTRUCTURE}
    
    UNION ALL
    
    SELECT s.IDSTRUCTURE
    FROM structure s
    INNER JOIN StructuresDescendantes sd ON s.IDPARENT = sd.IDSTRUCTURE
)

SELECT 
    p.MATRICULE,
    p.NOM,
    p.PRENOM,
    p.FONCTION,
    p.TELEPHONE,
    p.GRADE,
    p.SEXE,
    s.NOMSTRUCTURE as Structure,
    s.ABBREVIATION as StructureAbbreviation,
    COUNT(DISTINCT sf.IDFORMATION) as NombreFormations,
    GROUP_CONCAT(
        DISTINCT CONCAT(fm.INTITULE, '|', max_dates.MAX_SESSION_DATE) 
        ORDER BY max_dates.MAX_SESSION_DATE DESC 
        SEPARATOR ' | '
    ) as ListeFormations
FROM 
    personel p
JOIN 
    participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
JOIN 
    sessionformation sf ON ps.IDSESSION = sf.IDSESSION
JOIN 
    formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
JOIN 
    structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
JOIN (
    SELECT 
        ps2.IDPERSONNEL,
        sf2.IDFORMATION,
        MAX(sf2.DATE) as MAX_SESSION_DATE
    FROM 
        participer_session ps2
    JOIN 
        sessionformation sf2 ON ps2.IDSESSION = sf2.IDSESSION
    GROUP BY 
        ps2.IDPERSONNEL, sf2.IDFORMATION
) max_dates ON p.IDPERSONNEL = max_dates.IDPERSONNEL AND sf.IDFORMATION = max_dates.IDFORMATION
WHERE 
    p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
    AND sf.DATE >= '${g}' 
    AND sf.DATE <= '${B}'
    AND sf.CONFIRME = 1
GROUP BY 
    p.IDPERSONNEL, p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION, 
    p.TELEPHONE, p.GRADE, p.SEXE, s.NOMSTRUCTURE, s.ABBREVIATION
HAVING 
    COUNT(DISTINCT sf.IDFORMATION) >= ${u}
ORDER BY 
    NombreFormations DESC, p.NOM, p.PRENOM;

        `},S=async()=>{if(!l){R("Veuillez s√©lectionner une structure","error");return}if(!u||u<1){R("Veuillez saisir un nombre de formations valide (minimum 1)","error");return}if(!m||!C){R("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(m>C){R("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const g=a();W(!0);const B=localStorage.getItem("token");try{const he=await ae.post(`${v}/personnaliserrequette`,{query:g},{headers:{Authorization:`Bearer ${B}`}});if(he.data)_(he.data),V(!0),R(`${he.data.length} personnels trouv√©s dans la structure s√©lectionn√©e`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(he){R(he.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{W(!1)}},R=(g,B)=>{L(g),E(B),H(!0)},b=()=>{H(!1)},k=g=>g?new Date(g).toLocaleDateString("fr-FR"):"-",w=()=>m&&C?`du ${k(m)} au ${k(C)}`:"P√©riode non d√©finie",I=()=>$.reduce((g,B)=>g+(B.NombreFormations||0),0),N=()=>l?l.ABBREVIATION||l.NOMSTRUCTURE:"",f=g=>{const B=g.target.value;(B===""||Number(B)>=1&&Number.isInteger(Number(B)))&&h(B)};return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Nr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels d'une Structure par Nombre de Formations"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels d'une structure sp√©cifique ayant b√©n√©fici√© d'au moins X formations sur une p√©riode"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ge,{fullWidth:!0,value:l,onChange:(g,B)=>{x(B)},inputValue:p,onInputChange:(g,B)=>{P(B)},options:t,getOptionLabel:g=>g.ABBREVIATION||g.NOMSTRUCTURE,renderOption:(g,B)=>e.jsxs(s,{component:"li",...g,children:[e.jsx(jr,{children:e.jsx(ue,{fontSize:"small"})}),e.jsx(dr,{primary:B.ABBREVIATION||B.NOMSTRUCTURE,secondary:B.ABBREVIATION?B.NOMSTRUCTURE:null})]}),loading:D,loadingText:"Chargement des structures...",noOptionsText:p.length<2?"Tapez au moins 2 caract√®res":"Aucune structure trouv√©e",renderInput:g=>e.jsx(ee,{...g,label:"Structure",variant:"outlined",sx:{bgcolor:"#f9f9f9"},placeholder:"Commencez √† saisir le nom d'une structure...",InputProps:{...g.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(lr,{color:"action"})}),g.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[D?e.jsx(xe,{color:"inherit",size:20}):null,g.InputProps.endAdornment]})}}),isOptionEqualToValue:(g,B)=>g.IDSTRUCTURE===B?.IDSTRUCTURE})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{fullWidth:!0,label:"Nombre minimum de formations",type:"number",value:u,onChange:f,variant:"outlined",inputProps:{min:1,step:1},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(ar,{color:"action"})})},sx:{bgcolor:"#f9f9f9"},placeholder:"Ex: 3"})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:m,onChange:g=>y(g),renderInput:g=>e.jsx(ee,{...g,fullWidth:!0,InputProps:{...g.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:C,onChange:g=>z(g),minDate:m,renderInput:g=>e.jsx(ee,{...g,fullWidth:!0,InputProps:{...g.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(l||u||m||C)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16}}),"Structure: ",N()]}),u&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5},children:["‚Ä¢ Minimum ",u," formation",u>1?"s":""]}),(m||C)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",w()]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Zs,{onClick:S,startIcon:F?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:F||!l||!u||!m||!C,children:F?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:Q,onClose:()=>V(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Nr,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnels d'une Structure par Nombre de Formations"})]}),e.jsx(de,{onClick:()=>V(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[$.length," personnels trouv√©s"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:.5,fontSize:16}}),"Structure: ",N()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Ayant b√©n√©fici√© d'au moins ",u," formation",u>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),w()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:N(),color:"secondary",variant:"outlined",icon:e.jsx(ue,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:`‚â• ${u} formations`,color:"primary",variant:"outlined",icon:e.jsx(ar,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:`${I()} formations au total`,color:"info",variant:"outlined",size:"small",sx:{fontSize:"0.8rem"}})]})]}),e.jsx(se,{sx:{my:2}}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",textAlign:"center"},children:"Nb Formations"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Contact"})]})}),e.jsx(Be,{children:$.length>0?$.map((g,B)=>e.jsxs(te,{hover:!0,sx:{"&:last-child td":{borderBottom:0}},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:B+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[g.NOM," ",g.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),g.MATRICULE,g.SEXE&&e.jsx(Y,{label:g.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:g.FONCTION||"-"}),g.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",g.GRADE]})]})]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsx(Y,{label:g.NombreFormations,color:"primary",variant:"filled",size:"small",sx:{fontWeight:"bold",minWidth:40}})}),e.jsx(j,{children:g.TELEPHONE&&e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:g.TELEPHONE})]})})]},B)):e.jsx(te,{children:e.jsxs(j,{colSpan:5,align:"center",sx:{py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucun personnel trouv√© avec ces crit√®res dans la structure s√©lectionn√©e"})]})})})]})}),$.length>0&&e.jsxs(s,{sx:{mt:3,p:2,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:18}}),"Statistiques pour la structure: ",N()]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total personnels:"})," ",$.length]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total suivis:"})," ",I()]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Moyenne par personnel:"})," ",(I()/$.length).toFixed(1)]})})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:q,onClose:b,autoHideDuration:5e3,children:e.jsx(Xs,{onClose:b,severity:T,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:T==="error"?"#ff0000":"background.paper",color:T==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:O})})})]})})},eo=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),ro=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),to=J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}})),so=()=>{const[t,n]=o.useState(""),[l,x]=o.useState(new Date),[p,P]=o.useState(new Date),[u,h]=o.useState(!1),[m,y]=o.useState([]),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState(""),[$,_]=o.useState("success"),Q="",V=c=>c?c.toISOString().split("T")[0]:null,q=()=>{const c=V(l),a=V(p);return`
        SELECT 
            p.MATRICULE,
            p.NOM,
            p.PRENOM,
            p.FONCTION,
            p.TELEPHONE,
            p.GRADE,
            p.SEXE,
            s.NOMSTRUCTURE as Structure,
            s.ABBREVIATION as StructureAbbreviation,
            COUNT(DISTINCT sf.IDFORMATION) as NombreFormations,
            GROUP_CONCAT(DISTINCT fm.INTITULE SEPARATOR ' | ') as ListeFormations
        FROM 
            personel p
        JOIN 
            participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
        JOIN 
            sessionformation sf ON ps.IDSESSION = sf.IDSESSION
        JOIN 
            formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
        JOIN 
            structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
        WHERE 
            p.SEXE = 'F√©minin'
            AND sf.DATE >= '${c}' 
            AND sf.DATE <= '${a}'
            AND sf.CONFIRME = 1
        GROUP BY 
            p.IDPERSONNEL, p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION, 
            p.TELEPHONE, p.GRADE, p.SEXE, s.NOMSTRUCTURE, s.ABBREVIATION
        HAVING 
            COUNT(DISTINCT sf.IDFORMATION) >= ${t}
        ORDER BY 
            NombreFormations DESC, p.NOM, p.PRENOM;
    `},H=async()=>{if(!t||t<1){O("Veuillez saisir un nombre de formations valide (minimum 1)","error");return}if(!l||!p){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(l>p){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const c=q();h(!0);const a=localStorage.getItem("token");try{const S=await ae.post(`${Q}/personnaliserrequette`,{query:c},{headers:{Authorization:`Bearer ${a}`}});if(S.data)y(S.data),z(!0),O(`${S.data.length} personnels f√©minins trouv√©s`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(S){O(S.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{h(!1)}},O=(c,a)=>{M(c),_(a),W(!0)},L=()=>{W(!1)},T=c=>c?new Date(c).toLocaleDateString("fr-FR"):"-",E=()=>l&&p?`du ${T(l)} au ${T(p)}`:"P√©riode non d√©finie",v=()=>m.reduce((c,a)=>c+(a.NombreFormations||0),0),i=c=>{const a=c.target.value;(a===""||Number(a)>=1&&Number.isInteger(Number(a)))&&n(a)};return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(nr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels F√©minins par Nombre de Formations"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels f√©minins ayant b√©n√©fici√© d'au moins X formations sur une p√©riode"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{fullWidth:!0,label:"Nombre minimum de formations",type:"number",value:t,onChange:i,variant:"outlined",inputProps:{min:1,step:1},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(ar,{color:"action"})})},sx:{bgcolor:"#f9f9f9"},placeholder:"Ex: 3"})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",height:"100%",pl:2,color:"text.secondary",fontSize:"0.9rem"},children:[e.jsx(nr,{sx:{mr:1,color:"pink"}}),e.jsx(r,{children:"Personnel f√©minin uniquement"})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:l,onChange:c=>x(c),renderInput:c=>e.jsx(ee,{...c,fullWidth:!0,InputProps:{...c.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:p,onChange:c=>P(c),minDate:l,renderInput:c=>e.jsx(ee,{...c,fullWidth:!0,InputProps:{...c.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(t||l||p)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(s,{sx:{ml:3},children:[e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(nr,{sx:{mr:1,fontSize:16,color:"pink"}}),"Personnel f√©minin uniquement"]}),t&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["‚Ä¢ Minimum ",t," formation",t>1?"s":""]}),(l||p)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",E()]})]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(ro,{onClick:H,startIcon:u?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:u||!t||!l||!p,children:u?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:C,onClose:()=>z(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(nr,{sx:{mr:1.5,fontSize:28,color:"pink"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnels F√©minins par Nombre de Formations"})]}),e.jsx(de,{onClick:()=>z(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[m.length," personnels f√©minins trouv√©s"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Ayant b√©n√©fici√© d'au moins ",t," formation",t>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),E()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:"Personnel F√©minin",sx:{bgcolor:"pink",color:"white",fontWeight:500,py:1,mb:1},icon:e.jsx(nr,{fontSize:"small",sx:{color:"white"}})}),e.jsx("br",{}),e.jsx(Y,{label:`‚â• ${t} formations`,color:"primary",variant:"outlined",icon:e.jsx(ar,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:`${v()} formations au total`,color:"info",variant:"outlined",size:"small",sx:{fontSize:"0.8rem"}})]})]}),e.jsx(se,{sx:{my:2}}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",textAlign:"center"},children:"Nb Formations"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Structure"})]})}),e.jsx(Be,{children:m.length>0?m.map((c,a)=>e.jsxs(to,{index:a,hover:!0,children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:a+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[c.PRENOM," ",c.NOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),c.MATRICULE,e.jsx(Y,{label:"F",size:"small",sx:{ml:1,height:20,fontSize:"0.7rem",bgcolor:"pink",color:"white"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:c.FONCTION||"-"}),c.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",c.GRADE]})]})]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsx(Y,{label:c.NombreFormations,color:"primary",variant:"filled",size:"small",sx:{fontWeight:"bold",minWidth:40}})}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",children:c.Structure||"-"}),c.StructureAbbreviation&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["(",c.StructureAbbreviation,")"]})]})})]},a)):e.jsx(te,{children:e.jsxs(j,{colSpan:5,align:"center",sx:{py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucune personnel f√©minin trouv√© avec ces crit√®res"})]})})})]})}),m.length>0&&e.jsxs(s,{sx:{mt:3,p:2,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:18}}),"Statistiques"]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total personnels:"})," ",m.length]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total formations suivies:"})," ",v()]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Moyenne par personnel:"})," ",(v()/m.length).toFixed(1)]})})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:F,onClose:L,autoHideDuration:5e3,children:e.jsx(eo,{onClose:L,severity:$,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:$==="error"?"#ff0000":"background.paper",color:$==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:D})})})]})})},oo=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),no=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),io=()=>{const[t,n]=o.useState(""),[l,x]=o.useState(new Date),[p,P]=o.useState(new Date),[u,h]=o.useState(!1),[m,y]=o.useState([]),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState(""),[$,_]=o.useState("success"),Q="",V=c=>c?c.toISOString().split("T")[0]:null,q=()=>{const c=V(l),a=V(p);return`
                
          SELECT 
              p.MATRICULE,
              p.NOM,
              p.PRENOM,
              p.FONCTION,
              p.TELEPHONE,
              p.GRADE,
              p.SEXE,
              s.NOMSTRUCTURE as Structure,
              s.ABBREVIATION as StructureAbbreviation,
              COUNT(DISTINCT sf.IDFORMATION) as NombreFormations,
              GROUP_CONCAT(DISTINCT fm.INTITULE SEPARATOR ' | ') as ListeFormations
          FROM 
              personel p
          JOIN 
              participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
          JOIN 
              sessionformation sf ON ps.IDSESSION = sf.IDSESSION
          JOIN 
              formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
          JOIN 
              structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
          WHERE 
              p.SEXE = 'Masculin'
              AND sf.DATE >= '${c}' 
              AND sf.DATE <= '${a}'
              AND sf.CONFIRME = 1
          GROUP BY 
              p.IDPERSONNEL, p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION, 
              p.TELEPHONE, p.GRADE, p.SEXE, s.NOMSTRUCTURE, s.ABBREVIATION
          HAVING 
              COUNT(DISTINCT sf.IDFORMATION) >= ${t}
          ORDER BY 
              NombreFormations DESC, p.NOM, p.PRENOM;
    `},H=async()=>{if(!t||t<1){O("Veuillez saisir un nombre de formations valide (minimum 1)","error");return}if(!l||!p){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(l>p){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const c=q();h(!0);const a=localStorage.getItem("token");try{const S=await ae.post(`${Q}/personnaliserrequette`,{query:c},{headers:{Authorization:`Bearer ${a}`}});if(S.data)y(S.data),z(!0),O(`${S.data.length} personnels masculin trouv√©s`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(S){O(S.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{h(!1)}},O=(c,a)=>{M(c),_(a),W(!0)},L=()=>{W(!1)},T=c=>c?new Date(c).toLocaleDateString("fr-FR"):"-",E=()=>l&&p?`du ${T(l)} au ${T(p)}`:"P√©riode non d√©finie",v=()=>m.reduce((c,a)=>c+(a.NombreFormations||0),0),i=c=>{const a=c.target.value;(a===""||Number(a)>=1&&Number.isInteger(Number(a)))&&n(a)};return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(or,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels Masculins par Nombre de Formations"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels Masculins ayant b√©n√©fici√© d'au moins X formations sur une p√©riode"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{fullWidth:!0,label:"Nombre minimum de formations",type:"number",value:t,onChange:i,variant:"outlined",inputProps:{min:1,step:1},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(ar,{color:"action"})})},sx:{bgcolor:"#f9f9f9"},placeholder:"Ex: 3"})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",height:"100%",pl:2,color:"text.secondary",fontSize:"0.9rem"},children:[e.jsx(or,{sx:{mr:1,color:"pink"}}),e.jsx(r,{children:"Personnel masculin uniquement"})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:l,onChange:c=>x(c),renderInput:c=>e.jsx(ee,{...c,fullWidth:!0,InputProps:{...c.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:p,onChange:c=>P(c),minDate:l,renderInput:c=>e.jsx(ee,{...c,fullWidth:!0,InputProps:{...c.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(t||l||p)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(s,{sx:{ml:3},children:[e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(or,{sx:{mr:1,fontSize:16,color:"pink"}}),"Personnel masculin uniquement"]}),t&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["‚Ä¢ Minimum ",t," formation",t>1?"s":""]}),(l||p)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",E()]})]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(no,{onClick:H,startIcon:u?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:u||!t||!l||!p,children:u?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:C,onClose:()=>z(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(or,{sx:{mr:1.5,fontSize:28,color:"pink"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnels Masculin par Nombre de Formations"})]}),e.jsx(de,{onClick:()=>z(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[m.length," personnels masculin trouv√©s"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Ayant b√©n√©fici√© d'au moins ",t," formation",t>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),E()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:"Personnel Masculin",sx:{bgcolor:"pink",color:"white",fontWeight:500,py:1,mb:1},icon:e.jsx(or,{fontSize:"small",sx:{color:"white"}})}),e.jsx("br",{}),e.jsx(Y,{label:`‚â• ${t} formations`,color:"primary",variant:"outlined",icon:e.jsx(ar,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:`${v()} formations au total`,color:"info",variant:"outlined",size:"small",sx:{fontSize:"0.8rem"}})]})]}),e.jsx(se,{sx:{my:2}}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",textAlign:"center"},children:"Nombre Formations"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Structure"})]})}),e.jsx(Be,{children:m.length>0?m.map((c,a)=>e.jsxs(te,{hover:!0,sx:{"&:last-child td":{borderBottom:0}},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:a+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[c.PRENOM," ",c.NOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),c.MATRICULE,e.jsx(Y,{label:"M",size:"small",sx:{ml:1,height:20,fontSize:"0.7rem",bgcolor:"pink",color:"white"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:c.FONCTION||"-"}),c.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",c.GRADE]})]})]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsx(Y,{label:c.NombreFormations,color:"primary",variant:"filled",size:"small",sx:{fontWeight:"bold",minWidth:40}})}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",children:c.Structure||"-"}),c.StructureAbbreviation&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["(",c.StructureAbbreviation,")"]})]})})]},a)):e.jsx(te,{children:e.jsxs(j,{colSpan:5,align:"center",sx:{py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucune personnel masculin trouv√© avec ces crit√®res"})]})})})]})}),m.length>0&&e.jsxs(s,{sx:{mt:3,p:2,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:18}}),"Statistiques"]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total personnels:"})," ",m.length]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total formations suivies:"})," ",v()]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Moyenne par personnel:"})," ",(v()/m.length).toFixed(1)]})})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:F,onClose:L,autoHideDuration:5e3,children:e.jsx(oo,{onClose:L,severity:$,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:$==="error"?"#ff0000":"background.paper",color:$==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:D})})})]})})},ao=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),lo=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),co=J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const xo=()=>{const[t,n]=o.useState(""),[l,x]=o.useState(new Date),[p,P]=o.useState(new Date),[u,h]=o.useState(!1),[m,y]=o.useState([]),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState(""),[$,_]=o.useState("success"),Q="",V=c=>c?c.toISOString().split("T")[0]:null,q=()=>{const c=V(l),a=V(p);return`
          SELECT 
            p.MATRICULE,
            p.NOM,
            p.PRENOM,
            p.FONCTION,
            p.TELEPHONE,
            p.GRADE,
            p.SEXE,
            s.NOMSTRUCTURE as Structure,
            s.ABBREVIATION as StructureAbbreviation,
            COUNT(DISTINCT sf.IDFORMATION) as NombreFormations,
            GROUP_CONCAT(
                DISTINCT CONCAT(fm.INTITULE, '|', max_dates.MAX_SESSION_DATE) 
                ORDER BY max_dates.MAX_SESSION_DATE DESC 
                SEPARATOR ' | '
            ) as ListeFormations
        FROM 
            personel p
        JOIN 
            participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
        JOIN 
            sessionformation sf ON ps.IDSESSION = sf.IDSESSION
        JOIN 
            formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
        JOIN 
            structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
        JOIN (
            SELECT 
                ps2.IDPERSONNEL,
                sf2.IDFORMATION,
                MAX(sf2.DATE) as MAX_SESSION_DATE
            FROM 
                participer_session ps2
            JOIN 
                sessionformation sf2 ON ps2.IDSESSION = sf2.IDSESSION
            GROUP BY 
                ps2.IDPERSONNEL, sf2.IDFORMATION
        ) max_dates ON p.IDPERSONNEL = max_dates.IDPERSONNEL AND sf.IDFORMATION = max_dates.IDFORMATION
        WHERE 
            p.SERVICECENTRAL = 'Service Central'
            AND sf.DATE >= '${c}' 
            AND sf.DATE <= '${a}'
            AND sf.CONFIRME = 1
        GROUP BY 
            p.IDPERSONNEL, p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION, 
            p.TELEPHONE, p.GRADE, p.SEXE, s.NOMSTRUCTURE, s.ABBREVIATION
        HAVING 
            COUNT(DISTINCT sf.IDFORMATION) >= ${t}
        ORDER BY 
            NombreFormations DESC, p.NOM, p.PRENOM;
    `},H=async()=>{if(!t||t<1){O("Veuillez saisir un nombre de formations valide (minimum 1)","error");return}if(!l||!p){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(l>p){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const c=q();h(!0);const a=localStorage.getItem("token");try{const S=await ae.post(`${Q}/personnaliserrequette`,{query:c},{headers:{Authorization:`Bearer ${a}`}});if(S.data)y(S.data),z(!0),O(`${S.data.length} personnels des services centraux trouv√©s`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(S){O(S.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{h(!1)}},O=(c,a)=>{M(c),_(a),W(!0)},L=()=>{W(!1)},T=c=>c?new Date(c).toLocaleDateString("fr-FR"):"-",E=()=>l&&p?`du ${T(l)} au ${T(p)}`:"P√©riode non d√©finie",v=()=>m.reduce((c,a)=>c+(a.NombreFormations||0),0),i=c=>{const a=c.target.value;(a===""||Number(a)>=1&&Number.isInteger(Number(a)))&&n(a)};return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(cr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels des Services Centraux par Nombre de Formations"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels des services centraux ayant b√©n√©fici√© d'au moins X formations sur une p√©riode"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{fullWidth:!0,label:"Nombre minimum de formations",type:"number",value:t,onChange:i,variant:"outlined",inputProps:{min:1,step:1},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(ar,{color:"action"})})},sx:{bgcolor:"#f9f9f9"},placeholder:"Ex: 3"})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",height:"100%",pl:2,color:"text.secondary",fontSize:"0.9rem"},children:[e.jsx(cr,{sx:{mr:1,color:"primary.main"}}),e.jsx(r,{children:"Services centraux uniquement"})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:l,onChange:c=>x(c),renderInput:c=>e.jsx(ee,{...c,fullWidth:!0,InputProps:{...c.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:p,onChange:c=>P(c),minDate:l,renderInput:c=>e.jsx(ee,{...c,fullWidth:!0,InputProps:{...c.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(t||l||p)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(s,{sx:{ml:3},children:[e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(cr,{sx:{mr:1,fontSize:16,color:"primary.main"}}),"Services centraux uniquement"]}),t&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["‚Ä¢ Minimum ",t," formation",t>1?"s":""]}),(l||p)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",E()]})]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(lo,{onClick:H,startIcon:u?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:u||!t||!l||!p,children:u?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:C,onClose:()=>z(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(cr,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnels des Services Centraux par Nombre de Formations"})]}),e.jsx(de,{onClick:()=>z(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[m.length," personnels des services centraux trouv√©s"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Ayant b√©n√©fici√© d'au moins ",t," formation",t>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),E()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:"Services Centraux",color:"primary",variant:"outlined",icon:e.jsx(cr,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:`‚â• ${t} formations`,color:"secondary",variant:"outlined",icon:e.jsx(ar,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:`${v()} formations au total`,color:"info",variant:"outlined",size:"small",sx:{fontSize:"0.8rem"}})]})]}),e.jsx(se,{sx:{my:2}}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",textAlign:"center"},children:"Nb Formations"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Structure"})]})}),e.jsx(Be,{children:m.length>0?m.map((c,a)=>e.jsxs(co,{index:a,hover:!0,children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:a+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[c.PRENOM," ",c.NOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),c.MATRICULE,c.SEXE&&e.jsx(Y,{label:c.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:c.FONCTION||"-"}),c.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",c.GRADE]})]})]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsx(Y,{label:c.NombreFormations,color:"primary",variant:"filled",size:"small",sx:{fontWeight:"bold",minWidth:40}})}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",children:c.Structure||"-"}),c.StructureAbbreviation&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["(",c.StructureAbbreviation,")"]})]})})]},a)):e.jsx(te,{children:e.jsxs(j,{colSpan:5,align:"center",sx:{py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucun personnel des services centraux trouv√© avec ces crit√®res"})]})})})]})}),m.length>0&&e.jsxs(s,{sx:{mt:3,p:2,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:18}}),"Statistiques"]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total personnels:"})," ",m.length]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total formations suivies:"})," ",v()]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Moyenne par personnel:"})," ",(v()/m.length).toFixed(1)]})})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:F,onClose:L,autoHideDuration:5e3,children:e.jsx(ao,{onClose:L,severity:$,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:$==="error"?"#ff0000":"background.paper",color:$==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:D})})})]})})},uo=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),fo=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),mo=J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}})),ho=()=>{const[t,n]=o.useState(""),[l,x]=o.useState(new Date),[p,P]=o.useState(new Date),[u,h]=o.useState(!1),[m,y]=o.useState([]),[C,z]=o.useState(!1),[F,W]=o.useState(!1),[D,M]=o.useState(""),[$,_]=o.useState("success"),Q="",V=c=>c?c.toISOString().split("T")[0]:null,q=()=>{const c=V(l),a=V(p);return`
      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          COUNT(DISTINCT sf.IDFORMATION) as NombreFormations,
          GROUP_CONCAT(
              DISTINCT CONCAT(fm.INTITULE, '|', max_dates.MAX_SESSION_DATE) 
              ORDER BY max_dates.MAX_SESSION_DATE DESC 
              SEPARATOR ' | '
          ) as ListeFormations
      FROM 
          personel p
      JOIN 
          participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
      JOIN 
          sessionformation sf ON ps.IDSESSION = sf.IDSESSION
      JOIN 
          formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      JOIN (
          SELECT 
              ps2.IDPERSONNEL,
              sf2.IDFORMATION,
              MAX(sf2.DATE) as MAX_SESSION_DATE
          FROM 
              participer_session ps2
          JOIN 
              sessionformation sf2 ON ps2.IDSESSION = sf2.IDSESSION
          GROUP BY 
              ps2.IDPERSONNEL, sf2.IDFORMATION
      ) max_dates ON p.IDPERSONNEL = max_dates.IDPERSONNEL AND sf.IDFORMATION = max_dates.IDFORMATION
      WHERE 
          p.SERVICECENTRAL = 'Service Deconcentr√©'
          AND sf.DATE >= '${c}' 
          AND sf.DATE <= '${a}'
          AND sf.CONFIRME = 1
      GROUP BY 
          p.IDPERSONNEL, p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION, 
          p.TELEPHONE, p.GRADE, p.SEXE, s.NOMSTRUCTURE, s.ABBREVIATION
      HAVING 
          COUNT(DISTINCT sf.IDFORMATION) >= ${t}
      ORDER BY 
          NombreFormations DESC, p.NOM, p.PRENOM;
    `},H=async()=>{if(!t||t<1){O("Veuillez saisir un nombre de formations valide (minimum 1)","error");return}if(!l||!p){O("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(l>p){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const c=q();h(!0);const a=localStorage.getItem("token");try{const S=await ae.post(`${Q}/personnaliserrequette`,{query:c},{headers:{Authorization:`Bearer ${a}`}});if(S.data)y(S.data),z(!0),O(`${S.data.length} personnels d√©concentr√©s trouv√©s`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(S){O(S.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{h(!1)}},O=(c,a)=>{M(c),_(a),W(!0)},L=()=>{W(!1)},T=c=>c?new Date(c).toLocaleDateString("fr-FR"):"-",E=()=>l&&p?`du ${T(l)} au ${T(p)}`:"P√©riode non d√©finie",v=()=>m.reduce((c,a)=>c+(a.NombreFormations||0),0),i=c=>{const a=c.target.value;(a===""||Number(a)>=1&&Number.isInteger(Number(a)))&&n(a)};return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(yr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels D√©concentr√©s par Nombre de Formations"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels d√©concentr√©s ayant b√©n√©fici√© d'au moins X formations sur une p√©riode"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{fullWidth:!0,label:"Nombre minimum de formations",type:"number",value:t,onChange:i,variant:"outlined",inputProps:{min:1,step:1},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(ar,{color:"action"})})},sx:{bgcolor:"#f9f9f9"},placeholder:"Ex: 3"})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",height:"100%",pl:2,color:"text.secondary",fontSize:"0.9rem"},children:[e.jsx(yr,{sx:{mr:1,color:"primary.main"}}),e.jsx(r,{children:"Services d√©concentr√©s uniquement"})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:l,onChange:c=>x(c),renderInput:c=>e.jsx(ee,{...c,fullWidth:!0,InputProps:{...c.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:p,onChange:c=>P(c),minDate:l,renderInput:c=>e.jsx(ee,{...c,fullWidth:!0,InputProps:{...c.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(t||l||p)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(s,{sx:{ml:3},children:[e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(yr,{sx:{mr:1,fontSize:16,color:"primary.main"}}),"Services d√©concentr√©s uniquement"]}),t&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["‚Ä¢ Minimum ",t," formation",t>1?"s":""]}),(l||p)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",E()]})]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(fo,{onClick:H,startIcon:u?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:u||!t||!l||!p,children:u?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:C,onClose:()=>z(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(yr,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnels D√©concentr√©s par Nombre de Formations"})]}),e.jsx(de,{onClick:()=>z(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[m.length," personnels d√©concentr√©s trouv√©s"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Ayant b√©n√©fici√© d'au moins ",t," formation",t>1?"s":""]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),E()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:"Services D√©concentr√©s",color:"primary",variant:"outlined",icon:e.jsx(yr,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:`‚â• ${t} formations`,color:"secondary",variant:"outlined",icon:e.jsx(ar,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:`${v()} formations au total`,color:"info",variant:"outlined",size:"small",sx:{fontSize:"0.8rem"}})]})]}),e.jsx(se,{sx:{my:2}}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",textAlign:"center"},children:"Nb Formations"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Structure"})]})}),e.jsx(Be,{children:m.length>0?m.map((c,a)=>e.jsxs(mo,{index:a,hover:!0,children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:a+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[c.PRENOM," ",c.NOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),c.MATRICULE,c.SEXE&&e.jsx(Y,{label:c.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:c.FONCTION||"-"}),c.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",c.GRADE]})]})]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsx(Y,{label:c.NombreFormations,color:"primary",variant:"filled",size:"small",sx:{fontWeight:"bold",minWidth:40}})}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",children:c.Structure||"-"}),c.StructureAbbreviation&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["(",c.StructureAbbreviation,")"]})]})})]},a)):e.jsx(te,{children:e.jsxs(j,{colSpan:5,align:"center",sx:{py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucun personnel d√©concentr√© trouv√© avec ces crit√®res"})]})})})]})}),m.length>0&&e.jsxs(s,{sx:{mt:3,p:2,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:18}}),"Statistiques"]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total personnels:"})," ",m.length]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total formations suivies:"})," ",v()]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Moyenne par personnel:"})," ",(v()/m.length).toFixed(1)]})})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:F,onClose:L,autoHideDuration:5e3,children:e.jsx(uo,{onClose:L,severity:$,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:$==="error"?"#ff0000":"background.paper",color:$==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:D})})})]})})},po=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),bo=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),go=J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}})),jo=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(null),[p,P]=o.useState(new Date),[u,h]=o.useState(new Date),[m,y]=o.useState(!1),[C,z]=o.useState(!1),[F,W]=o.useState([]),[D,M]=o.useState(!1),[$,_]=o.useState(!1),[Q,V]=o.useState(""),[q,H]=o.useState("success"),[O,L]=o.useState(""),T="",E=o.useCallback(tr(async N=>{z(!0);const f=localStorage.getItem("token");try{const g=await ae.get(`${T}/listeformationeffectuees`,{headers:{Authorization:`Bearer ${f}`},params:{search:N}});g.data&&n(g.data)}catch{a("Erreur lors du chargement des formations","error")}finally{z(!1)}},300),[T]);o.useEffect(()=>{E(O)},[O,E]);const v=N=>N?N.toISOString().split("T")[0]:null,i=()=>{if(!l)return null;const N=v(p),f=v(u);let g="";return N&&f?g=`AND sf.DATE >= '${N}' AND sf.DATE <= '${f}'`:N?g=`AND sf.DATE >= '${N}'`:f&&(g=`AND sf.DATE <= '${f}'`),`
      SELECT 
        p.MATRICULE,
        p.NOM,
        p.PRENOM,
        p.FONCTION,
        p.TELEPHONE,
        p.GRADE,
        p.SEXE,
        s.NOMSTRUCTURE as Structure,
        s.ABBREVIATION as StructureAbbreviation,
        fm.INTITULE as Formation,
        sf.DATE as DateSession,
        COUNT(DISTINCT ps.IDSESSION) as NombreSessions
      FROM 
        personel p
      JOIN 
        participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
      JOIN 
        sessionformation sf ON ps.IDSESSION = sf.IDSESSION
      JOIN 
        formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      WHERE 
        fm.IDFORMATIONM = ${l.IDFORMATIONM}
        ${g}
        AND sf.CONFIRME = 1
      GROUP BY
        p.IDPERSONNEL, p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION,
        p.TELEPHONE, p.GRADE, p.SEXE, s.NOMSTRUCTURE, s.ABBREVIATION,
        fm.INTITULE, sf.DATE
      ORDER BY 
        s.NOMSTRUCTURE, p.NOM, p.PRENOM;
    `},c=async()=>{if(!l){a("Veuillez s√©lectionner une formation","error");return}if(p&&u&&p>u){a("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const N=i();y(!0);const f=localStorage.getItem("token");try{const g=await ae.post(`${T}/personnaliserrequette`,{query:N},{headers:{Authorization:`Bearer ${f}`}});if(g.data)W(g.data),M(!0),a(`${g.data.length} personnels trouv√©s`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(g){a(g.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{y(!1)}},a=(N,f)=>{V(N),H(f),_(!0)},S=()=>{_(!1)},R=N=>N?new Date(N).toLocaleDateString("fr-FR"):"-",b=()=>l?l.INTITULE:"",k=()=>p&&u?`du ${R(p)} au ${R(u)}`:p?`√† partir du ${R(p)}`:u?`jusqu'au ${R(u)}`:"Toutes les p√©riodes",I=(N=>{const f={};return N.forEach(g=>{const B=g.Structure||"Structure non d√©finie";f[B]||(f[B]=[]),f[B].push(g)}),f})(F);return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx($e,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels par Formation"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste de tous les personnels ayant suivi une formation sp√©cifique (toutes structures confondues)"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:8,children:e.jsx(Ge,{fullWidth:!0,options:t,getOptionLabel:N=>N?.INTITULE||"",value:l,onChange:(N,f)=>x(f),onInputChange:(N,f)=>L(f),loading:C,renderInput:N=>e.jsx(ee,{...N,label:"S√©lectionner une formation",variant:"outlined",placeholder:"Rechercher une formation...",InputProps:{...N.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(ve,{color:"action"})}),N.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[C?e.jsx(xe,{color:"inherit",size:20}):null,N.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(N,f)=>e.jsxs(s,{component:"li",...N,children:[e.jsx(ve,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{children:f.INTITULE}),f.DATE&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Date: ",R(f.DATE)]})]})]}),noOptionsText:"Aucune formation trouv√©e",loadingText:"Chargement des formations..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:p,onChange:N=>P(N),renderInput:N=>e.jsx(ee,{...N,fullWidth:!0,InputProps:{...N.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:u,onChange:N=>h(N),minDate:p,renderInput:N=>e.jsx(ee,{...N,fullWidth:!0,InputProps:{...N.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(l||p||u)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(s,{sx:{ml:3},children:[l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:16}}),"Formation: ",b()]}),(p||u)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",k()]})]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(bo,{onClick:c,startIcon:m?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:m||!l,children:m?"Traitement...":"Rechercher les personnels"})}),e.jsxs(Se,{open:D,onClose:()=>M(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx($e,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnels par Formation"})]}),e.jsx(de,{onClick:()=>M(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[F.length," personnels trouv√©s dans ",Object.keys(I).length," structures"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(ve,{sx:{mr:.5,fontSize:16}}),"Formation: ",b()]}),(p||u)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),k()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:b(),color:"primary",variant:"outlined",icon:e.jsx(ve,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),(p||u)&&e.jsx(Y,{label:k(),color:"info",variant:"outlined",icon:e.jsx(pe,{fontSize:"small"}),sx:{fontSize:"0.8rem",fontWeight:500,py:.5,mt:1}})]})]}),e.jsx(se,{sx:{my:2}}),Object.keys(I).length>0?Object.entries(I).map(([N,f])=>e.jsxs(s,{sx:{mb:3},children:[e.jsxs(r,{variant:"h6",sx:{display:"flex",alignItems:"center",mb:2,color:"primary.main",fontWeight:"bold"},children:[e.jsx(ue,{sx:{mr:1}}),N," (",f.length," ",f.length>1?"personnels":"personnel",")"]}),e.jsx(we,{sx:{maxHeight:400,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2,mb:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"40px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Contact"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Date Session"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",textAlign:"center"},children:"Sessions"})]})}),e.jsx(Be,{children:f.map((g,B)=>e.jsxs(go,{index:B,hover:!0,children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:B+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[g.PRENOM," ",g.NOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),g.MATRICULE,g.SEXE&&e.jsx(Y,{label:g.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:g.FONCTION||"-"}),g.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",g.GRADE]})]})]})}),e.jsx(j,{children:e.jsx(r,{variant:"body2",children:g.TELEPHONE||"-"})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{children:g.DateSession?R(g.DateSession):"-"})]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(mr,{sx:{mr:.5,fontSize:16,color:"secondary.main"}}),e.jsx(r,{variant:"body2",fontWeight:"bold",color:"secondary.main",children:g.NombreSessions||1})]})})]},B))})]})})]},N)):e.jsxs(s,{sx:{textAlign:"center",py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucun personnel trouv√© pour cette formation"})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:$,onClose:S,autoHideDuration:5e3,children:e.jsx(po,{onClose:S,severity:q,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:q==="error"?"#d32f2f":"background.paper",color:q==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:Q})})})]})})},So=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),yo=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Eo=J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const Io=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(null),[p,P]=o.useState(new Date),[u,h]=o.useState(new Date),[m,y]=o.useState(!1),[C,z]=o.useState(!1),[F,W]=o.useState([]),[D,M]=o.useState(!1),[$,_]=o.useState(!1),[Q,V]=o.useState(""),[q,H]=o.useState("success"),[O,L]=o.useState(""),T="",E=o.useCallback(tr(async N=>{z(!0);const f=localStorage.getItem("token");try{const g=await ae.get(`${T}/listeformationeffectuees`,{headers:{Authorization:`Bearer ${f}`},params:{search:N}});g.data&&n(g.data)}catch{a("Erreur lors du chargement des formations","error")}finally{z(!1)}},300),[T]);o.useEffect(()=>{O.length>=2?E(O):O.length===0&&n([])},[O,E]);const v=N=>N?N.toISOString().split("T")[0]:null,i=()=>{if(!l)return null;const N=v(p),f=v(u);let g="";return N&&f?g=`AND sf.DATE >= '${N}' AND sf.DATE <= '${f}'`:N?g=`AND sf.DATE >= '${N}'`:f&&(g=`AND sf.DATE <= '${f}'`),`
      SELECT 
        p.MATRICULE,
        p.NOM,
        p.PRENOM,
        p.FONCTION,
        p.TELEPHONE,
        p.GRADE,
        p.SEXE,
        s.NOMSTRUCTURE as Structure,
        s.ABBREVIATION as StructureAbbreviation,
        fm.INTITULE as Formation,
        MIN(sf.DATE) as PremiereSession,
        MAX(sf.DATE) as DerniereSession,
        COUNT(DISTINCT ps.IDSESSION) as NombreSessions
      FROM 
        personel p
      JOIN 
        participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
      JOIN 
        sessionformation sf ON ps.IDSESSION = sf.IDSESSION
      JOIN 
        formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      WHERE 
        fm.IDFORMATIONM = ${l.IDFORMATIONM}
        AND p.SERVICECENTRAL = 'Service Central'
        ${g}
        AND sf.CONFIRME = 1
      GROUP BY
        p.IDPERSONNEL, p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION,
        p.TELEPHONE, p.GRADE, p.SEXE, s.NOMSTRUCTURE, s.ABBREVIATION,
        fm.INTITULE
      ORDER BY 
        s.NOMSTRUCTURE, p.NOM, p.PRENOM;
    `},c=async()=>{if(!l){a("Veuillez s√©lectionner une formation","error");return}if(p&&u&&p>u){a("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const N=i();y(!0);const f=localStorage.getItem("token");try{const g=await ae.post(`${T}/personnaliserrequette`,{query:N},{headers:{Authorization:`Bearer ${f}`}});if(g.data)W(g.data),M(!0),a(`${g.data.length} personnels trouv√©s dans le Service Central`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(g){a(g.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{y(!1)}},a=(N,f)=>{V(N),H(f),_(!0)},S=()=>{_(!1)},R=N=>N?new Date(N).toLocaleDateString("fr-FR"):"-",b=()=>l?l.INTITULE:"",k=()=>p&&u?`du ${R(p)} au ${R(u)}`:p?`√† partir du ${R(p)}`:u?`jusqu'au ${R(u)}`:"Toutes les p√©riodes",I=(N=>{const f={};return N.forEach(g=>{const B=g.Structure||"Structure non d√©finie";f[B]||(f[B]=[]),f[B].push(g)}),f})(F);return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx($e,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels du Service Central par Formation"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels du Service Central ayant suivi une formation sp√©cifique"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:8,children:e.jsx(Ge,{fullWidth:!0,options:t,getOptionLabel:N=>N.INTITULE,value:l,onChange:(N,f)=>x(f),onInputChange:(N,f)=>L(f),loading:C,renderInput:N=>e.jsx(ee,{...N,label:"S√©lectionner une formation",variant:"outlined",placeholder:"Rechercher une formation...",InputProps:{...N.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(ve,{color:"action"})}),N.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[C?e.jsx(xe,{color:"inherit",size:20}):null,N.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(N,f)=>e.jsxs(s,{component:"li",...N,children:[e.jsx(ve,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{children:f.INTITULE}),f.DATE&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Date: ",R(f.DATE)]})]})]}),noOptionsText:O.length>=2?"Aucune formation trouv√©e":"Tapez au moins 2 caract√®res",loadingText:"Chargement des formations..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:p,onChange:N=>P(N),renderInput:N=>e.jsx(ee,{...N,fullWidth:!0,InputProps:{...N.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:u,onChange:N=>h(N),minDate:p,renderInput:N=>e.jsx(ee,{...N,fullWidth:!0,InputProps:{...N.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(l||p||u)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(s,{sx:{ml:3},children:[l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:16}}),"Formation: ",b()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx($e,{sx:{mr:1,fontSize:16}}),"Service Central uniquement"]}),(p||u)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",k()]})]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(yo,{onClick:c,startIcon:m?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:m||!l,children:m?"Traitement...":"Rechercher les personnels"})}),e.jsxs(Se,{open:D,onClose:()=>M(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx($e,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnels du Service Central par Formation"})]}),e.jsx(de,{onClick:()=>M(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[F.length," personnels trouv√©s dans ",Object.keys(I).length," structures du Service Central"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(ve,{sx:{mr:.5,fontSize:16}}),"Formation: ",b()]}),(p||u)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),k()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:b(),color:"primary",variant:"outlined",icon:e.jsx(ve,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),(p||u)&&e.jsx(Y,{label:k(),color:"info",variant:"outlined",icon:e.jsx(pe,{fontSize:"small"}),sx:{fontSize:"0.8rem",fontWeight:500,py:.5,mt:1}})]})]}),e.jsx(se,{sx:{my:2}}),Object.keys(I).length>0?Object.entries(I).map(([N,f])=>e.jsxs(s,{sx:{mb:3},children:[e.jsxs(r,{variant:"h6",sx:{display:"flex",alignItems:"center",mb:2,color:"primary.main",fontWeight:"bold"},children:[e.jsx(ue,{sx:{mr:1}}),N," (",f.length," ",f.length>1?"personnels":"personnel",")"]}),e.jsx(we,{sx:{maxHeight:400,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2,mb:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"40px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Contact"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"P√©riode des Sessions"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",textAlign:"center"},children:"Sessions"})]})}),e.jsx(Be,{children:f.map((g,B)=>e.jsxs(Eo,{index:B,hover:!0,children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:B+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[g.PRENOM," ",g.NOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),g.MATRICULE,g.SEXE&&e.jsx(Y,{label:g.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:g.FONCTION||"-"}),g.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",g.GRADE]})]})]})}),e.jsx(j,{children:e.jsx(r,{variant:"body2",children:g.TELEPHONE||"-"})}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body2",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16,color:"action.active"}}),"Premi√®re: ",g.PremiereSession?R(g.PremiereSession):"-"]}),e.jsxs(r,{variant:"body2",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(U,{sx:{mr:1,fontSize:16,color:"action.active"}}),"Derni√®re: ",g.DerniereSession?R(g.DerniereSession):"-"]})]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(mr,{sx:{mr:.5,fontSize:16,color:"secondary.main"}}),e.jsx(r,{variant:"body2",fontWeight:"bold",color:"secondary.main",children:g.NombreSessions||0})]})})]},B))})]})})]},N)):e.jsxs(s,{sx:{textAlign:"center",py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucun personnel du Service Central trouv√© pour cette formation"})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:$,onClose:S,autoHideDuration:5e3,children:e.jsx(So,{onClose:S,severity:q,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:q==="error"?"#ff0000":"background.paper",color:q==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:Q})})})]})})},No=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),vo=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Oo=J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}}));J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"}));const To=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(null),[p,P]=o.useState(new Date),[u,h]=o.useState(new Date),[m,y]=o.useState(!1),[C,z]=o.useState(!1),[F,W]=o.useState([]),[D,M]=o.useState(!1),[$,_]=o.useState(!1),[Q,V]=o.useState(""),[q,H]=o.useState("success"),[O,L]=o.useState(""),T="",E=o.useCallback(tr(async N=>{z(!0);const f=localStorage.getItem("token");try{const g=await ae.get(`${T}/listeformationeffectuees`,{headers:{Authorization:`Bearer ${f}`},params:{search:N}});g.data&&n(g.data)}catch{a("Erreur lors du chargement des formations","error")}finally{z(!1)}},300),[T]);o.useEffect(()=>{O.length>=2?E(O):O.length===0&&n([])},[O,E]);const v=N=>N?N.toISOString().split("T")[0]:null,i=()=>{if(!l)return null;const N=v(p),f=v(u);let g="";return N&&f?g=`AND sf.DATE >= '${N}' AND sf.DATE <= '${f}'`:N?g=`AND sf.DATE >= '${N}'`:f&&(g=`AND sf.DATE <= '${f}'`),`
      SELECT 
        p.MATRICULE,
        p.NOM,
        p.PRENOM,
        p.FONCTION,
        p.TELEPHONE,
        p.GRADE,
        p.SEXE,
        s.NOMSTRUCTURE as Structure,
        s.ABBREVIATION as StructureAbbreviation,
        fm.INTITULE as Formation,
        MIN(sf.DATE) as PremiereSession,
        MAX(sf.DATE) as DerniereSession,
        COUNT(DISTINCT ps.IDSESSION) as NombreSessions
      FROM 
        personel p
      JOIN 
        participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
      JOIN 
        sessionformation sf ON ps.IDSESSION = sf.IDSESSION
      JOIN 
        formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      WHERE 
        fm.IDFORMATIONM = ${l.IDFORMATIONM}
        AND p.SERVICECENTRAL = 'Service Deconcentr√©'
        ${g}
        AND sf.CONFIRME = 1
      GROUP BY
        p.IDPERSONNEL, p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION,
        p.TELEPHONE, p.GRADE, p.SEXE, s.NOMSTRUCTURE, s.ABBREVIATION,
        fm.INTITULE
      ORDER BY 
        s.NOMSTRUCTURE, p.NOM, p.PRENOM;
    `},c=async()=>{if(!l){a("Veuillez s√©lectionner une formation","error");return}if(p&&u&&p>u){a("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const N=i();y(!0);const f=localStorage.getItem("token");try{const g=await ae.post(`${T}/personnaliserrequette`,{query:N},{headers:{Authorization:`Bearer ${f}`}});if(g.data)W(g.data),M(!0),a(`${g.data.length} personnels trouv√©s dans le Service D√©concentr√©`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(g){a(g.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{y(!1)}},a=(N,f)=>{V(N),H(f),_(!0)},S=()=>{_(!1)},R=N=>N?new Date(N).toLocaleDateString("fr-FR"):"-",b=()=>l?l.INTITULE:"",k=()=>p&&u?`du ${R(p)} au ${R(u)}`:p?`√† partir du ${R(p)}`:u?`jusqu'au ${R(u)}`:"Toutes les p√©riodes",I=(N=>{const f={};return N.forEach(g=>{const B=g.Structure||"Structure non d√©finie";f[B]||(f[B]=[]),f[B].push(g)}),f})(F);return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx($e,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels du Service D√©concentr√© par Formation"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels du Service D√©concentr√© ayant suivi une formation sp√©cifique"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:8,children:e.jsx(Ge,{fullWidth:!0,options:t,getOptionLabel:N=>N.INTITULE,value:l,onChange:(N,f)=>x(f),onInputChange:(N,f)=>L(f),loading:C,renderInput:N=>e.jsx(ee,{...N,label:"S√©lectionner une formation",variant:"outlined",placeholder:"Rechercher une formation...",InputProps:{...N.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(ve,{color:"action"})}),N.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[C?e.jsx(xe,{color:"inherit",size:20}):null,N.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(N,f)=>e.jsxs(s,{component:"li",...N,children:[e.jsx(ve,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{children:f.INTITULE}),f.DATE&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Date: ",R(f.DATE)]})]})]}),noOptionsText:O.length>=2?"Aucune formation trouv√©e":"Tapez au moins 2 caract√®res",loadingText:"Chargement des formations..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:p,onChange:N=>P(N),renderInput:N=>e.jsx(ee,{...N,fullWidth:!0,InputProps:{...N.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:u,onChange:N=>h(N),minDate:p,renderInput:N=>e.jsx(ee,{...N,fullWidth:!0,InputProps:{...N.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(l||p||u)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(s,{sx:{ml:3},children:[l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:16}}),"Formation: ",b()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx($e,{sx:{mr:1,fontSize:16}}),"Service D√©concentr√© uniquement"]}),(p||u)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",k()]})]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(vo,{onClick:c,startIcon:m?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:m||!l,children:m?"Traitement...":"Rechercher les personnels"})}),e.jsxs(Se,{open:D,onClose:()=>M(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx($e,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnels du Service D√©concentr√© par Formation"})]}),e.jsx(de,{onClick:()=>M(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[F.length," personnels trouv√©s dans ",Object.keys(I).length," structures du Service D√©concentr√©"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(ve,{sx:{mr:.5,fontSize:16}}),"Formation: ",b()]}),(p||u)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),k()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:b(),color:"primary",variant:"outlined",icon:e.jsx(ve,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),(p||u)&&e.jsx(Y,{label:k(),color:"info",variant:"outlined",icon:e.jsx(pe,{fontSize:"small"}),sx:{fontSize:"0.8rem",fontWeight:500,py:.5,mt:1}})]})]}),e.jsx(se,{sx:{my:2}}),Object.keys(I).length>0?Object.entries(I).map(([N,f])=>e.jsxs(s,{sx:{mb:3},children:[e.jsxs(r,{variant:"h6",sx:{display:"flex",alignItems:"center",mb:2,color:"primary.main",fontWeight:"bold"},children:[e.jsx(ue,{sx:{mr:1}}),N," (",f.length," ",f.length>1?"personnels":"personnel",")"]}),e.jsx(we,{sx:{maxHeight:400,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2,mb:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"40px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Contact"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"P√©riode des Sessions"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",textAlign:"center"},children:"Sessions"})]})}),e.jsx(Be,{children:f.map((g,B)=>e.jsxs(Oo,{index:B,hover:!0,children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:B+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[g.PRENOM," ",g.NOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),g.MATRICULE,g.SEXE&&e.jsx(Y,{label:g.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:g.FONCTION||"-"}),g.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",g.GRADE]})]})]})}),e.jsx(j,{children:e.jsx(r,{variant:"body2",children:g.TELEPHONE||"-"})}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body2",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16,color:"action.active"}}),"Premi√®re: ",g.PremiereSession?R(g.PremiereSession):"-"]}),e.jsxs(r,{variant:"body2",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(U,{sx:{mr:1,fontSize:16,color:"action.active"}}),"Derni√®re: ",g.DerniereSession?R(g.DerniereSession):"-"]})]})}),e.jsx(j,{sx:{textAlign:"center"},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(mr,{sx:{mr:.5,fontSize:16,color:"secondary.main"}}),e.jsx(r,{variant:"body2",fontWeight:"bold",color:"secondary.main",children:g.NombreSessions||0})]})})]},B))})]})})]},N)):e.jsxs(s,{sx:{textAlign:"center",py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucun personnel du Service D√©concentr√© trouv√© pour cette formation"})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:$,onClose:S,autoHideDuration:5e3,children:e.jsx(No,{onClose:S,severity:q,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:q==="error"?"#ff0000":"background.paper",color:q==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:Q})})})]})})},Ro=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Ao=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Co=()=>{const[t,n]=o.useState([]),[l,x]=o.useState([]),[p,P]=o.useState(null),[u,h]=o.useState(null),[m,y]=o.useState(new Date),[C,z]=o.useState(new Date),[F,W]=o.useState(!1),[D,M]=o.useState(!1),[$,_]=o.useState(!1),[Q,V]=o.useState([]),[q,H]=o.useState(!1),[O,L]=o.useState(!1),[T,E]=o.useState(""),[v,i]=o.useState("success"),[c,a]=o.useState(""),[S,R]=o.useState(""),b="",k=o.useCallback(tr(async A=>{M(!0);const X=localStorage.getItem("token");try{const re=await ae.get(`${b}/listestructures`,{headers:{Authorization:`Bearer ${X}`},params:{search:A}});re.data&&n(re.data)}catch{B("Erreur lors du chargement des structures","error")}finally{M(!1)}},300),[b]),w=o.useCallback(tr(async A=>{_(!0);const X=localStorage.getItem("token");try{const re=await ae.get(`${b}/listeformationeffectuees`,{headers:{Authorization:`Bearer ${X}`},params:{search:A}});re.data&&x(re.data)}catch{B("Erreur lors du chargement des formations","error")}finally{_(!1)}},300),[b]);o.useEffect(()=>{c.length>=2?k(c):c.length===0&&n([])},[c,k]),o.useEffect(()=>{S.length>=2?w(S):S.length===0&&x([])},[S,w]);const I=(A,{inputValue:X})=>{const re=X.toLowerCase();return A.filter(ge=>ge.NOMSTRUCTURE.toLowerCase().includes(re)||ge.ABBREVIATION&&ge.ABBREVIATION.toLowerCase().includes(re))},N=A=>A?A.toISOString().split("T")[0]:null,f=()=>{if(!p||!u)return null;const A=N(m),X=N(C);let re="";return A&&X?re=`AND sf.DATE >= '${A}' AND sf.DATE <= '${X}'`:A?re=`AND sf.DATE >= '${A}'`:X&&(re=`AND sf.DATE <= '${X}'`),`
     WITH RECURSIVE StructuresDescendantes AS (
          SELECT IDSTRUCTURE
          FROM structure
          WHERE IDSTRUCTURE = ${p.IDSTRUCTURE}
          UNION ALL
          SELECT s.IDSTRUCTURE
          FROM structure s
          INNER JOIN StructuresDescendantes sd ON s.IDPARENT = sd.IDSTRUCTURE
      )

      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          fm.INTITULE as Formation,
          MIN(sf.DATE) as PremiereSession,
          MAX(sf.DATE) as DerniereSession,
          COUNT(DISTINCT ps.IDSESSION) as NombreSessions
      FROM 
          personel p
      JOIN 
          participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
      JOIN 
          sessionformation sf ON ps.IDSESSION = sf.IDSESSION
      JOIN 
          formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      WHERE 
          p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
          AND fm.IDFORMATIONM = ${u.IDFORMATIONM}
          AND sf.CONFIRME = 1
          ${re}
      GROUP BY
          p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION, p.TELEPHONE, p.GRADE, p.SEXE,
          s.NOMSTRUCTURE, s.ABBREVIATION, fm.INTITULE
      ORDER BY 
          p.NOM, p.PRENOM;
    `},g=async()=>{if(!p){B("Veuillez s√©lectionner une structure","error");return}if(!u){B("Veuillez s√©lectionner une formation","error");return}if(m&&C&&m>C){B("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const A=f();W(!0);const X=localStorage.getItem("token");try{const re=await ae.post(`${b}/personnaliserrequette`,{query:A},{headers:{Authorization:`Bearer ${X}`}});if(re.data)V(re.data),H(!0),B(`${re.data.length} personnels trouv√©s`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(re){B(re.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{W(!1)}},B=(A,X)=>{E(A),i(X),L(!0)},he=()=>{L(!1)},fe=A=>A?new Date(A).toLocaleDateString("fr-FR"):"-",Ce=()=>p?p.ABBREVIATION||p.NOMSTRUCTURE:"",le=()=>u?u.INTITULE:"",K=()=>m&&C?`du ${fe(m)} au ${fe(C)}`:m?`√† partir du ${fe(m)}`:C?`jusqu'au ${fe(C)}`:"Toutes les p√©riodes";return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(ue,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnels par Structure et Formation"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels d'une structure ayant b√©n√©fici√© d'une formation sp√©cifique"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ge,{fullWidth:!0,options:t,getOptionLabel:A=>A.NOMSTRUCTURE,value:p,onChange:(A,X)=>P(X),onInputChange:(A,X)=>a(X),loading:D,filterOptions:I,renderInput:A=>e.jsx(ee,{...A,label:"S√©lectionner une structure",variant:"outlined",placeholder:"Tapez le nom ou l'abr√©viation...",InputProps:{...A.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(ue,{color:"action"})}),A.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[D?e.jsx(xe,{color:"inherit",size:20}):null,A.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(A,X)=>e.jsxs(s,{component:"li",...A,children:[e.jsx(ue,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{children:X.NOMSTRUCTURE}),X.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Abr√©viation: ",X.ABBREVIATION]})]})]}),noOptionsText:c.length>=2?"Aucune structure trouv√©e":"Tapez au moins 2 caract√®res",loadingText:"Chargement des structures..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ge,{fullWidth:!0,options:l,getOptionLabel:A=>A.INTITULE,value:u,onChange:(A,X)=>h(X),onInputChange:(A,X)=>R(X),loading:$,renderInput:A=>e.jsx(ee,{...A,label:"S√©lectionner une formation",variant:"outlined",placeholder:"Rechercher une formation...",InputProps:{...A.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(ve,{color:"action"})}),A.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[$?e.jsx(xe,{color:"inherit",size:20}):null,A.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(A,X)=>e.jsxs(s,{component:"li",...A,children:[e.jsx(ve,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{children:X.INTITULE}),X.DATE&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Date: ",fe(X.DATE)]})]})]}),noOptionsText:S.length>=2?"Aucune formation trouv√©e":"Tapez au moins 2 caract√®res",loadingText:"Chargement des formations..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:m,onChange:A=>y(A),renderInput:A=>e.jsx(ee,{...A,fullWidth:!0,InputProps:{...A.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:C,onChange:A=>z(A),minDate:m,renderInput:A=>e.jsx(ee,{...A,fullWidth:!0,InputProps:{...A.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(p||u||m||C)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(s,{sx:{ml:3},children:[p&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16}}),"Structure: ",Ce()]}),u&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:16}}),"Formation: ",le()]}),(m||C)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",K()]})]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Ao,{onClick:g,startIcon:F?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:F||!p||!u,children:F?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:q,onClose:()=>H(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(ue,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnels par Structure et Formation"})]}),e.jsx(de,{onClick:()=>H(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[Q.length," personnels trouv√©s"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:.5,fontSize:16}}),"Structure: ",Ce()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(ve,{sx:{mr:.5,fontSize:16}}),"Formation: ",le()]}),(m||C)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),K()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:Ce(),color:"secondary",variant:"outlined",icon:e.jsx(ue,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:le(),color:"primary",variant:"outlined",icon:e.jsx(ve,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),(m||C)&&e.jsx(Y,{label:K(),color:"info",variant:"outlined",icon:e.jsx(pe,{fontSize:"small"}),sx:{fontSize:"0.8rem",fontWeight:500,py:.5,mt:1}})]})]}),e.jsx(se,{sx:{my:2}}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Structure"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Date Formation"})]})}),e.jsx(Be,{children:Q.length>0?Q.map((A,X)=>e.jsxs(te,{hover:!0,sx:{"&:last-child td":{borderBottom:0}},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:X+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[A.PRENOM," ",A.NOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),A.MATRICULE,A.SEXE&&e.jsx(Y,{label:A.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:A.FONCTION||"-"}),A.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",A.GRADE]})]})]})}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",children:A.Structure||"-"}),A.StructureAbbreviation&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["(",A.StructureAbbreviation,")"]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{children:A.DerniereSession?fe(A.DerniereSession):"-"})]})})]},X)):e.jsx(te,{children:e.jsxs(j,{colSpan:5,align:"center",sx:{py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucun personnel trouv√© pour cette combinaison structure/formation"})]})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:O,onClose:he,autoHideDuration:5e3,children:e.jsx(Ro,{onClose:he,severity:v,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:v==="error"?"#ff0000":"background.paper",color:v==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:T})})})]})})},Do=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Fo=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),zo=()=>{const[t,n]=o.useState([]),[l,x]=o.useState([]),[p,P]=o.useState(null),[u,h]=o.useState(null),[m,y]=o.useState(new Date),[C,z]=o.useState(new Date),[F,W]=o.useState(!1),[D,M]=o.useState(!1),[$,_]=o.useState(!1),[Q,V]=o.useState([]),[q,H]=o.useState(!1),[O,L]=o.useState(!1),[T,E]=o.useState(""),[v,i]=o.useState("success"),[c,a]=o.useState(""),[S,R]=o.useState(""),b="",k=o.useCallback(tr(async A=>{M(!0);const X=localStorage.getItem("token");try{const re=await ae.get(`${b}/listestructures`,{headers:{Authorization:`Bearer ${X}`},params:{search:A}});re.data&&n(re.data)}catch{B("Erreur lors du chargement des structures","error")}finally{M(!1)}},300),[b]),w=o.useCallback(tr(async A=>{_(!0);const X=localStorage.getItem("token");try{const re=await ae.get(`${b}/listeformationeffectuees`,{headers:{Authorization:`Bearer ${X}`},params:{search:A}});re.data&&x(re.data)}catch{B("Erreur lors du chargement des formations","error")}finally{_(!1)}},300),[b]);o.useEffect(()=>{c.length>=2?k(c):c.length===0&&n([])},[c,k]),o.useEffect(()=>{S.length>=2?w(S):S.length===0&&x([])},[S,w]);const I=(A,{inputValue:X})=>{const re=X.toLowerCase();return A.filter(ge=>ge.NOMSTRUCTURE.toLowerCase().includes(re)||ge.ABBREVIATION&&ge.ABBREVIATION.toLowerCase().includes(re))},N=A=>A?A.toISOString().split("T")[0]:null,f=()=>{if(!p||!u)return null;const A=N(m),X=N(C);let re="";return A&&X?re=`AND sf.DATE >= '${A}' AND sf.DATE <= '${X}'`:A?re=`AND sf.DATE >= '${A}'`:X&&(re=`AND sf.DATE <= '${X}'`),`
      WITH RECURSIVE StructuresDescendantes AS (
          SELECT IDSTRUCTURE
          FROM structure
          WHERE IDSTRUCTURE = ${p.IDSTRUCTURE}
          UNION ALL
          SELECT s.IDSTRUCTURE
          FROM structure s
          INNER JOIN StructuresDescendantes sd ON s.IDPARENT = sd.IDSTRUCTURE
      )

      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          fm.INTITULE as Formation,
          MIN(sf.DATE) as PremiereSession,
          MAX(sf.DATE) as DerniereSession,
          COUNT(DISTINCT ps.IDSESSION) as NombreSessions
      FROM 
          personel p
      JOIN 
          participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
      JOIN 
          sessionformation sf ON ps.IDSESSION = sf.IDSESSION
      JOIN 
          formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      WHERE 
          p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
          AND fm.IDFORMATIONM = ${u.IDFORMATIONM}
          AND p.SEXE='Masculin'
          AND sf.CONFIRME = 1
          ${re}
      GROUP BY
          p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION, p.TELEPHONE, p.GRADE, p.SEXE,
          s.NOMSTRUCTURE, s.ABBREVIATION, fm.INTITULE
      ORDER BY 
          p.NOM, p.PRENOM;
    `},g=async()=>{if(!p){B("Veuillez s√©lectionner une structure","error");return}if(!u){B("Veuillez s√©lectionner une formation","error");return}if(m&&C&&m>C){B("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const A=f();W(!0);const X=localStorage.getItem("token");try{const re=await ae.post(`${b}/personnaliserrequette`,{query:A},{headers:{Authorization:`Bearer ${X}`}});if(re.data)V(re.data),H(!0),B(`${re.data.length} personnels masculins trouv√©s`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(re){B(re.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{W(!1)}},B=(A,X)=>{E(A),i(X),L(!0)},he=()=>{L(!1)},fe=A=>A?new Date(A).toLocaleDateString("fr-FR"):"-",Ce=()=>p?p.ABBREVIATION||p.NOMSTRUCTURE:"",le=()=>u?u.INTITULE:"",K=()=>m&&C?`du ${fe(m)} au ${fe(C)}`:m?`√† partir du ${fe(m)}`:C?`jusqu'au ${fe(C)}`:"Toutes les p√©riodes";return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(or,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnel Masculin par Structure et Formation"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels masculins d'une structure ayant b√©n√©fici√© d'une formation sp√©cifique"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ge,{fullWidth:!0,options:t,getOptionLabel:A=>A.NOMSTRUCTURE,value:p,onChange:(A,X)=>P(X),onInputChange:(A,X)=>a(X),loading:D,filterOptions:I,renderInput:A=>e.jsx(ee,{...A,label:"S√©lectionner une structure",variant:"outlined",placeholder:"Tapez le nom ou l'abr√©viation...",InputProps:{...A.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(ue,{color:"action"})}),A.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[D?e.jsx(xe,{color:"inherit",size:20}):null,A.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(A,X)=>e.jsxs(s,{component:"li",...A,children:[e.jsx(ue,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{children:X.NOMSTRUCTURE}),X.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Abr√©viation: ",X.ABBREVIATION]})]})]}),noOptionsText:c.length>=2?"Aucune structure trouv√©e":"Tapez au moins 2 caract√®res",loadingText:"Chargement des structures..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ge,{fullWidth:!0,options:l,getOptionLabel:A=>A.INTITULE,value:u,onChange:(A,X)=>h(X),onInputChange:(A,X)=>R(X),loading:$,renderInput:A=>e.jsx(ee,{...A,label:"S√©lectionner une formation",variant:"outlined",placeholder:"Rechercher une formation...",InputProps:{...A.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(ve,{color:"action"})}),A.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[$?e.jsx(xe,{color:"inherit",size:20}):null,A.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(A,X)=>e.jsxs(s,{component:"li",...A,children:[e.jsx(ve,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{children:X.INTITULE}),X.DATE&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Date: ",fe(X.DATE)]})]})]}),noOptionsText:S.length>=2?"Aucune formation trouv√©e":"Tapez au moins 2 caract√®res",loadingText:"Chargement des formations..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:m,onChange:A=>y(A),renderInput:A=>e.jsx(ee,{...A,fullWidth:!0,InputProps:{...A.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:C,onChange:A=>z(A),minDate:m,renderInput:A=>e.jsx(ee,{...A,fullWidth:!0,InputProps:{...A.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(p||u||m||C)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(s,{sx:{ml:3},children:[p&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16}}),"Structure: ",Ce()]}),u&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:16}}),"Formation: ",le()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(or,{sx:{mr:1,fontSize:16}}),"Personnel: Masculin uniquement"]}),(m||C)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",K()]})]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Fo,{onClick:g,startIcon:F?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:F||!p||!u,children:F?"Traitement...":"Rechercher personnel masculin"})}),e.jsxs(Se,{open:q,onClose:()=>H(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(or,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnel Masculin par Structure et Formation"})]}),e.jsx(de,{onClick:()=>H(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[Q.length," personnels masculins trouv√©s"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:.5,fontSize:16}}),"Structure: ",Ce()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(ve,{sx:{mr:.5,fontSize:16}}),"Formation: ",le()]}),(m||C)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),K()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:Ce(),color:"secondary",variant:"outlined",icon:e.jsx(ue,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:le(),color:"primary",variant:"outlined",icon:e.jsx(ve,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),(m||C)&&e.jsx(Y,{label:K(),color:"info",variant:"outlined",icon:e.jsx(pe,{fontSize:"small"}),sx:{fontSize:"0.8rem",fontWeight:500,py:.5,mt:1}})]})]}),e.jsx(se,{sx:{my:2}}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Structure"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Date Formation"})]})}),e.jsx(Be,{children:Q.length>0?Q.map((A,X)=>e.jsxs(te,{hover:!0,sx:{"&:last-child td":{borderBottom:0}},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:X+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[A.PRENOM," ",A.NOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),A.MATRICULE,e.jsx(Y,{label:"Masculin",size:"small",color:"primary",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:A.FONCTION||"-"}),A.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",A.GRADE]})]})]})}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",children:A.Structure||"-"}),A.StructureAbbreviation&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["(",A.StructureAbbreviation,")"]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{children:A.DerniereSession?fe(A.DerniereSession):"-"})]})})]},X)):e.jsx(te,{children:e.jsxs(j,{colSpan:5,align:"center",sx:{py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucun personnel masculin trouv√© pour cette combinaison"})]})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:O,onClose:he,autoHideDuration:5e3,children:e.jsx(Do,{onClose:he,severity:v,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:v==="error"?"#ff0000":"background.paper",color:v==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:T})})})]})})},ko=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Po=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Lo=J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}})),Mo=()=>{const[t,n]=o.useState([]),[l,x]=o.useState([]),[p,P]=o.useState(null),[u,h]=o.useState(null),[m,y]=o.useState(new Date),[C,z]=o.useState(new Date),[F,W]=o.useState(!1),[D,M]=o.useState(!1),[$,_]=o.useState(!1),[Q,V]=o.useState([]),[q,H]=o.useState(!1),[O,L]=o.useState(!1),[T,E]=o.useState(""),[v,i]=o.useState("success"),[c,a]=o.useState(""),[S,R]=o.useState(""),b="",k=o.useCallback(tr(async A=>{M(!0);const X=localStorage.getItem("token");try{const re=await ae.get(`${b}/listestructures`,{headers:{Authorization:`Bearer ${X}`},params:{search:A}});re.data&&n(re.data)}catch{B("Erreur lors du chargement des structures","error")}finally{M(!1)}},300),[b]),w=o.useCallback(tr(async A=>{_(!0);const X=localStorage.getItem("token");try{const re=await ae.get(`${b}/listeformationeffectuees`,{headers:{Authorization:`Bearer ${X}`},params:{search:A}});re.data&&x(re.data)}catch{B("Erreur lors du chargement des formations","error")}finally{_(!1)}},300),[b]);o.useEffect(()=>{c.length>=2?k(c):c.length===0&&n([])},[c,k]),o.useEffect(()=>{S.length>=2?w(S):S.length===0&&x([])},[S,w]);const I=(A,{inputValue:X})=>{const re=X.toLowerCase();return A.filter(ge=>ge.NOMSTRUCTURE.toLowerCase().includes(re)||ge.ABBREVIATION&&ge.ABBREVIATION.toLowerCase().includes(re))},N=A=>A?A.toISOString().split("T")[0]:null,f=()=>{if(!p||!u)return null;const A=N(m),X=N(C);let re="";return A&&X?re=`AND sf.DATE >= '${A}' AND sf.DATE <= '${X}'`:A?re=`AND sf.DATE >= '${A}'`:X&&(re=`AND sf.DATE <= '${X}'`),`
       WITH RECURSIVE StructuresDescendantes AS (
          SELECT IDSTRUCTURE
          FROM structure
          WHERE IDSTRUCTURE = ${p.IDSTRUCTURE}
          UNION ALL
          SELECT s.IDSTRUCTURE
          FROM structure s
          INNER JOIN StructuresDescendantes sd ON s.IDPARENT = sd.IDSTRUCTURE
      )

      SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          p.SEXE,
          s.NOMSTRUCTURE as Structure,
          s.ABBREVIATION as StructureAbbreviation,
          fm.INTITULE as Formation,
          MIN(sf.DATE) as PremiereSession,
          MAX(sf.DATE) as DerniereSession,
          COUNT(DISTINCT ps.IDSESSION) as NombreSessions
      FROM 
          personel p
      JOIN 
          participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
      JOIN 
          sessionformation sf ON ps.IDSESSION = sf.IDSESSION
      JOIN 
          formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
      JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      WHERE 
          p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
          AND fm.IDFORMATIONM = ${u.IDFORMATIONM}
          AND p.SEXE='F√©minin'
          AND sf.CONFIRME = 1
          ${re}
      GROUP BY
          p.MATRICULE, p.NOM, p.PRENOM, p.FONCTION, p.TELEPHONE, p.GRADE, p.SEXE,
          s.NOMSTRUCTURE, s.ABBREVIATION, fm.INTITULE
      ORDER BY 
          p.NOM, p.PRENOM;
    `},g=async()=>{if(!p){B("Veuillez s√©lectionner une structure","error");return}if(!u){B("Veuillez s√©lectionner une formation","error");return}if(m&&C&&m>C){B("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const A=f();W(!0);const X=localStorage.getItem("token");try{const re=await ae.post(`${b}/personnaliserrequette`,{query:A},{headers:{Authorization:`Bearer ${X}`}});if(re.data)V(re.data),H(!0),B(`${re.data.length} personnels f√©minins trouv√©s`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(re){B(re.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{W(!1)}},B=(A,X)=>{E(A),i(X),L(!0)},he=()=>{L(!1)},fe=A=>A?new Date(A).toLocaleDateString("fr-FR"):"-",Ce=()=>p?p.ABBREVIATION||p.NOMSTRUCTURE:"",le=()=>u?u.INTITULE:"",K=()=>m&&C?`du ${fe(m)} au ${fe(C)}`:m?`√† partir du ${fe(m)}`:C?`jusqu'au ${fe(C)}`:"Toutes les p√©riodes";return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(nr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Personnel F√©minin par Structure et Formation"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des personnels f√©minins d'une structure ayant b√©n√©fici√© d'une formation sp√©cifique"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ge,{fullWidth:!0,options:t,getOptionLabel:A=>A.NOMSTRUCTURE,value:p,onChange:(A,X)=>P(X),onInputChange:(A,X)=>a(X),loading:D,filterOptions:I,renderInput:A=>e.jsx(ee,{...A,label:"S√©lectionner une structure",variant:"outlined",placeholder:"Tapez le nom ou l'abr√©viation...",InputProps:{...A.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(ue,{color:"action"})}),A.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[D?e.jsx(xe,{color:"inherit",size:20}):null,A.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(A,X)=>e.jsxs(s,{component:"li",...A,children:[e.jsx(ue,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{children:X.NOMSTRUCTURE}),X.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Abr√©viation: ",X.ABBREVIATION]})]})]}),noOptionsText:c.length>=2?"Aucune structure trouv√©e":"Tapez au moins 2 caract√®res",loadingText:"Chargement des structures..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ge,{fullWidth:!0,options:l,getOptionLabel:A=>A.INTITULE,value:u,onChange:(A,X)=>h(X),onInputChange:(A,X)=>R(X),loading:$,renderInput:A=>e.jsx(ee,{...A,label:"S√©lectionner une formation",variant:"outlined",placeholder:"Rechercher une formation...",InputProps:{...A.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(ve,{color:"action"})}),A.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[$?e.jsx(xe,{color:"inherit",size:20}):null,A.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(A,X)=>e.jsxs(s,{component:"li",...A,children:[e.jsx(ve,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{children:X.INTITULE}),X.DATE&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Date: ",fe(X.DATE)]})]})]}),noOptionsText:S.length>=2?"Aucune formation trouv√©e":"Tapez au moins 2 caract√®res",loadingText:"Chargement des formations..."})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:m,onChange:A=>y(A),renderInput:A=>e.jsx(ee,{...A,fullWidth:!0,InputProps:{...A.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:C,onChange:A=>z(A),minDate:m,renderInput:A=>e.jsx(ee,{...A,fullWidth:!0,InputProps:{...A.InputProps,startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}})})})]}),(p||u||m||C)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(s,{sx:{ml:3},children:[p&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16}}),"Structure: ",Ce()]}),u&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:16}}),"Formation: ",le()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(nr,{sx:{mr:1,fontSize:16}}),"Personnel: F√©minin uniquement"]}),(m||C)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode: ",K()]})]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Po,{onClick:g,startIcon:F?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:F||!p||!u,children:F?"Traitement...":"Rechercher personnel f√©minin"})}),e.jsxs(Se,{open:q,onClose:()=>H(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(nr,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Personnel F√©minin par Structure et Formation"})]}),e.jsx(de,{onClick:()=>H(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[Q.length," personnels f√©minins trouv√©s"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:.5,fontSize:16}}),"Structure: ",Ce()]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(ve,{sx:{mr:.5,fontSize:16}}),"Formation: ",le()]}),(m||C)&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx(pe,{sx:{mr:.5,fontSize:16}}),K()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:Ce(),color:"secondary",variant:"outlined",icon:e.jsx(ue,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:le(),color:"primary",variant:"outlined",icon:e.jsx(ve,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),(m||C)&&e.jsx(Y,{label:K(),color:"info",variant:"outlined",icon:e.jsx(pe,{fontSize:"small"}),sx:{fontSize:"0.8rem",fontWeight:500,py:.5,mt:1}})]})]}),e.jsx(se,{sx:{my:2}}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Structure"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Date Formation"})]})}),e.jsx(Be,{children:Q.length>0?Q.map((A,X)=>e.jsxs(Lo,{index:X,hover:!0,children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:X+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[A.PRENOM," ",A.NOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),A.MATRICULE,e.jsx(Y,{label:"F√©minin",size:"small",color:"secondary",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"body2",fontWeight:"500",children:A.FONCTION||"-"}),A.GRADE&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Grade: ",A.GRADE]})]})]})}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",children:A.Structure||"-"}),A.StructureAbbreviation&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["(",A.StructureAbbreviation,")"]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{children:A.DerniereSession?fe(A.DerniereSession):"-"})]})})]},X)):e.jsx(te,{children:e.jsxs(j,{colSpan:5,align:"center",sx:{py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucun personnel f√©minin trouv√© pour cette combinaison"})]})})})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:O,onClose:he,autoHideDuration:5e3,children:e.jsx(ko,{onClose:he,severity:v,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:v==="error"?"#ff0000":"background.paper",color:v==="error"?"#ffffff":"inherit"},children:e.jsx(r,{fontWeight:500,sx:{color:"inherit"},children:T})})})]})})},Wo=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),wo=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Hr=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),Uo=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(!1),[W,D]=o.useState(!1),[M,$]=o.useState(""),[_,Q]=o.useState("success"),V="",q=()=>{if(!n||!x)return null;const a=R=>R.toISOString().split("T")[0],S=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL ";return`
  SELECT 
    COUNT(DISTINCT ps.IDPERSONNEL) AS PersonnelsFormes,
    (SELECT COUNT(*) FROM personel) AS TotalPersonnels
  FROM 
    participer_session ps
  JOIN 
    sessionformation s ON ps.IDSESSION = s.IDSESSION
  JOIN 
    formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
  WHERE 
    s.DATE >= '${a(n)}' 
    AND s.DATE <= '${a(x)}'
    AND s.CONFIRME=1
    ${S};
`.trim()},H=async()=>{if(!n){O("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){O("Veuillez s√©lectionner une date de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();u(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${V}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data&&R.data.length>0){const b=R.data[0];m(b.PersonnelsFormes||0),C(b.TotalPersonnels||0),F(!0),O(`${b.PersonnelsFormes||0} personnels form√©s trouv√©s sur la p√©riode`,"success")}else m(0),C(0),F(!0),O("Aucun personnel form√© trouv√© sur cette p√©riode","info")}catch(R){O(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},O=(a,S)=>{$(a),Q(S),D(!0)},L=()=>{D(!1)},T=a=>a?a.toLocaleDateString("fr-FR"):"-",E=()=>y===0?0:(h/y*100).toFixed(1),v={chart:{type:"radialBar",height:350},colors:["#1976d2"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(a){return h+" / "+y}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Personnels Form√©s"],title:{text:`${E()}% du personnel total`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#1976d2"}}},i={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#1976d2","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(a){return a},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Personnel"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Personnel form√© vs Personnel total",align:"center"}},c=[{name:"Personnels Form√©s",data:[h]},{name:"Personnel Non Form√©",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(pe,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Nombre des Personnels Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse quantitative des formations par rapport au personnel total"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Hr,{label:"Date de d√©but",value:n,onChange:a=>l(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Hr,{label:"Date de fin",value:x,onChange:a=>p(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",T(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",T(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(wo,{onClick:H,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:z,onClose:()=>F(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(pe,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",T(n)," au ",T(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>F(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #1976d2",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#1976d2",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#1976d2",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnels Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnel Total"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:[E(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux de Formation"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Pourcentage du Personnel Form√©"}),y>0&&e.jsx(Re,{options:v,series:[parseFloat(E())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Visuelle"}),y>0&&e.jsx(Re,{options:i,series:c,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:T(n)})," au ",e.jsx("strong",{children:T(x)}),",",e.jsxs("strong",{children:[" ",h," personnels"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),", repr√©sentant ",e.jsxs("strong",{children:[E(),"%"]})," du personnel total de l'organisation (",y," personnes).",h===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune formation n'a √©t√© dispens√©e sur cette p√©riode."}),parseFloat(E())<50&&h>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Le taux de formation reste inf√©rieur √† 50% du personnel."}),parseFloat(E())>=50&&e.jsx("span",{style:{color:"#4caf50"},children:" Plus de la moiti√© du personnel a √©t√© form√© sur cette p√©riode."})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:L,autoHideDuration:5e3,children:e.jsx(Wo,{onClose:L,severity:_,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:M})})})]})})},Bo=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),$o=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Ho=({includePasserelles:t=!0})=>{const[n,l]=o.useState(ze().subtract(1,"month")),[x,p]=o.useState(ze()),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(!1),[W,D]=o.useState(!1),[M,$]=o.useState(""),[_,Q]=o.useState("success"),V="",q=()=>{if(!n||!x)return null;const a=n.format("YYYY-MM-DD"),S=x.format("YYYY-MM-DD");return`
      SELECT 
        COUNT(*) AS ParticipationsFormations,
        (SELECT COUNT(*) FROM personel) AS TotalPersonnels
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      WHERE 
        s.DATE >= '${a}' 
        AND s.DATE <= '${S}'
        AND s.CONFIRME=1
        ${t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL"};
    `.trim()},H=async()=>{if(!n){O("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){O("Veuillez s√©lectionner une date de fin","error");return}if(n.isAfter(x)){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();u(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${V}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data&&R.data.length>0){const b=R.data[0];m(b.ParticipationsFormations||0),C(b.TotalPersonnels||0),F(!0),O(`${b.ParticipationsFormations||0} participations trouv√©es sur la p√©riode`,"success")}else m(0),C(0),F(!0),O("Aucune participation √† une formation trouv√©e sur cette p√©riode","info")}catch(R){O(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},O=(a,S)=>{$(a),Q(S),D(!0)},L=()=>{D(!1)},T=a=>a?a.format("DD/MM/YYYY"):"-",E=()=>y===0?0:(h/y*100).toFixed(1),v={chart:{type:"radialBar",height:350},colors:["#1976d2"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:()=>`${h} / ${y}`}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Participations aux Formations"],title:{text:`${E()}% du personnel total (moyenne)`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#1976d2"}}},i={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#1976d2","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:a=>a,style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Personnel"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre"}},legend:{position:"top"},title:{text:"Participations vs Personnel total",align:"center"}},c=[{name:"Participations aux Formations",data:[h]},{name:"Personnel Total",data:[y]}];return e.jsx(Ae,{dateAdapter:er,adapterLocale:"fr",children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(pe,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Analyse des Participations aux Formations"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Comptabilise chaque participation √† une formation sur la p√©riode s√©lectionn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:a=>l(a),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:a=>p(a),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",T(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",T(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx($o,{onClick:H,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer les participations"})}),e.jsxs(Se,{open:z,onClose:()=>F(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(pe,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",T(n)," au ",T(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>F(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #1976d2",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#1976d2",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#1976d2",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Participations"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"(Nombre total de formations suivies)"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnel Total"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:[E(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Moyenne de formations/personne"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Moyenne de formations par personne"}),y>0&&e.jsx(Re,{options:v,series:[parseFloat(E())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Visuelle"}),y>0&&e.jsx(Re,{options:i,series:c,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:T(n)})," au ",e.jsx("strong",{children:T(x)}),", il y a eu ",e.jsxs("strong",{children:[h," participations"]})," √† des formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),", soit une moyenne de ",e.jsxs("strong",{children:[E(),"%"]})," du personnel total (",y," personnes).",h===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune formation n'a √©t√© dispens√©e sur cette p√©riode."}),parseFloat(E())<50&&h>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Le taux moyen de participation reste inf√©rieur √† 50%."}),parseFloat(E())>=50&&e.jsx("span",{style:{color:"#4caf50"},children:" En moyenne, plus de la moiti√© du personnel a particip√© √† des formations."})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:L,autoHideDuration:5e3,children:e.jsx(Bo,{onClose:L,severity:_,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:M})})})]})})},Yo=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),qo=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Vo=({includePasserelles:t=!0})=>{const[n,l]=o.useState(ze().subtract(1,"month")),[x,p]=o.useState(ze()),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(!1),[W,D]=o.useState(!1),[M,$]=o.useState(""),[_,Q]=o.useState("success"),V="",q=()=>{if(!n||!x)return null;const a=n.format("YYYY-MM-DD"),S=x.format("YYYY-MM-DD");return`
        SELECT 
          COUNT(DISTINCT p.IDPERSONNEL) AS ParticipationsFormations,
          (SELECT COUNT(*) FROM personel WHERE SERVICECENTRAL = 'Service Central') AS TotalPersonnels
        FROM 
          participer_session ps
        JOIN 
          sessionformation s ON ps.IDSESSION = s.IDSESSION
        JOIN 
          formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
        JOIN 
          personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
        WHERE 
          EXISTS (
            SELECT 1 FROM sessionformation s2 
            WHERE s2.IDFORMATION = fm.IDFORMATIONM 
            AND s2.DATE >= '${a}' 
            AND s2.DATE <= '${S}'
            AND s2.CONFIRME=1
          )
          AND p.SERVICECENTRAL = 'Service Central'
          ${t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL"};
`.trim()},H=async()=>{if(!n){O("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){O("Veuillez s√©lectionner une date de fin","error");return}if(n.isAfter(x)){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();u(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${V}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data&&R.data.length>0){const b=R.data[0];m(b.ParticipationsFormations||0),C(b.TotalPersonnels||0),F(!0),O(`${b.ParticipationsFormations||0} participations trouv√©es sur la p√©riode`,"success")}else m(0),C(0),F(!0),O("Aucune participation √† une formation trouv√©e sur cette p√©riode","info")}catch(R){O(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},O=(a,S)=>{$(a),Q(S),D(!0)},L=()=>{D(!1)},T=a=>a?a.format("DD/MM/YYYY"):"-",E=()=>y===0?0:(h/y*100).toFixed(1),v={chart:{type:"radialBar",height:350},colors:["#1976d2"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(a){return h+" / "+y}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Participations aux Formations"],title:{text:`${E()}% du personnel central (moyenne)`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#1976d2"}}},i={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#1976d2","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(a){return a},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Personnel Central"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre"}},legend:{position:"top"},title:{text:"Participations vs Personnel Central",align:"center"}},c=[{name:"Participations aux Formations",data:[h]},{name:"Personnel Total (Central)",data:[y]}];return e.jsx(Ae,{dateAdapter:er,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(pe,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Analyse des Participations aux Formations - Service Central"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Statistiques exclusivement pour le personnel du Service Central"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:a=>l(a),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:a=>p(a),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",T(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",T(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(qo,{onClick:H,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer les participations"})}),e.jsxs(Se,{open:z,onClose:()=>F(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(pe,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",T(n)," au ",T(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>F(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #1976d2",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#1976d2",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#1976d2",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Participations"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"(Nombre total de formations suivies)"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnel Total (Central)"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:[E(),"%"]})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion du personnel des services centraux form√©s"}),y>0&&e.jsx(Re,{options:v,series:[parseFloat(E())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:y>0&&e.jsx(Re,{options:i,series:c,type:"bar",height:300})})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:T(n)})," au ",e.jsx("strong",{children:T(x)}),", il y a eu ",e.jsxs("strong",{children:[h," participations"]})," √† des formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),", soit une moyenne de ",e.jsxs("strong",{children:[E(),"%"]})," du personnel central (",y," personnes) ayant particip√© √† au moins une formation.",h===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune formation n'a √©t√© dispens√©e sur cette p√©riode."}),parseFloat(E())<50&&h>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Le taux moyen de participation reste inf√©rieur √† 50%."}),parseFloat(E())>=50&&e.jsx("span",{style:{color:"#4caf50"},children:" En moyenne, plus de la moiti√© du personnel central a particip√© √† des formations."})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:L,autoHideDuration:5e3,children:e.jsx(Yo,{onClose:L,severity:_,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:M})})})]})})},Qo=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),_o=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Jo=({includePasserelles:t=!0})=>{const[n,l]=o.useState(ze().subtract(1,"month")),[x,p]=o.useState(ze()),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(!1),[W,D]=o.useState(!1),[M,$]=o.useState(""),[_,Q]=o.useState("success"),V="",q=()=>{if(!n||!x)return null;const a=n.format("YYYY-MM-DD"),S=x.format("YYYY-MM-DD");return`
      SELECT 
        COUNT(*) AS ParticipationsFormations,
        (SELECT COUNT(*) FROM personel WHERE SERVICECENTRAL = 'Service Central') AS TotalPersonnels
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
        (s.DATE >= '${a}' 
        AND s.DATE <= '${S}')
        AND s.CONFIRME=1       
        AND p.SERVICECENTRAL = 'Service Central'
        ${t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL"};
    `.trim()},H=async()=>{if(!n){O("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){O("Veuillez s√©lectionner une date de fin","error");return}if(n.isAfter(x)){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();u(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${V}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data&&R.data.length>0){const b=R.data[0];m(b.ParticipationsFormations||0),C(b.TotalPersonnels||0),F(!0),O(`${b.ParticipationsFormations||0} participations trouv√©es sur la p√©riode`,"success")}else m(0),C(0),F(!0),O("Aucune participation √† une formation trouv√©e sur cette p√©riode","info")}catch(R){O(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},O=(a,S)=>{$(a),Q(S),D(!0)},L=()=>{D(!1)},T=a=>a?a.format("DD/MM/YYYY"):"-",E=()=>y===0?0:(h/y*100).toFixed(1),v={chart:{type:"radialBar",height:350},colors:["#1976d2"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(a){return h+" / "+y}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Participations aux Formations"],title:{text:`${E()}% du personnel central (moyenne)`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#1976d2"}}},i={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#1976d2","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(a){return a},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Personnel Central"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre"}},legend:{position:"top"},title:{text:"Participations vs Personnel Central",align:"center"}},c=[{name:"Participations aux Formations",data:[h]},{name:"Personnel Total (Central)",data:[y]}];return e.jsx(Ae,{dateAdapter:er,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(pe,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Analyse des Participations aux Formations - Service Central"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Statistiques exclusivement pour le personnel du Service Central"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:a=>l(a),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:a=>p(a),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",T(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",T(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(_o,{onClick:H,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer les participations"})}),e.jsxs(Se,{open:z,onClose:()=>F(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(pe,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",T(n)," au ",T(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>F(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #1976d2",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#1976d2",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#1976d2",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Participations"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"(Nombre total de formations suivies)"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnel Total (Central)"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:[E(),"%"]})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion du personnel des services centraux form√©s"}),y>0&&e.jsx(Re,{options:v,series:[parseFloat(E())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:y>0&&e.jsx(Re,{options:i,series:c,type:"bar",height:300})})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:T(n)})," au ",e.jsx("strong",{children:T(x)}),", il y a eu ",e.jsxs("strong",{children:[h," participations"]})," √† des formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),", soit une moyenne de ",e.jsxs("strong",{children:[E(),"%"]})," du personnel central (",y," personnes) ayant particip√© √† au moins une formation.",h===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune formation n'a √©t√© dispens√©e sur cette p√©riode."}),parseFloat(E())<50&&h>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Le taux moyen de participation reste inf√©rieur √† 50%."}),parseFloat(E())>=50&&e.jsx("span",{style:{color:"#4caf50"},children:" En moyenne, plus de la moiti√© du personnel central a particip√© √† des formations."})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:L,autoHideDuration:5e3,children:e.jsx(Qo,{onClose:L,severity:_,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:M})})})]})})},Go=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Xo=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Yr=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),Zo=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(!1),[W,D]=o.useState(!1),[M,$]=o.useState(""),[_,Q]=o.useState("success"),V="",q=()=>{if(!n||!x)return null;const a=R=>R.toISOString().split("T")[0],S=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL ";return`
      SELECT 
        COUNT(DISTINCT p.IDPERSONNEL) AS ParticipationsFormations,
        (SELECT COUNT(*) FROM personel WHERE SERVICECENTRAL = 'Service Deconcentr√©') AS TotalPersonnels
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
        EXISTS (
          SELECT 1 FROM sessionformation s2 
          WHERE s2.IDFORMATION = fm.IDFORMATIONM 
          AND s2.DATE >= '${a(n)}' 
          AND s2.DATE <= '${a(x)}'
          AND s2.CONFIRME=1
        )
        AND p.SERVICECENTRAL = 'Service Deconcentr√©'       
        ${S};
    `.trim()},H=async()=>{if(!n){O("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){O("Veuillez s√©lectionner une date de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();u(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${V}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data&&R.data.length>0){const b=R.data[0];m(b.ParticipationsFormations||0),C(b.TotalPersonnels||0),F(!0);const k=t?" (avec passerelles)":" (sans passerelles)";O(`${b.ParticipationsFormations||0} participations trouv√©es sur la p√©riode${k}`,"success")}else m(0),C(0),F(!0),O(`Aucune participation √† une formation trouv√©e sur cette p√©riode${t?" (avec passerelles)":" (sans passerelles)"}`,"info")}catch(R){O(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},O=(a,S)=>{$(a),Q(S),D(!0)},L=()=>{D(!1)},T=a=>a?a.toLocaleDateString("fr-FR"):"-",E=()=>y===0?0:(h/y*100).toFixed(1),v={chart:{type:"radialBar",height:350},colors:["#1976d2"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(a){return h+" / "+y}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Participations aux Formations"],title:{text:`${E()}% du personnel d√©concentr√©`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#1976d2"}}},i={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#1976d2","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(a){return a},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Personnel D√©concentr√©"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre"}},legend:{position:"top"},title:{text:"Participations vs Personnel D√©concentr√©",align:"center"}},c=[{name:"Participations aux Formations",data:[h]},{name:"Personnel Total (D√©concentr√©)",data:[y]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(pe,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Analyse des Participations aux Formations - Services D√©concentr√©s"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Statistiques exclusivement pour le personnel des services d√©concentr√©s"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Yr,{label:"Date de d√©but",value:n,onChange:a=>l(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Yr,{label:"Date de fin",value:x,onChange:a=>p(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",T(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",T(x)]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mt:1,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,fontSize:16}}),"Filtre: ",t?"Avec formations passerelles":"Sans formations passerelles"]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Xo,{onClick:H,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer les participations"})}),e.jsxs(Se,{open:z,onClose:()=>F(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(pe,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",T(n)," au ",T(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>F(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #1976d2",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#1976d2",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#1976d2",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Participations"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"(Nombre total de formations suivies)"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnel Total (D√©concentr√©)"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:[E(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux de participation"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion du personnel des services d√©concentr√©s form√©s"}),y>0&&e.jsx(Re,{options:v,series:[parseFloat(E())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:y>0&&e.jsx(Re,{options:i,series:c,type:"bar",height:300})})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:T(n)})," au ",e.jsx("strong",{children:T(x)}),", il y a eu ",e.jsxs("strong",{children:[h," participations"]})," √† des formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),", soit une moyenne de ",e.jsxs("strong",{children:[E(),"%"]})," du personnel d√©concentr√© (",y," personnes) ayant particip√© √† au moins une formation.",h===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune formation n'a √©t√© dispens√©e sur cette p√©riode."}),parseFloat(E())<50&&h>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Le taux moyen de participation reste inf√©rieur √† 50%."}),parseFloat(E())>=50&&e.jsx("span",{style:{color:"#4caf50"},children:" En moyenne, plus de la moiti√© du personnel d√©concentr√© a particip√© √† des formations."})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:L,autoHideDuration:5e3,children:e.jsx(Go,{onClose:L,severity:_,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:M})})})]})})},Ko=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),en=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),qr=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),rn=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(!1),[W,D]=o.useState(!1),[M,$]=o.useState(""),[_,Q]=o.useState("success"),V="",q=()=>{if(!n||!x)return null;const a=R=>R.toISOString().split("T")[0],S=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL ";return`
      SELECT 
        COUNT(*) AS ParticipationsFormations,
        (SELECT COUNT(*) FROM personel WHERE SERVICECENTRAL = 'Service Deconcentr√©') AS TotalPersonnels
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE          
          (s.DATE >= '${a(n)}' 
          AND s.DATE <= '${a(x)}')        
        AND p.SERVICECENTRAL = 'Service Deconcentr√©'
        AND s.CONFIRME=1
        ${S};
    `.trim()},H=async()=>{if(!n){O("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){O("Veuillez s√©lectionner une date de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();u(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${V}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data&&R.data.length>0){const b=R.data[0];m(b.ParticipationsFormations||0),C(b.TotalPersonnels||0),F(!0);const k=t?" (avec passerelles)":" (sans passerelles)";O(`${b.ParticipationsFormations||0} participations trouv√©es sur la p√©riode${k}`,"success")}else m(0),C(0),F(!0),O(`Aucune participation √† une formation trouv√©e sur cette p√©riode${t?" (avec passerelles)":" (sans passerelles)"}`,"info")}catch(R){O(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},O=(a,S)=>{$(a),Q(S),D(!0)},L=()=>{D(!1)},T=a=>a?a.toLocaleDateString("fr-FR"):"-",E=()=>y===0?0:(h/y*100).toFixed(1),v={chart:{type:"radialBar",height:350},colors:["#1976d2"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(a){return h+" / "+y}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Participations aux Formations"],title:{text:`${E()}% du personnel d√©concentr√©`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#1976d2"}}},i={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#1976d2","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(a){return a},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Personnel D√©concentr√©"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre"}},legend:{position:"top"},title:{text:"Participations vs Personnel D√©concentr√©",align:"center"}},c=[{name:"Participations aux Formations",data:[h]},{name:"Personnel Total (D√©concentr√©)",data:[y]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(pe,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Analyse des Participations aux Formations - Services D√©concentr√©s"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Statistiques exclusivement pour le personnel des services d√©concentr√©s"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(qr,{label:"Date de d√©but",value:n,onChange:a=>l(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(qr,{label:"Date de fin",value:x,onChange:a=>p(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",T(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",T(x)]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mt:1,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,fontSize:16}}),"Filtre: ",t?"Avec formations passerelles":"Sans formations passerelles"]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(en,{onClick:H,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer les participations"})}),e.jsxs(Se,{open:z,onClose:()=>F(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(pe,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",T(n)," au ",T(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>F(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #1976d2",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#1976d2",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#1976d2",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Participations"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"(Nombre total de formations suivies)"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnel Total (D√©concentr√©)"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:[E(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux de participation"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion du personnel des services d√©concentr√©s form√©s"}),y>0&&e.jsx(Re,{options:v,series:[parseFloat(E())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:y>0&&e.jsx(Re,{options:i,series:c,type:"bar",height:300})})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:T(n)})," au ",e.jsx("strong",{children:T(x)}),", il y a eu ",e.jsxs("strong",{children:[h," participations"]})," √† des formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),", soit une moyenne de ",e.jsxs("strong",{children:[E(),"%"]})," du personnel d√©concentr√© (",y," personnes) ayant particip√© √† au moins une formation.",h===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune formation n'a √©t√© dispens√©e sur cette p√©riode."}),parseFloat(E())<50&&h>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Le taux moyen de participation reste inf√©rieur √† 50%."}),parseFloat(E())>=50&&e.jsx("span",{style:{color:"#4caf50"},children:" En moyenne, plus de la moiti√© du personnel d√©concentr√© a particip√© √† des formations."})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:L,autoHideDuration:5e3,children:e.jsx(Ko,{onClose:L,severity:_,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:M})})})]})})},tn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),sn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Vr=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),on=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(!1),[W,D]=o.useState(!1),[M,$]=o.useState(""),[_,Q]=o.useState("success"),V="",q=()=>{if(!n||!x)return null;const a=R=>R.toISOString().split("T")[0],S=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
      SELECT 
        COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' THEN p.IDPERSONNEL END) AS HommesFormes,
        COUNT(DISTINCT p.IDPERSONNEL) AS TotalPersonnelsFormes
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
        (s.DATE >= '${a(n)}' 
        AND s.DATE <= '${a(x)}')
        AND s.CONFIRME=1
        ${S};
    `.trim()},H=async()=>{if(!n){O("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){O("Veuillez s√©lectionner une date de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();u(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${V}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data&&R.data.length>0){const b=R.data[0];m(b.HommesFormes||0),C(b.TotalPersonnelsFormes||0),F(!0),O(`${b.HommesFormes||0} hommes form√©s trouv√©s sur la p√©riode`,"success")}else m(0),C(0),F(!0),O("Aucun homme form√© trouv√© sur cette p√©riode","info")}catch(R){O(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},O=(a,S)=>{$(a),Q(S),D(!0)},L=()=>{D(!1)},T=a=>a?a.toLocaleDateString("fr-FR"):"-",E=()=>y===0?0:(h/y*100).toFixed(1),v={chart:{type:"radialBar",height:350},colors:["#2196f3"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:()=>`${h} / ${y}`}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Hommes Form√©s"],title:{text:`${E()}% des personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#2196f3"}}},i={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#2196f3","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:a=>a,style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Personnels Form√©s"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Hommes form√©s vs Femmes form√©es",align:"center"}},c=[{name:"Hommes Form√©s",data:[h]},{name:"Femmes Form√©es",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Me,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Nombre d'Hommes Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse quantitative des formations masculines sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Vr,{label:"Date de d√©but",value:n,onChange:a=>l(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Vr,{label:"Date de fin",value:x,onChange:a=>p(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",T(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",T(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(sn,{onClick:H,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:z,onClose:()=>F(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Me,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",T(n)," au ",T(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>F(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#2196f3",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Hommes Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Personnels Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[E(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux de Formation Masculin"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion d'Hommes Form√©s parmi les Personnels"}),y>0&&e.jsx(Re,{options:v,series:[parseFloat(E())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Visuelle"}),y>0&&e.jsx(Re,{options:i,series:c,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:T(n)})," au ",e.jsx("strong",{children:T(x)}),",",e.jsxs("strong",{children:[" ",h," hommes"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),"sur un total de ",e.jsxs("strong",{children:[y," personnels form√©s"]}),", repr√©sentant ",e.jsxs("strong",{children:[E(),"%"]})," des personnels form√©s.",h===0&&y>0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucun homme n'a √©t√© form√© sur cette p√©riode."}),y===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune formation n'a √©t√© dispens√©e sur cette p√©riode."}),parseFloat(E())<50&&h>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Les hommes repr√©sentent moins de 50% des personnels form√©s."}),parseFloat(E())>=50&&e.jsx("span",{style:{color:"#4caf50"},children:" Les hommes repr√©sentent plus de la moiti√© des personnels form√©s."})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:L,autoHideDuration:5e3,children:e.jsx(tn,{onClose:L,severity:_,iconMapping:{success:e.jsx(Me,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:M})})})]})})},nn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),an=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Qr=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),ln=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(!1),[W,D]=o.useState(!1),[M,$]=o.useState(""),[_,Q]=o.useState("success"),V="",q=()=>{if(!n||!x)return null;const a=R=>R.toISOString().split("T")[0],S=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
      SELECT 
        COUNT(CASE WHEN p.SEXE = 'Masculin' THEN p.IDPERSONNEL END) AS HommesFormes,
        COUNT(p.IDPERSONNEL) AS TotalPersonnelsFormes
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
        (s.DATE >= '${a(n)}' 
          AND s.DATE <= '${a(x)}')
        AND s.CONFIRME=1
        ${S};
    `},H=async()=>{if(!n){O("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){O("Veuillez s√©lectionner une date de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();u(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${V}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data&&R.data.length>0){const b=R.data[0];m(b.HommesFormes||0),C(b.TotalPersonnelsFormes||0),F(!0),O(`${b.HommesFormes||0} hommes form√©s trouv√©s sur la p√©riode`,"success")}else m(0),C(0),F(!0),O("Aucun homme form√© trouv√© sur cette p√©riode","info")}catch(R){O(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},O=(a,S)=>{$(a),Q(S),D(!0)},L=()=>{D(!1)},T=a=>a?a.toLocaleDateString("fr-FR"):"-",E=()=>y===0?0:(h/y*100).toFixed(1),v={chart:{type:"radialBar",height:350},colors:["#2196f3"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:()=>`${h} / ${y}`}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Hommes Form√©s"],title:{text:`${E()}% des personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#2196f3"}}},i={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#2196f3","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:a=>a,style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Personnels Form√©s"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Hommes form√©s vs Femmes form√©es",align:"center"}},c=[{name:"Hommes Form√©s",data:[h]},{name:"Femmes Form√©es",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Me,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Nombre d'Hommes Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse quantitative des formations masculines sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Qr,{label:"Date de d√©but",value:n,onChange:a=>l(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Qr,{label:"Date de fin",value:x,onChange:a=>p(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",T(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",T(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(an,{onClick:H,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:z,onClose:()=>F(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Me,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",T(n)," au ",T(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>F(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#2196f3",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Hommes Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Personnels Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[E(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux de Formation Masculin"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion d'Hommes Form√©s parmi les Personnels"}),y>0&&e.jsx(Re,{options:v,series:[parseFloat(E())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Visuelle"}),y>0&&e.jsx(Re,{options:i,series:c,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:T(n)})," au ",e.jsx("strong",{children:T(x)}),",",e.jsxs("strong",{children:[" ",h," hommes"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),"sur un total de ",e.jsxs("strong",{children:[y," personnels form√©s"]}),", repr√©sentant ",e.jsxs("strong",{children:[E(),"%"]})," des personnels form√©s.",h===0&&y>0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucun homme n'a √©t√© form√© sur cette p√©riode."}),y===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune formation n'a √©t√© dispens√©e sur cette p√©riode."}),parseFloat(E())<50&&h>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Les hommes repr√©sentent moins de 50% des personnels form√©s."}),parseFloat(E())>=50&&e.jsx("span",{style:{color:"#4caf50"},children:" Les hommes repr√©sentent plus de la moiti√© des personnels form√©s."})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:L,autoHideDuration:5e3,children:e.jsx(nn,{onClose:L,severity:_,iconMapping:{success:e.jsx(Me,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:M})})})]})})},cn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),dn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),_r=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),xn=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(!1),[W,D]=o.useState(!1),[M,$]=o.useState(""),[_,Q]=o.useState("success"),V="",q=()=>{if(!n||!x)return null;const a=R=>R.toISOString().split("T")[0],S=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
  SELECT 
    COUNT(DISTINCT CASE WHEN p.SEXE = 'F√©minin' THEN p.IDPERSONNEL END) AS FemmesFormees,
    COUNT(DISTINCT p.IDPERSONNEL) AS TotalPersonnelsFormes
  FROM 
    participer_session ps
  JOIN 
    sessionformation s ON ps.IDSESSION = s.IDSESSION
  JOIN 
    formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
  JOIN 
    personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
  WHERE 
    s.DATE >= '${a(n)}' 
    AND s.DATE <= '${a(x)}'
    AND s.CONFIRME=1
    ${S};
`.trim()},H=async()=>{if(!n){O("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){O("Veuillez s√©lectionner une date de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();u(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${V}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data&&R.data.length>0){const b=R.data[0];m(b.FemmesFormees||0),C(b.TotalPersonnelsFormes||0),F(!0),O(`${b.FemmesFormees||0} femmes form√©es trouv√©es sur la p√©riode`,"success")}else m(0),C(0),F(!0),O("Aucune femme form√©e trouv√©e sur cette p√©riode","info")}catch(R){O(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},O=(a,S)=>{$(a),Q(S),D(!0)},L=()=>{D(!1)},T=a=>a?a.toLocaleDateString("fr-FR"):"-",E=()=>y===0?0:(h/y*100).toFixed(1),v={chart:{type:"radialBar",height:350},colors:["#e91e63"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(a){return h+" / "+y}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Femmes Form√©es"],title:{text:`${E()}% de personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#e91e63"}}},i={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#e91e63","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(a){return a},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Personnels Form√©s"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Femmes form√©es vs Hommes form√©s",align:"center"}},c=[{name:"Femmes Form√©es",data:[h]},{name:"Hommes Form√©s",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(We,{sx:{fontSize:36,mr:2,color:"#e91e63"}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#e91e63"},children:"Nombre de Femmes Form√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse quantitative des formations f√©minines sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse "})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(_r,{label:"Date de d√©but",value:n,onChange:a=>l(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(_r,{label:"Date de fin",value:x,onChange:a=>p(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fce4ec",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",T(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",T(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(dn,{onClick:H,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:z,onClose:()=>F(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(We,{sx:{mr:1.5,fontSize:28,color:"#e91e63"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",T(n)," au ",T(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>F(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fce4ec",borderLeft:"4px solid #e91e63",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#e91e63",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#e91e63",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Femmes Form√©es"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Personnels Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[E(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux de Formation F√©minin"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion de Femmes Form√©es parmi les Personnels"}),y>0&&e.jsx(Re,{options:v,series:[parseFloat(E())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Visuelle"}),y>0&&e.jsx(Re,{options:i,series:c,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:T(n)})," au ",e.jsx("strong",{children:T(x)}),",",e.jsxs("strong",{children:[" ",h," femmes"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles - condition: TYPEFORMATIONPASSERELLE IS NULL)"}),"sur un total de ",e.jsxs("strong",{children:[y," personnels form√©s"]}),", repr√©sentant ",e.jsxs("strong",{children:[E(),"%"]})," des personnels form√©s sur cette p√©riode.",h===0&&y>0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune femme n'a √©t√© form√©e sur cette p√©riode."}),y===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune formation n'a √©t√© dispens√©e sur cette p√©riode."}),parseFloat(E())<50&&h>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Les femmes repr√©sentent moins de 50% des personnels form√©s."}),parseFloat(E())>=50&&e.jsx("span",{style:{color:"#4caf50"},children:" Les femmes repr√©sentent plus de la moiti√© des personnels form√©s."})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:L,autoHideDuration:5e3,children:e.jsx(cn,{onClose:L,severity:_,iconMapping:{success:e.jsx(We,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:M})})})]})})},un=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),fn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Jr=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),mn=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(!1),[W,D]=o.useState(!1),[M,$]=o.useState(""),[_,Q]=o.useState("success"),V="",q=()=>{if(!n||!x)return null;const a=R=>R.toISOString().split("T")[0],S=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
  SELECT 
    COUNT(CASE WHEN p.SEXE = 'F√©minin' THEN p.IDPERSONNEL END) AS FemmesFormees,
    COUNT(p.IDPERSONNEL) AS TotalPersonnelsFormes
  FROM 
    participer_session ps
  JOIN 
    sessionformation s ON ps.IDSESSION = s.IDSESSION
  JOIN 
    formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
  JOIN 
    personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
  WHERE 
   s.IDFORMATION = fm.IDFORMATIONM 
      AND s.DATE >= '${a(n)}' 
      AND s.DATE <= '${a(x)}'
      AND s.CONFIRME=1
    ${S};
`},H=async()=>{if(!n){O("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){O("Veuillez s√©lectionner une date de fin","error");return}if(n>x){O("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const a=q();u(!0);const S=localStorage.getItem("token");try{const R=await ae.post(`${V}/personnaliserrequette`,{query:a},{headers:{Authorization:`Bearer ${S}`}});if(R.data&&R.data.length>0){const b=R.data[0];m(b.FemmesFormees||0),C(b.TotalPersonnelsFormes||0),F(!0),O(`${b.FemmesFormees||0} femmes form√©es trouv√©es sur la p√©riode`,"success")}else m(0),C(0),F(!0),O("Aucune femme form√©e trouv√©e sur cette p√©riode","info")}catch(R){O(R.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},O=(a,S)=>{$(a),Q(S),D(!0)},L=()=>{D(!1)},T=a=>a?a.toLocaleDateString("fr-FR"):"-",E=()=>y===0?0:(h/y*100).toFixed(1),v={chart:{type:"radialBar",height:350},colors:["#e91e63"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(a){return h+" / "+y}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Femmes Form√©es"],title:{text:`${E()}% de personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#e91e63"}}},i={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#e91e63","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(a){return a},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Personnels Form√©s"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Femmes form√©es vs Hommes form√©s",align:"center"}},c=[{name:"Femmes Form√©es",data:[h]},{name:"Hommes Form√©s",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(We,{sx:{fontSize:36,mr:2,color:"#e91e63"}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#e91e63"},children:"Nombre de Femmes Form√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse quantitative des formations f√©minines sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse "})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Jr,{label:"Date de d√©but",value:n,onChange:a=>l(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Jr,{label:"Date de fin",value:x,onChange:a=>p(a),renderInput:a=>e.jsx(ee,{...a,fullWidth:!0,InputProps:{...a.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fce4ec",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",T(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",T(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(fn,{onClick:H,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:z,onClose:()=>F(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(We,{sx:{mr:1.5,fontSize:28,color:"#e91e63"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",T(n)," au ",T(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>F(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fce4ec",borderLeft:"4px solid #e91e63",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#e91e63",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#e91e63",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Femmes Form√©es"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Personnels Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[E(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux de Formation F√©minin"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion de Femmes Form√©es parmi les Personnels"}),y>0&&e.jsx(Re,{options:v,series:[parseFloat(E())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Visuelle"}),y>0&&e.jsx(Re,{options:i,series:c,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:T(n)})," au ",e.jsx("strong",{children:T(x)}),",",e.jsxs("strong",{children:[" ",h," femmes"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles - condition: TYPEFORMATIONPASSERELLE IS NULL)"}),"sur un total de ",e.jsxs("strong",{children:[y," personnels form√©s"]}),", repr√©sentant ",e.jsxs("strong",{children:[E(),"%"]})," des personnels form√©s sur cette p√©riode.",h===0&&y>0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune femme n'a √©t√© form√©e sur cette p√©riode."}),y===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucune formation n'a √©t√© dispens√©e sur cette p√©riode."}),parseFloat(E())<50&&h>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Les femmes repr√©sentent moins de 50% des personnels form√©s."}),parseFloat(E())>=50&&e.jsx("span",{style:{color:"#4caf50"},children:" Les femmes repr√©sentent plus de la moiti√© des personnels form√©s."})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:L,autoHideDuration:5e3,children:e.jsx(un,{onClose:L,severity:_,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:M})})})]})})},hn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),pn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),bn=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(0),[W,D]=o.useState(!1),[M,$]=o.useState(!1),[_,Q]=o.useState(""),[V,q]=o.useState("success"),H="",O=k=>{if(!k)return null;const w=k.getFullYear(),I=String(k.getMonth()+1).padStart(2,"0"),N=String(k.getDate()).padStart(2,"0");return`${w}-${I}-${N}`},L=()=>{const k=O(n),w=O(x);return!k||!w?null:`
        SELECT 
          COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' AND p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS HommesServicesCentrauxFormes,
          COUNT(DISTINCT CASE WHEN p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesCentrauxFormes,
          COUNT(DISTINCT p.IDPERSONNEL) AS TotalPersonnelsFormes
        FROM 
          participer_session ps
        JOIN 
          sessionformation s ON ps.IDSESSION = s.IDSESSION
        JOIN 
          formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
        JOIN 
          personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
        WHERE 
          EXISTS (
            SELECT 1 FROM sessionformation s2 
            WHERE s2.IDFORMATION = fm.IDFORMATIONM 
            AND s2.DATE >= '${k}' 
            AND s2.DATE <= '${w}'
            AND s2.CONFIRME=1
          )
          ${t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL"};
      `.trim()},T=async()=>{if(!n){E("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){E("Veuillez s√©lectionner une date de fin","error");return}if(n>x){E("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const k=L();u(!0);const w=localStorage.getItem("token");try{const I=await ae.post(`${H}/personnaliserrequette`,{query:k},{headers:{Authorization:`Bearer ${w}`}});if(I.data&&I.data.length>0){const N=I.data[0];m(N.HommesServicesCentrauxFormes||0),C(N.TotalPersonnelsServicesCentrauxFormes||0),F(N.TotalPersonnelsFormes||0),D(!0),E(`${N.HommesServicesCentrauxFormes||0} hommes des services centraux form√©s trouv√©s`,"success")}else m(0),C(0),F(0),D(!0),E("Aucun homme des services centraux form√© trouv√© sur cette p√©riode","info")}catch(I){E(I.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},E=(k,w)=>{Q(k),q(w),$(!0)},v=()=>{$(!1)},i=k=>k?new Date(k).toLocaleDateString("fr-FR"):"-",c=()=>y===0?0:(h/y*100).toFixed(1),a=()=>z===0?0:(h/z*100).toFixed(1),S={chart:{type:"radialBar",height:350},colors:["#1976d2"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:()=>`${h} / ${z}`}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Hommes Services Centraux"],title:{text:`${a()}% de personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#1976d2"}}},R={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#1976d2","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:k=>k,style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["R√©partition des Form√©s"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Hommes vs Femmes (Services Centraux)",align:"center"}},b=[{name:"Hommes Services Centraux",data:[h]},{name:"Femmes Services Centraux",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(Me,{color:"primary",sx:{fontSize:28,mr:1}}),e.jsx(ue,{color:"primary",sx:{fontSize:32}})]}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Hommes des Services Centraux Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des formations masculines dans les services centraux sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:k=>l(k),renderInput:k=>e.jsx(ee,{...k,fullWidth:!0,InputProps:{...k.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:k=>p(k),minDate:n,renderInput:k=>e.jsx(ee,{...k,fullWidth:!0,InputProps:{...k.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",i(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",i(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(pn,{onClick:T,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:W,onClose:()=>D(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Me,{sx:{mr:1,fontSize:24,color:"primary.main"}}),e.jsx(ue,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",i(n)," au ",i(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>D(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(Me,{sx:{fontSize:32,color:"#2196f3",mr:1}}),e.jsx(ue,{sx:{fontSize:36,color:"#2196f3"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Hommes Services Centraux Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(lr,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnels service centraux Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[c(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux dans Services Centraux"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:[a(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Global (vs Total Form√©s)"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center",fontWeight:"bold",color:"black"},children:"Proportion d'Hommes Form√©s des Services Centraux"}),z>0&&e.jsx(Re,{options:S,series:[parseFloat(a())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Hommes vs Femmes (Centraux)"}),y>0&&e.jsx(Re,{options:R,series:b,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:i(n)})," au ",e.jsx("strong",{children:i(x)}),",",e.jsxs("strong",{children:[" ",h," hommes des services centraux"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),".",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Ils repr√©sentent ",e.jsxs("strong",{children:[c(),"%"]})," des ",e.jsxs("strong",{children:[y," personnels des services centraux form√©s"]}),".",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux global :"})," Ces hommes repr√©sentent ",e.jsxs("strong",{children:[a(),"%"]})," de l'ensemble des ",e.jsxs("strong",{children:[z," personnels form√©s"]}),".",h===0&&y>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun homme des services centraux n'a √©t√© form√©."})]}),y===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun personnel des services centraux n'a √©t√© form√©."})]}),parseFloat(a())>=25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{style:{color:"#4caf50"},children:["üìä Part importante (",a(),"%) du total des form√©s."]})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:M,onClose:v,autoHideDuration:5e3,children:e.jsx(hn,{onClose:v,severity:V,iconMapping:{success:e.jsx(ue,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:_})})})]})})},gn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),jn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Sn=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(0),[W,D]=o.useState(!1),[M,$]=o.useState(!1),[_,Q]=o.useState(""),[V,q]=o.useState("success"),H="",O=k=>{if(!k)return null;const w=k.getFullYear(),I=String(k.getMonth()+1).padStart(2,"0"),N=String(k.getDate()).padStart(2,"0");return`${w}-${I}-${N}`},L=()=>{const k=O(n),w=O(x);return!k||!w?null:`
      SELECT 
        COUNT(CASE WHEN p.SEXE = 'Masculin' AND p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS HommesServicesCentrauxFormes,
        COUNT(CASE WHEN p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesCentrauxFormes,
        COUNT(p.IDPERSONNEL) AS TotalPersonnelsFormes
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
       s.IDFORMATION = fm.IDFORMATIONM 
          AND s.DATE >= '${k}' 
          AND s.DATE <= '${w}'
          AND s.CONFIRME=1
        ${t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL"};
    `.trim()},T=async()=>{if(!n){E("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){E("Veuillez s√©lectionner une date de fin","error");return}if(n>x){E("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const k=L();u(!0);const w=localStorage.getItem("token");try{const I=await ae.post(`${H}/personnaliserrequette`,{query:k},{headers:{Authorization:`Bearer ${w}`}});if(I.data&&I.data.length>0){const N=I.data[0];m(N.HommesServicesCentrauxFormes||0),C(N.TotalPersonnelsServicesCentrauxFormes||0),F(N.TotalPersonnelsFormes||0),D(!0),E(`${N.HommesServicesCentrauxFormes||0} hommes des services centraux form√©s trouv√©s`,"success")}else m(0),C(0),F(0),D(!0),E("Aucun homme des services centraux form√© trouv√© sur cette p√©riode","info")}catch(I){E(I.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},E=(k,w)=>{Q(k),q(w),$(!0)},v=()=>{$(!1)},i=k=>k?new Date(k).toLocaleDateString("fr-FR"):"-",c=()=>y===0?0:(h/y*100).toFixed(1),a=()=>z===0?0:(h/z*100).toFixed(1),S={chart:{type:"radialBar",height:350},colors:["#1976d2"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:()=>`${h} / ${z}`}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Hommes Services Centraux"],title:{text:`${a()}% de personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#1976d2"}}},R={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#1976d2","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:k=>k,style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["R√©partition des Form√©s"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Hommes vs Femmes (Services Centraux)",align:"center"}},b=[{name:"Hommes Services Centraux",data:[h]},{name:"Femmes Services Centraux",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(Me,{color:"primary",sx:{fontSize:28,mr:1}}),e.jsx(ue,{color:"primary",sx:{fontSize:32}})]}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Hommes des Services Centraux Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des formations masculines dans les services centraux sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:k=>l(k),renderInput:k=>e.jsx(ee,{...k,fullWidth:!0,InputProps:{...k.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:k=>p(k),minDate:n,renderInput:k=>e.jsx(ee,{...k,fullWidth:!0,InputProps:{...k.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",i(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",i(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(jn,{onClick:T,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:W,onClose:()=>D(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Me,{sx:{mr:1,fontSize:24,color:"primary.main"}}),e.jsx(ue,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",i(n)," au ",i(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>D(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(Me,{sx:{fontSize:32,color:"#2196f3",mr:1}}),e.jsx(ue,{sx:{fontSize:36,color:"#2196f3"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Hommes Services Centraux Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(lr,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnels service centraux Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[c(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux dans Services Centraux"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:[a(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Global (vs Total Form√©s)"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center",fontWeight:"bold",color:"black"},children:"Proportion d'Hommes Form√©s des Services Centraux"}),z>0&&e.jsx(Re,{options:S,series:[parseFloat(a())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Hommes vs Femmes (Centraux)"}),y>0&&e.jsx(Re,{options:R,series:b,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:i(n)})," au ",e.jsx("strong",{children:i(x)}),",",e.jsxs("strong",{children:[" ",h," hommes des services centraux"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),".",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Ils repr√©sentent ",e.jsxs("strong",{children:[c(),"%"]})," des ",e.jsxs("strong",{children:[y," personnels des services centraux form√©s"]}),".",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux global :"})," Ces hommes repr√©sentent ",e.jsxs("strong",{children:[a(),"%"]})," de l'ensemble des ",e.jsxs("strong",{children:[z," personnels form√©s"]}),".",h===0&&y>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun homme des services centraux n'a √©t√© form√©."})]}),y===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun personnel des services centraux n'a √©t√© form√©."})]}),parseFloat(a())>=25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{style:{color:"#4caf50"},children:["üìä Part importante (",a(),"%) du total des form√©s."]})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:M,onClose:v,autoHideDuration:5e3,children:e.jsx(gn,{onClose:v,severity:V,iconMapping:{success:e.jsx(ue,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:_})})})]})})},yn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),En=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 192, 203, 0.47), rgba(255, 192, 203, 0))",color:"#e91e63",border:"2px solid #e91e63",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(255, 192, 203, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 192, 203, 0.7), rgba(255, 192, 203, 0))",transform:"translateY(-2px)"}})),Gr=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),In=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(0),[W,D]=o.useState(!1),[M,$]=o.useState(!1),[_,Q]=o.useState(""),[V,q]=o.useState("success"),H="",O=()=>{if(!n||!x)return null;const b=w=>w.toISOString().split("T")[0],k=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
  SELECT 
    COUNT(DISTINCT CASE WHEN p.SEXE = 'F√©minin' AND p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS FemmesServicesCentrauxFormees,
    COUNT(DISTINCT CASE WHEN p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesCentrauxFormes,
    COUNT(DISTINCT p.IDPERSONNEL) AS TotalPersonnelsFormes
  FROM 
    participer_session ps
  JOIN 
    sessionformation s ON ps.IDSESSION = s.IDSESSION
  JOIN 
    formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
  JOIN 
    personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
  WHERE 
    EXISTS (
      SELECT 1 FROM sessionformation s2 
      WHERE s2.IDFORMATION = fm.IDFORMATIONM 
      AND s2.DATE >= '${b(n)}' 
      AND s2.DATE <= '${b(x)}'
      AND s2.CONFIRME=1
    )
    ${k};
`.trim()},L=async()=>{if(!n){T("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){T("Veuillez s√©lectionner une date de fin","error");return}if(n>x){T("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const b=O();u(!0);const k=localStorage.getItem("token");try{const w=await ae.post(`${H}/personnaliserrequette`,{query:b},{headers:{Authorization:`Bearer ${k}`}});if(w.data&&w.data.length>0){const I=w.data[0];m(I.FemmesServicesCentrauxFormees||0),C(I.TotalPersonnelsServicesCentrauxFormes||0),F(I.TotalPersonnelsFormes||0),D(!0),T(`${I.FemmesServicesCentrauxFormees||0} femmes des services centraux form√©es trouv√©es`,"success")}else m(0),C(0),F(0),D(!0),T("Aucune femme des services centraux form√©e trouv√©e sur cette p√©riode","info")}catch(w){T(w.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},T=(b,k)=>{Q(b),q(k),$(!0)},E=()=>{$(!1)},v=b=>b?b.toLocaleDateString("fr-FR"):"-",i=()=>y===0?0:(h/y*100).toFixed(1),c=()=>z===0?0:(h/z*100).toFixed(1),a={chart:{type:"radialBar",height:350},colors:["#e91e63"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:()=>`${h} / ${z}`}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Femmes Services Centraux"],title:{text:`${c()}% du total des personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#e91e63"}}},S={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#e91e63","#f8bbd9"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:b=>b,style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["R√©partition des Form√©s"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Femmes vs Hommes (Services Centraux)",align:"center"}},R=[{name:"Femmes Services Centraux",data:[h]},{name:"Hommes Services Centraux",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(We,{sx:{color:"#e91e63",fontSize:28,mr:1}}),e.jsx(ue,{sx:{color:"#e91e63",fontSize:32}})]}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#e91e63"},children:"Femmes des Services Centraux Form√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des formations f√©minines dans les services centraux sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Gr,{label:"Date de d√©but",value:n,onChange:b=>l(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Gr,{label:"Date de fin",value:x,onChange:b=>p(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fce4ec",borderRadius:2,border:"1px solid #f8bbd9"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",v(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",v(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(En,{onClick:L,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:W,onClose:()=>D(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"white",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #f8bbd9"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(We,{sx:{mr:1,fontSize:24,color:"#e91e63"}}),e.jsx(ue,{sx:{mr:1.5,fontSize:28,color:"#e91e63"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",v(n)," au ",v(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>D(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fce4ec",borderLeft:"4px solid #e91e63",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(We,{sx:{fontSize:32,color:"#e91e63",mr:1}}),e.jsx(ue,{sx:{fontSize:36,color:"#e91e63"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#e91e63",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Femmes Services Centraux Form√©es"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(lr,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Services Centraux Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[i(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux dans Services Centraux"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:[c(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Global (vs Total Form√©s)"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion de Femmes Form√©es des Services Centraux"}),z>0&&e.jsx(Re,{options:a,series:[parseFloat(c())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Femmes vs Hommes (Centraux)"}),y>0&&e.jsx(Re,{options:S,series:R,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#fce4ec",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:v(n)})," au ",e.jsx("strong",{children:v(x)}),",",e.jsxs("strong",{children:[" ",h," femmes des services centraux"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),".",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Elles repr√©sentent ",e.jsxs("strong",{children:[i(),"%"]})," des ",e.jsxs("strong",{children:[y," personnels des services centraux form√©s"]}),".",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux global :"})," Ces femmes repr√©sentent ",e.jsxs("strong",{children:[c(),"%"]})," de l'ensemble des ",e.jsxs("strong",{children:[z," personnels form√©s"]}),".",h===0&&y>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucune femme des services centraux n'a √©t√© form√©e."})]}),y===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun personnel des services centraux n'a √©t√© form√©."})]}),parseFloat(c())>=25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{style:{color:"#4caf50"},children:["üìä Part importante (",c(),"%) du total des form√©s."]})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:M,onClose:E,autoHideDuration:5e3,children:e.jsx(yn,{onClose:E,severity:V,iconMapping:{success:e.jsx(ue,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:_})})})]})})},Nn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),vn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 192, 203, 0.47), rgba(255, 192, 203, 0))",color:"#e91e63",border:"2px solid #e91e63",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(255, 192, 203, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 192, 203, 0.7), rgba(255, 192, 203, 0))",transform:"translateY(-2px)"}})),Xr=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),On=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(0),[W,D]=o.useState(!1),[M,$]=o.useState(!1),[_,Q]=o.useState(""),[V,q]=o.useState("success"),H="",O=()=>{if(!n||!x)return null;const b=w=>w.toISOString().split("T")[0],k=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
      SELECT 
        COUNT( CASE WHEN p.SEXE = 'F√©minin' AND p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS FemmesServicesCentrauxFormees,
        COUNT( CASE WHEN p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesCentrauxFormes,
        COUNT( p.IDPERSONNEL) AS TotalPersonnelsFormes
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
          s.CONFIRME=1
          AND s.DATE >= '${b(n)}' 
          AND s.DATE <= '${b(x)}'
        
        ${k};
    `.trim()},L=async()=>{if(!n){T("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){T("Veuillez s√©lectionner une date de fin","error");return}if(n>x){T("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const b=O();u(!0);const k=localStorage.getItem("token");try{const w=await ae.post(`${H}/personnaliserrequette`,{query:b},{headers:{Authorization:`Bearer ${k}`}});if(w.data&&w.data.length>0){const I=w.data[0];m(I.FemmesServicesCentrauxFormees||0),C(I.TotalPersonnelsServicesCentrauxFormes||0),F(I.TotalPersonnelsFormes||0),D(!0),T(`${I.FemmesServicesCentrauxFormees||0} femmes des services centraux form√©es trouv√©es`,"success")}else m(0),C(0),F(0),D(!0),T("Aucune femme des services centraux form√©e trouv√©e sur cette p√©riode","info")}catch(w){T(w.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},T=(b,k)=>{Q(b),q(k),$(!0)},E=()=>{$(!1)},v=b=>b?b.toLocaleDateString("fr-FR"):"-",i=()=>y===0?0:(h/y*100).toFixed(1),c=()=>z===0?0:(h/z*100).toFixed(1),a={chart:{type:"radialBar",height:350},colors:["#e91e63"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:()=>`${h} / ${z}`}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Femmes Services Centraux"],title:{text:`${c()}% du total des personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#e91e63"}}},S={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#e91e63","#f8bbd9"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:b=>b,style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["R√©partition des Form√©s"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Femmes vs Hommes (Services Centraux)",align:"center"}},R=[{name:"Femmes Services Centraux",data:[h]},{name:"Hommes Services Centraux",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(We,{sx:{color:"#e91e63",fontSize:28,mr:1}}),e.jsx(ue,{sx:{color:"#e91e63",fontSize:32}})]}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#e91e63"},children:"Femmes des Services Centraux Form√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des formations f√©minines dans les services centraux sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Xr,{label:"Date de d√©but",value:n,onChange:b=>l(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Xr,{label:"Date de fin",value:x,onChange:b=>p(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fce4ec",borderRadius:2,border:"1px solid #f8bbd9"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",v(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",v(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(vn,{onClick:L,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:W,onClose:()=>D(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"white",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #f8bbd9"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(We,{sx:{mr:1,fontSize:24,color:"#e91e63"}}),e.jsx(ue,{sx:{mr:1.5,fontSize:28,color:"#e91e63"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",v(n)," au ",v(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>D(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fce4ec",borderLeft:"4px solid #e91e63",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(We,{sx:{fontSize:32,color:"#e91e63",mr:1}}),e.jsx(ue,{sx:{fontSize:36,color:"#e91e63"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#e91e63",children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Femmes Services Centraux Form√©es"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(lr,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Services Centraux Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[i(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux dans Services Centraux"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:[c(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Global (vs Total Form√©s)"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion de Femmes Form√©es des Services Centraux"}),z>0&&e.jsx(Re,{options:a,series:[parseFloat(c())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Femmes vs Hommes (Centraux)"}),y>0&&e.jsx(Re,{options:S,series:R,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#fce4ec",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:v(n)})," au ",e.jsx("strong",{children:v(x)}),",",e.jsxs("strong",{children:[" ",h," femmes des services centraux"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),".",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Elles repr√©sentent ",e.jsxs("strong",{children:[i(),"%"]})," des ",e.jsxs("strong",{children:[y," personnels des services centraux form√©s"]}),".",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux global :"})," Ces femmes repr√©sentent ",e.jsxs("strong",{children:[c(),"%"]})," de l'ensemble des ",e.jsxs("strong",{children:[z," personnels form√©s"]}),".",h===0&&y>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucune femme des services centraux n'a √©t√© form√©e."})]}),y===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun personnel des services centraux n'a √©t√© form√©."})]}),parseFloat(c())>=25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{style:{color:"#4caf50"},children:["üìä Part importante (",c(),"%) du total des form√©s."]})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:M,onClose:E,autoHideDuration:5e3,children:e.jsx(Nn,{onClose:E,severity:V,iconMapping:{success:e.jsx(ue,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:_})})})]})})},Tn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Rn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 193, 7, 0.47), rgba(255, 193, 7, 0))",color:"#f57c00",border:"2px solid #f57c00",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(255, 193, 7, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 193, 7, 0.7), rgba(255, 193, 7, 0))",transform:"translateY(-2px)"}})),Zr=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),An=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(0),[W,D]=o.useState(!1),[M,$]=o.useState(!1),[_,Q]=o.useState(""),[V,q]=o.useState("success"),H="",O=()=>{if(!n||!x)return null;const b=w=>w.toISOString().split("T")[0],k=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
    SELECT 
      COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' AND p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS HommesServicesDeconcentresFormes,
      COUNT(DISTINCT CASE WHEN p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesDeconcentresFormes,
      COUNT(DISTINCT p.IDPERSONNEL) AS TotalPersonnelsFormes
    FROM 
      participer_session ps
    JOIN 
      sessionformation s ON ps.IDSESSION = s.IDSESSION
    JOIN 
      formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
    JOIN 
      personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
    WHERE 
      EXISTS (
        SELECT 1 FROM sessionformation s2 
        WHERE s2.IDFORMATION = fm.IDFORMATIONM 
        AND s2.DATE >= '${b(n)}' 
        AND s2.DATE <= '${b(x)}'
        AND s2.CONFIRME=1
      )
      ${k};
  `.trim()},L=async()=>{if(!n){T("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){T("Veuillez s√©lectionner une date de fin","error");return}if(n>x){T("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const b=O();u(!0);const k=localStorage.getItem("token");try{const w=await ae.post(`${H}/personnaliserrequette`,{query:b},{headers:{Authorization:`Bearer ${k}`}});if(w.data&&w.data.length>0){const I=w.data[0];m(I.HommesServicesDeconcentresFormes||0),C(I.TotalPersonnelsServicesDeconcentresFormes||0),F(I.TotalPersonnelsFormes||0),D(!0),T(`${I.HommesServicesDeconcentresFormes||0} hommes des services d√©concentr√©s form√©s trouv√©s`,"success")}else m(0),C(0),F(0),D(!0),T("Aucun homme des services d√©concentr√©s form√© trouv√© sur cette p√©riode","info")}catch(w){T(w.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},T=(b,k)=>{Q(b),q(k),$(!0)},E=()=>{$(!1)},v=b=>b?b.toLocaleDateString("fr-FR"):"-",i=()=>y===0?0:(h/y*100).toFixed(1),c=()=>z===0?0:(h/z*100).toFixed(1),a={chart:{type:"radialBar",height:350},colors:["#f57c00"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:()=>`${h} / ${z}`}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Hommes Services D√©concentr√©s"],title:{text:`${c()}% de personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#f57c00"}}},S={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#f57c00","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:b=>b,style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["R√©partition des Form√©s"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Hommes vs Femmes (Services D√©concentr√©s)",align:"center"}},R=[{name:"Hommes Services D√©concentr√©s",data:[h]},{name:"Femmes Services D√©concentr√©s",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(Me,{sx:{color:"#f57c00",fontSize:28,mr:1}}),e.jsx(Ye,{sx:{color:"#f57c00",fontSize:32}})]}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#f57c00"},children:"Hommes des Services D√©concentr√©s Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des formations masculines dans les services d√©concentr√©s sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Zr,{label:"Date de d√©but",value:n,onChange:b=>l(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Zr,{label:"Date de fin",value:x,onChange:b=>p(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fff8e1",borderRadius:2,border:"1px solid #ffcc02"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#f57c00"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",v(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",v(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Rn,{onClick:L,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:W,onClose:()=>D(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Me,{sx:{mr:1,fontSize:24,color:"#f57c00"}}),e.jsx(Ye,{sx:{mr:1.5,fontSize:28,color:"#f57c00"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",v(n)," au ",v(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>D(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fff8e1",borderLeft:"4px solid #f57c00",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(Me,{sx:{fontSize:32,color:"#f57c00",mr:1}}),e.jsx(Ye,{sx:{fontSize:36,color:"#f57c00"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",sx:{color:"#f57c00"},children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Hommes Services D√©concentr√©s Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ar,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Services D√©concentr√©s Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#2196f3",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:[i(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux form√©s Services D√©concentr√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:[c(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Global (vs Total Form√©s)"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion d'Hommes Form√©s des Services D√©concentr√©s"}),z>0&&e.jsx(Re,{options:a,series:[parseFloat(c())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Hommes vs Femmes (D√©concentr√©s)"}),y>0&&e.jsx(Re,{options:S,series:R,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#f57c00"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:v(n)})," au ",e.jsx("strong",{children:v(x)}),",",e.jsxs("strong",{children:[" ",h," hommes des services d√©concentr√©s"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),".",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Ils repr√©sentent ",e.jsxs("strong",{children:[i(),"%"]})," des ",e.jsxs("strong",{children:[y," personnels des services d√©concentr√©s form√©s"]}),".",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux global :"})," Ces hommes repr√©sentent ",e.jsxs("strong",{children:[c(),"%"]})," de l'ensemble des ",e.jsxs("strong",{children:[z," personnels form√©s"]}),".",h===0&&y>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun homme des services d√©concentr√©s n'a √©t√© form√©."})]}),y===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun personnel des services d√©concentr√©s n'a √©t√© form√©."})]}),parseFloat(c())>=25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{style:{color:"#4caf50"},children:["üìä Part importante (",c(),"%) du total des form√©s."]})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:M,onClose:E,autoHideDuration:5e3,children:e.jsx(Tn,{onClose:E,severity:V,iconMapping:{success:e.jsx(Ye,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:_})})})]})})},Cn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Dn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 193, 7, 0.47), rgba(255, 193, 7, 0))",color:"#f57c00",border:"2px solid #f57c00",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(255, 193, 7, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 193, 7, 0.7), rgba(255, 193, 7, 0))",transform:"translateY(-2px)"}})),Kr=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),Fn=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(0),[W,D]=o.useState(!1),[M,$]=o.useState(!1),[_,Q]=o.useState(""),[V,q]=o.useState("success"),H="",O=()=>{if(!n||!x)return null;const b=w=>w.toISOString().split("T")[0],k=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
      SELECT 
        COUNT(CASE WHEN p.SEXE = 'Masculin' AND p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS HommesServicesDeconcentresFormes,
        COUNT(CASE WHEN p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesDeconcentresFormes,
        COUNT(p.IDPERSONNEL) AS TotalPersonnelsFormes
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
          (s.DATE >= '${b(n)}' 
          AND s.DATE <= '${b(x)}')
          AND s.CONFIRME=1
        ${k};
    `.trim()},L=async()=>{if(!n){T("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){T("Veuillez s√©lectionner une date de fin","error");return}if(n>x){T("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const b=O();u(!0);const k=localStorage.getItem("token");try{const w=await ae.post(`${H}/personnaliserrequette`,{query:b},{headers:{Authorization:`Bearer ${k}`}});if(w.data&&w.data.length>0){const I=w.data[0];m(I.HommesServicesDeconcentresFormes||0),C(I.TotalPersonnelsServicesDeconcentresFormes||0),F(I.TotalPersonnelsFormes||0),D(!0),T(`${I.HommesServicesDeconcentresFormes||0} hommes des services d√©concentr√©s form√©s trouv√©s`,"success")}else m(0),C(0),F(0),D(!0),T("Aucun homme des services d√©concentr√©s form√© trouv√© sur cette p√©riode","info")}catch(w){T(w.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},T=(b,k)=>{Q(b),q(k),$(!0)},E=()=>{$(!1)},v=b=>b?b.toLocaleDateString("fr-FR"):"-",i=()=>y===0?0:(h/y*100).toFixed(1),c=()=>z===0?0:(h/z*100).toFixed(1),a={chart:{type:"radialBar",height:350},colors:["#f57c00"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:()=>`${h} / ${z}`}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Hommes Services D√©concentr√©s"],title:{text:`${c()}% d'hommes form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#f57c00"}}},S={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#f57c00","#e0e0e0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:b=>b,style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["R√©partition des Form√©s"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Hommes vs Femmes (Services D√©concentr√©s)",align:"center"}},R=[{name:"Hommes Services D√©concentr√©s",data:[h]},{name:"Femmes Services D√©concentr√©s",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(Me,{sx:{color:"#f57c00",fontSize:28,mr:1}}),e.jsx(Ye,{sx:{color:"#f57c00",fontSize:32}})]}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#f57c00"},children:"Hommes des Services D√©concentr√©s Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des formations masculines dans les services d√©concentr√©s sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Kr,{label:"Date de d√©but",value:n,onChange:b=>l(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Kr,{label:"Date de fin",value:x,onChange:b=>p(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fff8e1",borderRadius:2,border:"1px solid #ffcc02"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#f57c00"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",v(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",v(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Dn,{onClick:L,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:W,onClose:()=>D(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Me,{sx:{mr:1,fontSize:24,color:"#f57c00"}}),e.jsx(Ye,{sx:{mr:1.5,fontSize:28,color:"#f57c00"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",v(n)," au ",v(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>D(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fff8e1",borderLeft:"4px solid #f57c00",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(Me,{sx:{fontSize:32,color:"#f57c00",mr:1}}),e.jsx(Ye,{sx:{fontSize:36,color:"#f57c00"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",sx:{color:"#f57c00"},children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Hommes Services D√©concentr√©s Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ar,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Services D√©concentr√©s Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#2196f3",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:[i(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux dans Services D√©concentr√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:[c(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Global (vs Total Form√©s)"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion d'Hommes Form√©s des Services D√©concentr√©s"}),z>0&&e.jsx(Re,{options:a,series:[parseFloat(c())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Hommes vs Femmes (D√©concentr√©s)"}),y>0&&e.jsx(Re,{options:S,series:R,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#f57c00"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:v(n)})," au ",e.jsx("strong",{children:v(x)}),",",e.jsxs("strong",{children:[" ",h," hommes des services d√©concentr√©s"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles)"}),".",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Ils repr√©sentent ",e.jsxs("strong",{children:[i(),"%"]})," des ",e.jsxs("strong",{children:[y," personnels des services d√©concentr√©s form√©s"]}),".",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux global :"})," Ces hommes repr√©sentent ",e.jsxs("strong",{children:[c(),"%"]})," de l'ensemble des ",e.jsxs("strong",{children:[z," personnels form√©s"]}),".",h===0&&y>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun homme des services d√©concentr√©s n'a √©t√© form√©."})]}),y===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun personnel des services d√©concentr√©s n'a √©t√© form√©."})]}),parseFloat(c())>=25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{style:{color:"#4caf50"},children:["üìä Part importante (",c(),"%) du total des form√©s."]})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:M,onClose:E,autoHideDuration:5e3,children:e.jsx(Cn,{onClose:E,severity:V,iconMapping:{success:e.jsx(Ye,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:_})})})]})})},zn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),kn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(30, 101, 233, 0.47), rgba(233, 30, 99, 0))",color:"#100f3cff",border:"2px solid rgb(91, 30, 233)",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(34, 24, 27, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(30, 71, 233, 0.7), rgba(233, 30, 99, 0))",transform:"translateY(-2px)"}})),et=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),Pn=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(0),[W,D]=o.useState(!1),[M,$]=o.useState(!1),[_,Q]=o.useState(""),[V,q]=o.useState("success"),H="",O=()=>{if(!n||!x)return null;const b=w=>w.toISOString().split("T")[0],k=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
      SELECT 
        COUNT(DISTINCT CASE WHEN p.SEXE = 'F√©minin' AND p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS FemmesServicesDeconcentresFormees,
        COUNT(DISTINCT CASE WHEN p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesDeconcentresFormes,
        COUNT(DISTINCT p.IDPERSONNEL) AS TotalPersonnelsFormes
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
        EXISTS (
          SELECT 1 FROM sessionformation s2 
          WHERE s2.IDFORMATION = fm.IDFORMATIONM 
          AND s2.DATE >= '${b(n)}' 
          AND s2.DATE <= '${b(x)}'
          AND s2.CONFIRME=1
        )
        ${k};
    `.trim()},L=async()=>{if(!n){T("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){T("Veuillez s√©lectionner une date de fin","error");return}if(n>x){T("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const b=O();u(!0);const k=localStorage.getItem("token");try{const w=await ae.post(`${H}/personnaliserrequette`,{query:b},{headers:{Authorization:`Bearer ${k}`}});if(w.data&&w.data.length>0){const I=w.data[0];m(I.FemmesServicesDeconcentresFormees||0),C(I.TotalPersonnelsServicesDeconcentresFormes||0),F(I.TotalPersonnelsFormes||0),D(!0),T(`${I.FemmesServicesDeconcentresFormees||0} femmes des services d√©concentr√©s form√©es trouv√©es`,"success")}else m(0),C(0),F(0),D(!0),T("Aucune femme des services d√©concentr√©s form√©e trouv√©e sur cette p√©riode","info")}catch(w){T(w.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},T=(b,k)=>{Q(b),q(k),$(!0)},E=()=>{$(!1)},v=b=>b?b.toLocaleDateString("fr-FR"):"-",i=()=>y===0?0:(h/y*100).toFixed(1),c=()=>z===0?0:(h/z*100).toFixed(1),a={chart:{type:"radialBar",height:350},colors:["#e91e63"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(b){return h+" / "+z}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Femmes Services D√©concentr√©s"],title:{text:`${c()}% de personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#e91e63"}}},S={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#e91e63","#e0e0e0","#4caf50"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(b){return b},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["R√©partition des Form√©es"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"R√©partition des Personnels Form√©s",align:"center"}},R=[{name:"Femmes Services D√©concentr√©s",data:[h]},{name:"Hommes Services D√©concentr√©s",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(We,{sx:{color:"#e91e63",fontSize:28,mr:1}}),e.jsx(Ye,{sx:{color:"#4e1e2eff",fontSize:32}})]}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#1e51e9ff"},children:"Femmes des Services D√©concentr√©s Form√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des formations f√©minines dans les services d√©concentr√©s sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse (condition: TYPEFORMATIONPASSERELLE IS NULL)"})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(et,{label:"Date de d√©but",value:n,onChange:b=>l(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(et,{label:"Date de fin",value:x,onChange:b=>p(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fce4ec",borderRadius:2,border:"1px solid #f8bbd9"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",v(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",v(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(kn,{onClick:L,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:W,onClose:()=>D(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(We,{sx:{mr:1,fontSize:24,color:"#e91e63"}}),e.jsx(Ye,{sx:{mr:1.5,fontSize:28,color:"#e91e63"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",v(n)," au ",v(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>D(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fce4ec",borderLeft:"4px solid #e91e63",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(We,{sx:{fontSize:32,color:"#e91e63",mr:1}}),e.jsx(Ye,{sx:{fontSize:36,color:"#e91e63"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",sx:{color:"#e91e63"},children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Femmes Services D√©concentr√©s Form√©es"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ar,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Services D√©concentr√©s Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#2196f3",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:[i(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux dans Services D√©concentr√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:[c(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Global (vs Total Form√©s)"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion de Femmes Form√©es des Services D√©concentr√©s"}),z>0&&e.jsx(Re,{options:a,series:[parseFloat(c())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:z>0&&e.jsx(Re,{options:S,series:R,type:"bar",height:300})})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:v(n)})," au ",e.jsx("strong",{children:v(x)}),",",e.jsxs("strong",{children:[" ",h," femmes des services d√©concentr√©s"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles - condition: TYPEFORMATIONPASSERELLE IS NULL)"}),".",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Elles repr√©sentent ",e.jsxs("strong",{children:[i(),"%"]})," des ",e.jsxs("strong",{children:[y," personnels des services d√©concentr√©s form√©s"]}),".",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux global :"})," Ces femmes des services d√©concentr√©s repr√©sentent ",e.jsxs("strong",{children:[c(),"%"]})," de l'ensemble des ",e.jsxs("strong",{children:[z," personnels form√©s"]})," sur cette p√©riode.",e.jsx("br",{}),h===0&&y>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucune femme des services d√©concentr√©s n'a √©t√© form√©e sur cette p√©riode."})]}),y===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun personnel des services d√©concentr√©s n'a √©t√© form√© sur cette p√©riode."})]}),parseFloat(c())<10&&h>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#ff9800"},children:"üìä Les femmes des services d√©concentr√©s repr√©sentent moins de 10% du total des personnels form√©s."})]}),parseFloat(c())>=10&&parseFloat(c())<25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{style:{color:"#2196f3"},children:["üìä Les femmes des services d√©concentr√©s repr√©sentent une part mod√©r√©e (",c(),"%) du total des personnels form√©s."]})]}),parseFloat(c())>=25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{style:{color:"#4caf50"},children:["üìä Les femmes des services d√©concentr√©s repr√©sentent une part importante (",c(),"%) du total des personnels form√©s."]})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:M,onClose:E,autoHideDuration:5e3,children:e.jsx(zn,{onClose:E,severity:V,iconMapping:{success:e.jsx(Ye,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:_})})})]})})},Ln=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Mn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(30, 101, 233, 0.47), rgba(233, 30, 99, 0))",color:"#100f3cff",border:"2px solid rgb(91, 30, 233)",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(34, 24, 27, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(30, 71, 233, 0.7), rgba(233, 30, 99, 0))",transform:"translateY(-2px)"}})),rt=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover fieldset":{borderColor:t.palette.primary.main},"&.Mui-focused fieldset":{borderColor:t.palette.primary.main}}})),Wn=({includePasserelles:t=!0})=>{const[n,l]=o.useState(new Date),[x,p]=o.useState(new Date),[P,u]=o.useState(!1),[h,m]=o.useState(0),[y,C]=o.useState(0),[z,F]=o.useState(0),[W,D]=o.useState(!1),[M,$]=o.useState(!1),[_,Q]=o.useState(""),[V,q]=o.useState("success"),H="",O=()=>{if(!n||!x)return null;const b=w=>w.toISOString().split("T")[0],k=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
      SELECT 
        COUNT(CASE WHEN p.SEXE = 'F√©minin' AND p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS FemmesServicesDeconcentresFormees,
        COUNT(CASE WHEN p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesDeconcentresFormes,
        COUNT(p.IDPERSONNEL) AS TotalPersonnelsFormes
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
          s.CONFIRME=1
          AND s.DATE >= '${b(n)}' 
          AND s.DATE <= '${b(x)}'
        
        ${k};
    `.trim()},L=async()=>{if(!n){T("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){T("Veuillez s√©lectionner une date de fin","error");return}if(n>x){T("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const b=O();u(!0);const k=localStorage.getItem("token");try{const w=await ae.post(`${H}/personnaliserrequette`,{query:b},{headers:{Authorization:`Bearer ${k}`}});if(w.data&&w.data.length>0){const I=w.data[0];m(I.FemmesServicesDeconcentresFormees||0),C(I.TotalPersonnelsServicesDeconcentresFormes||0),F(I.TotalPersonnelsFormes||0),D(!0),T(`${I.FemmesServicesDeconcentresFormees||0} femmes des services d√©concentr√©s form√©es trouv√©es`,"success")}else m(0),C(0),F(0),D(!0),T("Aucune femme des services d√©concentr√©s form√©e trouv√©e sur cette p√©riode","info")}catch(w){T(w.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},T=(b,k)=>{Q(b),q(k),$(!0)},E=()=>{$(!1)},v=b=>b?b.toLocaleDateString("fr-FR"):"-",i=()=>y===0?0:(h/y*100).toFixed(1),c=()=>z===0?0:(h/z*100).toFixed(1),a={chart:{type:"radialBar",height:350},colors:["#e91e63"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(b){return h+" / "+z}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Femmes Services D√©concentr√©s"],title:{text:`${c()}% de personnels form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#e91e63"}}},S={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#e91e63","#e0e0e0","#4caf50"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(b){return b},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["R√©partition des Form√©es"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"R√©partition des Personnels Form√©s",align:"center"}},R=[{name:"Femmes Services D√©concentr√©s",data:[h]},{name:"Hommes Services D√©concentr√©s",data:[y-h]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(We,{sx:{color:"#e91e63",fontSize:28,mr:1}}),e.jsx(Ye,{sx:{color:"#4e1e2eff",fontSize:32}})]}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#1e51e9ff"},children:"Femmes des Services D√©concentr√©s Form√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des formations f√©minines dans les services d√©concentr√©s sur une p√©riode donn√©e"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse (condition: TYPEFORMATIONPASSERELLE IS NULL)"})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(rt,{label:"Date de d√©but",value:n,onChange:b=>l(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(rt,{label:"Date de fin",value:x,onChange:b=>p(b),renderInput:b=>e.jsx(ee,{...b,fullWidth:!0,InputProps:{...b.InputProps,startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}})})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fce4ec",borderRadius:2,border:"1px solid #f8bbd9"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",v(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",v(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Mn,{onClick:L,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:W,onClose:()=>D(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(We,{sx:{mr:1,fontSize:24,color:"#e91e63"}}),e.jsx(Ye,{sx:{mr:1.5,fontSize:28,color:"#e91e63"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",v(n)," au ",v(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>D(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fce4ec",borderLeft:"4px solid #e91e63",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(We,{sx:{fontSize:32,color:"#e91e63",mr:1}}),e.jsx(Ye,{sx:{fontSize:36,color:"#e91e63"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",sx:{color:"#e91e63"},children:h}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Femmes Services D√©concentr√©s Form√©es"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ar,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:y}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Services D√©concentr√©s Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#2196f3",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:[i(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux dans Services D√©concentr√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:[c(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Global (vs Total Form√©s)"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion de Femmes Form√©es des Services D√©concentr√©s"}),z>0&&e.jsx(Re,{options:a,series:[parseFloat(c())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:z>0&&e.jsx(Re,{options:S,series:R,type:"bar",height:300})})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#e91e63"}}),"R√©sum√© de l'analyse ",!t&&"(sans formations passerelles)"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:v(n)})," au ",e.jsx("strong",{children:v(x)}),",",e.jsxs("strong",{children:[" ",h," femmes des services d√©concentr√©s"]})," ont b√©n√©fici√© de formations",!t&&e.jsx("strong",{children:" (hors formations passerelles - condition: TYPEFORMATIONPASSERELLE IS NULL)"}),".",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Elles repr√©sentent ",e.jsxs("strong",{children:[i(),"%"]})," des ",e.jsxs("strong",{children:[y," personnels des services d√©concentr√©s form√©s"]}),".",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux global :"})," Ces femmes des services d√©concentr√©s repr√©sentent ",e.jsxs("strong",{children:[c(),"%"]})," de l'ensemble des ",e.jsxs("strong",{children:[z," personnels form√©s"]})," sur cette p√©riode.",e.jsx("br",{}),h===0&&y>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucune femme des services d√©concentr√©s n'a √©t√© form√©e sur cette p√©riode."})]}),y===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun personnel des services d√©concentr√©s n'a √©t√© form√© sur cette p√©riode."})]}),parseFloat(c())<10&&h>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#ff9800"},children:"üìä Les femmes des services d√©concentr√©s repr√©sentent moins de 10% du total des personnels form√©s."})]}),parseFloat(c())>=10&&parseFloat(c())<25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{style:{color:"#2196f3"},children:["üìä Les femmes des services d√©concentr√©s repr√©sentent une part mod√©r√©e (",c(),"%) du total des personnels form√©s."]})]}),parseFloat(c())>=25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs("span",{style:{color:"#4caf50"},children:["üìä Les femmes des services d√©concentr√©s repr√©sentent une part importante (",c(),"%) du total des personnels form√©s."]})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:M,onClose:E,autoHideDuration:5e3,children:e.jsx(Ln,{onClose:E,severity:V,iconMapping:{success:e.jsx(Ye,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:_})})})]})})},wn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Un=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(33, 150, 243, 0.47), rgba(33, 150, 243, 0))",color:"#2196f3",border:"2px solid #2196f3",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(33, 150, 243, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(33, 150, 243, 0.7), rgba(33, 150, 243, 0))",transform:"translateY(-2px)"}})),Bn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 165, 0, 0.2), rgba(255, 165, 0, 0))",color:"orange",border:"2px solid orange",borderRadius:"20px",fontSize:"1rem",padding:t.spacing(1,3),boxShadow:"inset 0 2px 5px rgba(255, 165, 0, 0.3)",transition:"background-color 0.3s, transform 0.3s",height:"5vh",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 165, 0, 0.3), rgba(255, 165, 0, 0))",transform:"translateY(-2px)"}})),$n=()=>{const t=()=>{const fe=new Date;return new Date(fe.getFullYear(),fe.getMonth(),1)},n=()=>new Date,[l,x]=o.useState(t()),[p,P]=o.useState(n()),[u,h]=o.useState({debut:!1,fin:!1}),[m,y]=o.useState(!1),[C,z]=o.useState(0),[F,W]=o.useState(0),[D,M]=o.useState(0),[$,_]=o.useState(!1),[Q,V]=o.useState(!1),[q,H]=o.useState(""),[O,L]=o.useState("success"),T="",E=fe=>{if(!fe)return null;const Ce=fe.getFullYear(),le=String(fe.getMonth()+1).padStart(2,"0"),K=String(fe.getDate()).padStart(2,"0");return`${Ce}-${le}-${K}`},v=()=>{const fe={debut:!1,fin:!1};return l||(fe.debut=!0),p||(fe.fin=!0),l&&p&&l>p&&(fe.fin=!0),h(fe),!fe.debut&&!fe.fin},i=()=>{x(t()),P(n()),h({debut:!1,fin:!1}),S("Dates r√©initialis√©es","info")},c=()=>{if(!l||!p)return null;const fe=E(l),Ce=E(p);return`
      SELECT 
        COUNT(DISTINCT p.IDPERSONNEL) AS TotalPersonnels,
        COUNT(DISTINCT CASE WHEN ps.IDPERSONNEL IS NOT NULL THEN p.IDPERSONNEL END) AS PersonnelsFormes,
        COUNT(DISTINCT CASE WHEN ps.IDPERSONNEL IS NULL THEN p.IDPERSONNEL END) AS PersonnelsNonFormes
      FROM 
        personel p
      LEFT JOIN 
        participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
      LEFT JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      LEFT JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM 
        AND (s.DATE >= '${fe}' AND s.DATE <= '${Ce}') OR s.CONFIRME<>1
      WHERE 
        p.IDPERSONNEL IS NOT NULL;
    `},a=async()=>{if(!v()){S("Veuillez v√©rifier les dates s√©lectionn√©es","error");return}const fe=c();y(!0);const Ce=localStorage.getItem("token");try{const le=await ae.post(`${T}/personnaliserrequette`,{query:fe},{headers:{Authorization:`Bearer ${Ce}`}});if(le.data&&le.data.length>0){const K=le.data[0];W(K.TotalPersonnels||0),M(K.PersonnelsFormes||0),z(K.PersonnelsNonFormes||0),_(!0),S(`${K.PersonnelsNonFormes||0} personnels non form√©s trouv√©s`,"success")}else W(0),M(0),z(0),_(!0),S("Aucune donn√©e trouv√©e pour cette p√©riode","info")}catch(le){S(le.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{y(!1)}},S=(fe,Ce)=>{H(fe),L(Ce),V(!0)},R=()=>{V(!1)},b=fe=>fe?new Date(fe).toLocaleDateString("fr-FR"):"-",k=()=>l&&p?`du ${b(l)} au ${b(p)}`:"P√©riode non d√©finie",w=()=>F===0?0:(C/F*100).toFixed(1),I=()=>F===0?0:(D/F*100).toFixed(1),N={chart:{type:"radialBar",height:350},colors:["#f44336"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(fe){return C+" / "+F}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Personnels Non Form√©s"],title:{text:`${w()}% du personnel`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#f44336"}}},f={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#f44336","#4caf50"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(fe){return fe},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Statut Formation"],title:{text:"Comparaison"}},yaxis:{title:{text:"Nombre de personnels"}},legend:{position:"top"},title:{text:"R√©partition des Personnels par Statut de Formation",align:"center"}},g=[{name:"Non Form√©s",data:[C]},{name:"Form√©s",data:[D]}],B={chart:{type:"pie",height:300},colors:["#f44336","#4caf50"],labels:["Non Form√©s","Form√©s"],legend:{position:"bottom"},dataLabels:{enabled:!0,formatter:function(fe,Ce){return Ce.w.config.series[Ce.seriesIndex]+`
(`+fe.toFixed(1)+"%)"}},title:{text:"R√©partition en Pourcentage",align:"center",style:{fontSize:"16px",fontWeight:"bold"}},responsive:[{breakpoint:480,options:{chart:{width:200},legend:{position:"bottom"}}}]},he=[C,D];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(Je,{sx:{color:"#2196f3",fontSize:32,mr:1}}),e.jsx(Ke,{sx:{color:"#2196f3",fontSize:28}})]}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#2196f3"},children:"Personnels Non Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des personnels n'ayant b√©n√©fici√© d'aucune formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:l,onChange:fe=>{x(fe),h(Ce=>({...Ce,debut:!1}))},onError:fe=>h(Ce=>({...Ce,debut:!!fe})),format:"dd/MM/yyyy",slotProps:{textField:{error:u.debut,helperText:u.debut?"Date invalide":"",fullWidth:!0,variant:"outlined",InputProps:{startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:p,onChange:fe=>{P(fe),h(Ce=>({...Ce,fin:!1}))},onError:fe=>h(Ce=>({...Ce,fin:!!fe})),minDate:l,format:"dd/MM/yyyy",slotProps:{textField:{error:u.fin,helperText:u.fin?"Date doit √™tre apr√®s la date de d√©but":"",fullWidth:!0,variant:"outlined",InputProps:{startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}}}})})]}),(l||p)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#e3f2fd",borderRadius:2,border:"1px solid #bbdefb"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#2196f3"}}),"Crit√®res de recherche:"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode d'absence de formation: ",k()]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mt:.5},children:"‚Ä¢ Analyse de tous les personnels"})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"center",gap:2,mt:4},children:[e.jsx(Bn,{onClick:i,startIcon:e.jsx(Fr,{}),children:"R√©initialiser"}),e.jsx(Un,{onClick:a,startIcon:m?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:m||!l||!p,children:m?"Analyse...":"Calculer le nombre"})]}),e.jsxs(Se,{open:$,onClose:()=>_(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Je,{sx:{mr:1,fontSize:30,color:"warning.main"}}),e.jsx(Ke,{sx:{mr:1.5,fontSize:30,color:"warning.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"R√©sultats - Personnels Non Form√©s"})]}),e.jsx(s,{children:e.jsx(de,{onClick:()=>_(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})})]}),e.jsxs(ye,{sx:{py:3,bgcolor:"#fafafa"},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#ffebee",borderLeft:"4px solid #f44336",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(Je,{sx:{fontSize:36,color:"#f44336",mr:1}}),e.jsx(Ke,{sx:{fontSize:32,color:"#f44336"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",sx:{color:"#f44336"},children:C}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnels Non Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:D}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnels Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#2196f3",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:F}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Personnels"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(hr,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[w(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Non Form√©s"})]})})})]}),e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"warning.main"}}),C," personnel",C>1?"s":""," non form√©",C>1?"s":""]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse globale de tous les personnels"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode: ",e.jsx("strong",{children:k()})]})]}),e.jsx(Y,{icon:e.jsx(pe,{fontSize:"small"}),label:k(),color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32}})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px",bgcolor:"white"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion des Personnels Non Form√©s"}),F>0&&e.jsx(Re,{options:N,series:[parseFloat(w())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px",bgcolor:"white"},children:F>0&&e.jsx(Re,{options:B,series:he,type:"pie",height:300})})})]}),e.jsx(d,{container:!0,spacing:3,sx:{mt:2},children:e.jsx(d,{item:!0,xs:12,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,bgcolor:"white"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Form√©s vs Non Form√©s"}),F>0&&e.jsx(Re,{options:f,series:g,type:"bar",height:300})]})})}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode ",e.jsx("strong",{children:k()}),",",e.jsxs("strong",{children:[" ",C," personnels"]})," n'ont b√©n√©fici√© d'aucune formation.",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux de non-formation :"})," ",e.jsxs("strong",{children:[w(),"%"]})," des personnels n'ont pas √©t√© form√©s.",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux de formation :"})," ",e.jsxs("strong",{children:[I(),"%"]})," des personnels ont √©t√© form√©s (",D," personnes).",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Total des personnels :"})," ",e.jsx("strong",{children:F})," personnels au total.",e.jsx("br",{}),parseFloat(w())>50&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Plus de la moiti√© des personnels n'ont pas √©t√© form√©s sur cette p√©riode."})]}),parseFloat(w())>75&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"üö® Alerte : Plus de 75% des personnels n'ont pas √©t√© form√©s !"})]}),parseFloat(w())<25&&C>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#4caf50"},children:"‚úÖ Bon taux de formation : moins de 25% des personnels n'ont pas √©t√© form√©s."})]}),C===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#4caf50"},children:"üéâ Excellent ! Tous les personnels ont √©t√© form√©s sur cette p√©riode."})]}),F===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#ff9800"},children:"‚ö†Ô∏è Aucun personnel enregistr√© dans le syst√®me."})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:Q,onClose:R,autoHideDuration:5e3,children:e.jsx(wn,{onClose:R,severity:O,iconMapping:{success:e.jsx(Je,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:q})})})]})})},Hn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Yn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(156, 39, 176, 0.47), rgba(156, 39, 176, 0))",color:"#9c27b0",border:"2px solid #9c27b0",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(156, 39, 176, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(156, 39, 176, 0.7), rgba(156, 39, 176, 0))",transform:"translateY(-2px)"}})),qn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 165, 0, 0.2), rgba(255, 165, 0, 0))",color:"orange",border:"2px solid orange",borderRadius:"20px",fontSize:"1rem",padding:t.spacing(1,3),boxShadow:"inset 0 2px 5px rgba(255, 165, 0, 0.3)",transition:"background-color 0.3s, transform 0.3s",height:"5vh",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 165, 0, 0.3), rgba(255, 165, 0, 0))",transform:"translateY(-2px)"}})),Vn=()=>{const t=()=>{const f=new Date;return new Date(f.getFullYear(),f.getMonth(),1)},n=()=>new Date,[l,x]=o.useState(t()),[p,P]=o.useState(n()),[u,h]=o.useState({debut:!1,fin:!1}),[m,y]=o.useState(!1),[C,z]=o.useState(0),[F,W]=o.useState(0),[D,M]=o.useState(!1),[$,_]=o.useState(!1),[Q,V]=o.useState(""),[q,H]=o.useState("success"),O="",L=f=>{if(!f)return null;const g=f.getFullYear(),B=String(f.getMonth()+1).padStart(2,"0"),he=String(f.getDate()).padStart(2,"0");return`${g}-${B}-${he}`},T=()=>{const f={debut:!1,fin:!1};return l||(f.debut=!0),p||(f.fin=!0),l&&p&&l>p&&(f.fin=!0),h(f),!f.debut&&!f.fin},E=()=>{x(t()),P(n()),h({debut:!1,fin:!1}),c("Dates r√©initialis√©es","info")},v=()=>{if(!l||!p)return null;const f=L(l),g=L(p);return`
      SELECT 
        (SELECT COUNT(*) FROM personel WHERE SEXE = 'F√©minin') AS TotalFemmes,
        (SELECT COUNT(*) FROM personel WHERE SEXE = 'F√©minin') - 
        COUNT(DISTINCT CASE WHEN p.SEXE = 'F√©minin' THEN p.IDPERSONNEL END) AS FemmesNonFormees
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
        (s.DATE >= '${f}' AND s.DATE <= '${g}')
        OR s.CONFIRME<>1;
    `},i=async()=>{if(!T()){c("Veuillez v√©rifier les dates s√©lectionn√©es","error");return}const f=v();y(!0);const g=localStorage.getItem("token");try{const B=await ae.post(`${O}/personnaliserrequette`,{query:f},{headers:{Authorization:`Bearer ${g}`}});if(B.data&&B.data.length>0){const he=B.data[0];z(he.FemmesNonFormees||0),W(he.TotalFemmes||0),M(!0),c(`${he.FemmesNonFormees||0} femmes non form√©es identifi√©es sur la p√©riode`,"success")}else z(0),W(0),M(!0),c("Aucune donn√©e trouv√©e pour cette p√©riode","info")}catch(B){c(B.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{y(!1)}},c=(f,g)=>{V(f),H(g),_(!0)},a=()=>{_(!1)},S=f=>f?new Date(f).toLocaleDateString("fr-FR"):"-",R=()=>l&&p?`du ${S(l)} au ${S(p)}`:"P√©riode non d√©finie",b=()=>F===0?0:(C/F*100).toFixed(1),k=()=>{const f=F-C;return F===0?0:(f/F*100).toFixed(1)},w={chart:{type:"radialBar",height:350},colors:["#9c27b0"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(f){return C+" / "+F}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Femmes Non Form√©es"],title:{text:`${b()}% des femmes non form√©es`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#9c27b0"}}},I={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#9c27b0","#4caf50"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(f){return f},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Population F√©minine"],title:{text:"Statut de Formation"}},yaxis:{title:{text:"Nombre de femmes"}},legend:{position:"top"},title:{text:"Femmes non form√©es vs Femmes form√©es",align:"center"}},N=[{name:"Femmes Non Form√©es",data:[C]},{name:"Femmes Form√©es",data:[F-C]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Je,{sx:{color:"#9c27b0",fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#9c27b0"},children:"Nombre (Taux) de Femmes Non Form√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des femmes n'ayant pas b√©n√©fici√© de formations sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:l,onChange:f=>{x(f),h(g=>({...g,debut:!1}))},onError:f=>h(g=>({...g,debut:!!f})),format:"dd/MM/yyyy",slotProps:{textField:{error:u.debut,helperText:u.debut?"Date invalide":"",fullWidth:!0,variant:"outlined",InputProps:{startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:p,onChange:f=>{P(f),h(g=>({...g,fin:!1}))},onError:f=>h(g=>({...g,fin:!!f})),minDate:l,format:"dd/MM/yyyy",slotProps:{textField:{error:u.fin,helperText:u.fin?"Date doit √™tre apr√®s la date de d√©but":"",fullWidth:!0,variant:"outlined",InputProps:{startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}}}})})]}),(l||p)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f3e5f5",borderRadius:2,border:"1px solid #e1bee7"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#9c27b0"}}),"P√©riode d'analyse:"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,fontSize:16}}),"P√©riode d'absence de formation: ",R()]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mt:.5},children:"‚Ä¢ Analyse sp√©cifique de la population f√©minine"})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"center",gap:2,mt:4},children:[e.jsx(qn,{onClick:E,startIcon:e.jsx(Fr,{}),children:"R√©initialiser"}),e.jsx(Yn,{onClick:i,startIcon:m?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:m||!l||!p,children:m?"Analyse...":"Calculer le taux"})]}),e.jsxs(Se,{open:D,onClose:()=>M(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f3e5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #e1bee7"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Je,{sx:{mr:1.5,fontSize:30,color:"#9c27b0"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"#9c27b0",children:"R√©sultats - Femmes Non Form√©es"})]}),e.jsx(s,{children:e.jsx(de,{onClick:()=>M(!1),size:"small",sx:{bgcolor:"white",color:"#9c27b0",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#fce4ec",color:"#7b1fa2",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})})]}),e.jsxs(ye,{sx:{py:3,bgcolor:"#fafafa"},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Je,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:C}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Femmes Non Form√©es"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(We,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:F}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Femmes"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(hr,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[b(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Non Form√©es"})]})})})]}),e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,mb:3,children:[e.jsx(s,{children:e.jsxs(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#9c27b0"}}),"Analyse de la p√©riode: ",R()]})}),e.jsx(Y,{icon:e.jsx(pe,{fontSize:"small"}),label:R(),sx:{borderColor:"#9c27b0",color:"#9c27b0",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32},variant:"outlined"})]}),e.jsx(se,{sx:{my:2.5,borderColor:"divider"}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px",bgcolor:"white"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center",color:"#9c27b0"},children:"Proportion de Femmes Non Form√©es"}),F>0&&e.jsx(Re,{options:w,series:[parseFloat(b())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px",bgcolor:"white"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center",color:"#9c27b0"},children:"Comparaison Visuelle"}),F>0&&e.jsx(Re,{options:I,series:N,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#9c27b0"}}),"R√©sum√© de l'analyse"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode ",e.jsx("strong",{children:R()}),",",e.jsxs("strong",{children:[" ",C," femmes"]})," n'ont pas b√©n√©fici√© de formations sur un total de ",e.jsxs("strong",{children:[F," femmes"]})," dans l'organisation, repr√©sentant ",e.jsxs("strong",{children:[b(),"%"]})," de la population f√©minine non form√©e.",C===0&&F>0&&e.jsx("span",{style:{color:"#4caf50"},children:" Toutes les femmes ont √©t√© form√©es sur cette p√©riode - excellente performance !"}),F===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucun personnel f√©minin n'est enregistr√© dans l'organisation."}),parseFloat(b())>50&&C>0&&e.jsx("span",{style:{color:"#d32f2f"},children:" Plus de la moiti√© des femmes n'ont pas √©t√© form√©es - attention requise."}),parseFloat(b())<=50&&C>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Moins de la moiti√© des femmes non form√©es - situation acceptable mais peut √™tre am√©lior√©e."}),parseFloat(k())>0&&e.jsxs("span",{children:[" En parall√®le, ",e.jsxs("strong",{children:[k(),"%"]})," des femmes ont √©t√© form√©es."]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:$,onClose:a,autoHideDuration:5e3,children:e.jsx(Hn,{onClose:a,severity:q,iconMapping:{success:e.jsx(We,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:Q})})})]})})},Qn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),_n=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 69, 58, 0.47), rgba(255, 69, 58, 0))",color:"#d32f2f",border:"2px solid #d32f2f",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(255, 69, 58, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 69, 58, 0.7), rgba(255, 69, 58, 0))",transform:"translateY(-2px)"}})),Jn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 165, 0, 0.2), rgba(255, 165, 0, 0))",color:"orange",border:"2px solid orange",borderRadius:"20px",fontSize:"1rem",padding:t.spacing(1,3),boxShadow:"inset 0 2px 5px rgba(255, 165, 0, 0.3)",transition:"background-color 0.3s, transform 0.3s",height:"5vh",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 165, 0, 0.3), rgba(255, 165, 0, 0))",transform:"translateY(-2px)"}})),Gn=()=>{const t=()=>{const f=new Date;return new Date(f.getFullYear(),f.getMonth(),1)},n=()=>new Date,[l,x]=o.useState(t()),[p,P]=o.useState(n()),[u,h]=o.useState({debut:!1,fin:!1}),[m,y]=o.useState(!1),[C,z]=o.useState(0),[F,W]=o.useState(0),[D,M]=o.useState(!1),[$,_]=o.useState(!1),[Q,V]=o.useState(""),[q,H]=o.useState("success"),O="",L=f=>{if(!f)return null;const g=f.getFullYear(),B=String(f.getMonth()+1).padStart(2,"0"),he=String(f.getDate()).padStart(2,"0");return`${g}-${B}-${he}`},T=()=>{const f={debut:!1,fin:!1};return l||(f.debut=!0),p||(f.fin=!0),l&&p&&l>p&&(f.fin=!0),h(f),!f.debut&&!f.fin},E=()=>{x(t()),P(n()),h({debut:!1,fin:!1}),c("Dates r√©initialis√©es","info")},v=()=>{if(!l||!p)return null;const f=L(l),g=L(p);return`
      SELECT 
        (SELECT COUNT(*) FROM personel WHERE SEXE = 'Masculin') AS TotalHommes,
        (SELECT COUNT(*) FROM personel WHERE SEXE = 'Masculin') - 
        COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' THEN p.IDPERSONNEL END) AS HommesNonFormes
      FROM 
        participer_session ps
      JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
      JOIN 
        personel p ON ps.IDPERSONNEL = p.IDPERSONNEL
      WHERE 
        (s.DATE >= '${f}' AND s.DATE <= '${g}')
        OR s.CONFIRME<>1;
    `},i=async()=>{if(!T()){c("Veuillez v√©rifier les dates s√©lectionn√©es","error");return}const f=v();y(!0);const g=localStorage.getItem("token");try{const B=await ae.post(`${O}/personnaliserrequette`,{query:f},{headers:{Authorization:`Bearer ${g}`}});if(B.data&&B.data.length>0){const he=B.data[0];z(he.HommesNonFormes||0),W(he.TotalHommes||0),M(!0),c(`${he.HommesNonFormes||0} hommes non form√©s identifi√©s sur la p√©riode`,"success")}else z(0),W(0),M(!0),c("Aucune donn√©e trouv√©e pour cette p√©riode","info")}catch(B){c(B.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{y(!1)}},c=(f,g)=>{V(f),H(g),_(!0)},a=()=>{_(!1)},S=f=>f?new Date(f).toLocaleDateString("fr-FR"):"-",R=()=>l&&p?`du ${S(l)} au ${S(p)}`:"P√©riode non d√©finie",b=()=>F===0?0:(C/F*100).toFixed(1),k=()=>{const f=F-C;return F===0?0:(f/F*100).toFixed(1)},w={chart:{type:"radialBar",height:350},colors:["#d32f2f"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(f){return C+" / "+F}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Hommes Non Form√©s"],title:{text:`${b()}% des hommes non form√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#d32f2f"}}},I={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#d32f2f","#4caf50"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(f){return f},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Population Masculine"],title:{text:"Statut de Formation"}},yaxis:{title:{text:"Nombre d'hommes"}},legend:{position:"top"},title:{text:"Hommes non form√©s vs Hommes form√©s",align:"center"}},N=[{name:"Hommes Non Form√©s",data:[C]},{name:"Hommes Form√©s",data:[F-C]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Je,{sx:{color:"#d32f2f",fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#d32f2f"},children:"Nombre (Taux) d'Hommes Non Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des hommes n'ayant pas b√©n√©fici√© de formations sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:l,onChange:f=>{x(f),h(g=>({...g,debut:!1}))},onError:f=>h(g=>({...g,debut:!!f})),format:"dd/MM/yyyy",slotProps:{textField:{error:u.debut,helperText:u.debut?"Date invalide":"",fullWidth:!0,variant:"outlined",InputProps:{startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:p,onChange:f=>{P(f),h(g=>({...g,fin:!1}))},onError:f=>h(g=>({...g,fin:!!f})),minDate:l,format:"dd/MM/yyyy",slotProps:{textField:{error:u.fin,helperText:u.fin?"Date doit √™tre apr√®s la date de d√©but":"",fullWidth:!0,variant:"outlined",InputProps:{startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}}}})})]}),(l||p)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fff5f5",borderRadius:2,border:"1px solid #ffcdd2"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#d32f2f"}}),"P√©riode d'analyse:"]}),l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",S(l)]}),p&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",S(p)]})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"center",gap:2,mt:4},children:[e.jsx(Jn,{onClick:E,startIcon:e.jsx(Fr,{}),children:"R√©initialiser"}),e.jsx(_n,{onClick:i,startIcon:m?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:m||!l||!p,children:m?"Analyse...":"Calculer le taux"})]}),e.jsxs(Se,{open:D,onClose:()=>M(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Je,{sx:{mr:1.5,fontSize:28,color:"#d32f2f"}}),e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - ",R()]})]}),e.jsx(de,{onClick:()=>M(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#ffebee",borderLeft:"4px solid #d32f2f",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Je,{sx:{fontSize:48,color:"#d32f2f",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#d32f2f",children:C}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Hommes Non Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Me,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:F}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Hommes"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(hr,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[b(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Non Form√©s"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion d'Hommes Non Form√©s"}),F>0&&e.jsx(Re,{options:w,series:[parseFloat(b())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Comparaison Visuelle"}),F>0&&e.jsx(Re,{options:I,series:N,type:"bar",height:300})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#d32f2f"}}),"R√©sum√© de l'analyse"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode ",e.jsx("strong",{children:R()}),",",e.jsxs("strong",{children:[" ",C," hommes"]})," n'ont pas b√©n√©fici√© de formations sur un total de ",e.jsxs("strong",{children:[F," hommes"]})," dans l'organisation, repr√©sentant ",e.jsxs("strong",{children:[b(),"%"]})," de la population masculine non form√©e.",C===0&&F>0&&e.jsx("span",{style:{color:"#4caf50"},children:" Tous les hommes ont √©t√© form√©s sur cette p√©riode - excellente performance !"}),F===0&&e.jsx("span",{style:{color:"#f44336"},children:" Aucun personnel masculin n'est enregistr√© dans l'organisation."}),parseFloat(b())>50&&C>0&&e.jsx("span",{style:{color:"#d32f2f"},children:" Plus de la moiti√© des hommes n'ont pas √©t√© form√©s - attention requise."}),parseFloat(b())<=50&&C>0&&e.jsx("span",{style:{color:"#ff9800"},children:" Moins de la moiti√© des hommes non form√©s - situation acceptable mais peut √™tre am√©lior√©e."}),parseFloat(k())>0&&e.jsxs("span",{children:[" En parall√®le, ",e.jsxs("strong",{children:[k(),"%"]})," des hommes ont √©t√© form√©s."]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:$,onClose:a,autoHideDuration:5e3,children:e.jsx(Qn,{onClose:a,severity:q,iconMapping:{success:e.jsx(Je,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:Q})})})]})})},Xn=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Zn=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 193, 7, 0.47), rgba(255, 193, 7, 0))",color:"#f57c00",border:"2px solid #f57c00",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(255, 193, 7, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 193, 7, 0.7), rgba(255, 193, 7, 0))",transform:"translateY(-2px)"}})),Kn=()=>{const[t,n]=o.useState(new Date),[l,x]=o.useState(new Date),[p,P]=o.useState(!1),[u,h]=o.useState(0),[m,y]=o.useState(0),[C,z]=o.useState(0),[F,W]=o.useState(0),[D,M]=o.useState(!1),[$,_]=o.useState(!1),[Q,V]=o.useState(""),[q,H]=o.useState("success"),O="",L=()=>!t||!l?null:`
      SELECT 
        -- Total des hommes des services centraux
        COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' AND p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS TotalHommesServicesCentraux,
        
        -- Total des personnels des services centraux
        COUNT(DISTINCT CASE WHEN p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesCentraux,
        
        -- Hommes des services centraux form√©s sur la p√©riode
        COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' AND p.SERVICECENTRAL = 'Service Central' AND ps.IDPERSONNEL IS NOT NULL THEN p.IDPERSONNEL END) AS HommesServicesCentrauxFormes,
        
        -- Hommes des services centraux NON form√©s (diff√©rence)
        (COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' AND p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) - 
        COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' AND p.SERVICECENTRAL = 'Service Central' AND ps.IDPERSONNEL IS NOT NULL THEN p.IDPERSONNEL END)) AS HommesServicesCentrauxNonFormes
        
      FROM 
        personel p
      LEFT JOIN 
        participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
      LEFT JOIN 
        sessionformation s ON ps.IDSESSION = s.IDSESSION
      LEFT JOIN 
        formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM 
        AND (s.DATE >= '${t}' AND s.DATE <= '${l}') OR s.CONFIRME<>1
      WHERE 
        p.SERVICECENTRAL = 'Service Central' AND p.SEXE = 'Masculin';
    `,T=async()=>{if(!t){E("Veuillez s√©lectionner une date de d√©but","error");return}if(!l){E("Veuillez s√©lectionner une date de fin","error");return}if(new Date(t)>new Date(l)){E("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const I=L();P(!0);const N=localStorage.getItem("token");try{const f=await ae.post(`${O}/personnaliserrequette`,{query:I},{headers:{Authorization:`Bearer ${N}`}});if(f.data&&f.data.length>0){const g=f.data[0];y(g.TotalHommesServicesCentraux||0),z(g.TotalPersonnelsServicesCentraux||0),W(g.HommesServicesCentrauxFormes||0),h(g.HommesServicesCentrauxNonFormes||0),M(!0),E(`${g.HommesServicesCentrauxNonFormes||0} hommes des services centraux non form√©s trouv√©s`,"warning")}else y(0),z(0),W(0),h(0),M(!0),E("Aucune donn√©e trouv√©e sur cette p√©riode","info")}catch(f){E(f.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},E=(I,N)=>{V(I),H(N),_(!0)},v=()=>{_(!1)},i=I=>I?new Date(I).toLocaleDateString("fr-FR"):"-",c=()=>m===0?0:(u/m*100).toFixed(1),a=()=>m===0?0:(F/m*100).toFixed(1),S={chart:{type:"radialBar",height:350},colors:["#ff9800"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(I){return u+" / "+m}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Hommes Non Form√©s"],title:{text:`${c()}% d'hommes des services centraux`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#ff9800"}}},R={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#4caf50","#ff9800"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(I){return I},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Hommes Services Centraux"],title:{text:"Comparaison Formation"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"Statut Formation - Hommes Services Centraux",align:"center"}},b=[{name:"Form√©s",data:[F]},{name:"Non Form√©s",data:[u]}],k={chart:{type:"donut",height:300},colors:["#4caf50","#ff9800"],labels:["Form√©s","Non Form√©s"],dataLabels:{enabled:!0,formatter:function(I,N){return N.w.config.series[N.seriesIndex]}},legend:{position:"bottom"},title:{text:"R√©partition Formation/Non Formation",align:"center"},responsive:[{breakpoint:480,options:{chart:{width:200},legend:{position:"bottom"}}}]},w=[F,u];return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(Me,{color:"warning",sx:{fontSize:28,mr:1}}),e.jsx(ue,{color:"warning",sx:{fontSize:32,mr:1}}),e.jsx(Ke,{color:"warning",sx:{fontSize:24}})]}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#f57c00"},children:"Hommes des Services Centraux Non Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des hommes des services centraux n'ayant pas b√©n√©fici√© de formations sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{fullWidth:!0,type:"date",label:"Date de d√©but",value:t,onChange:I=>n(I.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{fullWidth:!0,type:"date",label:"Date de fin",value:l,onChange:I=>x(I.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}})})]}),(t||l)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#f57c00"}}),"P√©riode d'analyse:"]}),t&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",i(t)]}),l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",i(l)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Zn,{onClick:T,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p||!t||!l,children:p?"Analyse...":"Calculer les non form√©s"})}),e.jsxs(Se,{open:D,onClose:()=>M(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#fff3e0",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #ffcc02"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Me,{sx:{mr:1,fontSize:24,color:"#f57c00"}}),e.jsx(ue,{sx:{mr:1,fontSize:28,color:"#f57c00"}}),e.jsx(Ke,{sx:{mr:1.5,fontSize:24,color:"#f57c00"}}),e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",i(t)," au ",i(l)]})]}),e.jsx(de,{onClick:()=>M(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(Me,{sx:{fontSize:32,color:"#ff9800",mr:1}}),e.jsx(Ke,{sx:{fontSize:36,color:"#ff9800"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:u}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Hommes Non Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Me,{sx:{fontSize:48,color:"#2196f3",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:m}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Hommes Services Centraux"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:F}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Hommes Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#ffebee",borderLeft:"4px solid #f44336",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(hr,{sx:{fontSize:48,color:"#f44336",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#f44336",children:[c(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Non Formation"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Proportion des Hommes Non Form√©s"}),m>0&&e.jsx(Re,{options:S,series:[parseFloat(c())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:m>0&&e.jsx(Re,{options:R,series:b,type:"bar",height:300})})})]}),e.jsx(d,{container:!0,spacing:3,sx:{mt:2},children:e.jsx(d,{item:!0,xs:12,children:e.jsxs(Z,{sx:{p:3,borderRadius:2},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"R√©partition Globale : Form√©s vs Non Form√©s"}),m>0&&e.jsx(Re,{options:k,series:w,type:"donut",height:300})]})})}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800"},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#f57c00"}}),"R√©sum√© de l'analyse"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:i(t)})," au ",e.jsx("strong",{children:i(l)})," :",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ ",e.jsxs("strong",{children:[u," hommes des services centraux"]})," n'ont pas b√©n√©fici√© de formations.",e.jsx("br",{}),"‚Ä¢ Sur un total de ",e.jsxs("strong",{children:[m," hommes des services centraux"]}),",",e.jsxs("strong",{children:[" ",F," ont √©t√© form√©s"]})," et ",e.jsxs("strong",{children:[u," ne l'ont pas √©t√©"]}),".",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux de non-formation :"})," ",c(),"% des hommes des services centraux n'ont pas √©t√© form√©s.",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux de formation :"})," ",a(),"% des hommes des services centraux ont √©t√© form√©s.",parseFloat(c())>70&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("br",{}),e.jsxs("span",{style:{color:"#f44336"},children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Alerte :"})," Plus de 70% des hommes des services centraux n'ont pas √©t√© form√©s sur cette p√©riode. Il est recommand√© d'intensifier les efforts de formation."]})]}),parseFloat(c())>50&&parseFloat(c())<=70&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("br",{}),e.jsxs("span",{style:{color:"#ff9800"},children:["üìä ",e.jsx("strong",{children:"Attention :"})," Plus de la moiti√© des hommes des services centraux (",c(),"%) n'ont pas √©t√© form√©s."]})]}),parseFloat(c())<=30&&m>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("br",{}),e.jsxs("span",{style:{color:"#4caf50"},children:["‚úÖ ",e.jsx("strong",{children:"Bon r√©sultat :"})," Moins de 30% des hommes des services centraux n'ont pas √©t√© form√©s. Les efforts de formation portent leurs fruits."]})]}),u===0&&m>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("br",{}),e.jsxs("span",{style:{color:"#4caf50"},children:["üéâ ",e.jsx("strong",{children:"Excellent :"})," Tous les hommes des services centraux ont √©t√© form√©s sur cette p√©riode !"]})]}),m===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun homme des services centraux n'a √©t√© identifi√© dans la base de donn√©es."})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:$,onClose:v,autoHideDuration:5e3,children:e.jsx(Xn,{onClose:v,severity:q,iconMapping:{success:e.jsx(ue,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"}),warning:e.jsx(Ke,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:Q})})})]})},ei=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),ri=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),tt=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover .MuiOutlinedInput-notchedOutline":{borderColor:t.palette.primary.main},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:t.palette.primary.main,borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:t.palette.primary.main}})),ti=()=>{const[t,n]=o.useState(ze()),[l,x]=o.useState(ze()),[p,P]=o.useState(!1),[u,h]=o.useState(0),[m,y]=o.useState(0),[C,z]=o.useState(0),[F,W]=o.useState(!1),[D,M]=o.useState(!1),[$,_]=o.useState(""),[Q,V]=o.useState("success"),q="",H=()=>{if(!t||!l)return null;const R=b=>ze(b).format("YYYY-MM-DD");return`
      SELECT 
        COUNT(DISTINCT CASE WHEN p.SEXE = 'F√©minin' AND p.SERVICECENTRAL = 'Service Central' 
                            AND p.IDPERSONNEL NOT IN (
                                SELECT DISTINCT ps.IDPERSONNEL 
                                FROM participer_session ps 
                                JOIN sessionformation s ON ps.IDSESSION = s.IDSESSION 
                                WHERE s.CONFIRME=1 AND s.DATE >= '${R(t)}' AND s.DATE <= '${R(l)}'
                            ) THEN p.IDPERSONNEL END) AS FemmesServicesCentrauxNonFormees,
        COUNT(DISTINCT CASE WHEN p.SEXE = 'F√©minin' AND p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS TotalFemmesServicesCentraux,
        COUNT(DISTINCT CASE WHEN p.SERVICECENTRAL = 'Service Central' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesCentraux
      FROM 
        personel p;
    `},O=async()=>{if(!t){L("Veuillez s√©lectionner une date de d√©but","error");return}if(!l){L("Veuillez s√©lectionner une date de fin","error");return}if(t.isAfter(l)){L("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const R=H();P(!0);const b=localStorage.getItem("token");try{const k=await ae.post(`${q}/personnaliserrequette`,{query:R},{headers:{Authorization:`Bearer ${b}`}});if(k.data&&k.data.length>0){const w=k.data[0];h(w.FemmesServicesCentrauxNonFormees||0),y(w.TotalFemmesServicesCentraux||0),z(w.TotalPersonnelsServicesCentraux||0),W(!0),L(`${w.FemmesServicesCentrauxNonFormees||0} femmes des services centraux non form√©es trouv√©es`,"success")}else h(0),y(0),z(0),W(!0),L("Aucune donn√©e trouv√©e sur cette p√©riode","info")}catch(k){L(k.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},L=(R,b)=>{_(R),V(b),M(!0)},T=()=>{M(!1)},E=R=>R?ze(R).format("DD/MM/YYYY"):"-",v=()=>m===0?0:(u/m*100).toFixed(1),i=()=>m===0?0:((m-u)/m*100).toFixed(1),c={chart:{type:"radialBar",height:350},colors:["#e91e63"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(R){return u+" / "+m}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Non Form√©es"],title:{text:`${v()}% de femmes des services centraux`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#e91e63"}}},a={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#e91e63","#4caf50"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(R){return R},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Femmes Services Centraux"],title:{text:"Statut Formation"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"R√©partition Formation/Non-Formation",align:"center"}},S=[{name:"Non Form√©es",data:[u]},{name:"Form√©es",data:[m-u]}];return e.jsx(Ae,{dateAdapter:er,adapterLocale:"fr",children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(We,{sx:{fontSize:28,mr:1,color:"#e91e63"}}),e.jsx(Je,{sx:{fontSize:32,color:"#e91e63"}})]}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#e91e63"},children:"Femmes des Services Centraux Non Form√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des femmes des services centraux qui n'ont pas re√ßu de formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(tt,{label:"Date de d√©but",value:t,onChange:R=>n(R),format:"DD/MM/YYYY",slotProps:{textField:{fullWidth:!0,InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(tt,{label:"Date de fin",value:l,onChange:R=>x(R),format:"DD/MM/YYYY",slotProps:{textField:{fullWidth:!0,InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}}}})})]}),(t||l)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),t&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",E(t)]}),l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",E(l)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(ri,{onClick:O,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p||!t||!l,children:p?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:F,onClose:()=>W(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(We,{sx:{mr:1,fontSize:24,color:"#e91e63"}}),e.jsx(Je,{sx:{mr:1.5,fontSize:28,color:"#e91e63"}}),e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",E(t)," au ",E(l)]})]}),e.jsx(de,{onClick:()=>W(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:5,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fce4ec",borderLeft:"4px solid #e91e63",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(We,{sx:{fontSize:32,color:"#e91e63",mr:1}}),e.jsx(Je,{sx:{fontSize:36,color:"#e91e63"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#e91e63",children:u}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Femmes Services Centraux Non Form√©es"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(We,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:m}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Femmes Services Centraux"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fce4ec",borderLeft:"4px solid #e91e63",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(hr,{sx:{fontSize:48,color:"#e91e63",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#e91e63",children:[v(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux de Non-Formation"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion des Femmes Non Form√©es Services Centraux"}),m>0&&e.jsx(Re,{options:c,series:[parseFloat(v())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:m>0&&e.jsx(Re,{options:a,series:S,type:"bar",height:300})})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"R√©sum√© de l'analyse"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Durant la p√©riode du ",e.jsx("strong",{children:E(t)})," au ",e.jsx("strong",{children:E(l)}),",",e.jsxs("strong",{children:[" ",u," femmes des services centraux"]})," n'ont pas b√©n√©fici√© de formations.",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Sur un total de ",e.jsxs("strong",{children:[m," femmes des services centraux"]}),",",e.jsxs("strong",{children:[" ",v(),"%"]})," n'ont pas √©t√© form√©es.",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux de couverture :"})," ",e.jsxs("strong",{children:[i(),"%"]})," des femmes des services centraux ont re√ßu au moins une formation sur cette p√©riode.",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Gap de formation :"})," Il reste ",e.jsxs("strong",{children:[u," femmes"]})," √† former pour atteindre une couverture compl√®te.",e.jsx("br",{}),u===0&&m>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#4caf50"},children:"‚úÖ Excellent ! Toutes les femmes des services centraux ont √©t√© form√©es sur cette p√©riode."})]}),parseFloat(v())>50&&u>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#e91e63"},children:"‚ö†Ô∏è Plus de la moiti√© des femmes des services centraux n'ont pas √©t√© form√©es."})]}),parseFloat(v())<=50&&parseFloat(v())>25&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#ff9800"},children:"üìä Un quart √† la moiti√© des femmes des services centraux n√©cessitent encore une formation."})]}),parseFloat(v())<=25&&parseFloat(v())>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#2196f3"},children:"üìä Bon taux de couverture ! Moins du quart des femmes des services centraux restent √† former."})]}),m===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#e91e63"},children:"‚ö†Ô∏è Aucune femme des services centraux n'a √©t√© trouv√©e dans la base de donn√©es."})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:D,onClose:T,autoHideDuration:5e3,children:e.jsx(ei,{onClose:T,severity:Q,iconMapping:{success:e.jsx(Je,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:$})})})]})})},si=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),oi=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 193, 7, 0.47), rgba(255, 193, 7, 0))",color:"#f57c00",border:"2px solid #f57c00",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(255, 193, 7, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 193, 7, 0.7), rgba(255, 193, 7, 0))",transform:"translateY(-2px)"}})),st=J(ne)(({theme:t})=>({"& .MuiOutlinedInput-root":{backgroundColor:"#f9f9f9","&:hover .MuiOutlinedInput-notchedOutline":{borderColor:t.palette.primary.main},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:t.palette.primary.main,borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:t.palette.primary.main}})),ni=()=>{const[t,n]=o.useState(ze()),[l,x]=o.useState(ze()),[p,P]=o.useState(!1),[u,h]=o.useState(0),[m,y]=o.useState(0),[C,z]=o.useState(0),[F,W]=o.useState(!1),[D,M]=o.useState(!1),[$,_]=o.useState(""),[Q,V]=o.useState("success"),q="",H=()=>{if(!t||!l)return null;const R=b=>ze(b).format("YYYY-MM-DD");return`
      SELECT 
        COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' AND p.SERVICECENTRAL = 'Service Deconcentr√©' 
                            AND p.IDPERSONNEL NOT IN (
                                SELECT DISTINCT ps.IDPERSONNEL 
                                FROM participer_session ps 
                                JOIN sessionformation s ON ps.IDSESSION = s.IDSESSION 
                                WHERE s.CONFIRME<>1 OR (s.DATE >= '${R(t)}' AND s.DATE <= '${R(l)}')
                            ) THEN p.IDPERSONNEL END) AS HommesServicesDeconcentresNonFormes,
        COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' AND p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS TotalHommesServicesDeconcentres,
        COUNT(DISTINCT CASE WHEN p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesDeconcentres
      FROM 
        personel p;
    `},O=async()=>{if(!t){L("Veuillez s√©lectionner une date de d√©but","error");return}if(!l){L("Veuillez s√©lectionner une date de fin","error");return}if(t.isAfter(l)){L("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const R=H();P(!0);const b=localStorage.getItem("token");try{const k=await ae.post(`${q}/personnaliserrequette`,{query:R},{headers:{Authorization:`Bearer ${b}`}});if(k.data&&k.data.length>0){const w=k.data[0];h(w.HommesServicesDeconcentresNonFormes||0),y(w.TotalHommesServicesDeconcentres||0),z(w.TotalPersonnelsServicesDeconcentres||0),W(!0),L(`${w.HommesServicesDeconcentresNonFormes||0} hommes des services d√©concentr√©s non form√©s trouv√©s`,"warning")}else h(0),y(0),z(0),W(!0),L("Aucune donn√©e trouv√©e sur cette p√©riode","info")}catch(k){L(k.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},L=(R,b)=>{_(R),V(b),M(!0)},T=()=>{M(!1)},E=R=>R?ze(R).format("DD/MM/YYYY"):"-",v=()=>m===0?0:(u/m*100).toFixed(1),i=()=>m===0?0:((m-u)/m*100).toFixed(1),c={chart:{type:"radialBar",height:350},colors:["#ff5722"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:function(R){return u+" / "+m}}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Hommes Non Form√©s"],title:{text:`${v()}% d'hommes des services d√©concentr√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#ff5722"}}},a={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#ff5722","#4caf50"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:function(R){return R},style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Hommes Services D√©concentr√©s"],title:{text:"Statut Formation"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"R√©partition Form√©s vs Non Form√©s",align:"center"}},S=[{name:"Non Form√©s",data:[u]},{name:"Form√©s",data:[m-u]}];return e.jsx(Ae,{dateAdapter:er,adapterLocale:"fr",children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(Me,{sx:{color:"#f57c00",fontSize:28,mr:1}}),e.jsx(Ye,{sx:{color:"#f57c00",fontSize:32,mr:1}}),e.jsx(Ke,{sx:{color:"#ff5722",fontSize:28}})]}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#f57c00"},children:"Hommes des Services D√©concentr√©s Non Form√©s sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des hommes des services d√©concentr√©s qui n'ont pas re√ßu de formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(st,{label:"Date de d√©but",value:t,onChange:R=>n(R),format:"DD/MM/YYYY",slotProps:{textField:{fullWidth:!0,InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(st,{label:"Date de fin",value:l,onChange:R=>x(R),format:"DD/MM/YYYY",slotProps:{textField:{fullWidth:!0,InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}}}})})]}),(t||l)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fff8e1",borderRadius:2,border:"1px solid #ffcc02"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#f57c00"}}),"P√©riode d'analyse:"]}),t&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",E(t)]}),l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",E(l)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(oi,{onClick:O,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p||!t||!l,children:p?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:F,onClose:()=>W(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Me,{sx:{mr:1,fontSize:24,color:"#f57c00"}}),e.jsx(Ye,{sx:{mr:1,fontSize:28,color:"#f57c00"}}),e.jsx(Ke,{sx:{mr:1.5,fontSize:28,color:"#ff5722"}}),e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",E(t)," au ",E(l)]})]}),e.jsx(de,{onClick:()=>W(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#ffebee",borderLeft:"4px solid #ff5722",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(Me,{sx:{fontSize:32,color:"#ff5722",mr:1}}),e.jsx(Ke,{sx:{fontSize:36,color:"#ff5722"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",sx:{color:"#ff5722"},children:u}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Hommes Non Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Me,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:m}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Hommes Services D√©concentr√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(hr,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[v(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Non Form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #2196f3",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#2196f3",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#2196f3",children:[i(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux de Couverture Formation"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h5",sx:{mb:2,textAlign:"center"},children:"Proportion d'hommes Non Form√©s des Services D√©concentr√©s"}),m>0&&e.jsx(Re,{options:c,series:[parseFloat(v())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:m>0&&e.jsx(Re,{options:a,series:S,type:"bar",height:300})})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#f57c00"}}),"R√©sum√© de l'analyse"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:E(t)})," au ",e.jsx("strong",{children:E(l)}),",",e.jsxs("strong",{children:[" ",u," hommes des services d√©concentr√©s"]})," n'ont pas b√©n√©fici√© de formations.",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Sur un total de ",e.jsxs("strong",{children:[m," hommes des services d√©concentr√©s"]}),",",e.jsxs("strong",{children:[" ",v(),"%"]})," n'ont pas √©t√© form√©s.",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux de couverture :"})," ",e.jsxs("strong",{children:[i(),"%"]})," des hommes des services d√©concentr√©s ont b√©n√©fici√© d'une formation sur cette p√©riode.",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Hommes form√©s :"})," ",m-u," hommes ont √©t√© form√©s.",e.jsx("br",{}),parseFloat(v())>50&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Plus de la moiti√© des hommes des services d√©concentr√©s n'ont pas √©t√© form√©s."})]}),parseFloat(v())>=25&&parseFloat(v())<=50&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#ff9800"},children:"üìä Un quart √† la moiti√© des hommes des services d√©concentr√©s n'ont pas √©t√© form√©s."})]}),parseFloat(v())<25&&u>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#4caf50"},children:"üìä Moins d'un quart des hommes des services d√©concentr√©s n'ont pas √©t√© form√©s - bonne couverture formation."})]}),u===0&&m>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#4caf50"},children:"üéâ Excellente nouvelle ! Tous les hommes des services d√©concentr√©s ont √©t√© form√©s sur cette p√©riode."})]}),m===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucun homme des services d√©concentr√©s n'a √©t√© identifi√© dans la base de donn√©es."})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:D,onClose:T,autoHideDuration:5e3,children:e.jsx(si,{onClose:T,severity:Q,iconMapping:{success:e.jsx(Ye,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"}),warning:e.jsx(Ke,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:$})})})]})})},ii=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),ai=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(255, 193, 7, 0.47), rgba(255, 193, 7, 0))",color:"#f57c00",border:"2px solid #f57c00",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(255, 193, 7, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(255, 193, 7, 0.7), rgba(255, 193, 7, 0))",transform:"translateY(-2px)"}})),li=()=>{const[t,n]=o.useState(new Date),[l,x]=o.useState(new Date),[p,P]=o.useState(!1),[u,h]=o.useState(0),[m,y]=o.useState(0),[C,z]=o.useState(0),[F,W]=o.useState(!1),[D,M]=o.useState(!1),[$,_]=o.useState(""),[Q,V]=o.useState("success"),q="",H=b=>{if(!b)return null;const k=b.getFullYear(),w=String(b.getMonth()+1).padStart(2,"0"),I=String(b.getDate()).padStart(2,"0");return`${k}-${w}-${I}`},O=()=>{const b=H(t),k=H(l);return!b||!k?null:`
      SELECT 
        COUNT(DISTINCT CASE WHEN p.SEXE = 'F√©minin' AND p.SERVICECENTRAL = 'Service Deconcentr√©' 
                            AND p.IDPERSONNEL NOT IN (
                                SELECT DISTINCT ps.IDPERSONNEL 
                                FROM participer_session ps 
                                JOIN sessionformation s ON ps.IDSESSION = s.IDSESSION 
                                WHERE s.CONFIRME=1 AND s.DATE >= '${b}' AND s.DATE <= '${k}'
                            ) THEN p.IDPERSONNEL END) AS FemmesServicesDeconcentresNonFormees,
        COUNT(DISTINCT CASE WHEN p.SEXE = 'F√©minin' AND p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS TotalFemmesServicesDeconcentres,
        COUNT(DISTINCT CASE WHEN p.SERVICECENTRAL = 'Service Deconcentr√©' THEN p.IDPERSONNEL END) AS TotalPersonnelsServicesDeconcentres
      FROM 
        personel p;
    `},L=async()=>{if(!t){T("Veuillez s√©lectionner une date de d√©but","error");return}if(!l){T("Veuillez s√©lectionner une date de fin","error");return}if(t>l){T("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const b=O();P(!0);const k=localStorage.getItem("token");try{const w=await ae.post(`${q}/personnaliserrequette`,{query:b},{headers:{Authorization:`Bearer ${k}`}});if(w.data&&w.data.length>0){const I=w.data[0];h(I.FemmesServicesDeconcentresNonFormees||0),y(I.TotalFemmesServicesDeconcentres||0),z(I.TotalPersonnelsServicesDeconcentres||0),W(!0),T(`${I.FemmesServicesDeconcentresNonFormees||0} femmes des services d√©concentr√©s non form√©es trouv√©es`,"warning")}else h(0),y(0),z(0),W(!0),T("Aucune donn√©e trouv√©e sur cette p√©riode","info")}catch(w){T(w.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},T=(b,k)=>{_(b),V(k),M(!0)},E=()=>{M(!1)},v=b=>b?new Date(b).toLocaleDateString("fr-FR"):"-",i=()=>m===0?0:(u/m*100).toFixed(1),c=()=>m===0?0:((m-u)/m*100).toFixed(1),a={chart:{type:"radialBar",height:350},colors:["#e91e63"],plotOptions:{radialBar:{startAngle:-135,endAngle:135,track:{background:"#e7e7e7",strokeWidth:"97%",margin:5},dataLabels:{name:{fontSize:"16px",color:"#888",offsetY:120},value:{offsetY:76,fontSize:"22px",color:"#111",formatter:()=>`${u} / ${m}`}}}},fill:{type:"gradient",gradient:{shade:"dark",shadeIntensity:.15,inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,65,91]}},stroke:{dashArray:4},labels:["Femmes Non Form√©es"],title:{text:`${i()}% de femmes des services d√©concentr√©s`,align:"center",style:{fontSize:"18px",fontWeight:"bold",color:"#e91e63"}}},S={chart:{type:"bar",height:300,toolbar:{show:!1}},colors:["#e91e63","#4caf50"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!0,formatter:b=>b,style:{fontSize:"14px",fontWeight:"bold"}},xaxis:{categories:["Femmes Services D√©concentr√©s"],title:{text:"Statut Formation"}},yaxis:{title:{text:"Nombre de personnes"}},legend:{position:"top"},title:{text:"R√©partition Form√©es vs Non Form√©es",align:"center"}},R=[{name:"Non Form√©es",data:[u]},{name:"Form√©es",data:[m-u]}];return e.jsx(Ae,{dateAdapter:Pe,adapterLocale:ke,children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(We,{sx:{color:"#f57c00",fontSize:28,mr:1}}),e.jsx(Ye,{sx:{color:"#f57c00",fontSize:32,mr:1}}),e.jsx(Ke,{sx:{color:"#e91e63",fontSize:28}})]}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",sx:{color:"#f57c00"},children:"Femmes des Services D√©concentr√©s Non Form√©es sur une P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des femmes des services d√©concentr√©s qui n'ont pas re√ßu de formation sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:t,onChange:b=>n(b),slotProps:{textField:{fullWidth:!0,sx:{bgcolor:"#f9f9f9"},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:l,onChange:b=>x(b),minDate:t,slotProps:{textField:{fullWidth:!0,sx:{bgcolor:"#f9f9f9"},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})}}}})})]}),(t||l)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#fff8e1",borderRadius:2,border:"1px solid #ffcc02"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"#f57c00"}}),"P√©riode d'analyse:"]}),t&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",v(t)]}),l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",v(l)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(ai,{onClick:L,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p||!t||!l,children:p?"Analyse...":"Calculer le nombre"})}),e.jsxs(Se,{open:F,onClose:()=>W(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(We,{sx:{mr:1,fontSize:24,color:"#f57c00"}}),e.jsx(Ye,{sx:{mr:1,fontSize:28,color:"#f57c00"}}),e.jsx(Ke,{sx:{mr:1.5,fontSize:28,color:"#e91e63"}}),e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["R√©sultats - P√©riode du ",v(t)," au ",v(l)]})]}),e.jsx(de,{onClick:()=>W(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fce4ec",borderLeft:"4px solid #e91e63",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:1},children:[e.jsx(We,{sx:{fontSize:32,color:"#e91e63",mr:1}}),e.jsx(Ke,{sx:{fontSize:36,color:"#e91e63"}})]}),e.jsx(r,{variant:"h3",fontWeight:"bold",sx:{color:"#e91e63"},children:u}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Femmes Non Form√©es"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#f3e5f5",borderLeft:"4px solid #9c27b0",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(We,{sx:{fontSize:48,color:"#9c27b0",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#9c27b0",children:m}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total Femmes Services D√©concentr√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(hr,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[i(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux Non Form√©es"})]})})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:[c(),"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux de Couverture Formation"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:7,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"Proportion des Femmes Non Form√©es Services D√©concentr√©s"}),m>0&&e.jsx(Re,{options:a,series:[parseFloat(i())],type:"radialBar",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:5,children:e.jsx(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:m>0&&e.jsx(Re,{options:S,series:R,type:"bar",height:300})})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#f57c00"}}),"R√©sum√© de l'analyse"]}),e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:["Sur la p√©riode du ",e.jsx("strong",{children:v(t)})," au ",e.jsx("strong",{children:v(l)}),",",e.jsxs("strong",{children:[" ",u," femmes des services d√©concentr√©s"]})," n'ont pas b√©n√©fici√© de formations.",e.jsx("br",{}),e.jsx("br",{}),"‚Ä¢ Sur un total de ",e.jsxs("strong",{children:[m," femmes des services d√©concentr√©s"]}),",",e.jsxs("strong",{children:[" ",i(),"%"]})," n'ont pas √©t√© form√©es.",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Taux de couverture :"})," ",e.jsxs("strong",{children:[c(),"%"]})," des femmes des services d√©concentr√©s ont b√©n√©fici√© d'une formation sur cette p√©riode.",e.jsx("br",{}),"‚Ä¢ ",e.jsx("strong",{children:"Femmes form√©es :"})," ",m-u," femmes ont √©t√© form√©es.",e.jsx("br",{}),parseFloat(i())>50&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Plus de la moiti√© des femmes des services d√©concentr√©s n'ont pas √©t√© form√©es."})]}),parseFloat(i())>=25&&parseFloat(i())<=50&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#ff9800"},children:"üìä Un quart √† la moiti√© des femmes des services d√©concentr√©s n'ont pas √©t√© form√©es."})]}),parseFloat(i())<25&&u>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#4caf50"},children:"üìä Moins d'un quart des femmes des services d√©concentr√©s n'ont pas √©t√© form√©es - bonne couverture formation."})]}),u===0&&m>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#4caf50"},children:"üéâ Excellente nouvelle ! Toutes les femmes des services d√©concentr√©s ont √©t√© form√©es sur cette p√©riode."})]}),m===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:"‚ö†Ô∏è Aucune femme des services d√©concentr√©s n'a √©t√© identifi√©e dans la base de donn√©es."})]})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:D,onClose:E,autoHideDuration:5e3,children:e.jsx(ii,{onClose:E,severity:Q,iconMapping:{success:e.jsx(Ye,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"}),warning:e.jsx(Ke,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:$})})})]})})},ci=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),di=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),xi=()=>{const[t,n]=o.useState(ze().subtract(1,"month")),[l,x]=o.useState(ze()),[p,P]=o.useState(!1),[u,h]=o.useState([]),[m,y]=o.useState(!1),[C,z]=o.useState(!1),[F,W]=o.useState(""),[D,M]=o.useState("success"),$=()=>!t||!l?null:`
    SELECT 
      fm.IDFORMATIONM,
      fm.INTITULE,
      s.DATE,
      s.LIEU,
      COUNT(DISTINCT ps.IDPERSONNEL) as NB_PARTICIPANTS
    FROM formationmodifiable fm
    INNER JOIN sessionformation s ON fm.IDFORMATIONM = s.IDFORMATION
    LEFT JOIN participer_session ps ON s.IDSESSION = ps.IDSESSION
    WHERE s.DATE >= '${t.format("YYYY-MM-DD")}' 
      AND s.DATE <= '${l.format("YYYY-MM-DD")}'
      AND s.CONFIRME=1
    GROUP BY fm.IDFORMATIONM, fm.INTITULE, s.DATE, s.LIEU
    ORDER BY s.DATE;`,_=async()=>{if(!t||!l){Q("Veuillez s√©lectionner les dates de d√©but et de fin","error");return}if(t.isAfter(l)){Q("La date de fin doit √™tre post√©rieure √† la date de d√©but","error");return}const E=$();P(!0);const v=localStorage.getItem("token"),i="";try{const c=await ae.post(`${i}/personnaliserrequette`,{query:E},{headers:{Authorization:`Bearer ${v}`}});if(c.data){h(c.data),y(!0);const a=new Set(c.data.map(S=>S.IDFORMATIONM)).size;Q(`${c.data.length} sessions trouv√©es pour ${a} formation(s) distincte(s)`,"success")}else throw new Error("Aucun r√©sultat trouv√©.")}catch(c){Q(c.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},Q=(E,v)=>{W(E),M(v),z(!0)},V=()=>{z(!1)},q=u.length,H=o.useMemo(()=>u.reduce((E,v)=>E+(v.NB_PARTICIPANTS||0),0),[u]),O=o.useMemo(()=>new Set(u.map(v=>v.IDFORMATIONM)).size,[u]),L=o.useMemo(()=>{if(!u.length)return{};const v=l.diff(t,"day")>60?"month":"day",i={};u.forEach(S=>{const R=ze(S.DATE);let b;v==="month"?b=R.format("MMM YYYY"):b=R.format("DD/MM"),i[b]=(i[b]||0)+1});const c=Object.keys(i),a=Object.values(i);return{chart:{type:"bar",height:300,toolbar:{show:!0,tools:{download:!0,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:!0}}},plotOptions:{bar:{borderRadius:4,distributed:!0,columnWidth:v==="month"?"50%":"70%"}},dataLabels:{enabled:!1},xaxis:{categories:c,labels:{rotate:v==="month"?0:-45,style:{fontSize:"12px"}}},yaxis:{title:{text:"Nombre de sessions",style:{fontSize:"12px"}},labels:{style:{fontSize:"11px"}}},colors:a.map((S,R)=>R%2===0?"#2196f3":"#1976d2"),grid:{borderColor:"#f0f0f0",strokeDashArray:3},tooltip:{y:{formatter:function(S){return S+" session(s)"}}},legend:{show:!1}}},[u,t,l]),T=o.useMemo(()=>{if(!u.length)return[];const v=l.diff(t,"day")>60?"month":"day",i={};return u.forEach(c=>{const a=ze(c.DATE);let S;v==="month"?S=a.format("MMM YYYY"):S=a.format("DD/MM"),i[S]=(i[S]||0)+1}),[{name:"Sessions",data:Object.values(i)}]},[u,t,l]);return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:800,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(G,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Statistiques des Sessions de Formation par P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Visualisez les sessions de formation r√©alis√©es sur une p√©riode donn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsx(Ae,{dateAdapter:er,children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:t,onChange:E=>n(E),format:"DD/MM/YYYY",enableAccessibleFieldDOMStructure:!1,slotProps:{textField:{fullWidth:!0,variant:"outlined",InputProps:{startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:l,onChange:E=>x(E),format:"DD/MM/YYYY",minDate:t,enableAccessibleFieldDOMStructure:!1,slotProps:{textField:{fullWidth:!0,variant:"outlined",InputProps:{startAdornment:e.jsx(U,{color:"action",sx:{mr:1}})},sx:{bgcolor:"#f9f9f9"}}}})})]})}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(di,{onClick:_,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p,children:p?"Traitement...":"Afficher les statistiques"})}),e.jsxs(Se,{open:m,onClose:()=>y(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:4,boxShadow:"0px 12px 36px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"primary.main",display:"flex",justifyContent:"space-between",alignItems:"center",py:2.5,px:3,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(G,{sx:{mr:1.5,fontSize:30,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"primary.main",children:"Statistiques des Sessions de Formation"})]}),e.jsx(de,{onClick:()=>y(!1),size:"small",sx:{bgcolor:"white",color:"primary.main",boxShadow:"0 1px 3px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#ffebee",color:"#d32f2f",transform:"scale(1.05)"}},children:e.jsx(Te,{fontSize:"small"})})]}),e.jsxs(ye,{sx:{px:4,py:3,bgcolor:"#fafafa"},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:3,mb:3,children:[e.jsxs(s,{textAlign:"center",sx:{minWidth:120},children:[e.jsx(ve,{sx:{fontSize:32,color:"primary.main",mb:1}}),e.jsx(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:"Formations"}),e.jsx(r,{variant:"h4",fontWeight:"bold",color:"primary",children:O})]}),e.jsxs(s,{textAlign:"center",sx:{minWidth:120},children:[e.jsx(G,{sx:{fontSize:32,color:"secondary.main",mb:1}}),e.jsx(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:"Sessions"}),e.jsx(r,{variant:"h4",fontWeight:"bold",color:"secondary",children:q})]}),e.jsxs(s,{textAlign:"center",sx:{minWidth:120},children:[e.jsx($e,{sx:{fontSize:32,color:"success.main",mb:1}}),e.jsx(r,{variant:"subtitle1",fontWeight:"600",color:"text.primary",children:"Participants"}),e.jsx(r,{variant:"h4",fontWeight:"bold",color:"success.main",children:H})]}),e.jsx(Y,{icon:e.jsx(U,{fontSize:"small"}),label:`${t.format("DD/MM/YYYY")} ‚Üí ${l.format("DD/MM/YYYY")}`,color:"primary",variant:"outlined",sx:{borderColor:"primary.light",color:"primary.main",fontWeight:500,fontSize:"0.875rem",px:1.5,height:32,alignSelf:"center"}})]}),e.jsx(se,{sx:{my:2.5}}),q>0?e.jsxs(e.Fragment,{children:[e.jsx(oe,{sx:{mb:3,borderRadius:2,boxShadow:2},children:e.jsxs(ie,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,fontWeight:"medium",color:"text.primary",children:["R√©partition des sessions par ",L.xaxis?.categories?.length>12?"mois":"jour"]}),e.jsx(s,{sx:{mt:2},children:e.jsx(Re,{options:L,series:T,type:"bar",height:300})})]})}),e.jsx(oe,{sx:{borderRadius:2,boxShadow:2},children:e.jsxs(ie,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,fontWeight:"medium",color:"text.primary",children:"D√©tails des formations"}),e.jsx(s,{sx:{mt:2,maxHeight:300,overflow:"auto"},children:Array.from(new Set(u.map(E=>E.IDFORMATIONM))).map(E=>{const v=u.filter(c=>c.IDFORMATIONM===E),i=v[0];return e.jsxs(s,{sx:{mb:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(r,{variant:"subtitle1",fontWeight:"600",color:"primary",children:i.INTITULE}),e.jsxs(s,{display:"flex",justifyContent:"space-between",mt:1,children:[e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Sessions: ",v.length]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Participants totaux: ",v.reduce((c,a)=>c+(a.NB_PARTICIPANTS||0),0)]})]})]},E)})})]})})]}):e.jsxs(s,{textAlign:"center",py:5,children:[e.jsx(ce,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(r,{variant:"h6",color:"text.secondary",fontWeight:"medium",children:"Aucune session de formation trouv√©e"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez une autre p√©riode."})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:C,onClose:V,autoHideDuration:5e3,children:e.jsx(ci,{onClose:V,severity:D,iconMapping:{success:e.jsx(G,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:F})})})]})},ui=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),fi=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),mi=J(te)(({theme:t,index:n})=>({backgroundColor:n%2===0?"rgba(102, 104, 105, 0.24)":"rgba(200, 230, 255, 0.8)","&:hover":{backgroundColor:n%2===0?"rgba(200, 230, 255, 0.8)":"rgba(220, 220, 220, 0.8)"}})),hi=J(De)(({theme:t})=>({background:"linear-gradient(to right, rgba(100, 181, 246, 0.2), rgba(30, 136, 229, 0.2))"})),pi=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(""),[p,P]=o.useState(!1),[u,h]=o.useState([]),[m,y]=o.useState(!1),[C,z]=o.useState(!1),[F,W]=o.useState(""),[D,M]=o.useState("success"),[$,_]=o.useState(!1),[Q,V]=o.useState(!1),[q,H]=o.useState(null),[O,L]=o.useState([]),[T,E]=o.useState(!1),[v,i]=o.useState(!1),[c,a]=o.useState([]),[S,R]=o.useState(!1),b="",k=o.useCallback(async()=>{try{E(!0);const re=localStorage.getItem("token"),ge=await ae.get(`${b}/listestructures`,{params:{limit:10},headers:{Authorization:`Bearer ${re}`}});L(ge.data),i(!0)}catch(re){le("Erreur lors du chargement des structures par d√©faut","error"),console.error("Error fetching default structures:",re)}finally{E(!1)}},[b]),w=o.useCallback(tr(async re=>{try{E(!0);const ge=localStorage.getItem("token"),_e=await ae.get(`${b}/listestructures`,{params:{search:re},headers:{Authorization:`Bearer ${ge}`}});L(_e.data)}catch(ge){le("Erreur lors du chargement des structures","error"),console.error("Error fetching structures:",ge)}finally{E(!1)}},300),[b]),I=()=>{_(!0),!v&&O.length===0&&k()},N=()=>{_(!1)};o.useEffect(()=>{l.length>=2?w(l):l.length===0&&$&&!v&&k()},[l,w,k,$,v]);const f=(re,{inputValue:ge})=>{const _e=ge.toLowerCase();return re.filter(Qe=>{const He=Qe.NOMSTRUCTURE?.toLowerCase().includes(_e),Sr=Qe.ABBREVIATION?.toLowerCase().includes(_e);return He||Sr})},g=o.useCallback(async()=>{try{R(!0);const re=localStorage.getItem("token"),ge=await ae.get(`${b}/listepersonnels`,{params:{limit:20},headers:{Authorization:`Bearer ${re}`}});a(ge.data),V(!0)}catch(re){console.error("Error fetching default personnels:",re)}finally{R(!1)}},[b]),B=o.useCallback(tr(async re=>{try{R(!0);const ge=localStorage.getItem("token"),_e=await ae.get(`${b}/listepersonels`,{params:{search:re},headers:{Authorization:`Bearer ${ge}`}});a(_e.data),le("Personnels charg√©s avec succ√®s")}catch(ge){console.error("Error fetching personnels:",ge)}finally{R(!1)}},300),[b]);o.useEffect(()=>{l.length>=2?B(l):l.length===0&&$&&!Q&&g()},[l,B,g,$,Q]);const he=()=>q?`
        WITH RECURSIVE StructuresDescendantes AS (
          SELECT IDSTRUCTURE
          FROM structure
          WHERE IDSTRUCTURE = ${q.IDSTRUCTURE}
          UNION ALL
          SELECT s.IDSTRUCTURE
          FROM structure s
          INNER JOIN StructuresDescendantes sd ON s.IDPARENT = sd.IDSTRUCTURE
        )

        SELECT 
          p.MATRICULE,
          p.NOM,
          p.PRENOM,
          p.NOMMARI,
          p.FONCTION,
          p.TELEPHONE,
          p.GRADE,
          s.NOMSTRUCTURE as Structure,
          fm.INTITULE as Formation,
          sf.DATE as DateFormation,
          sf.LIEU,
          fm.CIBLES
        FROM 
          personel p
        JOIN 
          participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
        JOIN 
          sessionformation sf ON ps.IDSESSION = sf.IDSESSION
        JOIN 
          formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
        JOIN 
          structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
        WHERE 
          p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
          AND sf.CONFIRME=1
        ORDER BY 
          p.NOM, p.PRENOM, sf.DATE DESC;
      `:null,fe=async()=>{if(!q){le("Veuillez s√©lectionner une structure","error");return}const re=he();P(!0);const ge=localStorage.getItem("token");try{const _e=await ae.post(`${b}/personnaliserrequette`,{query:re},{headers:{Authorization:`Bearer ${ge}`}});if(_e.data)h(_e.data),y(!0),le(`${_e.data.length} formations trouv√©es`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(_e){le(_e.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},Ce=()=>{const re=document.getElementById("printable-content"),ge=document.body.innerHTML;document.body.innerHTML=re.innerHTML,window.print(),document.body.innerHTML=ge,window.location.reload()},le=(re,ge)=>{W(re),M(ge),z(!0)},K=()=>{z(!1)},A=re=>re?new Date(re).toLocaleDateString("fr-FR"):"-",X=o.useCallback(()=>{const re=u.reduce((Qe,He)=>{const Sr=`${He.MATRICULE}_${He.NOM}_${He.PRENOM}`;return Qe[Sr]||(Qe[Sr]={personnel:{MATRICULE:He.MATRICULE,NOM:He.NOM,PRENOM:He.PRENOM,FONCTION:He.FONCTION,TELEPHONE:He.TELEPHONE,GRADE:He.GRADE,Structure:He.Structure},formations:[]}),Qe[Sr].formations.push({Formation:He.Formation,DateFormation:He.DateFormation,LIEU:He.LIEU,CIBLES:He.CIBLES}),Qe},{}),ge=Object.entries(re).sort((Qe,He)=>He[1].formations.length-Qe[1].formations.length),_e={};return ge.forEach(([Qe,He])=>{_e[Qe]=He}),_e},[u]);return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:900,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Ir,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Formations par Personnel d'une Structure"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Liste des formations b√©n√©fici√©es par les personnels d'une structure (class√©s par nombre de formations)"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsx(d,{container:!0,spacing:3,children:e.jsx(d,{item:!0,xs:12,children:e.jsx(Ge,{options:O,getOptionLabel:re=>re.NOMSTRUCTURE,value:q,open:$,onOpen:I,onClose:N,onChange:(re,ge)=>{H(ge)},onInputChange:(re,ge)=>{x(ge)},loading:T,filterOptions:f,renderInput:re=>e.jsx(ee,{...re,label:"Rechercher une structure",variant:"outlined",fullWidth:!0,placeholder:"Tapez le nom ou l'abr√©viation de la structure...",InputProps:{...re.InputProps,startAdornment:e.jsx(ue,{color:"action",sx:{mr:1}}),endAdornment:e.jsxs(e.Fragment,{children:[T?e.jsx(xe,{color:"inherit",size:20}):null,re.InputProps.endAdornment]})},sx:{bgcolor:"#f9f9f9"}}),renderOption:(re,ge)=>o.createElement(s,{component:"li",...re,key:ge.IDSTRUCTURE},e.jsx(ue,{sx:{mr:2,color:"action.active"}}),e.jsxs(s,{sx:{flexGrow:1},children:[e.jsx(r,{variant:"body1",children:ge.NOMSTRUCTURE}),ge.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Abr√©viation: ",ge.ABBREVIATION]})]})),noOptionsText:l.length>=2?"Aucune structure trouv√©e":"Tapez au moins 2 caract√®res pour rechercher",loadingText:"Chargement des structures..."})})}),q&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,color:"primary.main"}}),"Structure s√©lectionn√©e:"]}),e.jsx(r,{variant:"h6",sx:{ml:3,mt:1},children:q.NOMSTRUCTURE}),q.ABBREVIATION&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3},children:["Abr√©viation: ",q.ABBREVIATION]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(fi,{onClick:fe,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p||!q,children:p?"Traitement...":"Ex√©cuter la requ√™te"})}),e.jsxs(Se,{open:m,onClose:()=>y(!1),maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Ir,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Formations par Personnel (Class√© par nombre de formations)"})]}),e.jsxs(s,{children:[e.jsx(de,{onClick:Ce,size:"small",sx:{color:"text.secondary",mr:1},title:"Imprimer",children:e.jsx(Xe,{})}),e.jsx(de,{onClick:()=>y(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]})]}),e.jsxs(ye,{sx:{py:3,minHeight:"80vh"},children:[e.jsxs("div",{id:"printable-content",style:{display:"none"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Formations par Personnel d'une Structure (Class√© par nombre de formations)"}),q&&e.jsxs(s,{children:[e.jsxs(r,{variant:"body2",gutterBottom:!0,children:["Structure: ",q.NOMSTRUCTURE]}),q.ABBREVIATION&&e.jsxs(r,{variant:"body2",gutterBottom:!0,children:["Abr√©viation: ",q.ABBREVIATION]}),e.jsxs(r,{variant:"body2",gutterBottom:!0,children:["Nombre de personnels: ",Object.keys(X()).length]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"16px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{padding:"8px",textAlign:"left",borderBottom:"1px solid #ddd"},children:"Matricule"}),e.jsx("th",{style:{padding:"8px",textAlign:"left",borderBottom:"1px solid #ddd"},children:"Nom"}),e.jsx("th",{style:{padding:"8px",textAlign:"left",borderBottom:"1px solid #ddd"},children:"Pr√©nom"}),e.jsx("th",{style:{padding:"8px",textAlign:"left",borderBottom:"1px solid #ddd"},children:"Fonction"}),e.jsx("th",{style:{padding:"8px",textAlign:"left",borderBottom:"1px solid #ddd"},children:"Formation"}),e.jsx("th",{style:{padding:"8px",textAlign:"left",borderBottom:"1px solid #ddd"},children:"Date"}),e.jsx("th",{style:{padding:"8px",textAlign:"left",borderBottom:"1px solid #ddd"},children:"Lieu"})]})}),e.jsx("tbody",{children:Object.entries(X()).map(([re,ge],_e)=>ge.formations.map((Qe,He)=>e.jsxs("tr",{style:{backgroundColor:He%2===0?"#f9f9f9":"white"},children:[He===0&&e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{padding:"8px",borderBottom:"1px solid #ddd"},rowSpan:ge.formations.length,children:ge.personnel.MATRICULE}),e.jsx("td",{style:{padding:"8px",borderBottom:"1px solid #ddd"},rowSpan:ge.formations.length,children:ge.personnel.NOM}),e.jsx("td",{style:{padding:"8px",borderBottom:"1px solid #ddd"},rowSpan:ge.formations.length,children:ge.personnel.PRENOM}),e.jsx("td",{style:{padding:"8px",borderBottom:"1px solid #ddd"},rowSpan:ge.formations.length,children:ge.personnel.FONCTION})]}),e.jsx("td",{style:{padding:"8px",borderBottom:"1px solid #ddd"},children:Qe.Formation?Qe.Formation.toUpperCase():"-"}),e.jsx("td",{style:{padding:"8px",borderBottom:"1px solid #ddd"},children:A(Qe.DateFormation)}),e.jsx("td",{style:{padding:"8px",borderBottom:"1px solid #ddd"},children:Qe.LIEU||"-"})]},`${re}-${He}`)))})]})]}),q&&e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",children:[Object.keys(X()).length," personnels ‚Ä¢"]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Formations suivies par les personnels de la structure (class√©s par nombre de formations) :"}),e.jsx(r,{variant:"subtitle1",color:"text.primary",fontWeight:"bold",children:q.NOMSTRUCTURE})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:q.ABBREVIATION,color:"primary",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",m:1}}),e.jsx("br",{}),e.jsx(Y,{label:`${(u.length/Object.keys(X()).length).toFixed(1)} formations √† moyenne par personne`,color:"secondary",variant:"outlined",size:"small",sx:{fontSize:"0.8rem"}})]})]}),e.jsx(se,{sx:{my:2}}),e.jsx(s,{children:Object.keys(X()).length>0?Object.entries(X()).map(([re,ge],_e)=>e.jsxs(ut,{sx:{mb:1,border:"1px solid #e0e0e0",borderRadius:2},children:[e.jsx(dt,{expandIcon:e.jsx(Dr,{}),sx:{bgcolor:"#fafafa","&:hover":{bgcolor:"#f0f0f0"},borderRadius:"8px 8px 0 0"},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(s,{sx:{display:"flex",alignItems:"center",minWidth:40},children:e.jsx(Y,{label:_e+1,color:"primary",size:"small",sx:{fontWeight:"bold",mr:1}})}),e.jsx(Le,{sx:{mr:2,color:"primary.main"}}),e.jsxs(s,{sx:{flexGrow:1},children:[e.jsxs(r,{variant:"h6",fontWeight:"bold",children:[ge.personnel.NOM," ",ge.personnel.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[ge.personnel.MATRICULE," ‚Ä¢ ",ge.personnel.FONCTION," ‚Ä¢ ",ge.personnel.Structure]})]}),e.jsx(Y,{label:`${ge.formations.length} formation${ge.formations.length>1?"s":""}`,color:ge.formations.length>=5?"success":ge.formations.length>=3?"primary":"default",size:"small",variant:"filled",sx:{fontWeight:"bold"}})]})}),e.jsxs(xt,{sx:{pt:2},children:[e.jsxs(d,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"text.secondary"}}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Grade:"})," ",ge.personnel.GRADE||"-"]})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"text.secondary"}}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"T√©l√©phone:"})," ",ge.personnel.TELEPHONE||"-"]})]})})]}),e.jsx(se,{sx:{mb:2}}),e.jsxs(r,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(ve,{sx:{mr:1,fontSize:18}}),"Formations suivies (",ge.formations.length,")"]}),e.jsx(we,{sx:{border:"1px solid #f0f0f0",borderRadius:1,maxHeight:300},children:e.jsxs(Ue,{size:"small",children:[e.jsx(hi,{children:e.jsxs(te,{sx:{bgcolor:"#f9f9f9"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.9rem"},children:"Formation"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.9rem"},children:"Date"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.9rem"},children:"Lieu"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cibles"})]})}),e.jsx(Be,{children:ge.formations.map((Qe,He)=>e.jsxs(mi,{index:He,hover:!0,children:[e.jsx(j,{sx:{fontWeight:500},children:Qe.Formation?Qe.Formation.toUpperCase():"-"}),e.jsx(j,{children:A(Qe.DateFormation)}),e.jsx(j,{children:Qe.LIEU||"-"}),e.jsx(j,{children:Qe.CIBLES||"-"})]},He))})]})})]})]},re)):e.jsxs(s,{sx:{textAlign:"center",py:4},children:[e.jsx(ce,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucune formation trouv√©e pour les personnels s√©lectionn√©s"})]})})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:C,onClose:K,autoHideDuration:5e3,children:e.jsx(ui,{onClose:K,severity:D,iconMapping:{success:e.jsx(rr,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:F})})})]})},bi=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),gi=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),ji=()=>{const[t,n]=o.useState(""),[l,x]=o.useState([]),[p,P]=o.useState(!1),[u,h]=o.useState(!1),[m,y]=o.useState(""),[C,z]=o.useState("success"),[F,W]=o.useState(!0),[D,M]=o.useState(null),[$,_]=o.useState(!1),[Q,V]=o.useState(0),[q,H]=o.useState(0),[O,L]=o.useState(0),[T,E]=o.useState(0);o.useEffect(()=>{(async()=>{const k=localStorage.getItem("token"),w="";try{const I=await ae.post(`${w}/personnaliserrequette`,{query:`SELECT DISTINCT annee 
                    FROM (
                      SELECT ANNEE1 AS annee FROM formationmodifiable
                      UNION
                      SELECT ANNEE2 AS annee FROM formationmodifiable
                      UNION
                      SELECT ANNEE3 AS annee FROM formationmodifiable
                      UNION
                      SELECT YEAR(DATE) AS annee FROM sessionformation
                    ) AS years 
                    WHERE annee IS NOT NULL
                    ORDER BY annee DESC`},{headers:{Authorization:`Bearer ${k}`}});if(I.data){const N=I.data.map(f=>f.annee).filter(f=>!isNaN(f)&&f!==null).sort((f,g)=>g-f);x(N),N.length>0&&n(N[0])}}catch{c("Erreur lors de la r√©cup√©ration des ann√©es disponibles","error")}finally{W(!1)}})()},[]);const v=async()=>{if(!t){c("Veuillez s√©lectionner une ann√©e","error");return}P(!0),M(null);const b=localStorage.getItem("token"),k="";try{const w=`
        SELECT 
          COUNT(*) AS total,
          SUM(
            CASE 
              WHEN EXISTS (
                SELECT 1 
                FROM sessionformation s 
                WHERE s.IDFORMATION = fm.IDFORMATIONM 
                AND YEAR(s.DATE) = '${t}'
                AND s.CONFIRME = 1
              ) THEN 1 
              ELSE 0 
            END
          ) AS executed
        FROM formationmodifiable fm
        WHERE '${t}' IN (ANNEE1, ANNEE2, ANNEE3)
      `,I=await ae.post(`${k}/personnaliserrequette`,{query:w},{headers:{Authorization:`Bearer ${b}`}});if(I.data&&I.data.length>0){const N=I.data[0],f=N.total||0,g=N.executed||0,B=f-g,he=f>0?Math.round(g/f*100):0;V(f),H(g),E(B),L(he),i(he,f,g),_(!0),c(`Taux d'ex√©cution calcul√© pour ${t}: ${he}%`,"success")}else throw new Error("Aucune donn√©e retourn√©e")}catch(w){c(w.response?.data?.message||"Erreur lors du calcul du taux","error")}finally{P(!1)}},i=(b,k,w)=>{const I=N=>N>=90?"#4CAF50":N>=70?"#2196F3":N>=50?"#FF9800":"#F44336";M({series:[b],options:{chart:{type:"radialBar",height:350,toolbar:{show:!1},background:"transparent"},plotOptions:{radialBar:{startAngle:-90,endAngle:90,hollow:{size:"70%",background:"transparent",margin:0,image:void 0},track:{background:"#f0f0f0",strokeWidth:"100%",margin:0},dataLabels:{name:{show:!1},value:{offsetY:0,fontSize:"48px",fontWeight:700,color:"#333",formatter:function(N){return N+"%"}},total:{show:!0,label:"Taux d'ex√©cution",fontSize:"18px",fontWeight:600,color:"#555",formatter:function(){return""}}}}},fill:{type:"gradient",gradient:{shade:"light",type:"horizontal",gradientToColors:[I(b)],stops:[0,100]}},stroke:{lineCap:"round"},colors:[I(b)],labels:["Taux d'ex√©cution"]}})},c=(b,k)=>{y(b),z(k),h(!0)},a=()=>{h(!1)},S=()=>{_(!1)},R=()=>O>=90?"success":O>=70?"primary":O>=50?"warning":"error";return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(G,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Taux d'Ex√©cution des Formations"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Visualisez le pourcentage de r√©alisation des formations pr√©vues par ann√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,alignItems:"center",justifyContent:"center",children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(Or,{fullWidth:!0,variant:"outlined",children:[e.jsx(Rr,{id:"year-select-label",children:"Ann√©e de formation"}),e.jsx(Tr,{labelId:"year-select-label",value:t,onChange:b=>n(b.target.value),label:"Ann√©e de formation",disabled:F,sx:{bgcolor:"#f9f9f9"},children:F?e.jsxs(ur,{disabled:!0,children:[e.jsx(xe,{size:20}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Chargement des ann√©es..."})]}):l.length>0?l.map(b=>e.jsx(ur,{value:b,children:b},b)):e.jsx(ur,{disabled:!0,children:"Aucune ann√©e disponible"})})]})}),e.jsx(d,{item:!0,xs:12,md:6,sx:{display:"flex",justifyContent:"center"},children:e.jsx(gi,{onClick:v,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p||F||!t,children:p?"Calcul en cours...":"Calculer le taux"})})]}),e.jsxs(Se,{open:$,onClose:S,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{borderRadius:3,overflow:"hidden",bgcolor:"#fafafa"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"#1565c0",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1.5,fontSize:28}}),e.jsxs(r,{variant:"h6",fontWeight:"bold",children:["R√©sultats - Ann√©e ",t]})]}),e.jsx(de,{onClick:S,sx:{color:"#1565c0"},children:e.jsx(Te,{})})]}),e.jsx(ye,{sx:{p:0},children:D&&e.jsxs(s,{sx:{mt:3,textAlign:"center"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:3,flexWrap:"wrap",p:2,bgcolor:"#f5f7ff"},children:[e.jsx(Y,{label:`Total: ${Q}`,color:"info",variant:"outlined",sx:{fontSize:"1rem",fontWeight:600,p:1.5,m:.5,bgcolor:"white"}}),e.jsx(Y,{icon:e.jsx(ft,{}),label:`R√©alis√©es: ${q}`,color:"success",variant:"outlined",sx:{fontSize:"1rem",fontWeight:600,p:1.5,m:.5,bgcolor:"white"}}),e.jsx(Y,{icon:e.jsx(mt,{}),label:`En attente: ${T}`,color:"warning",variant:"outlined",sx:{fontSize:"1rem",fontWeight:600,p:1.5,m:.5,bgcolor:"white"}})]}),e.jsx(s,{sx:{position:"relative",height:"300px",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Re,{options:D.options,series:D.series,type:"radialBar",height:300,width:"100%"})}),e.jsxs(s,{sx:{mt:1,p:3,bgcolor:"white",borderRadius:2,textAlign:"center"},children:[e.jsx(Y,{label:`Taux d'ex√©cution: ${O}%`,color:R(),variant:"filled",sx:{fontSize:"1.2rem",fontWeight:700,p:2,mb:2,color:"white"}}),e.jsxs(r,{variant:"body1",paragraph:!0,children:[e.jsx("strong",{children:q})," formations r√©alis√©es sur ",e.jsx("strong",{children:Q})," pr√©vues"]}),e.jsx(r,{variant:"body2",color:"textSecondary",children:O>=100?"Toutes les formations pr√©vues ont √©t√© r√©alis√©es !":`${T} formations restantes`})]})]})}),e.jsx(zr,{sx:{p:2,bgcolor:"#f5f5f5"},children:e.jsx(me,{onClick:S,variant:"outlined",color:"primary",sx:{borderRadius:2,px:4,py:1},children:"Fermer"})})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:u,onClose:a,autoHideDuration:5e3,children:e.jsx(bi,{onClose:a,severity:C,sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:m})})})]})},Si=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),yi=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Ei=()=>{const[t,n]=o.useState(""),[l,x]=o.useState([]),[p,P]=o.useState(!1),[u,h]=o.useState(!1),[m,y]=o.useState(""),[C,z]=o.useState("success"),[F,W]=o.useState(!0),[D,M]=o.useState(null),[$,_]=o.useState(!1),[Q,V]=o.useState(0),[q,H]=o.useState(0),[O,L]=o.useState(0),[T,E]=o.useState(0),[v,i]=o.useState("");o.useEffect(()=>{(async()=>{const I=localStorage.getItem("token"),N="";try{const f=await ae.post(`${N}/personnaliserrequette`,{query:`SELECT IDPLAN, ANNEE1, ANNEE2, ANNEE3 
                    FROM plantrienal 
                    ORDER BY ANNEE1 DESC`},{headers:{Authorization:`Bearer ${I}`}});f.data&&(x(f.data),f.data.length>0&&n(f.data[0].IDPLAN))}catch{S("Erreur lors de la r√©cup√©ration des plans triennaux","error")}finally{W(!1)}})()},[]);const c=async()=>{if(!t){S("Veuillez s√©lectionner un plan","error");return}P(!0),M(null);const w=localStorage.getItem("token"),I="";try{const N=`
        SELECT 
          COUNT(*) AS total,
          SUM(
            CASE 
              WHEN EXISTS (
                SELECT 1 
                FROM sessionformation s 
                WHERE s.IDFORMATION = fm.IDFORMATIONM
                AND s.CONFIRME=1
              ) THEN 1 
              ELSE 0 
            END
          ) AS executed
        FROM formationmodifiable fm
        WHERE IDPLAN = ${t}
      `,f=await ae.post(`${I}/personnaliserrequette`,{query:N},{headers:{Authorization:`Bearer ${w}`}});if(f.data&&f.data.length>0){const g=f.data[0],B=g.total||0,he=g.executed||0,fe=B-he,Ce=B>0?Math.round(he/B*100):0;V(B),H(he),E(fe),L(Ce);const le=l.find(K=>K.IDPLAN==t);le&&i(`${le.ANNEE1}-${le.ANNEE2}-${le.ANNEE3}`),a(Ce,B,he),_(!0),S("Taux d'ex√©cution calcul√© pour le plan triennal","success")}else throw new Error("Aucune donn√©e retourn√©e")}catch(N){S(N.response?.data?.message||"Erreur lors du calcul du taux","error")}finally{P(!1)}},a=(w,I,N)=>{const f=g=>g>=90?"#66BB6A":g>=70?"#42A5F5":g>=50?"#FFA726":"#EF5350";M({series:[w],options:{chart:{type:"radialBar",height:350,toolbar:{show:!1},background:"transparent"},plotOptions:{radialBar:{startAngle:-90,endAngle:90,hollow:{size:"70%",background:"transparent",margin:0,image:void 0},track:{background:"#f0f0f0",strokeWidth:"100%",margin:0},dataLabels:{name:{show:!1},value:{offsetY:0,fontSize:"48px",fontWeight:700,color:"#333",formatter:function(g){return g+"%"}},total:{show:!0,label:"Taux d'ex√©cution",fontSize:"18px",fontWeight:600,color:"#555",formatter:function(){return""}}}}},fill:{type:"gradient",gradient:{shade:"light",type:"horizontal",gradientToColors:[f(w)],stops:[0,100]}},stroke:{lineCap:"round"},colors:[f(w)],labels:["Taux d'ex√©cution"]}})},S=(w,I)=>{y(w),z(I),h(!0)},R=()=>{h(!1)},b=()=>{_(!1)},k=()=>O>=90?"success":O>=70?"primary":O>=50?"warning":"error";return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Mr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Taux d'Ex√©cution des Plans Triennaux"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"√âvaluez le taux de r√©alisation global d'un plan triennal complet"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,alignItems:"center",justifyContent:"center",children:[e.jsx(d,{item:!0,xs:12,md:8,children:e.jsxs(Or,{fullWidth:!0,variant:"outlined",children:[e.jsx(Rr,{id:"plan-select-label",children:"Plan triennal"}),e.jsx(Tr,{labelId:"plan-select-label",value:t,onChange:w=>n(w.target.value),label:"Plan triennal",disabled:F,sx:{bgcolor:"#f9f9f9"},children:F?e.jsxs(ur,{disabled:!0,children:[e.jsx(xe,{size:20}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Chargement des plans..."})]}):l.length>0?l.map(w=>e.jsxs(ur,{value:w.IDPLAN,children:["Plan ",w.ANNEE1,"-",w.ANNEE2,"-",w.ANNEE3]},w.IDPLAN)):e.jsx(ur,{disabled:!0,children:"Aucun plan disponible"})})]})}),e.jsx(d,{item:!0,xs:12,md:4,sx:{display:"flex",justifyContent:"center"},children:e.jsx(yi,{onClick:c,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p||F||!t,children:p?"Calcul en cours...":"√âvaluer le plan"})})]}),e.jsxs(Se,{open:$,onClose:b,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{borderRadius:3,overflow:"hidden",bgcolor:"#fafafa"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#e3f2fd",color:"#1565c0",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid #bbdefb"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Mr,{sx:{mr:1.5,fontSize:28}}),e.jsx(r,{variant:"h6",fontWeight:"bold",children:"√âvaluation du Plan Triennal"})]}),e.jsx(de,{onClick:b,sx:{color:"#1565c0"},children:e.jsx(Te,{})})]}),e.jsx(ye,{sx:{p:0},children:D&&e.jsxs(s,{sx:{mt:3,textAlign:"center"},children:[e.jsxs(s,{sx:{p:2,bgcolor:"#f5f7ff",borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"h6",fontWeight:"bold",color:"primary",children:["Plan ",v]}),e.jsx(r,{variant:"body2",color:"textSecondary",children:"Taux d'ex√©cution global sur 3 ans"})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:3,flexWrap:"wrap",p:2},children:[e.jsx(Y,{label:`Total: ${Q}`,color:"info",variant:"outlined",sx:{fontSize:"1rem",fontWeight:600,p:1.5,m:.5,bgcolor:"white"}}),e.jsx(Y,{icon:e.jsx(ft,{}),label:`R√©alis√©es: ${q}`,color:"success",variant:"outlined",sx:{fontSize:"1rem",fontWeight:600,p:1.5,m:.5,bgcolor:"white"}}),e.jsx(Y,{icon:e.jsx(mt,{}),label:`En attente: ${T}`,color:"warning",variant:"outlined",sx:{fontSize:"1rem",fontWeight:600,p:1.5,m:.5,bgcolor:"white"}})]}),e.jsx(s,{sx:{position:"relative",height:"180px",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Re,{options:D.options,series:D.series,type:"radialBar",height:300,width:"100%"})}),e.jsxs(s,{sx:{mt:1,p:3,bgcolor:"white",borderRadius:2,textAlign:"center"},children:[e.jsx(Y,{label:`Taux d'ex√©cution: ${O}%`,color:k(),variant:"filled",sx:{fontSize:"1.2rem",fontWeight:700,p:2,mb:2,color:"white"}}),e.jsxs(r,{variant:"body1",paragraph:!0,children:[e.jsx("strong",{children:q})," formations r√©alis√©es sur ",e.jsx("strong",{children:Q})," pr√©vues"]}),e.jsx(r,{variant:"body2",color:"textSecondary",children:O>=100?"Toutes les formations du plan ont √©t√© r√©alis√©es !":`${T} formations restantes √† r√©aliser`})]})]})}),e.jsx(zr,{sx:{p:2,bgcolor:"#f5f5f5"},children:e.jsx(me,{onClick:b,variant:"outlined",color:"primary",sx:{borderRadius:2,px:4,py:1},children:"Fermer"})})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:u,onClose:R,autoHideDuration:5e3,children:e.jsx(Si,{onClose:R,severity:C,sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:m})})})]})},Ii=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Ni=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),vi=({includePasserelles:t=!0})=>{const[n,l]=o.useState([]),[x,p]=o.useState(null),[P,u]=o.useState(""),[h,m]=o.useState(!1),[y,C]=o.useState(ze().subtract(1,"month")),[z,F]=o.useState(ze()),[W,D]=o.useState(!1),[M,$]=o.useState({totalPersonnels:0,personnelsFormes:0,personnelsNonFormes:0,femmesFormees:0,hommesFormes:0,totalFemmes:0,totalHommes:0,pourcentageFormes:0,pourcentageFemmesFormees:0,pourcentageHommesFormes:0}),[_,Q]=o.useState(!1),[V,q]=o.useState(!1),[H,O]=o.useState(""),[L,T]=o.useState("success"),E="";o.useEffect(()=>{v()},[]),o.useEffect(()=>{P.length>=2?v(P):P.length===0&&v()},[P]);const v=async(f="")=>{m(!0);const g=localStorage.getItem("token");try{const B=await ae.get(`${E}/listestructures`,{headers:{Authorization:`Bearer ${g}`},params:f?{search:f}:{}});B.data&&l(B.data)}catch{a("Erreur lors du chargement des structures","error")}finally{m(!1)}},i=()=>{if(!y||!z||!x)return null;const f=y.format("YYYY-MM-DD"),g=z.format("YYYY-MM-DD"),B=t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL";return`
WITH RECURSIVE StructuresDescendantes AS (
    SELECT IDSTRUCTURE
    FROM structure
    WHERE IDSTRUCTURE = ${x.IDSTRUCTURE}
    
    UNION ALL
    
    SELECT s.IDSTRUCTURE
    FROM structure s
    INNER JOIN StructuresDescendantes sd ON s.IDPARENT = sd.IDSTRUCTURE
),

StatsStructure AS (
    SELECT 
        COUNT(DISTINCT p.IDPERSONNEL) as TotalPersonnels,
        SUM(CASE WHEN p.SEXE = 'F√©minin' THEN 1 ELSE 0 END) as TotalFemmes,
        SUM(CASE WHEN p.SEXE = 'Masculin' THEN 1 ELSE 0 END) as TotalHommes
    FROM personel p
    WHERE p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
),

PersonnelsFormes AS (
    SELECT 
        COUNT(DISTINCT p.IDPERSONNEL) as PersonnelsFormes,
        COUNT(DISTINCT CASE WHEN p.SEXE = 'F√©minin' THEN p.IDPERSONNEL END) as FemmesFormees,
        COUNT(DISTINCT CASE WHEN p.SEXE = 'Masculin' THEN p.IDPERSONNEL END) as HommesFormes
    FROM personel p
    JOIN participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
    JOIN sessionformation s ON ps.IDSESSION = s.IDSESSION
    JOIN formationmodifiable fm ON s.IDFORMATION = fm.IDFORMATIONM
    WHERE p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
        AND s.DATE >= '${f}'
        AND s.DATE <= '${g}'
        AND s.CONFIRME=1
        ${B}
)

SELECT 
    (SELECT TotalPersonnels FROM StatsStructure) as TotalPersonnels,
    (SELECT TotalFemmes FROM StatsStructure) as TotalFemmes,
    (SELECT TotalHommes FROM StatsStructure) as TotalHommes,
    COALESCE((SELECT PersonnelsFormes FROM PersonnelsFormes), 0) as PersonnelsFormes,
    COALESCE((SELECT FemmesFormees FROM PersonnelsFormes), 0) as FemmesFormees,
    COALESCE((SELECT HommesFormes FROM PersonnelsFormes), 0) as HommesFormes,
    (SELECT TotalPersonnels FROM StatsStructure) - COALESCE((SELECT PersonnelsFormes FROM PersonnelsFormes), 0) as PersonnelsNonFormes;
    `.trim()},c=async()=>{if(!x){a("Veuillez s√©lectionner une structure","error");return}if(!y){a("Veuillez s√©lectionner une date de d√©but","error");return}if(!z){a("Veuillez s√©lectionner une date de fin","error");return}if(y.isAfter(z)){a("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const f=i();D(!0);const g=localStorage.getItem("token");try{const B=await ae.post(`${E}/personnaliserrequette`,{query:f},{headers:{Authorization:`Bearer ${g}`}});if(B.data&&B.data.length>0){const he=B.data[0],fe=he.TotalPersonnels||0,Ce=he.PersonnelsFormes||0,le=he.TotalFemmes||0,K=he.TotalHommes||0,A=he.FemmesFormees||0,X=he.HommesFormes||0;$({totalPersonnels:fe,personnelsFormes:Ce,personnelsNonFormes:he.PersonnelsNonFormes||0,femmesFormees:A,hommesFormes:X,totalFemmes:le,totalHommes:K,pourcentageFormes:fe>0?(Ce/fe*100).toFixed(1):0,pourcentageFemmesFormees:le>0?(A/le*100).toFixed(1):0,pourcentageHommesFormes:K>0?(X/K*100).toFixed(1):0}),Q(!0),a(`${Ce} personnels form√©s dans la structure s√©lectionn√©e`,"success")}else $({totalPersonnels:0,personnelsFormes:0,personnelsNonFormes:0,femmesFormees:0,hommesFormes:0,totalFemmes:0,totalHommes:0,pourcentageFormes:0,pourcentageFemmesFormees:0,pourcentageHommesFormes:0}),Q(!0),a("Aucune donn√©e trouv√©e pour cette structure sur la p√©riode","info")}catch(B){a(B.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{D(!1)}},a=(f,g)=>{O(f),T(g),q(!0)},S=()=>{q(!1)},R=f=>f?f.format("DD/MM/YYYY"):"-",b=()=>x?x.ABBREVIATION||x.NOMSTRUCTURE:"",k={chart:{type:"pie",height:350},labels:["Personnels Form√©s","Personnels Non Form√©s"],colors:["#4caf50","#f44336"],legend:{position:"bottom"},title:{text:`Taux de formation: ${M.pourcentageFormes}%`,align:"center",style:{fontSize:"16px",fontWeight:"bold"}},dataLabels:{enabled:!0,formatter:function(f,g){return f.toFixed(1)+"%"},style:{fontSize:"14px",fontWeight:"bold"}}},w=[M.personnelsFormes,M.personnelsNonFormes],I={chart:{type:"bar",height:350,toolbar:{show:!1}},colors:["#e91e63","#2196f3","#4caf50","#ff9800"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,offsetY:-20,style:{fontSize:"12px",fontWeight:"bold"}},xaxis:{categories:["Femmes","Hommes"],title:{text:"Genre"}},yaxis:{title:{text:"Effectifs"}},legend:{position:"top"},title:{text:"R√©partition par Genre",align:"center"}},N=[{name:"Total",data:[M.totalFemmes,M.totalHommes]},{name:"Form√©s",data:[M.femmesFormees,M.hommesFormes]}];return e.jsx(Ae,{dateAdapter:er,adapterLocale:"fr",children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(pe,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Effectifs d'une Structure par P√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Analyse des personnels form√©s dans une structure sp√©cifique"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(Ge,{fullWidth:!0,value:x,onChange:(f,g)=>{p(g)},inputValue:P,onInputChange:(f,g)=>{u(g)},options:n,getOptionLabel:f=>f.ABBREVIATION||f.NOMSTRUCTURE,renderOption:(f,g)=>e.jsxs(s,{component:"li",...f,children:[e.jsx(jr,{children:e.jsx(ue,{fontSize:"small"})}),e.jsx(dr,{primary:g.ABBREVIATION||g.NOMSTRUCTURE,secondary:g.ABBREVIATION?g.NOMSTRUCTURE:null})]}),loading:h,loadingText:"Chargement des structures...",noOptionsText:P.length<2?"Tapez au moins 2 caract√®res":"Aucune structure trouv√©e",renderInput:f=>e.jsx(ee,{...f,label:"Structure",variant:"outlined",sx:{bgcolor:"#f9f9f9"},placeholder:"Commencez √† saisir le nom d'une structure...",InputProps:{...f.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(lr,{color:"action"})}),f.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[h?e.jsx(xe,{color:"inherit",size:20}):null,f.InputProps.endAdornment]})}}),isOptionEqualToValue:(f,g)=>f.IDSTRUCTURE===g?.IDSTRUCTURE})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:y,onChange:f=>C(f),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:z,onChange:f=>F(f),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})})]}),(x||y||z)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res d'analyse:"]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16}}),"Structure: ",b()]}),y&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",R(y)]}),z&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",R(z)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Ni,{onClick:c,startIcon:W?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:W||!x||!y||!z,children:W?"Analyse...":"Analyser les effectifs"})}),e.jsxs(Se,{open:_,onClose:()=>Q(!1),fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(pe,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsxs(r,{variant:"h6",fontWeight:"medium",children:["Effectifs - ",b()]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsx(de,{onClick:()=>Q(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #1976d2",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#1976d2",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#1976d2",children:M.totalPersonnels}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Personnel Total"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(ve,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:M.personnelsFormes}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Form√©s"}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:[M.pourcentageFormes,"% du personnel"]})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#ffebee",borderLeft:"4px solid #f44336",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Le,{sx:{fontSize:48,color:"#f44336",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#f44336",children:M.personnelsNonFormes}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Non Form√©s"})]})})})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"R√©partition Form√©s / Non Form√©s"}),M.totalPersonnels>0&&e.jsx(Re,{options:k,series:w,type:"pie",height:350})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(Z,{sx:{p:3,borderRadius:2,height:"400px"},children:[e.jsx(r,{variant:"h6",sx:{mb:2,textAlign:"center"},children:"R√©partition par Genre"}),M.totalPersonnels>0&&e.jsx(Re,{options:I,series:N,type:"bar",height:350})]})})]}),e.jsxs(s,{sx:{mt:3,p:3,bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsxs(r,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"D√©tail par genre ",!t&&"(sans formations passerelles)"]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{p:2,bgcolor:"white",borderRadius:2},children:[e.jsxs(s,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(We,{sx:{color:"#e91e63",mr:1}}),e.jsx(r,{variant:"subtitle1",fontWeight:"bold",children:"Femmes"})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Total:"}),e.jsx(r,{variant:"h6",fontWeight:"bold",children:M.totalFemmes})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Form√©es:"}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"#4caf50",children:M.femmesFormees})]}),e.jsx(d,{item:!0,xs:12,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Taux de formation: ",e.jsxs("strong",{children:[M.pourcentageFemmesFormees,"%"]})]})})]})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{p:2,bgcolor:"white",borderRadius:2},children:[e.jsxs(s,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(Me,{sx:{color:"#2196f3",mr:1}}),e.jsx(r,{variant:"subtitle1",fontWeight:"bold",children:"Hommes"})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Total:"}),e.jsx(r,{variant:"h6",fontWeight:"bold",children:M.totalHommes})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Form√©s:"}),e.jsx(r,{variant:"h6",fontWeight:"bold",color:"#4caf50",children:M.hommesFormes})]}),e.jsx(d,{item:!0,xs:12,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Taux de formation: ",e.jsxs("strong",{children:[M.pourcentageHommesFormes,"%"]})]})})]})]})})]}),e.jsx(s,{sx:{mt:3},children:e.jsxs(r,{variant:"body1",sx:{lineHeight:1.6},children:[e.jsx("strong",{children:"R√©sum√©:"})," Sur la p√©riode du ",e.jsx("strong",{children:R(y)})," au ",e.jsx("strong",{children:R(z)}),", la structure ",e.jsx("strong",{children:b()})," compte ",e.jsxs("strong",{children:[M.totalPersonnels," personnels"]}),".",M.personnelsFormes>0?e.jsxs(e.Fragment,{children:[" ",e.jsxs("strong",{children:[M.personnelsFormes," personnels (",M.pourcentageFormes,"%)"]})," ont suivi au moins une formation.",M.pourcentageFormes<50?e.jsx("span",{style:{color:"#ff9800"},children:" Le taux de formation reste inf√©rieur √† 50%."}):e.jsx("span",{style:{color:"#4caf50"},children:" Plus de la moiti√© du personnel a √©t√© form√©."})]}):e.jsx("span",{style:{color:"#f44336"},children:" Aucun personnel n'a suivi de formation sur cette p√©riode."})]})})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:V,onClose:S,autoHideDuration:5e3,children:e.jsx(Ii,{onClose:S,severity:L,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:H})})})]})})},Oi=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Ti=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),Ri=({includePasserelles:t=!0})=>{const[n,l]=o.useState(ze().subtract(1,"month")),[x,p]=o.useState(ze()),[P,u]=o.useState(!1),[h,m]=o.useState([]),[y,C]=o.useState(!1),[z,F]=o.useState(!1),[W,D]=o.useState(""),[M,$]=o.useState("success"),[_,Q]=o.useState(0),[V,q]=o.useState(0),H="",O=()=>{if(!n||!x)return null;const S=n.format("YYYY-MM-DD"),R=x.format("YYYY-MM-DD");return`
WITH StructuresParent AS (
    SELECT 
        IDSTRUCTURE,
        NOMSTRUCTURE,
        ABBREVIATION
    FROM structure
    WHERE IDPARENT IS NULL
),

StatsStructures AS (
    SELECT 
        sp.IDSTRUCTURE,
        sp.NOMSTRUCTURE,
        sp.ABBREVIATION,
        COUNT(DISTINCT p.IDPERSONNEL) as TotalPersonnels,
        COUNT(DISTINCT CASE WHEN ps.IDSESSION IS NOT NULL THEN p.IDPERSONNEL END) as PersonnelsFormes
    FROM StructuresParent sp
    LEFT JOIN structure s ON s.IDPARENT = sp.IDSTRUCTURE OR s.IDSTRUCTURE = sp.IDSTRUCTURE
    LEFT JOIN personel p ON p.IDSTRUCTURE = s.IDSTRUCTURE
    LEFT JOIN participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
    LEFT JOIN sessionformation sf ON ps.IDSESSION = sf.IDSESSION
    LEFT JOIN formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
        AND sf.DATE >= '${S}'
        AND sf.DATE <= '${R}'
        AND s2.CONFIRME=1
        ${t?"":"AND fm.TYPEFORMATIONPASSERELLE IS NULL"}
    GROUP BY 
        sp.IDSTRUCTURE, sp.NOMSTRUCTURE, sp.ABBREVIATION
)

SELECT 
    IDSTRUCTURE,
    NOMSTRUCTURE,
    ABBREVIATION,
    COALESCE(TotalPersonnels, 0) as TotalPersonnels,
    COALESCE(PersonnelsFormes, 0) as PersonnelsFormes,
    CASE 
        WHEN COALESCE(TotalPersonnels, 0) > 0 
        THEN ROUND((COALESCE(PersonnelsFormes, 0) * 100.0 / COALESCE(TotalPersonnels, 0)), 1)
        ELSE 0 
    END as TauxFormation
FROM StatsStructures
WHERE COALESCE(TotalPersonnels, 0) > 0
ORDER BY PersonnelsFormes DESC;
    `.trim()},L=async()=>{if(!n){T("Veuillez s√©lectionner une date de d√©but","error");return}if(!x){T("Veuillez s√©lectionner une date de fin","error");return}if(n.isAfter(x)){T("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const S=O();u(!0);const R=localStorage.getItem("token");try{const b=await ae.post(`${H}/personnaliserrequette`,{query:S},{headers:{Authorization:`Bearer ${R}`}}),k=Array.isArray(b.data)?b.data:[];if(k.length>0){const w=k.map(f=>({IDSTRUCTURE:f.IDSTRUCTURE||0,NOMSTRUCTURE:f.NOMSTRUCTURE||"",ABBREVIATION:f.ABBREVIATION||"",TotalPersonnels:Number(f.TotalPersonnels)||0,PersonnelsFormes:Number(f.PersonnelsFormes)||0,TauxFormation:Number(f.TauxFormation)||0}));m(w);const I=w.reduce((f,g)=>f+g.PersonnelsFormes,0),N=w.reduce((f,g)=>f+g.TotalPersonnels,0);Q(I),q(N),C(!0),T(`${w.length} structures trouv√©es`,"success")}else m([]),Q(0),q(0),C(!0),T("Aucune structure trouv√©e avec des personnels form√©s","info")}catch(b){console.error("Erreur:",b),T(b.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{u(!1)}},T=(S,R)=>{D(S),$(R),F(!0)},E=()=>{F(!1)},v=S=>S?S.format("DD/MM/YYYY"):"-",i=()=>{try{const S=gr.json_to_sheet(h.map(k=>({Structure:k.ABBREVIATION||k.NOMSTRUCTURE,"Nom complet":k.NOMSTRUCTURE,"Effectif total":k.TotalPersonnels,"Personnels form√©s":k.PersonnelsFormes,"Taux de formation (%)":k.TauxFormation}))),R=gr.book_new();gr.book_append_sheet(R,S,"Structures");const b=`structures_parent_formees_${v(n)}_au_${v(x)}.xlsx`;ht(R,b),T("Donn√©es export√©es avec succ√®s","success")}catch(S){console.error("Erreur export:",S),T("Erreur lors de l'exportation","error")}},c={chart:{type:"bar",height:500,toolbar:{show:!0,tools:{download:!0,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:!0}},animations:{enabled:!0,easing:"easeinout",speed:800}},colors:["#1976d2","#4caf50","#ff9800"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,offsetY:-20,style:{fontSize:"12px",fontWeight:"bold",colors:["#333"]},formatter:function(S){return S!==void 0?S:0}},xaxis:{categories:h.map(S=>S.ABBREVIATION||S.NOMSTRUCTURE),title:{text:"Structures",style:{fontSize:"14px",fontWeight:"bold"}},labels:{rotate:-45,rotateAlways:!0,style:{fontSize:"11px"}}},yaxis:{title:{text:"Nombre de personnels",style:{fontSize:"14px",fontWeight:"bold"}}},legend:{position:"top",horizontalAlign:"center",floating:!1,fontSize:"14px",markers:{width:12,height:12,radius:12}},title:{text:`Personnels form√©s par structure (${v(n)} - ${v(x)})`,align:"center",style:{fontSize:"16px",fontWeight:"bold"}},tooltip:{y:{formatter:function(S,{seriesIndex:R}){return R===2?`${S}%`:S}}}},a=[{name:"Effectif total",data:h.map(S=>S.TotalPersonnels||0)},{name:"Personnels form√©s",data:h.map(S=>S.PersonnelsFormes||0)},{name:"Taux (%)",data:h.map(S=>S.TauxFormation||0)}];return e.jsx(Ae,{dateAdapter:er,adapterLocale:"fr",children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1200,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Wr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Analyse des Structures"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Effectifs des personnels form√©s par structure racine"})]}),e.jsx(Y,{icon:e.jsx(Fe,{}),label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:t?"#e8f5e9":"#fff3e0",borderRadius:2,border:`1px solid ${t?"#4caf50":"#ff9800"}`,display:"flex",alignItems:"center"},children:[e.jsx(Fe,{sx:{mr:1,color:t?"#4caf50":"#ff9800"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t?"Les formations passerelles sont incluses dans cette analyse":"Les formations passerelles sont exclues de cette analyse"})]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:n,onChange:S=>l(S),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:x,onChange:S=>p(S),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})})]}),(n||x)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),n&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",v(n)]}),x&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",v(x)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Ti,{onClick:L,startIcon:P?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:P||!n||!x,children:P?"Analyse...":"Analyser les structures"})}),e.jsxs(Se,{open:y,onClose:()=>C(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(Wr,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Structures - Personnels form√©s"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode du ",v(n)," au ",v(x)]}),e.jsx(Y,{size:"small",label:t?"Avec Passerelles":"Sans Passerelles",color:t?"success":"warning",sx:{mt:.5}})]})]}),e.jsxs(s,{children:[h.length>0&&e.jsx(Cr,{title:"Exporter en Excel",children:e.jsx(de,{onClick:i,sx:{mr:1,color:"primary.main"},children:e.jsx(pt,{})})}),e.jsx(de,{onClick:()=>C(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e3f2fd",borderLeft:"4px solid #1976d2",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(lr,{sx:{fontSize:48,color:"#1976d2",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#1976d2",children:h.length}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Structures"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#e8f5e8",borderLeft:"4px solid #4caf50",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx($e,{sx:{fontSize:48,color:"#4caf50",mb:1}}),e.jsx(r,{variant:"h3",fontWeight:"bold",color:"#4caf50",children:_}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Total personnels form√©s"})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{bgcolor:"#fff3e0",borderLeft:"4px solid #ff9800",height:"100%"},children:e.jsxs(ie,{sx:{textAlign:"center"},children:[e.jsx(Ze,{sx:{fontSize:48,color:"#ff9800",mb:1}}),e.jsxs(r,{variant:"h3",fontWeight:"bold",color:"#ff9800",children:[V>0?(_/V*100).toFixed(1):0,"%"]}),e.jsx(r,{variant:"body1",color:"text.secondary",fontWeight:"medium",children:"Taux global moyen"})]})})})]}),h.length>0&&e.jsx(Z,{sx:{p:3,borderRadius:2,mb:4},children:e.jsx(Re,{options:c,series:a,type:"bar",height:500})}),h.length>0&&e.jsx(we,{component:Z,sx:{borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsxs(Ue,{children:[e.jsx(De,{sx:{bgcolor:"#f5f5f5"},children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold"},children:"Structure"}),e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center"},children:"Effectif total"}),e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center"},children:"Personnels form√©s"}),e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center"},children:"Taux (%)"})]})}),e.jsx(Be,{children:h.map(S=>e.jsxs(te,{hover:!0,children:[e.jsx(j,{children:e.jsxs(s,{children:[e.jsx(r,{variant:"body1",fontWeight:"500",children:S.ABBREVIATION||S.NOMSTRUCTURE}),S.ABBREVIATION&&S.NOMSTRUCTURE&&e.jsx(r,{variant:"caption",color:"text.secondary",children:S.NOMSTRUCTURE})]})}),e.jsx(j,{align:"center",children:e.jsx(Y,{label:S.TotalPersonnels,variant:"outlined",size:"small"})}),e.jsx(j,{align:"center",children:e.jsx(Y,{label:S.PersonnelsFormes,color:"primary",variant:"filled",size:"small"})}),e.jsx(j,{align:"center",children:e.jsx(Y,{label:`${S.TauxFormation}%`,color:S.TauxFormation>=50?"success":S.TauxFormation>=25?"warning":"default",variant:"filled",size:"small"})})]},S.IDSTRUCTURE))})]})}),h.length===0&&e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,textAlign:"center",bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsx(Fe,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(r,{variant:"h6",color:"text.secondary",children:"Aucune donn√©e trouv√©e pour cette p√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez d'ajuster les dates de recherche"})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:z,onClose:E,autoHideDuration:5e3,children:e.jsx(Oi,{onClose:E,severity:M,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:W})})})]})})},Ai=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Ci=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),ot=[{id:"TYPEFORMATIONPASSERELLE",name:"Centre d'Excellence",color:"#2e7d32"},{id:"TYPEFORMATIONTRANSVERSALLE",name:"Formations Transversales",color:"#ed6c02"},{id:"TYPEFORMATIONSPECIALISATIONFONCTIONEL",name:"Sp√©cialisation Fonctionnelle",color:"#d32f2f"},{id:"TYPEFORMATIONINDIVIDUELLE",name:"Formations Individuelles",color:"#9c27b0"},{id:"TYPEAUTOFORMATION",name:"Auto-Formation",color:"#e65100"}],Di=()=>{const[t,n]=o.useState(ze().subtract(1,"month")),[l,x]=o.useState(ze()),[p,P]=o.useState(!1),[u,h]=o.useState([]),[m,y]=o.useState(!1),[C,z]=o.useState(!1),[F,W]=o.useState(""),[D,M]=o.useState("success"),$="",_=()=>{if(!t||!l)return null;const v=t.format("YYYY-MM-DD"),i=l.format("YYYY-MM-DD");return`
WITH StructuresParent AS (
    SELECT 
        IDSTRUCTURE,
        NOMSTRUCTURE,
        ABBREVIATION
    FROM structure
    WHERE IDPARENT IS NULL
),

FormationsParCategorie AS (
    SELECT 
        sp.IDSTRUCTURE,
        sp.NOMSTRUCTURE,
        sp.ABBREVIATION,
        COUNT(DISTINCT CASE WHEN fm.TYPEFORMATIONPASSERELLE = 1 THEN ps.IDPERSONNEL END) as CentreExcellence,
        COUNT(DISTINCT CASE WHEN fm.TYPEFORMATIONTRANSVERSALLE = 1 THEN ps.IDPERSONNEL END) as Transversales,
        COUNT(DISTINCT CASE WHEN fm.TYPEFORMATIONSPECIALISATIONFONCTIONEL = 1 THEN ps.IDPERSONNEL END) as Specialisation,
        COUNT(DISTINCT CASE WHEN fm.TYPEFORMATIONINDIVIDUELLE = 1 THEN ps.IDPERSONNEL END) as Individuelles,
        COUNT(DISTINCT CASE WHEN fm.TYPEAUTOFORMATION = 1 THEN ps.IDPERSONNEL END) as Autoformation
    FROM StructuresParent sp
    LEFT JOIN structure s ON s.IDPARENT = sp.IDSTRUCTURE OR s.IDSTRUCTURE = sp.IDSTRUCTURE
    LEFT JOIN personel p ON p.IDSTRUCTURE = s.IDSTRUCTURE
    LEFT JOIN participer_session ps ON p.IDPERSONNEL = ps.IDPERSONNEL
    LEFT JOIN sessionformation sf ON ps.IDSESSION = sf.IDSESSION
    LEFT JOIN formationmodifiable fm ON sf.IDFORMATION = fm.IDFORMATIONM
        AND sf.DATE >= '${v}'
        AND sf.DATE <= '${i}'
        AND sf.CONFIRME=1
    GROUP BY 
        sp.IDSTRUCTURE, sp.NOMSTRUCTURE, sp.ABBREVIATION
)

SELECT 
    IDSTRUCTURE,
    NOMSTRUCTURE,
    ABBREVIATION,
    COALESCE(CentreExcellence, 0) as CentreExcellence,
    COALESCE(Transversales, 0) as Transversales,
    COALESCE(Specialisation, 0) as Specialisation,
    COALESCE(Individuelles, 0) as Individuelles,
    COALESCE(Autoformation, 0) as Autoformation,
    (COALESCE(CentreExcellence, 0) + 
     COALESCE(Transversales, 0) + 
     COALESCE(Specialisation, 0) + 
     COALESCE(Individuelles, 0) + 
     COALESCE(Autoformation, 0)) as TotalFormations
FROM FormationsParCategorie
WHERE (COALESCE(CentreExcellence, 0) + 
       COALESCE(Transversales, 0) + 
       COALESCE(Specialisation, 0) + 
       COALESCE(Individuelles, 0) + 
       COALESCE(Autoformation, 0)) > 0
ORDER BY TotalFormations DESC;
    `.trim()},Q=async()=>{if(!t){V("Veuillez s√©lectionner une date de d√©but","error");return}if(!l){V("Veuillez s√©lectionner une date de fin","error");return}if(t.isAfter(l)){V("La date de d√©but doit √™tre ant√©rieure √† la date de fin","error");return}const v=_();P(!0);const i=localStorage.getItem("token");try{const c=await ae.post(`${$}/personnaliserrequette`,{query:v},{headers:{Authorization:`Bearer ${i}`}}),a=Array.isArray(c.data)?c.data:[];if(a.length>0){const S=a.map(R=>({IDSTRUCTURE:R.IDSTRUCTURE||0,NOMSTRUCTURE:R.NOMSTRUCTURE||"",ABBREVIATION:R.ABBREVIATION||"",CentreExcellence:Number(R.CentreExcellence)||0,Transversales:Number(R.Transversales)||0,Specialisation:Number(R.Specialisation)||0,Individuelles:Number(R.Individuelles)||0,Autoformation:Number(R.Autoformation)||0,TotalFormations:Number(R.TotalFormations)||0}));h(S),y(!0),V(`${S.length} structures parent trouv√©es`,"success")}else h([]),y(!0),V("Aucune structure parent trouv√©e avec des formations","info")}catch(c){console.error("Erreur:",c),V(c.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{P(!1)}},V=(v,i)=>{W(v),M(i),z(!0)},q=()=>{z(!1)},H=v=>v?v.format("DD/MM/YYYY"):"-",O=()=>{try{const v=gr.json_to_sheet(u.map(a=>({Structure:a.ABBREVIATION||a.NOMSTRUCTURE,"Nom complet":a.NOMSTRUCTURE,"Centre d'Excellence":a.CentreExcellence,"Formations Transversales":a.Transversales,"Sp√©cialisation Fonctionnelle":a.Specialisation,"Formations Individuelles":a.Individuelles,"Auto-Formation":a.Autoformation,"Total formations":a.TotalFormations}))),i=gr.book_new();gr.book_append_sheet(i,v,"Structures Parent");const c=`structures_parent_formations_par_categorie_${H(t)}_au_${H(l)}.xlsx`;ht(i,c),V("Donn√©es export√©es avec succ√®s","success")}catch(v){console.error("Erreur export:",v),V("Erreur lors de l'exportation","error")}},T=(()=>{const v=u.map(c=>c.ABBREVIATION||c.NOMSTRUCTURE),i=[{name:"Centre d'Excellence",data:u.map(c=>c.CentreExcellence)},{name:"Formations Transversales",data:u.map(c=>c.Transversales)},{name:"Sp√©cialisation Fonctionnelle",data:u.map(c=>c.Specialisation)},{name:"Formations Individuelles",data:u.map(c=>c.Individuelles)},{name:"Auto-Formation",data:u.map(c=>c.Autoformation)}];return{categories:v,series:i}})(),E={chart:{type:"bar",height:500,stacked:!0,toolbar:{show:!0,tools:{download:!0,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:!0}},animations:{enabled:!0,easing:"easeinout",speed:800}},colors:["#2e7d32","#ed6c02","#d32f2f","#9c27b0","#e65100"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4,dataLabels:{position:"top",total:{enabled:!0,style:{fontSize:"13px",fontWeight:"bold"}}}}},dataLabels:{enabled:!0,offsetY:-20,style:{fontSize:"11px",fontWeight:"normal",colors:["#333"]},formatter:function(v){return v>0?v:""}},xaxis:{categories:T.categories,title:{text:"Structures",style:{fontSize:"14px",fontWeight:"bold"}},labels:{rotate:-45,rotateAlways:!0,style:{fontSize:"11px"}}},yaxis:{title:{text:"Nombre de personnels form√©s",style:{fontSize:"14px",fontWeight:"bold"}}},legend:{position:"top",horizontalAlign:"center",floating:!1,fontSize:"13px",markers:{width:12,height:12,radius:12}},title:{text:`R√©partition des formations par cat√©gorie (${H(t)} - ${H(l)})`,align:"center",style:{fontSize:"16px",fontWeight:"bold"}},tooltip:{y:{formatter:function(v){return v+" personne(s)"}}}};return e.jsx(Ae,{dateAdapter:er,adapterLocale:"fr",children:e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1200,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(xr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Analyse des Formations par Cat√©gorie"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"R√©partition des formations par cat√©gorie pour chaque structure parent"})]})]}),e.jsxs(s,{sx:{mb:3,p:2,bgcolor:"#f5f5f5",borderRadius:2,border:"1px solid #e0e0e0",display:"flex",flexWrap:"wrap",gap:2,alignItems:"center"},children:[e.jsxs(r,{variant:"subtitle2",sx:{mr:1},children:[e.jsx(xr,{sx:{fontSize:18,verticalAlign:"middle",mr:.5}}),"Cat√©gories:"]}),ot.map(v=>e.jsx(Y,{label:v.name,size:"small",sx:{bgcolor:v.color,color:"white",fontWeight:500}},v.id))]}),e.jsx(se,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de d√©but",value:t,onChange:v=>n(v),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ne,{label:"Date de fin",value:l,onChange:v=>x(v),slotProps:{textField:{fullWidth:!0,size:"small",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(be,{position:"start",children:e.jsx(U,{color:"action"})})},sx:{bgcolor:"#f9f9f9"}}}})})]}),(t||l)&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#f0f8ff",borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"P√©riode d'analyse:"]}),t&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,mb:.5,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Du: ",H(t)]}),l&&e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1,fontSize:16}}),"Au: ",H(l)]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Ci,{onClick:Q,startIcon:p?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:p||!t||!l,children:p?"Analyse...":"Analyser les formations"})}),e.jsxs(Se,{open:m,onClose:()=>y(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(xr,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Formations par Cat√©gorie - Structures Parent"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["P√©riode du ",H(t)," au ",H(l)]})]})]}),e.jsxs(s,{children:[u.length>0&&e.jsx(Cr,{title:"Exporter en Excel",children:e.jsx(de,{onClick:O,sx:{mr:1,color:"primary.main"},children:e.jsx(pt,{})})}),e.jsx(de,{onClick:()=>y(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]})]}),e.jsxs(ye,{sx:{py:3},children:[u.length>0&&e.jsx(Z,{sx:{p:3,borderRadius:2,mb:4},children:e.jsx(Re,{options:E,series:T.series,type:"bar",height:500})}),u.length>0&&e.jsx(we,{component:Z,sx:{borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsxs(Ue,{children:[e.jsx(De,{sx:{bgcolor:"#f5f5f5"},children:e.jsxs(te,{children:[e.jsx(j,{sx:{fontWeight:"bold"},children:"Structure"}),ot.map(v=>e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center"},children:v.name},v.id)),e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center"},children:"Total"})]})}),e.jsx(Be,{children:u.map(v=>e.jsxs(te,{hover:!0,children:[e.jsx(j,{children:e.jsxs(s,{children:[e.jsx(r,{variant:"body1",fontWeight:"500",children:v.ABBREVIATION||v.NOMSTRUCTURE}),v.ABBREVIATION&&v.NOMSTRUCTURE&&e.jsx(r,{variant:"caption",color:"text.secondary",children:v.NOMSTRUCTURE})]})}),e.jsx(j,{align:"center",children:e.jsx(Y,{label:v.CentreExcellence,size:"small",sx:{bgcolor:"#2e7d32",color:"white",minWidth:40}})}),e.jsx(j,{align:"center",children:e.jsx(Y,{label:v.Transversales,size:"small",sx:{bgcolor:"#ed6c02",color:"white",minWidth:40}})}),e.jsx(j,{align:"center",children:e.jsx(Y,{label:v.Specialisation,size:"small",sx:{bgcolor:"#d32f2f",color:"white",minWidth:40}})}),e.jsx(j,{align:"center",children:e.jsx(Y,{label:v.Individuelles,size:"small",sx:{bgcolor:"#9c27b0",color:"white",minWidth:40}})}),e.jsx(j,{align:"center",children:e.jsx(Y,{label:v.Autoformation,size:"small",sx:{bgcolor:"#e65100",color:"white",minWidth:40}})}),e.jsx(j,{align:"center",children:e.jsx(Y,{label:v.TotalFormations,color:"primary",variant:"filled",size:"small",sx:{minWidth:40}})})]},v.IDSTRUCTURE))})]})}),u.length===0&&e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,textAlign:"center",bgcolor:"#f9f9f9",borderRadius:2},children:[e.jsx(Fe,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(r,{variant:"h6",color:"text.secondary",children:"Aucune donn√©e trouv√©e pour cette p√©riode"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Essayez d'ajuster les dates de recherche"})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:C,onClose:q,autoHideDuration:5e3,children:e.jsx(Ai,{onClose:q,severity:D,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(ce,{fontSize:"inherit"}),info:e.jsx(G,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:F})})})]})})},Fi=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),zi=J(me)(({theme:t})=>({marginTop:t.spacing(2),background:"linear-gradient(to top, rgba(173, 216, 230, 0.47), rgba(173, 216, 230, 0))",color:"blue",border:"2px solid blue",borderRadius:"20px",fontSize:"1.2rem",padding:t.spacing(1.5,4),boxShadow:"inset 0 2px 5px rgba(173, 216, 230, 0.6)",transition:"background-color 0.3s, transform 0.3s",height:"6vh",width:"25vw",textTransform:"none","&:hover":{background:"linear-gradient(to top, rgba(173, 216, 230, 0.7), rgba(173, 216, 230, 0))",transform:"translateY(-2px)"}})),ki=()=>{const[t,n]=o.useState([]),[l,x]=o.useState(null),[p,P]=o.useState(""),[u,h]=o.useState(!1),[m,y]=o.useState(!1),[C,z]=o.useState([]),[F,W]=o.useState(!1),[D,M]=o.useState(!1),[$,_]=o.useState(""),[Q,V]=o.useState("success"),q="";o.useEffect(()=>{H()},[]),o.useEffect(()=>{p.length>=2?H(p):p.length===0&&H()},[p]);const H=async(i="")=>{y(!0);const c=localStorage.getItem("token");try{const a=await ae.get(`${q}/listestructures`,{headers:{Authorization:`Bearer ${c}`},params:i?{search:i}:{}});a.data&&n(a.data)}catch{T("Erreur lors du chargement des structures","error")}finally{y(!1)}},O=()=>l?`
      WITH RECURSIVE StructuresDescendantes AS (
        SELECT IDSTRUCTURE
        FROM structure
        WHERE IDSTRUCTURE = ${l.IDSTRUCTURE}
        
        UNION ALL
        
        SELECT s.IDSTRUCTURE
        FROM structure s
        INNER JOIN StructuresDescendantes sd ON s.IDPARENT = sd.IDSTRUCTURE
      )

      SELECT 
        p.MATRICULE,
        p.NOM,
        p.PRENOM,
        p.FONCTION,
        p.TELEPHONE,
        p.GRADE,
        p.SEXE,
        s.NOMSTRUCTURE as Structure,
        s.ABBREVIATION as StructureAbbreviation
      FROM 
        personel p
      JOIN 
        structure s ON p.IDSTRUCTURE = s.IDSTRUCTURE
      WHERE 
        p.IDSTRUCTURE IN (SELECT IDSTRUCTURE FROM StructuresDescendantes)
      ORDER BY 
        p.NOM, p.PRENOM;
    `:null,L=async()=>{if(!l){T("Veuillez s√©lectionner une structure","error");return}const i=O();h(!0);const c=localStorage.getItem("token");try{const a=await ae.post(`${q}/personnaliserrequette`,{query:i},{headers:{Authorization:`Bearer ${c}`}});if(a.data)z(a.data),W(!0),T(`${a.data.length} personnels trouv√©s dans la structure`,"success");else throw new Error("Aucun r√©sultat trouv√©.")}catch(a){T(a.response?.data?.message||"Erreur lors de l'ex√©cution de la requ√™te.","error")}finally{h(!1)}},T=(i,c)=>{_(i),V(c),M(!0)},E=()=>{M(!1)},v=()=>l?l.ABBREVIATION||l.NOMSTRUCTURE:"";return e.jsxs(Z,{elevation:0,sx:{p:4,maxWidth:1e3,mx:"auto",borderRadius:3,bgcolor:"background.paper",boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(rr,{color:"primary",sx:{fontSize:36,mr:2}}),e.jsxs(s,{children:[e.jsx(r,{variant:"h5",fontWeight:"bold",color:"primary",children:"Liste du Personnel par Structure"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Affichage de la liste compl√®te du personnel d'une structure s√©lectionn√©e"})]})]}),e.jsx(se,{sx:{my:3}}),e.jsx(d,{container:!0,spacing:3,children:e.jsx(d,{item:!0,xs:12,children:e.jsx(Ge,{fullWidth:!0,value:l,onChange:(i,c)=>{x(c)},inputValue:p,onInputChange:(i,c)=>{P(c)},options:t,getOptionLabel:i=>i.ABBREVIATION||i.NOMSTRUCTURE,renderOption:(i,c)=>e.jsxs(s,{component:"li",...i,children:[e.jsx(jr,{children:e.jsx(ue,{fontSize:"small"})}),e.jsx(dr,{primary:c.ABBREVIATION||c.NOMSTRUCTURE,secondary:c.ABBREVIATION?c.NOMSTRUCTURE:null})]}),loading:m,loadingText:"Chargement des structures...",noOptionsText:p.length<2?"Tapez au moins 2 caract√®res":"Aucune structure trouv√©e",renderInput:i=>e.jsx(ee,{...i,label:"Structure",variant:"outlined",sx:{bgcolor:"#f9f9f9"},placeholder:"Commencez √† saisir le nom d'une structure...",InputProps:{...i.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(be,{position:"start",children:e.jsx(lr,{color:"action"})}),i.InputProps.startAdornment]}),endAdornment:e.jsxs(e.Fragment,{children:[m?e.jsx(xe,{color:"inherit",size:20}):null,i.InputProps.endAdornment]})}}),isOptionEqualToValue:(i,c)=>i.IDSTRUCTURE===c?.IDSTRUCTURE})})}),l&&e.jsxs(s,{sx:{mt:2,p:2,bgcolor:"#e3f2fd",borderRadius:2,border:"1px solid #90caf9"},children:[e.jsxs(r,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(G,{sx:{mr:1,color:"primary.main"}}),"Crit√®res de recherche:"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{ml:3,display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,fontSize:16}}),"Structure: ",v()]})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(zi,{onClick:L,startIcon:u?e.jsx(xe,{size:20,color:"inherit"}):e.jsx(Oe,{}),disabled:u||!l,children:u?"Traitement...":"Afficher le personnel"})}),e.jsxs(Se,{open:F,onClose:()=>W(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{borderRadius:3,boxShadow:"0px 8px 24px rgba(0, 0, 0, 0.1)"}},children:[e.jsxs(Ee,{sx:{bgcolor:"#f5f5f5",color:"text.primary",display:"flex",justifyContent:"space-between",alignItems:"center",py:2,pr:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(s,{display:"flex",alignItems:"center",children:[e.jsx(rr,{sx:{mr:1.5,fontSize:28,color:"primary.main"}}),e.jsx(r,{variant:"h6",fontWeight:"medium",children:"Liste du Personnel"})]}),e.jsx(de,{onClick:()=>W(!1),size:"small",sx:{color:"text.secondary"},children:e.jsx(Te,{})})]}),e.jsxs(ye,{sx:{py:3},children:[e.jsxs(s,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"medium",sx:{display:"flex",alignItems:"center"},children:[e.jsx(rr,{sx:{mr:1,color:"primary.main"}}),C.length," personnel(s) dans la structure"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:.5,fontSize:16}}),"Structure: ",v()]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(Y,{label:v(),color:"primary",variant:"outlined",icon:e.jsx(ue,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1,mb:1}}),e.jsx("br",{}),e.jsx(Y,{label:`${C.length} personnel(s)`,color:"success",variant:"outlined",icon:e.jsx(rr,{fontSize:"small"}),sx:{fontSize:"0.9rem",fontWeight:500,py:1}})]})]}),e.jsx(se,{sx:{my:2}}),e.jsx(we,{sx:{maxHeight:600,border:"1px solid",borderColor:"#f0f0f0",borderRadius:2},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx(De,{children:e.jsxs(te,{sx:{bgcolor:"#fafafa"},children:[e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem",width:"50px",textAlign:"center"},children:"N¬∞"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Personnel"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Fonction"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Grade"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Contact"}),e.jsx(j,{sx:{fontWeight:"bold",fontSize:"0.95rem"},children:"Structure"})]})}),e.jsx(Be,{children:C.length>0?C.map((i,c)=>e.jsxs(te,{hover:!0,sx:{"&:last-child td":{borderBottom:0}},children:[e.jsx(j,{sx:{fontWeight:"bold",textAlign:"center",color:"text.secondary"},children:c+1}),e.jsx(j,{children:e.jsxs(s,{children:[e.jsxs(r,{variant:"body1",fontWeight:"bold",children:[i.NOM," ",i.PRENOM]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ve,{sx:{mr:.5,fontSize:14}}),i.MATRICULE,i.SEXE&&e.jsx(Y,{label:i.SEXE,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]})]})}),e.jsx(j,{children:e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",fontWeight:"500",children:i.FONCTION||"-"})]})}),e.jsx(j,{children:e.jsx(r,{variant:"body2",children:i.GRADE||"-"})}),e.jsx(j,{children:i.TELEPHONE?e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1,fontSize:16,color:"action.active"}}),e.jsx(r,{variant:"body2",children:i.TELEPHONE})]}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(j,{children:e.jsx(r,{variant:"body2",children:i.StructureAbbreviation||i.Structure})})]},c)):e.jsx(te,{children:e.jsxs(j,{colSpan:6,align:"center",sx:{py:4},children:[e.jsx(rr,{color:"action",sx:{fontSize:40,mb:1}}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucun personnel trouv√© dans cette structure"})]})})})]})}),C.length>0&&e.jsxs(s,{sx:{mt:3,p:2,bgcolor:"#e3f2fd",borderRadius:2,border:"1px solid #90caf9"},children:[e.jsxs(r,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(rr,{sx:{mr:1,fontSize:18,color:"primary.main"}}),"Statistiques pour la structure: ",v()]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Total personnel:"})," ",C.length]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Avec fonction:"})," ",C.filter(i=>i.FONCTION).length]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Avec t√©l√©phone:"})," ",C.filter(i=>i.TELEPHONE).length]})})]})]})]})]}),e.jsx(Ie,{anchorOrigin:{vertical:"top",horizontal:"right"},open:D,onClose:E,autoHideDuration:5e3,children:e.jsx(Fi,{onClose:E,severity:Q,iconMapping:{success:e.jsx(Le,{fontSize:"inherit"}),error:e.jsx(Error,{fontSize:"inherit"})},sx:{boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.05)",borderRadius:2,minWidth:300,bgcolor:"background.paper"},children:e.jsx(r,{fontWeight:500,children:$})})})]})},nt=je.forwardRef(function(n,l){return e.jsx(Ne,{elevation:6,ref:l,...n})}),Pi=J(Z)(({theme:t})=>({marginTop:t.spacing(8),padding:t.spacing(3),borderRadius:"15px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",background:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)"})),Li=J(Bt)(({theme:t})=>({marginBottom:t.spacing(1),borderRadius:"8px",backgroundColor:"white",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",transition:"all 0.3s ease","&:hover":{backgroundColor:"#f0f8ff",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.1)",transform:"translateY(-2px)"}})),Mi=J(Lt)(({theme:t})=>({padding:t.spacing(2),borderRadius:"8px","&:hover":{backgroundColor:"transparent"}})),Wi=J(s)(({theme:t})=>({color:"#1976d2",marginRight:t.spacing(2),display:"flex",alignItems:"center",fontSize:"1.2rem"})),wi=J(s)(({theme:t})=>({color:"#666",marginLeft:"auto",transition:"transform 0.3s ease",".MuiListItemButton-root:hover &":{transform:"translateX(5px)"}})),fr=({title:t,queries:n,onQuerySelect:l,includePasserelles:x})=>{const[p,P]=o.useState(!1),[u,h]=o.useState(null),[m,y]=o.useState({open:!1,message:"",severity:"success"}),C=D=>{h(D),P(!0),l&&l(D)},z=()=>{y(D=>({...D,open:!1}))},F=()=>{P(!1),h("")},W=()=>{const D={includePasserelles:x};switch(u?.id){case 101:return e.jsx(Qt,{});case 102:return e.jsx(Kt,{});case 103:return e.jsx(Gt,{});case 104:return e.jsx(ts,{});case 105:return e.jsx(ns,{});case 106:return e.jsx(cs,{});case 107:return e.jsx(ms,{});case 201:return e.jsx(bs,{});case 202:return e.jsx(Ss,{});case 203:return e.jsx(Is,{});case 301:return e.jsx(Gs,{});case 302:return e.jsx(Ks,{});case 303:return e.jsx(so,{});case 304:return e.jsx(io,{});case 305:return e.jsx(xo,{});case 306:return e.jsx(ho,{});case 307:return e.jsx(jo,{});case 308:return e.jsx(Io,{});case 309:return e.jsx(To,{});case 310:return e.jsx(Co,{});case 311:return e.jsx(Mo,{});case 312:return e.jsx(zo,{});case 401:return e.jsx(Os,{});case 402:return e.jsx(As,{});case 403:return e.jsx(Fs,{});case 404:return e.jsx(Ps,{});case 405:return e.jsx(Ws,{});case 406:return e.jsx(Bs,{});case 407:return e.jsx(Ys,{});case 408:return e.jsx(Qs,{});case 501:return e.jsx(Ho,{...D});case 502:return e.jsx(Uo,{...D});case 503:return e.jsx(mn,{...D});case 504:return e.jsx(xn,{...D});case 505:return e.jsx(ln,{...D});case 506:return e.jsx(on,{...D});case 507:return e.jsx(Jo,{...D});case 508:return e.jsx(Vo,{...D});case 509:return e.jsx(On,{...D});case 510:return e.jsx(In,{...D});case 511:return e.jsx(Sn,{...D});case 512:return e.jsx(bn,{...D});case 513:return e.jsx(rn,{...D});case 514:return e.jsx(Zo,{...D});case 515:return e.jsx(Wn,{...D});case 516:return e.jsx(Pn,{...D});case 517:return e.jsx(Fn,{...D});case 518:return e.jsx(An,{...D});case 519:return e.jsx($n,{...D});case 520:return e.jsx(Vn,{...D});case 521:return e.jsx(Gn,{...D});case 522:return e.jsx(ti,{...D});case 523:return e.jsx(Kn,{...D});case 524:return e.jsx(li,{...D});case 525:return e.jsx(ni,{...D});case 526:return e.jsx(xi,{...D});case 527:return e.jsx(pi,{...D});case 528:return e.jsx(ji,{...D});case 529:return e.jsx(Ei,{...D});case 530:return e.jsx(vi,{...D});case 531:return e.jsx(Ri,{...D});case 532:return e.jsx(Di,{...D});case 601:return e.jsx(ki,{});default:return e.jsxs(s,{sx:{p:3,textAlign:"center"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Configuration de la requ√™te"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:u}),e.jsx(nt,{severity:"info",children:"Cette requ√™te n'a pas encore de composant de configuration sp√©cifique. Le composant sera d√©velopp√© prochainement."})]})}};return e.jsxs(bt,{maxWidth:"lg",children:[e.jsxs(Pi,{elevation:3,children:[e.jsxs(s,{sx:{textAlign:"center",mb:4},children:[e.jsx(r,{variant:"h4",component:"h1",sx:{fontWeight:"bold",color:"#1976d2",mb:1},children:t}),e.jsx(r,{variant:"subtitle1",sx:{color:"#666",fontStyle:"italic"},children:"S√©lectionnez une requ√™te √† configurer"})]}),e.jsx(Ft,{sx:{width:"100%"},children:n.map((D,M)=>e.jsx(Li,{disablePadding:!0,children:e.jsxs(Mi,{onClick:()=>C(D),sx:{display:"flex",alignItems:"center"},children:[e.jsx(Wi,{children:e.jsx(zt,{})}),e.jsx(dr,{primary:D.label,primaryTypographyProps:{variant:"body1",sx:{fontWeight:"500",color:"#333",lineHeight:1.5}}}),e.jsx(wi,{children:e.jsx(kt,{})})]})},M))}),n.length===0&&e.jsx(s,{sx:{textAlign:"center",py:4},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:"Aucune requ√™te disponible pour cette cat√©gorie."})})]}),e.jsxs(Se,{open:p,onClose:F,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"12px",minHeight:"400px"}},children:[e.jsxs(Ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(r,{variant:"h6",component:"h2",sx:{fontWeight:"bold"},children:u?.label||"Requ√™te inconnue"}),e.jsx(de,{onClick:F,sx:{color:"text.secondary"},children:e.jsx(Pt,{})})]}),e.jsx(ye,{sx:{p:0},children:W()}),e.jsx(zr,{sx:{px:3,py:2,borderTop:"1px solid #e0e0e0"},children:e.jsx(me,{onClick:F,color:"primary",variant:"outlined",children:"Fermer"})})]}),e.jsx(Ie,{open:m.open,autoHideDuration:6e3,onClose:z,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(nt,{onClose:z,severity:m.severity,variant:"filled",children:m.message})})]})},Ui=J(Z)(({theme:t})=>({marginTop:t.spacing(4),padding:t.spacing(4),borderRadius:"16px",background:"linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%)",color:"#333",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.08)",minHeight:"60vh",display:"flex",flexDirection:"column",justifyContent:"center"})),it=J(me)(({theme:t})=>({padding:t.spacing(3),borderRadius:"12px",background:"rgba(255, 255, 255, 0.8)",border:"1px solid rgba(173, 216, 230, 0.5)",color:"#2c5aa0",fontSize:"1rem",fontWeight:"600",height:"140px",transition:"all 0.3s ease",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)","&:hover":{background:"rgba(255, 255, 255, 1)",transform:"translateY(-3px)",boxShadow:"0 6px 16px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(173, 216, 230, 0.8)"}})),at=J(s)(({theme:t})=>({fontSize:"2rem",marginBottom:t.spacing(1),color:"#4a90e2"})),Bi=J(me)(({theme:t})=>({position:"absolute",top:20,left:20,zIndex:1e3,color:"#4a90e2",backgroundColor:"rgba(255, 255, 255, 0.95)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",borderRadius:"25px",padding:"8px 16px 8px 12px",textTransform:"none",fontWeight:"600",fontSize:"0.9rem",border:"1px solid rgba(74, 144, 226, 0.2)",transition:"all 0.3s ease",backdropFilter:"blur(10px)","&:hover":{backgroundColor:"rgba(255, 255, 255, 1)",transform:"translateX(-3px)",boxShadow:"0 6px 20px rgba(0, 0, 0, 0.2)",border:"1px solid rgba(74, 144, 226, 0.4)"},"& .MuiButton-startIcon":{marginRight:"6px",transition:"transform 0.3s ease"},"&:hover .MuiButton-startIcon":{transform:"translateX(-2px)"}})),$i=J("div")({minHeight:"100vh",background:"linear-gradient(135deg, #f8fbff 0%, #f0f7ff 100%)",position:"relative"}),Ja=()=>{const[t,n]=o.useState("Menu"),[l,x]=o.useState(null),p=C=>{x(C),console.log("Requ√™te s√©lectionn√©e:",C)},P=({onClick:C,label:z="Retour"})=>e.jsx(Bi,{onClick:C,startIcon:e.jsx(Mt,{}),className:"back-button",children:z}),u=()=>t!=="Menu",h=[{id:501,label:"Effectif et pourcentage brut des personnels form√©s (Brut = le personnel est compt√© autant de fois qu'il a assist√© √† une formation) "},{id:502,label:"Effectif et pourcentage r√©el des personnels form√©s (R√©el = le personnel est compt√© une seule fois malgr√© le nombre de formations assist√©)"},{id:503,label:"Effectif et pourcentage brut des personnels f√©minins form√©s"},{id:504,label:"Effectif et pourcentage r√©el des personnels f√©minins form√©s"},{id:505,label:"Effectif et pourcentage brut des personnels masculins form√©s"},{id:506,label:"Effectif et pourcentage r√©el des personnels masculins form√©s"},{id:507,label:"Effectif et pourcentage brut des personnels form√©s dans les services centraux"},{id:508,label:"Effectif et pourcentage r√©el des personnels form√©s dans les services centraux"},{id:509,label:"Effectif et pourcentage brut des personnels f√©minins form√©s dans les services centraux"},{id:510,label:"Effectif et pourcentage r√©el des personnels f√©minins form√©s dans les services centraux"},{id:511,label:"Effectif et pourcentage brut des personnels masculins form√©s dans les services centraux "},{id:512,label:"Effectif et pourcentage r√©el des personnels masculins form√©s dans les services centraux"},{id:513,label:"Effectif et pourcentage brut des personnels form√©s dans les services d√©concentr√©s"},{id:514,label:"Effectif et pourcentage r√©el des personnels form√©s dans les services d√©concentr√©s"},{id:515,label:"Effectif et pourcentage brut des personnels f√©minins form√©s dans les services d√©concentr√©s"},{id:516,label:"Effectif et pourcentage r√©el des personnels f√©minins form√©s dans les services d√©concentr√©s"},{id:517,label:"Effectif et pourcentage brut des personnels masculins form√©s dans les services d√©concentr√©s"},{id:518,label:"Effectif et pourcentage r√©el des personnels masculins form√©s dans les services d√©concentr√©s"},{id:519,label:"Effectif et pourcentage r√©el des personnels non form√©s "},{id:520,label:"Effectif et pourcentage r√©el des personnels f√©minins non form√©s"},{id:521,label:"Effectif et pourcentage r√©el des personnels masculins non form√©s "},{id:522,label:"Effectif et pourcentage r√©el des personnels f√©minins non form√©s dans les services centraux"},{id:523,label:"Effectif et pourcentage r√©el des personnels masculins non form√©s dans les services centraux"},{id:524,label:"Effectif et pourcentage r√©el des personnels f√©minins non form√©s dans les services d√©concentr√©s"},{id:525,label:"Effectif et pourcentage r√©el des personnels masculins non form√©s dans les services d√©concentr√©s "},{id:526,label:"Nombre de formations r√©alis√©es sur une p√©riode"},{id:527,label:"Nombre individuel de formations par personnel d'une structure"},{id:528,label:"Nombre et taux de r√©alisation du plan de formation annuel"},{id:529,label:"Nombre et taux de r√©alisation du plan de formation triennal"},{id:530,label:"Nombre de personnels form√©s d'une structure"},{id:531,label:"Tableau Recapitulatif des personnels form√©s par structure"},{id:532,label:"Tableau Recapitulatif des personnels form√©s par structure et par type de formation"}],m=()=>e.jsx(bt,{maxWidth:"md",sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh"},children:e.jsx(s,{sx:{position:"relative",width:"100%"},children:e.jsxs(Ui,{elevation:3,children:[e.jsxs(s,{sx:{textAlign:"center",mb:6,position:"relative"},children:[e.jsx(s,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"120px",height:"120px",background:"linear-gradient(135deg, rgba(74, 144, 226, 0.1) 0%, rgba(173, 216, 230, 0.2) 100%)",borderRadius:"50%",zIndex:0,filter:"blur(20px)"}}),e.jsx(s,{sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"80px",height:"80px",background:"linear-gradient(135deg, #4a90e2 0%, #2c5aa0 100%)",borderRadius:"50%",marginBottom:3,boxShadow:"0 8px 25px rgba(44, 90, 160, 0.3)",position:"relative",zIndex:1},children:e.jsx(Lr,{style:{fontSize:"2rem",color:"white"}})}),e.jsx(r,{variant:"h2",component:"h1",sx:{fontWeight:"800",mb:2,background:"linear-gradient(135deg, #2c5aa0 0%, #4a90e2 50%, #67b26f 100%)",backgroundSize:"200% auto",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textFillColor:"transparent",fontSize:{xs:"2.5rem",md:"3.5rem"},lineHeight:1.1,textShadow:"0 4px 15px rgba(0, 0, 0, 0.1)",position:"relative",zIndex:1,animation:"shine 3s ease-in-out infinite alternate","@keyframes shine":{"0%":{backgroundPosition:"0% center"},"100%":{backgroundPosition:"200% center"}}},children:"Statistiques"}),e.jsx(r,{variant:"h4",component:"div",sx:{fontWeight:"300",color:"#4a90e2",fontSize:{xs:"1.5rem",md:"2rem"},letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:1,position:"relative",zIndex:1,"&::after":{content:'""',display:"block",width:"60px",height:"3px",background:"linear-gradient(90deg, #4a90e2, #67b26f)",margin:"8px auto 0",borderRadius:"2px"}},children:"de Formation"}),e.jsx(r,{variant:"h6",sx:{width:"100%",color:"#666",fontStyle:"italic",fontSize:{xs:"1rem",md:"1.25rem"},marginTop:3,padding:"6px",background:"linear-gradient(135deg, #2c5aa042 0%, #4a91e23c 50%, #67b26f39 100%)",borderRadius:"25px",display:"inline-block",border:"1px solid rgba(173, 216, 230, 0.5)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",position:"relative",zIndex:1,animation:"shine 3s ease-in-out infinite alternate","@keyframes shine":{"0%":{backgroundPosition:"0% center"},"100%":{backgroundPosition:"200% center"}}},children:"Choisissez le type de statistiques √† consulter"})]}),e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(it,{fullWidth:!0,onClick:()=>n("StatistiquesAvecPasserelles"),startIcon:e.jsx(at,{children:e.jsx(Lr,{})}),children:e.jsxs(s,{sx:{textAlign:"center"},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:"bold",mb:1,color:"#2c5aa0"},children:"Statistiques globales"}),e.jsx(r,{variant:"body2",sx:{color:"#666",lineHeight:1.4},children:"Statistiques incluant les formations passerelles"})]})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(it,{fullWidth:!0,onClick:()=>n("StatistiquesSansPasserelles"),startIcon:e.jsx(at,{children:e.jsx(Wt,{})}),children:e.jsxs(s,{sx:{textAlign:"center"},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:"bold",mb:1,color:"#2c5aa0"},children:"Statistiques restreintes"}),e.jsx(r,{variant:"body2",sx:{color:"#666",lineHeight:1.4},children:"Statistiques excluant les formations passerelles"})]})})})]}),e.jsx(s,{sx:{mt:4,p:2,backgroundColor:"rgba(255, 255, 255, 0.7)",borderRadius:"8px",border:"1px solid rgba(173, 216, 230, 0.5)"},children:e.jsxs(r,{variant:"body2",sx:{textAlign:"center",color:"#666"},children:[e.jsx("strong",{children:"Note :"})," Les formations passerelles incluent les sessions de formation dispens√©es au Centre d'Excellence"]})})]})})}),y=()=>{switch(t){case"Menu":return e.jsx($r,{onComponentChange:n});case"FormationsTenues":return e.jsx(fr,{title:"Formations R√©alis√©es",queries:[{id:101,label:"Formations r√©alis√©es au profit de la DGB"},{id:102,label:"Formations r√©alis√©es d'une structure"},{id:103,label:"Historique des formations d'une structure"},{id:104,label:"Formations r√©alis√©es par cat√©gorie(s) "},{id:105,label:"Formations improvis√©es"},{id:106,label:"Aper√ßu des formations b√©n√©fici√©es par un(des) personnel(s)"},{id:107,label:"Aper√ßu des Formations Individuelles"}],onQuerySelect:p});case"FormationsNonTenues":return e.jsx(fr,{title:"Formations Non R√©alis√©es",queries:[{id:201,label:"Formations non r√©alis√©es"},{id:202,label:"Formations non r√©alis√©es par structure"},{id:203,label:"Formations non r√©alis√©es par cat√©gorie"}],onQuerySelect:p});case"PersonnelForme":return e.jsx(fr,{title:"Personnels Form√©s",queries:[{id:301,label:"Personnels ayant b√©n√©fici√© d'un minimum donn√© de formations"},{id:302,label:"Personnels d'une structure ayant b√©n√©fici√© d'un minimum donn√© de formations"},{id:303,label:"Personnels f√©minins ayant b√©n√©fici√© d'un minimum donn√© de formations"},{id:304,label:"Personnels masculin ayant b√©n√©fici√© d'un minimum donn√© de formations "},{id:305,label:"Personnels des services centraux ayant b√©n√©fici√© d'un minimum donn√© de formations"},{id:306,label:"Personnels des services d√©concentr√©s ayant b√©n√©fici√© d'un minimum donn√© de formations"},{id:307,label:"Personnels ayant b√©n√©fici√©s d'une formation pr√©cise"},{id:308,label:"Personnels du service Central ayant b√©n√©fici√©s d'une formation pr√©cise"},{id:309,label:"Personnels du Service Deconcentr√© ayant b√©n√©fici√©s d'une formation pr√©cise"},{id:310,label:"Personnels d'une structure ayant b√©n√©fici√© d'une formation pr√©cise "},{id:311,label:"Personnels f√©minin d'une structure ayant b√©n√©fici√©s d'une formation pr√©cise"},{id:312,label:"Personnels masculin d'une structure ayant b√©n√©fici√©s d'une formation pr√©cise"}],onQuerySelect:p});case"PersonnelNonForme":return e.jsx(fr,{title:"Personnels Non Form√©s",queries:[{id:401,label:"Personnels non form√©s"},{id:402,label:"Personnels f√©minins non form√©s"},{id:403,label:"Personnels masculins non form√©s"},{id:404,label:"Personnels non form√©s d'une structure"},{id:405,label:"Personnels f√©minins non form√©s d'une structure"},{id:406,label:"Personnels masculins non form√©s d'une structure"},{id:407,label:"Personnels non form√©s des services centraux"},{id:408,label:"Personnels non form√©s des services d√©concentr√©s"}],onQuerySelect:p});case"StatistiquesFormation":return e.jsx(m,{});case"StatistiquesAvecPasserelles":return e.jsx(fr,{title:"Statistiques de Formation (incluant les formations passerelles)",queries:h,onQuerySelect:p,includePasserelles:!0});case"StatistiquesSansPasserelles":return e.jsx(fr,{title:"Statistiques de Formation (excluant les formations passerelles)",queries:h,onQuerySelect:p,includePasserelles:!1});case"Autre":return e.jsx(fr,{title:"Autres Requ√™tes",queries:[{id:601,label:"Liste simple des personnels d'une structure"},{id:602,label:"Informations suppl√©mentaires ou autres donn√©es pertinentes"}],onQuerySelect:p});default:return e.jsx($r,{onComponentChange:n})}};return e.jsxs($i,{children:[u()&&e.jsx(P,{onClick:()=>{n(t==="StatistiquesAvecPasserelles"||t==="StatistiquesSansPasserelles"?"StatistiquesFormation":"Menu")},label:t==="StatistiquesAvecPasserelles"||t==="StatistiquesSansPasserelles"?"Retour aux statistiques":"Retour"}),y()]})};export{Ja as default};
