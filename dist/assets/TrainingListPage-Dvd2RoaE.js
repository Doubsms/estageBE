import{l as fe,j as e,B as y,s as ge,w as Ce,A as je,T as p,i as Te,C as Re,r as o,D as Ne,Z as Pe,u as we,Y as q,I as xe,z as ae,G as me,H as ye,$ as Le,a0 as Ae,a1 as Me,L as Oe}from"./index-zHPv1lze.js";import{a as ee}from"./index-C3O71W1x.js";import{a as te,D as se}from"./DialogContent-COvIddmc.js";import{D as ne}from"./DialogTitle-CCgKuUmv.js";import{S as Fe}from"./Select-DCG_CkE0.js";import{M as he}from"./MenuItem-D-1uk7AZ.js";import{D as re}from"./DialogActions-CZ9LuKoL.js";import{B as Y}from"./Button-0T1tR8_c.js";import{T as ce}from"./TextField-DNVhVnCv.js";import{F as $e}from"./FormGroup-BSrjtQju.js";import{F as Se}from"./FormControlLabel-D_GYa5-T.js";import{C as ke}from"./Checkbox-BNRiEFgI.js";import{P as Be}from"./Pagination-BeHNtj-4.js";import{R as ze}from"./index-BJqg444i.js";import{d as X}from"./dayjs.min-BzR6NVRV.js";import{P as ue}from"./Print-BhcHkGDV.js";import{C as K}from"./Close-B5GqWx1j.js";import{S as We}from"./Switch-Dv7hQiiI.js";import{G as U}from"./Group-CKNX0Zix.js";import{C as _e}from"./CircularProgress-BHFhENdB.js";import{C as le}from"./CalendarToday-BYxDq_1X.js";import{L as Ue}from"./LocationOn-We7TmFLi.js";import"./OutlinedInput-C5vYvqQm.js";import"./useFormControl-BwsGWz84.js";import"./ButtonGroupButtonContext-BYVHV5Ft.js";import"./FormHelperText-BXMwkblB.js";import"./SwitchBase-CEgujy3G.js";import"./LastPage-aHJdqG80.js";const Ye=fe([e.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),e.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime"),pe=fe(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.89-2-2-2m0 16H5V7h14zm-5.5-6c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5M12 9c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"Preview"),He=ge(Re)(({theme:f})=>({marginBottom:16,borderRadius:12,width:"100%",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1)",transition:"transform 0.2s, box-shadow 0.2s"})),Ge=ge(Te)(({theme:f})=>({width:"100%",borderRadius:12,display:"block",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"scale(1.02)",boxShadow:"0 6px 30px rgba(0, 0, 0, 0.2)"}})),Ve=({trainings:f,onRowClick:S})=>e.jsx(y,{sx:{display:"flex",flexDirection:"column",gap:2,padding:2,width:"100%"},children:f.map(g=>e.jsx(Ge,{onClick:()=>S(g),children:e.jsxs(He,{variant:"outlined",children:[e.jsx(Ce,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",backgroundColor:"rgba(0, 195, 255, 0.08)"},children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(je,{sx:{bgcolor:"#1976d2",marginRight:2},children:[g.title.charAt(0)," "]}),e.jsx(p,{variant:"h6",sx:{fontWeight:"2px"},children:g.title})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs(p,{variant:"body2",color:"textSecondary",sx:{padding:2},children:["Instructeur: ",g.instructor]}),e.jsxs(p,{mt:3,mr:2,variant:"body2",color:"textSecondary",sx:{marginLeft:2},children:["Ann√©e(s): ",g.date," "]})]})]})},g.id))}),qe=({open:f,onClose:S,trainings:g,selectedTrainingId:a,onSelectTraining:v})=>e.jsxs(te,{open:f,onClose:S,children:[e.jsx(ne,{children:"S√©lectionnez une formation"}),e.jsx(se,{children:e.jsxs(Fe,{fullWidth:!0,value:a,onChange:v,displayEmpty:!0,sx:{marginBottom:2},children:[e.jsx(he,{value:"",children:e.jsx("em",{children:"Choisissez une formation"})}),g.map(b=>e.jsx(he,{value:b.id,children:b.title},b.id))]})}),e.jsx(re,{children:e.jsx(Y,{onClick:S,variant:"outlined",color:"secondary",children:"Fermer"})})]}),Ze=({open:f,onClose:S,personnelList:g,selectedPersonnel:a,onSelectPersonnel:v,formationId:b,onProceed:A})=>{const[w,I]=o.useState(""),[R,M]=o.useState(1),[z,W]=o.useState(!1),L=10,O=[...g.filter(r=>`${r.NOM||""} ${r.PRENOM||""} ${r.NOMMARI||""}`.toLowerCase().includes(w.toLowerCase()))].sort((r,D)=>{const _=a.some($=>$.IDPERSONNEL===r.IDPERSONNEL);return(a.some($=>$.IDPERSONNEL===D.IDPERSONNEL)?1:0)-(_?1:0)}),n=O.slice((R-1)*L,R*L),N=async()=>{A()};return e.jsxs(te,{open:f,onClose:S,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:4,boxShadow:6,p:2}},children:[e.jsx(ne,{variant:"h6",fontWeight:"bold",children:"S√©lectionnez le Personnel"}),e.jsxs(se,{children:[e.jsx(ce,{variant:"outlined",placeholder:"Rechercher par nom, pr√©nom ou nom du mari...",size:"small",fullWidth:!0,value:w,onChange:r=>I(r.target.value),sx:{mb:3,"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"#f9f9f9"}}}),e.jsx(y,{sx:{maxHeight:"50vh",overflowY:"auto"},children:e.jsx($e,{children:n.length>0?n.map(r=>{const D=a.some(F=>F.IDPERSONNEL===r.IDPERSONNEL),_=r.NOMMARI!=="null"&&r.NOMMARI?` √âpse. ${r.NOMMARI}`:"";return e.jsxs(y,{children:[e.jsx(Se,{control:e.jsx(ke,{value:r.IDPERSONNEL,checked:D,onChange:F=>{const $=F.target.checked;v(r.IDPERSONNEL,$)},color:"primary"}),label:e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(je,{sx:{bgcolor:D?"success.main":"action.active",mr:2},children:r.PRENOM?r.PRENOM.charAt(0).toUpperCase():r.NOM.charAt(0).toUpperCase()}),e.jsxs(y,{children:[e.jsxs(p,{variant:"subtitle1",fontWeight:D?"bold":"normal",children:[r.NOM," ",r.PRENOM,_]}),e.jsx(p,{variant:"body2",color:"textSecondary",children:r.STRUCTURE_HIERARCHY||"Non d√©finie"})]})]}),sx:{m:0,py:1,px:2,borderRadius:2,"&:hover":{backgroundColor:D?"action.selected":"action.hover"}}}),e.jsx(Ne,{})]},r.IDPERSONNEL)}):e.jsx(p,{variant:"body2",color:"textSecondary",align:"center",mt:2,children:"Aucun r√©sultat trouv√©."})})}),e.jsx(y,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx(Be,{count:Math.ceil(O.length/L),page:R,onChange:(r,D)=>M(D),color:"primary",size:"medium",showFirstButton:!0,showLastButton:!0})})]}),e.jsxs(re,{sx:{justifyContent:"space-between",px:3},children:[e.jsx(Y,{onClick:S,variant:"outlined",color:"secondary",children:"Fermer"}),e.jsxs(Y,{variant:"contained",color:"primary",onClick:N,disabled:a.length===0,children:["Suivant (",a.length,")"]})]})]})},Je="/assets/entete-DIb2VfFt.JPG",be=Pe.forwardRef(({trainingTitle:f,selectedPersonnel:S,startDate:g,endDate:a,location:v,startTime:b,coordination:A,assistedBy:w,moderator:I,experts:R,evaluator:M,secretariat:z,logisticsSupport:W,headerTextFr:L,showEnglish:C},O)=>{const[n,N]=o.useState(""),[r,D]=o.useState(!1),[_,F]=o.useState(""),[$,H]=o.useState(""),G="",Z=s=>s?s.split("/")[0].trim():"",V=Array.isArray(S)?[...S].filter(Boolean).map((s,h)=>({...s,key:s.matricule?`person-${s.matricule}`:`person-${h}`,displayStructure:Z(s.structure)})):[],E=V.filter(s=>s.sexe==="F√©minin"),k=V.filter(s=>s.sexe==="Masculin"),t=E.length>15||k.length>15,d=Math.ceil(E.length/2),c=Math.ceil(k.length/2),j=t?E.slice(0,d):E,i=t?E.slice(d):[],m=t?k.slice(0,c):k,x=t?k.slice(c):[],l={fontWeight:"bold"},u={marginBottom:"2px",lineHeight:"1.1",display:"flex",alignItems:"flex-start"},B={marginRight:"1px"},P={fontWeight:"bold",fontStyle:"italic",marginLeft:"4px"},T=s=>s&&String(s).trim()!=="",Q=new Date(g).toLocaleDateString("fr-FR",{day:"numeric"}),J=new Date(a).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"});new Date(a).toLocaleDateString("en-EN",{year:"numeric",month:"long",day:"numeric"});const ve=new Date().getFullYear().toString().slice(-2),de=o.useCallback(async s=>"",[G]),ie=`${L} ¬´ ${f} ¬ª qui se tiendra du ${Q} au ${J}, √† ${v}${T(b)?` √† partir de ${b}`:""} pr√©cises.`;o.useEffect(()=>{C&&ie&&!n&&de(ie).then(s=>{s&&N(s)})},[C,ie,n,de]),o.useEffect(()=>{C||(N(""),F(""),D(!1))},[C]);const De=(s=>{const h=s.split(" "),Ee=h[0],Ie=h.slice(1).map(oe=>/(\b[A-Z][a-z]*\b|\b[A-Z]+\b|\d+)/.test(oe)?`<strong>${oe}</strong>`:oe).join(" ");return`${Ee} ${Ie}`})(n);return e.jsxs("div",{style:{margin:"8%",fontFamily:"-moz-initial",fontSize:t?"12px":"14px"},ref:O,children:[e.jsx("span",{style:{width:"100vw"},children:e.jsx("img",{src:Je,style:{width:"117%",display:"block",marginTop:"-50px",marginLeft:"-58px"},alt:"En-t√™te"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",width:"100%",marginTop:"15px",marginBottom:"5px"},children:[e.jsxs("div",{children:["N¬∞",ve,"/_______________NS/MINFI/SG/DGB/SDAG/SF"]}),e.jsx("div",{children:"Yaound√© le______________"})]}),e.jsxs("div",{style:{textAlign:"center",lineHeight:"0.5",marginBottom:"15px",marginTop:"25px"},children:[e.jsx("h2",{style:{fontSize:t?"16px":"18px",margin:"4px 4px"},children:"NOTE DE SERVICE"}),e.jsx("span",{style:{fontStyle:"italic",fontSize:t?"14px":"16px",fontWeight:"bold"},children:"SERVICE NOTE"}),e.jsx("h3",{style:{fontSize:t?"16px":"18px",margin:"5px 0"},children:"**********"})]}),e.jsxs("div",{style:{textAlign:"justify",marginBottom:"5px",fontSize:"13px"},children:[L,e.jsxs("span",{style:l,children:[" ¬´ ",f," ¬ª "]})," qui se tiendra du",e.jsxs("span",{style:l,children:[" ",Q," "]})," au ",e.jsxs("span",{style:l,children:[" ",J," "]}),", √†"," ",e.jsx("span",{style:l,children:v}),T(b)?" √† partir de ":""," ",T(b)?e.jsx("span",{style:l,children:b}):"",T(b)?" pr√©cises.":""]}),C&&e.jsx(e.Fragment,{children:r?e.jsx("div",{style:{textAlign:"justify",fontStyle:"italic",marginBottom:"3px",fontSize:"13px",color:"#666"},children:"Traduction en cours..."}):_?e.jsx("div",{style:{textAlign:"justify",fontStyle:"italic",marginBottom:"3px",fontSize:"13px",color:"red"},children:_}):e.jsx("div",{style:{textAlign:"justify",fontStyle:"italic",marginBottom:"3px",fontSize:"13px"},dangerouslySetInnerHTML:{__html:De}})}),e.jsx("div",{style:{fontWeight:"bold"},children:e.jsx("span",{style:{fontWeight:"normal"},children:"Il s'agit de:"})}),E.length>0&&e.jsxs("div",{style:{marginLeft:"15px"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"13px"},children:"Mesdame(s) :"}),t&&e.jsxs("div",{style:{display:"flex",gap:"1px"},children:[e.jsx("div",{style:{flex:1},children:j.map((s,h)=>e.jsxs("div",{style:u,children:[e.jsxs("span",{style:{minWidth:"25px",marginLeft:"13px"},children:[h+1,"."]}),e.jsx("span",{style:B,children:s.fullName||"Nom inconnu"}),s.displayStructure&&e.jsxs("span",{style:P,children:["(",s.displayStructure,")"]})]},`female-col1-${s.key||h}`))}),e.jsx("div",{style:{flex:1},children:i.map((s,h)=>e.jsxs("div",{style:u,children:[e.jsxs("span",{style:{minWidth:"25px",marginLeft:"13px"},children:[d+h+1,"."]}),e.jsx("span",{style:B,children:s.fullName||"Nom inconnu"}),s.displayStructure&&e.jsxs("span",{style:P,children:["(",s.displayStructure,")"]})]},`female-col2-${s.key||h}`))})]}),!t&&e.jsx("div",{style:{marginLeft:"30px"},children:E.map((s,h)=>e.jsxs("div",{style:u,children:[e.jsxs("span",{style:{minWidth:"25px",marginLeft:"13px"},children:[h+1,"."]}),e.jsx("span",{style:B,children:s.fullName||"Nom inconnu"}),s.displayStructure&&e.jsxs("span",{style:P,children:["(",s.displayStructure,")"]})]},`female-single-${s.key||h}`))})]}),k.length>0&&e.jsxs("div",{style:{marginLeft:"15px"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"13px",paddingBottom:"0px"},children:"Messieurs :"}),t&&e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx("div",{style:{flex:1},children:m.map((s,h)=>e.jsxs("div",{style:u,children:[e.jsxs("span",{style:{minWidth:"25px",marginLeft:"13px"},children:[E.length+h+1,"."]}),e.jsx("span",{style:B,children:s.fullName||"Nom inconnu"}),s.displayStructure&&e.jsxs("span",{style:P,children:["(",s.displayStructure,")"]})]},`male-col1-${s.key||h}`))}),e.jsx("div",{style:{flex:1},children:x.map((s,h)=>e.jsxs("div",{style:u,children:[e.jsxs("span",{style:{minWidth:"25px",marginLeft:"13px"},children:[E.length+c+h+1,"."]}),e.jsx("span",{style:B,children:s.fullName||"Nom inconnu"}),s.displayStructure&&e.jsxs("span",{style:P,children:["(",s.displayStructure,")"]})]},`male-col2-${s.key||h}`))})]}),!t&&e.jsx("div",{style:{marginLeft:"30px"},children:k.map((s,h)=>e.jsxs("div",{style:u,children:[e.jsxs("span",{style:{minWidth:"25px",marginLeft:"13px"},children:[E.length+h+1,"."]}),e.jsx("span",{style:B,children:s.fullName||"Nom inconnu"}),s.displayStructure&&e.jsxs("span",{style:P,children:["(",s.displayStructure,")"]})]},`male-single-${s.key||h}`))})]}),e.jsxs("div",{style:{marginTop:"20px",fontSize:t?"13px":"15px",lineHeight:"0.2"},children:[T(A)&&e.jsxs("p",{children:[e.jsx("span",{style:l,children:"Coordination"}),": ",A]}),T(w)&&e.jsxs("p",{children:[e.jsx("span",{style:l,children:"Assist√© par"}),": ",w]}),T(I)&&e.jsxs("p",{children:[e.jsx("span",{style:l,children:"Mod√©rateur"}),": ",I]}),T(R)&&e.jsxs("p",{children:[e.jsx("span",{style:l,children:"Experts"}),": ",R]}),T(M)&&e.jsxs("p",{children:[e.jsx("span",{style:l,children:"√âvaluateur"}),": ",M]}),T(z)&&e.jsxs("p",{children:[e.jsx("span",{style:l,children:"Secr√©tariat technique"}),": ",z]}),T(W)&&e.jsxs("p",{children:[e.jsx("span",{style:l,children:"Appui logistique"}),": ",W]})]})]})}),Qe=({open:f,onClose:S,printRef:g,formData:a,onChange:v,formationId:b,selectedPersonnel:A,trainingTitle:w})=>{const[I,R]=o.useState(a.endDate||""),[M,z]=o.useState(!1),[W,L]=o.useState(!1),[C,O]=o.useState(!1),n=we(),N=o.useRef(!1),r=o.useRef(!1);console.log("Form Data:",a);const D={dates:{title:"Dates et Lieu",icon:e.jsx(le,{}),fields:["startDate","endDate","location","startTime"]},personnel:{title:"Personnel et Coordination",icon:e.jsx(U,{}),fields:["coordination","assistedBy","moderator","experts","evaluator","secretariat","logisticsSupport"]}},_={startDate:{label:"Date de d√©but",icon:e.jsx(le,{fontSize:"small"})},endDate:{label:"Date de fin",icon:e.jsx(le,{fontSize:"small"})},location:{label:"Lieu",icon:e.jsx(Ue,{fontSize:"small"})},startTime:{label:"Heure de d√©but",icon:e.jsx(Ye,{fontSize:"small"})},coordination:{label:"Coordination",icon:e.jsx(U,{fontSize:"small"})},assistedBy:{label:"Assist√© par",icon:e.jsx(U,{fontSize:"small"})},moderator:{label:"Mod√©rateur",icon:e.jsx(U,{fontSize:"small"})},experts:{label:"Experts",icon:e.jsx(U,{fontSize:"small"})},evaluator:{label:"√âvaluateur",icon:e.jsx(U,{fontSize:"small"})},secretariat:{label:"Secr√©tariat technique",icon:e.jsx(U,{fontSize:"small"})},logisticsSupport:{label:"Appui logistique",icon:e.jsx(U,{fontSize:"small"})},headerTextFr:{label:"Texte ent√™te en fran√ßais",icon:null}},F=t=>t==="headerTextFr"?a[t]||"Les personnels dont les noms suivent sont invit√©s √† prendre part au s√©minaire de formation sur le th√®me : ":a[t]||"";o.useEffect(()=>{if(a.startDate&&I){const t=X(a.startDate,"DD/MM/YYYY"),d=X(I,"DD/MM/YYYY");if(!t.isValid()||!d.isValid()){q.error("Une des dates est invalide");return}if(d.isBefore(t)){q.error("La date de fin doit √™tre apr√®s la date de d√©but");return}const c=d.diff(t,"day");v("periode",c)}},[I,a.startDate,v]);const $=()=>{N.current=!1,r.current=!1,z(!0)},H=()=>{z(!1)},G=async()=>{const t=localStorage.getItem("token"),d="";try{const j=(await ee.post(`${d}/creer-session`,{IDFORMATION:b,DATE:a.startDate,LIEU:a.location},{headers:{Authorization:`Bearer ${t}`}})).data.IDSESSION,i=A.map(m=>m.IDPERSONNEL);return await ee.post(`${d}/participer-session`,{IDPERSONNEL:i,IDSESSION:j},{headers:{Authorization:`Bearer ${t}`}}),console.log("‚úÖ Session cr√©√©e et personnels assign√©s avec succ√®s!"),j}catch(c){throw console.error("Erreur lors de la cr√©ation de session:",c),q.error("Erreur lors de la cr√©ation de session"),c}},Z=async()=>{if(r.current){console.log("üõë Demande d√©j√† en cours de traitement, ignore...");return}if(N.current){console.log("üõë Donn√©es d√©j√† envoy√©es avec succ√®s, ignore...");return}r.current=!0,O(!0),console.log("üöÄ D√âBUT de l'envoi des donn√©es...");const t=a.startDate,d=X(t,"DD/MM/YYYY"),c=X(I,"DD/MM/YYYY"),j=a.location,i=I?c.diff(d,"day"):0;console.log(`üìÖ Dates : D√©but: ${t}, Fin: ${I}, Dur√©e: ${i} jour(s), Lieu: ${j}`);const m={IDFORMATIONM:b,PERIODE:i,LIEU:j},x=localStorage.getItem("token"),l="";try{if(console.log("üì§ Envoi des donn√©es de formation (sans date)..."),!(await fetch(`${l}/modifierformations`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify(m)})).ok)throw new Error("Erreur lors de l'envoi des donn√©es √† l'API");console.log("üì§ Cr√©ation de session et assignation des personnels..."),await G(),N.current=!0,console.log("‚úÖ Toutes les donn√©es ont √©t√© envoy√©es avec succ√®s!"),q.success("Session cr√©√©e et donn√©es enregistr√©es avec succ√®s !")}catch(u){throw console.error("‚ùå Erreur compl√®te:",u),N.current=!1,r.current=!1,q.error("Erreur lors de l'envoi des donn√©es."),u}finally{O(!1),r.current=!1}},V=t=>{const d=t.NOMMARI?` √âpse. ${t.NOMMARI}`:"",c=(t.NOM||"").trim().split(" ").filter(x=>x.length>0),j=(t.PRENOM||"").trim().split(" ").filter(x=>x.length>0),i=(x,l)=>{const u=x.join(" "),B=l.join(" ");return`${u} ${B}${d}`.trim()};let m=i(c,j);if(m.length>30&&c.length>2){const x=c.slice(0,2);m=i(x,j)}if(m.length>30&&j.length>2){const x=c.length>2?c.slice(0,2):c,l=j.slice(0,2);m=i(x,l)}return m},E=t=>{const d=_[t];return d?e.jsx(ce,{label:d.label,variant:"outlined",fullWidth:!0,margin:"normal",multiline:t==="headerTextFr",rows:t==="headerTextFr"?4:1,value:t==="endDate"?I:F(t),onChange:c=>{if(t==="endDate"){const j=c.target.value;R(j),v("endDate",j)}else v(t,c.target.value)},type:t==="startDate"||t==="endDate"?"date":"text",InputLabelProps:t==="startDate"||t==="endDate"?{shrink:!0}:{},InputProps:{startAdornment:d.icon&&e.jsx(y,{sx:{mr:1,display:"flex",alignItems:"center"},children:d.icon})},sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:n.palette.primary.main}}}},t):null},k=async()=>{console.log("üîµ onBeforeGetContent appel√©");try{return await Z(),console.log("üü¢ onBeforeGetContent termin√© avec succ√®s"),!0}catch(t){return console.error("üî¥ onBeforeGetContent a √©chou√©:",t),q.error("Erreur lors de la pr√©paration du document"),!1}};return e.jsxs(e.Fragment,{children:[e.jsxs(te,{open:f,onClose:S,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:n.shadows[10]}},children:[e.jsxs(ne,{sx:{backgroundColor:n.palette.grey[100],color:n.palette.text.primary,display:"flex",alignItems:"center",justifyContent:"space-between",py:2,borderBottom:`1px solid ${n.palette.divider}`},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{sx:{mr:1,color:n.palette.primary.main}}),e.jsx(p,{variant:"h6",component:"div",children:"Configuration d'impression"})]}),e.jsx(xe,{onClick:S,sx:{color:n.palette.text.secondary},size:"small",children:e.jsx(K,{})})]}),e.jsxs(se,{sx:{p:3,backgroundColor:n.palette.grey[25]},children:[e.jsxs(ae,{elevation:2,sx:{p:3,mb:3,borderRadius:2,background:"white"},children:[e.jsx(p,{variant:"h6",sx:{mb:2,color:n.palette.primary.main,fontWeight:600,display:"flex",alignItems:"center"},children:"En-t√™te du document"}),E("headerTextFr"),e.jsx(y,{sx:{mt:2,mb:1},children:e.jsx(Se,{control:e.jsx(We,{checked:W,onChange:t=>L(t.target.checked),color:"primary"}),label:e.jsxs(y,{children:[e.jsx(p,{variant:"body2",sx:{fontWeight:500},children:"Afficher √©galement la version anglaise"}),e.jsx(p,{variant:"caption",sx:{color:n.palette.text.secondary,fontStyle:"italic"},children:"(La version anglaise sera g√©n√©r√©e automatiquement si activ√©)"})]}),sx:{"& .MuiFormControlLabel-label":{color:n.palette.text.primary}}})})]}),Object.entries(D).map(([t,d])=>e.jsxs(ae,{elevation:2,sx:{p:3,mb:3,borderRadius:2,background:"white"},children:[e.jsxs(p,{variant:"h6",sx:{mb:2,color:n.palette.primary.main,fontWeight:500,display:"flex",alignItems:"center"},children:[d.icon,e.jsx(y,{sx:{ml:1},children:d.title})]}),e.jsx(me,{container:!0,spacing:2,children:d.fields.map(c=>e.jsx(me,{item:!0,xs:12,md:6,children:E(c)},c))})]},t)),e.jsxs(ae,{elevation:2,sx:{p:3,mb:3,borderRadius:2,background:"#f0f8ff",border:"1px solid #e3f2fd"},children:[e.jsxs(p,{variant:"h6",sx:{mb:2,color:n.palette.primary.main,fontWeight:600,display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1}}),"R√©sum√© des actions"]}),e.jsxs(y,{sx:{pl:2},children:[e.jsxs(p,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Formation :"})," ",w]}),e.jsxs(p,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Personnels s√©lectionn√©s :"})," ",A.length]}),e.jsxs(p,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Date de d√©but :"})," ",a.startDate||"Non d√©finie"]}),e.jsxs(p,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Lieu :"})," ",a.location||"Non d√©fini"]}),e.jsx(p,{variant:"body2",color:"primary",sx:{mt:2,fontStyle:"italic"},children:"Lors de l'impression, une session sera cr√©√©e et les personnels y seront assign√©s."})]})]})]}),e.jsxs(re,{sx:{p:3,backgroundColor:n.palette.grey[25],borderTop:`1px solid ${n.palette.divider}`,gap:2},children:[e.jsx(Y,{onClick:S,variant:"outlined",color:"secondary",startIcon:e.jsx(K,{}),sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:3},children:"Fermer"}),e.jsx(Y,{onClick:$,variant:"contained",color:"primary",startIcon:e.jsx(pe,{}),disabled:!a.startDate||A.length===0,sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:3,boxShadow:n.shadows[1],"&:hover":{boxShadow:n.shadows[2]}},children:"Aper√ßu et impression"})]})]}),e.jsxs(te,{open:M,onClose:H,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2,boxShadow:n.shadows[3],height:"90vh"}},children:[e.jsxs(ne,{sx:{backgroundColor:n.palette.grey[100],color:n.palette.text.primary,display:"flex",alignItems:"center",justifyContent:"space-between",py:2,borderBottom:`1px solid ${n.palette.divider}`},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{sx:{mr:1,color:n.palette.primary.main}}),e.jsx(p,{variant:"h6",component:"div",children:"Aper√ßu avant impression"})]}),e.jsx(xe,{onClick:H,sx:{color:n.palette.text.secondary},size:"small",children:e.jsx(K,{})})]}),e.jsx(se,{sx:{overflow:"auto",height:"calc(90vh - 120px)",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:e.jsx(y,{sx:{transform:"scale(1)",transformOrigin:"top center",width:"150%"},children:e.jsx(be,{ref:g,trainingTitle:w,selectedPersonnel:A.map(t=>({fullName:V(t),matricule:t.MATRICULE,structure:t.STRUCTURE_HIERARCHY||"Non d√©finie",sexe:t.SEXE})),...a,showEnglish:W})})}),e.jsxs(re,{sx:{p:3,backgroundColor:n.palette.grey[25],borderTop:`1px solid ${n.palette.divider}`,gap:2},children:[e.jsx(Y,{onClick:H,variant:"outlined",color:"secondary",startIcon:e.jsx(K,{}),sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:3},children:"Fermer"}),e.jsx(ze,{trigger:()=>e.jsx(Y,{variant:"contained",color:"primary",startIcon:C?e.jsx(e.Fragment,{}):e.jsx(ue,{}),disabled:C,sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:3,boxShadow:n.shadows[1],"&:hover":{boxShadow:n.shadows[2]}},children:C?e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:20,sx:{mr:1}}),"Traitement..."]}):"Confirmer l'impression"}),content:()=>g.current,onBeforeGetContent:k,onAfterPrint:()=>{console.log("üñ®Ô∏è Impression termin√©e"),N.current=!1}})]})]}),e.jsx(ye,{})]})},Xe=Ae({palette:{primary:{main:"#3d5afe"},secondary:{main:"#f44336"},background:{default:"#f5f5f5"}}}),Rt=()=>{const[f,S]=o.useState([]),[g,a]=o.useState([]),[v,b]=o.useState(""),[A,w]=o.useState(!1),[I,R]=o.useState(!1),[M,z]=o.useState(null),[W,L]=o.useState([]),[C,O]=o.useState(""),[n,N]=o.useState(!1),[r,D]=o.useState([]),[_,F]=o.useState(!1),[$,H]=o.useState({headerTextFr:"Les personnels dont les noms suivent sont invit√©s √† prendre part au s√©minaire de formation sur le th√®me : ",headerTextEn:"The staff members whose names follow are invited to participate in the training seminar on the theme : ",startDate:"",location:"",startTime:"",endDate:"",coordination:"",assistedBy:"",moderator:"",experts:"",evaluator:"",secretariat:"",logisticsSupport:""}),G=o.useRef();o.useEffect(()=>{const i=async()=>{F(!0);const x=localStorage.getItem("token"),l="";try{const B=(await ee.get(`${l}/listeformation`,{headers:{Authorization:`Bearer ${x}`}})).data.map(P=>{const T=[P.ANNEE1,P.ANNEE2,P.ANNEE3].filter(J=>J!==null&&J!==""),Q=T.length>0?T.join(", "):"Aucune ann√©e disponible";return{id:P.IDFORMATIONM,title:P.INTITULE,instructor:P.PRESTATAIREPEDAGOGIQUE,date:Q}});S(B),a(B)}catch(u){console.error("Erreur lors de la r√©cup√©ration des formations:",u)}finally{F(!1)}},m=async()=>{const x=localStorage.getItem("token"),l="";try{const u=await ee.get(`${l}/listepersonels`,{headers:{Authorization:`Bearer ${x}`}});D(u.data)}catch(u){console.error("Erreur lors de la r√©cup√©ration du personnel:",u)}};i(),m()},[]),o.useEffect(()=>{const i=f.filter(m=>m.title&&m.title.toLowerCase().includes(v.toLowerCase()));a(i)},[v,f]);const Z=()=>w(!0),V=()=>{w(!1),O("")},E=i=>{const m=i.target.value,x=f.find(l=>l.id===parseInt(m));z(x),O(m),w(!1),R(!0)},k=i=>{z(i),L([]),O(i.id),R(!0)},t=()=>{R(!1),z(null),L([]),H({headerTextFr:"Les personnels dont les noms suivent sont invit√©s au s√©minaire de formation sur le th√®me : ",headerTextEn:"The staff members whose names follow are invited to participate to the training seminar,on the theme",startDate:"",location:"",startTime:"",endDate:"",coordination:"",assistedBy:"",moderator:"",experts:"",evaluator:"",secretariat:"",logisticsSupport:""})},d=(i,m)=>{const x=r.find(l=>l.IDPERSONNEL===i);x&&L(l=>m?[...l,x]:l.filter(u=>u.IDPERSONNEL!==x.IDPERSONNEL))},c=()=>{R(!1),N(!0)},j=(i,m)=>{H(x=>({...x,[i]:m}))};return e.jsxs(Le,{theme:Xe,children:[e.jsx(ye,{style:{color:"#2196F3"}}),e.jsx(Me,{position:"static",sx:{backgroundColor:"transparent",boxShadow:"none"},children:e.jsx(p,{variant:"h5",sx:{width:"95%",marginTop:2,marginBottom:1,fontWeight:"bold",color:"#1a237e",textAlign:"center",fontSize:"2rem"},children:"Formations non effectu√©es"})}),e.jsxs(y,{sx:{padding:2},children:[e.jsx(Y,{variant:"contained",color:"primary",onClick:Z,children:"Initier une Formation"}),e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",marginTop:0},children:e.jsx(ce,{variant:"outlined",placeholder:"Rechercher un titre...",size:"small",sx:{width:"300px"},value:v,onChange:i=>b(i.target.value)})}),e.jsx(Ve,{trainings:g,onRowClick:k}),e.jsx(qe,{open:A,onClose:V,trainings:f,selectedTrainingId:C,onSelectTraining:E}),_&&e.jsx(Oe,{sx:{marginBottom:2}}),e.jsx(Ze,{open:I,onClose:t,personnelList:r,selectedPersonnel:W,onSelectPersonnel:d,onProceed:c,formationId:C}),e.jsx(Qe,{open:n,onClose:()=>N(!1),printRef:G,formData:$,onChange:j,formationId:C,selectedPersonnel:W,trainingTitle:M?M.title:""}),e.jsx("div",{style:{display:"none"},children:e.jsx(be,{ref:G,trainingTitle:M?M.title:"",selectedPersonnel:W.map(i=>({fullName:`${i.NOM||""} ${i.PRENOM||""}${i.NOMMARI?" √âpse. "+i.NOMMARI:""}`,matricule:i.MATRICULE,structure:i.STRUCTUREAUTRE||i.STRUCTURE_HIERARCHY||"Non d√©finie"})),...$})})]})]})};export{Rt as default};
